import{V,a as w,H as p}from"./Panorama-f8ccb1e3.js";import{_ as k}from"./_plugin-vue_export-helper-c27b6911.js";import{o as c,A as m,a as _,b as a,w as o,g as h,m as u,c as f,C as v,J as T,K as C,p as y,t as g,D as P,F as E,B as q,M as x,N as L,f as S,P as B}from"./app-1c141545.js";const M={props:["url","capture"],data(){return{isM3u8:!1,viewer:null,panorama:null,video:null,hls:null,isPlaying:!1,progress:0,disabled:!1,step:2,current_quality:{value:-1,text:"自動"},qualities:[]}},mounted(){this.isM3u8=!!this.url.endsWith("m3u8"),this.initVideoPlayer()},unmounted(){self.video&&self.video.remove(),self.panorama&&self.panorama.dispose(),self.viewer&&self.viewer.dispose()},methods:{async initVideoPlayer(){const e=this,i=this.get_path_url(this.url);e.viewer=new V({container:e.$refs.vp_wrap,controlBar:!1}),e.panorama=new w(i,{}),e.viewer.add(e.panorama);const n=e.panorama.getVideoElement();if(e.isM3u8&&p.isSupported()){console.log("isSuppprted");const s=new p;s.loadSource(i),s.attachMedia(n),console.log("hls.levels",s.levels),console.log("this.hls.current_quality",s.current_quality),s.on(p.Events.MANIFEST_PARSED,function(t,l){e.qualities=[{value:-1,text:"自動"}],s.levels.forEach(function(r,d){e.qualities.push({value:d,text:r.height+"p"}),console.log("self.qualities",e.qualities)})}),s.on(p.Events.LEVEL_SWITCHED,function(t,l){console.log("LEVEL_SWITCHED"),console.log("current-quality-",l.level)}),e.hls=s}else n.canPlayType("application/vnd.apple.mpegurl")&&(n.src=i);n.addEventListener("timeupdate",function(){var s=n.currentTime,t=n.duration;e.progress=s/t*100}),e.video=n},async onPause(){try{await this.video.pause(),this.isPlaying=!1}catch(e){console.log(e)}},async onPlay(){try{await this.video.play(),this.isPlaying=!0}catch(e){console.log(e)}},onRewind(){this.video.currentTime=this.video.currentTime<this.step?0:this.video.currentTime-this.step},onFast(){this.video.currentTime=this.video.duration-this.video.currentTime<this.step?this.video.duration:this.video.currentTime+this.step},onSeekTo(e){const i=e.currentTarget.getBoundingClientRect(),n=e.clientX-i.left,s=i.width,t=n/s*100;this.progress=t;const l=parseInt(t/100*this.video.duration);this.video.currentTime=l},changeQuality(e){return console.log("changeQuality"),this.hls.nextLevel=e,this.current_quality=this.qualities.find(i=>i.value==e),!1}}},b={ref:"vp_wrap",class:"vp_wrap"},I={class:"vp_controls"},N={class:"vp_progress mt-2"};function R(e,i,n,s,t,l){return c(),m("div",b,[_("div",I,[a(S,{justify:"center"},{default:o(()=>[a(h,{cols:"auto",class:"pa-2"},{default:o(()=>[a(u,{density:"comfortable",icon:"mdi-rewind",onClick:l.onRewind},null,8,["onClick"])]),_:1}),a(h,{cols:"auto",class:"pa-2"},{default:o(()=>[t.isPlaying?(c(),f(u,{key:0,density:"comfortable",icon:"mdi-stop",onClick:l.onPause},null,8,["onClick"])):v("",!0),t.isPlaying?v("",!0):(c(),f(u,{key:1,density:"comfortable",icon:"mdi-play",onClick:l.onPlay},null,8,["onClick"]))]),_:1}),a(h,{cols:"auto",class:"pa-2"},{default:o(()=>[a(u,{density:"comfortable",icon:"mdi-fast-forward",onClick:l.onFast},null,8,["onClick"])]),_:1}),t.isM3u8?(c(),f(h,{key:0,cols:"auto",class:"pa-2"},{default:o(()=>[a(T,null,{activator:o(({props:r})=>[a(u,C(r,{width:"80",class:"px-1 text-caption"}),{default:o(()=>[y(g(t.current_quality.text),1)]),_:2},1040)]),default:o(()=>[a(P,null,{default:o(()=>[(c(!0),m(E,null,q(t.qualities,(r,d)=>(c(),f(x,{key:d,value:d},{default:o(()=>[a(L,{class:"text-caption",onClick:D=>l.changeQuality(r.value)},{default:o(()=>[y(g(r.text),1)]),_:2},1032,["onClick"])]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1})):v("",!0)]),_:1}),_("div",N,[a(B,{modelValue:t.progress,"onUpdate:modelValue":i[0]||(i[0]=r=>t.progress=r),height:10,onClick:l.onSeekTo},null,8,["modelValue","onClick"])])])],512)}const A=k(M,[["render",R]]);export{A as T};
