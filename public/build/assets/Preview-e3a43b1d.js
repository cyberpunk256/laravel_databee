import{L as n}from"./leaflet-src-17579372.js";import{P as h}from"./gpx-f365e077.js";import{T as c}from"./ThreeVideoPlayer-511ab330.js";import{M as v}from"./MapLayout-9f658151.js";import{o as d,c as i,w as t,b as s,m as p,u as y,l as w,s as u,q as _,n as g,A as m,a as f,z as V}from"./app-189fa0bd.js";import"./_plugin-vue_export-helper-c27b6911.js";const k=f("div",{id:"map",class:"fix_map"},null,-1),L={class:"vp_content"},b={class:"vp_content"},C={components:{ThreeVideoPlayer:c,Panorama:h},props:["records"],data(){return{map:null,map_default_option:{view:[0,0],pin:[0,0],scale:1},modal:!1,modal_type:1,modal_video_url:null,modal_image_url:null,bounds_sum:new n.LatLngBounds,loaded_gpxs:0,gpxOptions:{async:!0,marker_options:{startIconUrl:!1,endIconUrl:!1,shadowUrl:!1},gpx_options:{joinTrackSegments:!1},polyline_options:{color:"red",weight:5,opacity:.7,lineCap:"round"}}}},mounted(){console.log("thisuser",this.user);const o=this,a=this.user.init_lat&&this.user.init_long?[this.user.init_lat,this.user.init_long]:o.map_default_option.view;o.map_default_option=this.constant.map,o.map=n.map("map").setView(a,o.map_default_option.zoom),n.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://www.osm.org">OpenStreetMap</a>'}).addTo(o.map);for(let l=0;l<o.records.length;l++){const e=o.records[l];if(e.type==1){const r=o.get_path_url(e.gpx_path);new n.GPX(r,this.gpxOptions).on("loaded",o.onGpxLoaded).on("click",function(){o.onShowModal(e)})}else if(e.type==2||e.type==3){const r=e.image_lat&&e.image_long?[e.image_lat,e.image_long]:this.map_default_option.pin;n.marker(r,{draggable:!0}).addTo(o.map).on("click",function(){o.onShowModal(e)}),this.bounds_sum.extend(r),this.loaded_gpxs+=1}}},watch:{loaded_gpxs(o){o==this.records.length}},methods:{onGpxLoaded(o){const a=o.target;this.bounds_sum.extend(a.getBounds()),a.addTo(this.map),this.loaded_gpxs+=1},onShowModal(o){this.modal_type=o.type,o.type==1?(this.modal_video_url=o.media_path,this.modal=!0):(this.modal_image_url=this.get_path_url(o.media_path),this.modal=!0)}}},z=Object.assign(C,{name:"Preview",setup(o){return(a,l)=>(d(),i(v,null,{map:t(()=>[k]),action:t(()=>[s(y(w),{href:"/admin/media",as:"div"},{default:t(()=>[s(p,{icon:"mdi-arrow-left",size:"large"})]),_:1})]),content:t(()=>[a.modal_type==1&&a.modal_video_url?(d(),i(u,{key:0,modelValue:a.modal,"onUpdate:modelValue":l[1]||(l[1]=e=>_(modal)?modal.value=e:null),width:"auto"},{default:t(()=>[s(g,{class:"vp_card"},{default:t(()=>[s(p,{icon:"mdi-close",onClick:l[0]||(l[0]=e=>a.modal=!1),class:"vp_close"}),s(c,{url:a.modal_video_url},null,8,["url"])]),_:1})]),_:1},8,["modelValue"])):m("",!0),a.modal_type==2&&a.modal_image_url?(d(),i(u,{key:1,modelValue:a.modal,"onUpdate:modelValue":l[3]||(l[3]=e=>_(modal)?modal.value=e:null),width:"auto"},{default:t(()=>[s(g,{class:"vp_card"},{default:t(()=>[s(p,{icon:"mdi-close",onClick:l[2]||(l[2]=e=>a.modal=!1),class:"vp_close"}),f("div",L,[a.modal?(d(),i(V,{key:0,"max-width":"1000",contain:"",src:a.modal_image_url},null,8,["src"])):m("",!0)])]),_:1})]),_:1},8,["modelValue"])):m("",!0),a.modal_type==3&&a.modal_image_url?(d(),i(u,{key:2,modelValue:a.modal,"onUpdate:modelValue":l[5]||(l[5]=e=>_(modal)?modal.value=e:null),width:"auto"},{default:t(()=>[s(g,{class:"vp_card"},{default:t(()=>[s(p,{icon:"mdi-close",onClick:l[4]||(l[4]=e=>a.modal=!1),class:"vp_close"}),f("div",b,[a.modal?(d(),i(h,{key:0,url:a.modal_image_url},null,8,["url"])):m("",!0)])]),_:1})]),_:1},8,["modelValue"])):m("",!0)]),_:1}))}});export{z as default};
