import{o as i,c as m,w as n,b as s,m as _,u as B,l as C,s as g,q as f,n as y,C as p,a as h,z as L,L as d}from"./app-69cb1a43.js";import{P as w}from"./Panorama-ffc55234.js";import{T as k}from"./ThreeVideoPlayer-6500243f.js";import{M}from"./MapLayout-d636ac94.js";import"./_plugin-vue_export-helper-c27b6911.js";const S=h("div",{id:"map",class:"fix_map"},null,-1),U={class:"vp_content"},b={class:"vp_content"},T={components:{ThreeVideoPlayer:k,Panorama:w},props:["records"],data(){return{map:null,modal:!1,modal_type:1,modal_video_url:null,modal_image_url:null,bounds_sum:new d.LatLngBounds,gpxOptions:{async:!0,marker_options:{startIconUrl:!1,endIconUrl:!1,shadowUrl:!1},gpx_options:{joinTrackSegments:!1},polyline_options:{color:"blue",weight:12,opacity:1,lineCap:"round"}}}},mounted(){const o=this,a={maxZoom:o.constant.map.max_zoom},e=o.user.init_lat&&o.user.init_long?[o.user.init_lat,o.user.init_long]:o.constant.map.view,t=o.gpxOptions.polyline_options;t.polyline_options.weight=o.getLineWeightByZoom(o.constant.map.zoom,o.constant.map.gpx.weight);const v=o.getMarkerSizeByZoom(o.constant.map.zoom,o.constant.map.marker.size),V=d.icon({iconUrl:o.constant.map.marker.icon,iconSize:[v,v]}),r=d.map("map",a).setView(e,o.constant.map.zoom).on("zoomend",o.onZoomChange);d.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://www.osm.org">OpenStreetMap</a>',maxZoom:o.constant.map.max_zoom}).addTo(r);for(let c=0;c<o.records.length;c++){const l=o.records[c];if(l.type==1){const u=o.get_path_url(l.gpx_path);new d.GPX(u,t).on("loaded",function(z){o.onGpxLoaded(z,r)}).on("click",function(){o.onShowModal(l)})}else if(l.type==2||l.type==3){const u=l.image_lat&&l.image_long?[l.image_lat,l.image_long]:o.constant.map.pin;d.marker(u,{icon:V,draggable:!0}).addTo(r).on("click",function(){o.onShowModal(l)}),o.onFitBounds(r,u)}}o.map=r},methods:{onFitBounds(o,a){let e=o.getBounds();e.extend(a),o.fitBounds(e)},onGpxLoaded(o,a){const e=this,t=o.target;e.onFitBounds(a,t.getBounds()),t.addTo(a)},onShowModal(o){this.modal_type=o.type,o.type==1?(this.modal_video_url=o.media_path,this.modal=!0):(this.modal_image_url=this.get_path_url(o.media_path),this.modal=!0)}}},G=Object.assign(T,{name:"Preview",setup(o){return(a,e)=>(i(),m(M,null,{map:n(()=>[S]),action:n(()=>[s(B(C),{href:"/admin/media",as:"div"},{default:n(()=>[s(_,{icon:"mdi-arrow-left",size:"large"})]),_:1})]),content:n(()=>[a.modal_type==1&&a.modal_video_url?(i(),m(g,{key:0,modelValue:a.modal,"onUpdate:modelValue":e[1]||(e[1]=t=>f(modal)?modal.value=t:null),width:"auto"},{default:n(()=>[s(y,{class:"vp_card"},{default:n(()=>[s(_,{icon:"mdi-close",onClick:e[0]||(e[0]=t=>a.modal=!1),class:"vp_close"}),s(k,{url:a.modal_video_url},null,8,["url"])]),_:1})]),_:1},8,["modelValue"])):p("",!0),a.modal_type==2&&a.modal_image_url?(i(),m(g,{key:1,modelValue:a.modal,"onUpdate:modelValue":e[3]||(e[3]=t=>f(modal)?modal.value=t:null),width:"auto"},{default:n(()=>[s(y,{class:"vp_card"},{default:n(()=>[s(_,{icon:"mdi-close",onClick:e[2]||(e[2]=t=>a.modal=!1),class:"vp_close"}),h("div",U,[a.modal?(i(),m(L,{key:0,"lazy-src":"/empty.png","max-width":"1000",src:a.modal_image_url},null,8,["src"])):p("",!0)])]),_:1})]),_:1},8,["modelValue"])):p("",!0),a.modal_type==3&&a.modal_image_url?(i(),m(g,{key:2,modelValue:a.modal,"onUpdate:modelValue":e[5]||(e[5]=t=>f(modal)?modal.value=t:null),width:"auto"},{default:n(()=>[s(y,{class:"vp_card"},{default:n(()=>[s(_,{icon:"mdi-close",onClick:e[4]||(e[4]=t=>a.modal=!1),class:"vp_close"}),h("div",b,[a.modal?(i(),m(w,{key:0,url:a.modal_image_url},null,8,["url"])):p("",!0)])]),_:1})]),_:1},8,["modelValue"])):p("",!0)]),_:1}))}});export{G as default};
