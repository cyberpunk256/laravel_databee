import{M as c}from"./MapLayout-5ee97da9.js";import{o as d,c as i,w as t,b as s,m as p,u as v,l as y,s as u,p as _,z as n,a as f,y as w}from"./app-be450289.js";import{L as m}from"./leaflet-src-696e8210.js";import{P as g}from"./gpx-f7031f0e.js";import{T as h}from"./ThreeVideoPlayer-98643852.js";import"./_plugin-vue_export-helper-c27b6911.js";const V=f("div",{id:"map",class:"fix_map"},null,-1),k={class:"vp_content"},L={class:"vp_content"},b={components:{ThreeVideoPlayer:h,Panorama:g},props:["records"],data(){return{map:null,map_default_option:{view:[0,0],pin:[0,0],scale:1},modal:!1,modal_type:1,modal_video_url:null,modal_image_url:null,bounds_sum:new m.LatLngBounds,loaded_gpxs:0,gpxOptions:{async:!0,marker_options:{startIconUrl:!1,endIconUrl:!1,shadowUrl:!1},gpx_options:{joinTrackSegments:!1}}}},mounted(){console.log("thisuser",this.user);const o=this,e=this.user.init_lat&&this.user.init_long?[this.user.init_lat,this.user.init_long]:o.map_default_option.view;o.map_default_option=this.constant.map,o.map=m.map("map").setView(e,o.map_default_option.zoom),m.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://www.osm.org">OpenStreetMap</a>'}).addTo(o.map);for(let l=0;l<o.records.length;l++){const a=o.records[l];if(a.type==1){const r=o.get_file_url(a.gpx_path);new m.GPX(r,this.gpxOptions).on("loaded",o.onGpxLoaded).on("click",function(){o.onShowModal(a)})}else if(a.type==2||a.type==3){const r=a.image_lat&&a.image_long?[a.image_lat,a.image_long]:this.map_default_option.pin;m.marker(r,{draggable:!0}).addTo(o.map).on("click",function(){o.onShowModal(a)}),this.bounds_sum.extend(r),this.loaded_gpxs+=1}}},watch:{loaded_gpxs(o){o==this.records.length}},methods:{onGpxLoaded(o){const e=o.target;this.bounds_sum.extend(e.getBounds()),e.addTo(this.map),this.loaded_gpxs+=1},onShowModal(o){this.modal_type=o.type,o.type==1?(this.modal_video_url=this.get_video_url(o.media_path),this.modal=!0):(this.modal_image_url=this.get_file_url(o.media_path),this.modal=!0)}}},S=Object.assign(b,{__name:"Preview",setup(o){return(e,l)=>(d(),i(c,null,{map:t(()=>[V]),action:t(()=>[s(v(y),{href:"/admin/media",as:"div"},{default:t(()=>[s(p,{icon:"mdi-arrow-left",size:"large"})]),_:1})]),content:t(()=>[e.modal_type==1&&e.modal_video_url?(d(),i(u,{key:0,modelValue:e.modal,"onUpdate:modelValue":l[1]||(l[1]=a=>e.modal=a),width:"auto"},{default:t(()=>[s(_,{class:"vp_card"},{default:t(()=>[s(p,{icon:"mdi-close",onClick:l[0]||(l[0]=a=>e.modal=!1),class:"vp_close"}),s(h,{url:e.modal_video_url},null,8,["url"])]),_:1})]),_:1},8,["modelValue"])):n("",!0),e.modal_type==2&&e.modal_image_url?(d(),i(u,{key:1,modelValue:e.modal,"onUpdate:modelValue":l[3]||(l[3]=a=>e.modal=a),width:"auto"},{default:t(()=>[s(_,{class:"vp_card"},{default:t(()=>[s(p,{icon:"mdi-close",onClick:l[2]||(l[2]=a=>e.modal=!1),class:"vp_close"}),f("div",k,[e.modal?(d(),i(w,{key:0,"max-width":"1000",contain:"",src:e.modal_image_url},null,8,["src"])):n("",!0)])]),_:1})]),_:1},8,["modelValue"])):n("",!0),e.modal_type==3&&e.modal_image_url?(d(),i(u,{key:2,modelValue:e.modal,"onUpdate:modelValue":l[5]||(l[5]=a=>e.modal=a),width:"auto"},{default:t(()=>[s(_,{class:"vp_card"},{default:t(()=>[s(p,{icon:"mdi-close",onClick:l[4]||(l[4]=a=>e.modal=!1),class:"vp_close"}),f("div",L,[e.modal?(d(),i(g,{key:0,url:e.modal_image_url},null,8,["url"])):n("",!0)])]),_:1})]),_:1},8,["modelValue"])):n("",!0)]),_:1}))}});export{S as default};
