import{o as i,c as m,w as n,a as g,b as s,m as c,u as B,l as b,s as f,q as y,n as h,C as p,z as C,L as d}from"./app-3b60bdfc.js";import{P as w}from"./Panorama-13fb8343.js";import{T as k}from"./ThreeVideoPlayer-5f5191ea.js";import{M as L}from"./MapLayout-4b1642ba.js";import"./_plugin-vue_export-helper-c27b6911.js";const M={class:"vp_content"},S={class:"vp_content"},I={components:{ThreeVideoPlayer:k,Panorama:w},props:["records"],data(){return{map:null,modal:!1,modal_type:1,modal_video_url:null,modal_image_url:null,bounds_sum:new d.LatLngBounds,gpxOptions:{async:!0,marker_options:{startIconUrl:!1,endIconUrl:!1,shadowUrl:!1},gpx_options:{joinTrackSegments:!1},polyline_options:{color:"blue",weight:12,opacity:1,lineCap:"round"}}}},mounted(){const o=this;new IntersectionObserver(a=>{a[0].isIntersecting&&o.$refs.map&&o.onInit()},{threshold:[1]}).observe(this.$refs.map)},methods:{onInit(){const o=this,e={maxZoom:o.constant.map.max_zoom},a=o.user.init_lat&&o.user.init_long?[o.user.init_lat,o.user.init_long]:o.constant.map.view,t=o.gpxOptions;t.polyline_options.weight=o.getLineWeightByZoom(o.constant.map.zoom,o.constant.map.gpx.weight);const v=o.getMarkerSizeByZoom(o.constant.map.zoom,o.constant.map.marker.size),V=d.icon({iconUrl:o.constant.map.marker.icon,iconSize:[v,v]}),r=d.map("map",e).setView(a,o.constant.map.zoom).on("zoomend",o.onZoomChange);d.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://www.osm.org">OpenStreetMap</a>',maxZoom:o.constant.map.max_zoom}).addTo(r);for(let _=0;_<o.records.length;_++){const l=o.records[_];if(l.type==1){const u=o.get_path_url(l.gpx_path);new d.GPX(u,t).on("loaded",function(z){o.onGpxLoaded(z,r)}).on("click",function(){o.onShowModal(l)})}else if(l.type==2||l.type==3){const u=l.image_lat&&l.image_long?[l.image_lat,l.image_long]:o.constant.map.pin;d.marker(u,{icon:V,draggable:!0}).addTo(r).on("click",function(){o.onShowModal(l)}),o.onFitBounds(r,u)}}o.map=r},onFitBounds(o,e){let a=o.getBounds();a.extend(e),o.fitBounds(a)},onGpxLoaded(o,e){const a=this,t=o.target;a.onFitBounds(e,t.getBounds()),t.addTo(e)},onShowModal(o){this.modal_type=o.type,o.type==1?(this.modal_video_url=o.media_path,this.modal=!0):(this.modal_image_url=this.get_path_url(o.media_path),this.modal=!0)}}},$=Object.assign(I,{name:"Preview",setup(o){return(e,a)=>(i(),m(L,null,{map:n(()=>[g("div",{id:"map",ref_key:"map",ref:map,class:"fix_map"},null,512)]),action:n(()=>[s(B(b),{href:"/admin/media",as:"div"},{default:n(()=>[s(c,{icon:"mdi-arrow-left",size:"large"})]),_:1})]),content:n(()=>[e.modal_type==1&&e.modal_video_url?(i(),m(f,{key:0,modelValue:e.modal,"onUpdate:modelValue":a[1]||(a[1]=t=>y(modal)?modal.value=t:null),width:"auto"},{default:n(()=>[s(h,{class:"vp_card"},{default:n(()=>[s(c,{icon:"mdi-close",onClick:a[0]||(a[0]=t=>e.modal=!1),class:"vp_close"}),s(k,{url:e.modal_video_url},null,8,["url"])]),_:1})]),_:1},8,["modelValue"])):p("",!0),e.modal_type==2&&e.modal_image_url?(i(),m(f,{key:1,modelValue:e.modal,"onUpdate:modelValue":a[3]||(a[3]=t=>y(modal)?modal.value=t:null),width:"auto"},{default:n(()=>[s(h,{class:"vp_card"},{default:n(()=>[s(c,{icon:"mdi-close",onClick:a[2]||(a[2]=t=>e.modal=!1),class:"vp_close"}),g("div",M,[e.modal?(i(),m(C,{key:0,"lazy-src":"/empty.png","max-width":"1000",src:e.modal_image_url},null,8,["src"])):p("",!0)])]),_:1})]),_:1},8,["modelValue"])):p("",!0),e.modal_type==3&&e.modal_image_url?(i(),m(f,{key:2,modelValue:e.modal,"onUpdate:modelValue":a[5]||(a[5]=t=>y(modal)?modal.value=t:null),width:"auto"},{default:n(()=>[s(h,{class:"vp_card"},{default:n(()=>[s(c,{icon:"mdi-close",onClick:a[4]||(a[4]=t=>e.modal=!1),class:"vp_close"}),g("div",S,[e.modal?(i(),m(w,{key:0,url:e.modal_image_url},null,8,["url"])):p("",!0)])]),_:1})]),_:1},8,["modelValue"])):p("",!0)]),_:1}))}});export{$ as default};
