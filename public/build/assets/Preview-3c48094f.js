import{o as i,c as m,w as l,b as s,m as c,u as B,l as b,s as g,q as f,n as y,C as p,a as h,z as C,L as d}from"./app-5de3646e.js";import{P as w}from"./Panorama-92186798.js";import{T as k}from"./ThreeVideoPlayer-b2057db6.js";import{M as L}from"./MapLayout-b8a973e9.js";import"./_plugin-vue_export-helper-c27b6911.js";const S=h("div",{id:"map",class:"fix_map"},null,-1),M={class:"vp_content"},I={class:"vp_content"},U={components:{ThreeVideoPlayer:k,Panorama:w},props:["records"],data(){return{map:null,modal:!1,modal_type:1,modal_video_url:null,modal_image_url:null,bounds_sum:new d.LatLngBounds,gpxOptions:{async:!0,marker_options:{startIconUrl:!1,endIconUrl:!1,shadowUrl:!1},gpx_options:{joinTrackSegments:!1},polyline_options:{color:"blue",weight:12,opacity:1,lineCap:"round"}}}},mounted(){const o=this,e=document.querySelector("#map");new IntersectionObserver(t=>{t[0].isIntersecting&&e&&o.onInit()},{threshold:[1]}).observe(e)},methods:{onInit(){const o=this,e={maxZoom:o.constant.map.max_zoom},a=o.user.init_lat&&o.user.init_long?[o.user.init_lat,o.user.init_long]:o.constant.map.view,t=o.gpxOptions;t.polyline_options.weight=o.getLineWeightByZoom(o.constant.map.zoom,o.constant.map.gpx.weight);const v=o.getMarkerSizeByZoom(o.constant.map.zoom,o.constant.map.marker.size),V=d.icon({iconUrl:o.constant.map.marker.icon,iconSize:[v,v]}),r=d.map("map",e).setView(a,o.constant.map.zoom).on("zoomend",o.onZoomChange);d.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://www.osm.org">OpenStreetMap</a>',maxZoom:o.constant.map.max_zoom}).addTo(r);for(let _=0;_<o.records.length;_++){const n=o.records[_];if(n.type==1){const u=o.get_path_url(n.gpx_path);new d.GPX(u,t).on("loaded",function(z){o.onGpxLoaded(z,r)}).on("click",function(){o.onShowModal(n)})}else if(n.type==2||n.type==3){const u=n.image_lat&&n.image_long?[n.image_lat,n.image_long]:o.constant.map.pin;d.marker(u,{icon:V,draggable:!0}).addTo(r).on("click",function(){o.onShowModal(n)}),o.onFitBounds(r,u)}}o.map=r},onFitBounds(o,e){let a=o.getBounds();a.extend(e),o.fitBounds(a)},onGpxLoaded(o,e){const a=this,t=o.target;a.onFitBounds(e,t.getBounds()),t.addTo(e)},onShowModal(o){this.modal_type=o.type,o.type==1?(this.modal_video_url=o.media_path,this.modal=!0):(this.modal_image_url=this.get_path_url(o.media_path),this.modal=!0)}}},F=Object.assign(U,{name:"Preview",setup(o){return(e,a)=>(i(),m(L,null,{map:l(()=>[S]),action:l(()=>[s(B(b),{href:"/admin/media",as:"div"},{default:l(()=>[s(c,{icon:"mdi-arrow-left",size:"large"})]),_:1})]),content:l(()=>[e.modal_type==1&&e.modal_video_url?(i(),m(g,{key:0,modelValue:e.modal,"onUpdate:modelValue":a[1]||(a[1]=t=>f(modal)?modal.value=t:null),width:"auto"},{default:l(()=>[s(y,{class:"vp_card"},{default:l(()=>[s(c,{icon:"mdi-close",onClick:a[0]||(a[0]=t=>e.modal=!1),class:"vp_close"}),s(k,{url:e.modal_video_url},null,8,["url"])]),_:1})]),_:1},8,["modelValue"])):p("",!0),e.modal_type==2&&e.modal_image_url?(i(),m(g,{key:1,modelValue:e.modal,"onUpdate:modelValue":a[3]||(a[3]=t=>f(modal)?modal.value=t:null),width:"auto"},{default:l(()=>[s(y,{class:"vp_card"},{default:l(()=>[s(c,{icon:"mdi-close",onClick:a[2]||(a[2]=t=>e.modal=!1),class:"vp_close"}),h("div",M,[e.modal?(i(),m(C,{key:0,"lazy-src":"/empty.png","max-width":"1000",src:e.modal_image_url},null,8,["src"])):p("",!0)])]),_:1})]),_:1},8,["modelValue"])):p("",!0),e.modal_type==3&&e.modal_image_url?(i(),m(g,{key:2,modelValue:e.modal,"onUpdate:modelValue":a[5]||(a[5]=t=>f(modal)?modal.value=t:null),width:"auto"},{default:l(()=>[s(y,{class:"vp_card"},{default:l(()=>[s(c,{icon:"mdi-close",onClick:a[4]||(a[4]=t=>e.modal=!1),class:"vp_close"}),h("div",I,[e.modal?(i(),m(w,{key:0,url:e.modal_image_url},null,8,["url"])):p("",!0)])]),_:1})]),_:1},8,["modelValue"])):p("",!0)]),_:1}))}});export{F as default};
