import{a3 as jf,o as $f,A as Yf}from"./app-68115e54.js";import{_ as Kf}from"./_plugin-vue_export-helper-c27b6911.js";Number.EPSILON===void 0&&(Number.EPSILON=Math.pow(2,-52));Number.isInteger===void 0&&(Number.isInteger=function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t});Math.sign===void 0&&(Math.sign=function(t){return t<0?-1:t>0?1:+t});"name"in Function.prototype||Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}});Object.assign===void 0&&function(){Object.assign=function(t){if(t==null)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var n=arguments[i];if(n!=null)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}}();function Zt(){}Object.assign(Zt.prototype,{addEventListener:function(t,e){this._listeners===void 0&&(this._listeners={});var i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)},hasEventListener:function(t,e){if(this._listeners===void 0)return!1;var i=this._listeners;return i[t]!==void 0&&i[t].indexOf(e)!==-1},removeEventListener:function(t,e){if(this._listeners!==void 0){var i=this._listeners,n=i[t];if(n!==void 0){var r=n.indexOf(e);r!==-1&&n.splice(r,1)}}},dispatchEvent:function(t){if(this._listeners!==void 0){var e=this._listeners,i=e[t.type];if(i!==void 0){t.target=this;for(var n=i.slice(0),r=0,s=n.length;r<s;r++)n[r].call(this,t)}}}});var Hh="105",Oa={LEFT:0,MIDDLE:1,RIGHT:2},Xf=0,ic=1,qf=2,Vh=1,Zf=2,ss=0,xt=1,rr=2,zh=1,Wh=0,jh=1,sr=2,dr=0,Fn=1,go=2,vo=3,yo=4,$h=5,Cn=100,Jf=101,Qf=102,Fa=103,ka=104,ed=200,td=201,id=202,nd=203,Yh=204,Kh=205,rd=206,sd=207,ad=208,od=209,ld=210,cd=0,hd=1,ud=2,xo=3,fd=4,dd=5,pd=6,md=7,Ta=0,gd=1,vd=2,Na=0,Xh=1,yd=2,xd=3,Ed=4,bd=5,bl=300,Tl=301,Eo=302,qh=303,bo=304,Zh=305,_l=306,wl=307,qi=1e3,qt=1001,Un=1002,Mt=1003,Al=1004,Sl=1005,ht=1006,Jh=1007,_a=1008,Ll=1009,Td=1010,_d=1011,Ss=1012,wd=1013,Qh=1014,yr=1015,Ml=1016,Ad=1017,Sd=1018,Ld=1019,Ls=1020,Md=1021,Ai=1022,Si=1023,Rd=1024,Id=1025,kn=1026,xr=1027,Cd=1028,nc=33776,rc=33777,sc=33778,ac=33779,oc=35840,lc=35841,cc=35842,hc=35843,Dd=36196,Pd=37808,Od=37809,Fd=37810,kd=37811,Nd=37812,Bd=37813,Ud=37814,Gd=37815,Hd=37816,Vd=37817,zd=37818,Wd=37819,jd=37820,$d=37821,Yd=2200,Kd=2201,Xd=2202,Ms=2300,ws=2301,Ba=2302,Gn=2400,Dn=2401,Rs=2402,Rl=0,qd=1,Zd=2,Is=3e3,Jd=3001,eu=3007,Qd=3002,ep=3004,tp=3005,ip=3006,np=3200,rp=3201,wa=0,sp=1,Te={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var t=[],e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16);return function(){var n=Math.random()*4294967295|0,r=Math.random()*4294967295|0,s=Math.random()*4294967295|0,a=Math.random()*4294967295|0,o=t[n&255]+t[n>>8&255]+t[n>>16&255]+t[n>>24&255]+"-"+t[r&255]+t[r>>8&255]+"-"+t[r>>16&15|64]+t[r>>24&255]+"-"+t[s&63|128]+t[s>>8&255]+"-"+t[s>>16&255]+t[s>>24&255]+t[a&255]+t[a>>8&255]+t[a>>16&255]+t[a>>24&255];return o.toUpperCase()}}(),clamp:function(t,e,i){return Math.max(e,Math.min(i,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)},lerp:function(t,e,i){return(1-i)*t+i*e},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*(3-2*t))},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*t*(t*(t*6-15)+10))},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*Te.DEG2RAD},radToDeg:function(t){return t*Te.RAD2DEG},isPowerOfTwo:function(t){return(t&t-1)===0&&t!==0},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}};function X(t,e){this.x=t||0,this.y=e||0}Object.defineProperties(X.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}});Object.assign(X.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return e!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return e!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this},clampLength:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return e===void 0&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,i){return i!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*i-s*n+t.x,this.y=r*n+s*i+t.y,this}});function tt(t,e,i,n){this._x=t||0,this._y=e||0,this._z=i||0,this._w=n!==void 0?n:1}Object.assign(tt,{slerp:function(t,e,i,n){return i.copy(t).slerp(e,n)},slerpFlat:function(t,e,i,n,r,s,a){var o=i[n+0],l=i[n+1],c=i[n+2],h=i[n+3],u=r[s+0],f=r[s+1],d=r[s+2],p=r[s+3];if(h!==p||o!==u||l!==f||c!==d){var m=1-a,g=o*u+l*f+c*d+h*p,v=g>=0?1:-1,x=1-g*g;if(x>Number.EPSILON){var y=Math.sqrt(x),b=Math.atan2(y,g*v);m=Math.sin(m*b)/y,a=Math.sin(a*b)/y}var E=a*v;if(o=o*m+u*E,l=l*m+f*E,c=c*m+d*E,h=h*m+p*E,m===1-a){var w=1/Math.sqrt(o*o+l*l+c*c+h*h);o*=w,l*=w,c*=w,h*=w}}t[e]=o,t[e+1]=l,t[e+2]=c,t[e+3]=h}});Object.defineProperties(tt.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this.onChangeCallback()}}});Object.assign(tt.prototype,{isQuaternion:!0,set:function(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,e){if(!(t&&t.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=t._x,n=t._y,r=t._z,s=t.order,a=Math.cos,o=Math.sin,l=a(i/2),c=a(n/2),h=a(r/2),u=o(i/2),f=o(n/2),d=o(r/2);return s==="XYZ"?(this._x=u*c*h+l*f*d,this._y=l*f*h-u*c*d,this._z=l*c*d+u*f*h,this._w=l*c*h-u*f*d):s==="YXZ"?(this._x=u*c*h+l*f*d,this._y=l*f*h-u*c*d,this._z=l*c*d-u*f*h,this._w=l*c*h+u*f*d):s==="ZXY"?(this._x=u*c*h-l*f*d,this._y=l*f*h+u*c*d,this._z=l*c*d+u*f*h,this._w=l*c*h-u*f*d):s==="ZYX"?(this._x=u*c*h-l*f*d,this._y=l*f*h+u*c*d,this._z=l*c*d-u*f*h,this._w=l*c*h+u*f*d):s==="YZX"?(this._x=u*c*h+l*f*d,this._y=l*f*h+u*c*d,this._z=l*c*d-u*f*h,this._w=l*c*h-u*f*d):s==="XZY"&&(this._x=u*c*h-l*f*d,this._y=l*f*h-u*c*d,this._z=l*c*d+u*f*h,this._w=l*c*h+u*f*d),e!==!1&&this.onChangeCallback(),this},setFromAxisAngle:function(t,e){var i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e=t.elements,i=e[0],n=e[4],r=e[8],s=e[1],a=e[5],o=e[9],l=e[2],c=e[6],h=e[10],u=i+a+h,f;return u>0?(f=.5/Math.sqrt(u+1),this._w=.25/f,this._x=(c-o)*f,this._y=(r-l)*f,this._z=(s-n)*f):i>a&&i>h?(f=2*Math.sqrt(1+i-a-h),this._w=(c-o)/f,this._x=.25*f,this._y=(n+s)/f,this._z=(r+l)/f):a>h?(f=2*Math.sqrt(1+a-i-h),this._w=(r-l)/f,this._x=(n+s)/f,this._y=.25*f,this._z=(o+c)/f):(f=2*Math.sqrt(1+h-i-a),this._w=(s-n)/f,this._x=(r+l)/f,this._y=(o+c)/f,this._z=.25*f),this.onChangeCallback(),this},setFromUnitVectors:function(t,e){var i=1e-6,n=t.dot(e)+1;return n<i?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(Te.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,e){var i=this.angleTo(t);if(i===0)return this;var n=Math.min(1,e/i);return this.slerp(t,n),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,e){return e!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var i=t._x,n=t._y,r=t._z,s=t._w,a=e._x,o=e._y,l=e._z,c=e._w;return this._x=i*c+s*a+n*l-r*o,this._y=n*c+s*o+r*a-i*l,this._z=r*c+s*l+i*o-n*a,this._w=s*c-i*a-n*o-r*l,this.onChangeCallback(),this},slerp:function(t,e){if(e===0)return this;if(e===1)return this.copy(t);var i=this._x,n=this._y,r=this._z,s=this._w,a=s*t._w+i*t._x+n*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;var o=1-a*a;if(o<=Number.EPSILON){var l=1-e;return this._w=l*s+e*this._w,this._x=l*i+e*this._x,this._y=l*n+e*this._y,this._z=l*r+e*this._z,this.normalize()}var c=Math.sqrt(o),h=Math.atan2(c,a),u=Math.sin((1-e)*h)/c,f=Math.sin(e*h)/c;return this._w=s*u+this._w*f,this._x=i*u+this._x*f,this._y=n*u+this._y*f,this._z=r*u+this._z*f,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return e===void 0&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this},toArray:function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}});function S(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0}Object.assign(S.prototype,{isVector3:!0,set:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return e!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return e!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return e!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(){var t=new tt;return function(i){return i&&i.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(t.setFromEuler(i))}}(),applyAxisAngle:function(){var t=new tt;return function(i,n){return this.applyQuaternion(t.setFromAxisAngle(i,n))}}(),applyMatrix3:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this},applyMatrix4:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements,s=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*s,this},applyQuaternion:function(t){var e=this.x,i=this.y,n=this.z,r=t.x,s=t.y,a=t.z,o=t.w,l=o*e+s*n-a*i,c=o*i+a*e-r*n,h=o*n+r*i-s*e,u=-r*e-s*i-a*n;return this.x=l*o+u*-r+c*-a-h*-s,this.y=c*o+u*-s+h*-r-l*-a,this.z=h*o+u*-a+l*-s-c*-r,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},clampLength:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},cross:function(t,e){return e!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var i=t.x,n=t.y,r=t.z,s=e.x,a=e.y,o=e.z;return this.x=n*o-r*a,this.y=r*s-i*o,this.z=i*a-n*s,this},projectOnVector:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)},projectOnPlane:function(){var t=new S;return function(i){return t.copy(this).projectOnVector(i),this.sub(t)}}(),reflect:function(){var t=new S;return function(i){return this.sub(t.copy(i).multiplyScalar(2*this.dot(i)))}}(),angleTo:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(Te.clamp(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,e,i){var n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,e*4)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return e===void 0&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,i){return i!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}});function Rt(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(Rt.prototype,{isMatrix3:!0,set:function(t,e,i,n,r,s,a,o,l){var c=this.elements;return c[0]=t,c[1]=n,c[2]=a,c[3]=e,c[4]=r,c[5]=o,c[6]=i,c[7]=s,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return new this.constructor().fromArray(this.elements)},copy:function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:function(){var t=new S;return function(i){for(var n=0,r=i.count;n<r;n++)t.x=i.getX(n),t.y=i.getY(n),t.z=i.getZ(n),t.applyMatrix3(this),i.setXYZ(n,t.x,t.y,t.z);return i}}(),multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var i=t.elements,n=e.elements,r=this.elements,s=i[0],a=i[3],o=i[6],l=i[1],c=i[4],h=i[7],u=i[2],f=i[5],d=i[8],p=n[0],m=n[3],g=n[6],v=n[1],x=n[4],y=n[7],b=n[2],E=n[5],w=n[8];return r[0]=s*p+a*v+o*b,r[3]=s*m+a*x+o*E,r[6]=s*g+a*y+o*w,r[1]=l*p+c*v+h*b,r[4]=l*m+c*x+h*E,r[7]=l*g+c*y+h*w,r[2]=u*p+f*v+d*b,r[5]=u*m+f*x+d*E,r[8]=u*g+f*y+d*w,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8];return e*s*c-e*a*l-i*r*c+i*a*o+n*r*l-n*s*o},getInverse:function(t,e){t&&t.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var i=t.elements,n=this.elements,r=i[0],s=i[1],a=i[2],o=i[3],l=i[4],c=i[5],h=i[6],u=i[7],f=i[8],d=f*l-c*u,p=c*h-f*o,m=u*o-l*h,g=r*d+s*p+a*m;if(g===0){var v="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(e===!0)throw new Error(v);return console.warn(v),this.identity()}var x=1/g;return n[0]=d*x,n[1]=(a*u-f*s)*x,n[2]=(c*s-a*l)*x,n[3]=p*x,n[4]=(f*r-a*h)*x,n[5]=(a*o-c*r)*x,n[6]=m*x,n[7]=(s*h-u*r)*x,n[8]=(l*r-s*o)*x,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,i,n,r,s,a){var o=Math.cos(r),l=Math.sin(r);this.set(i*o,i*l,-i*(o*s+l*a)+s+t,-n*l,n*o,-n*(-l*s+o*a)+a+e,0,0,1)},scale:function(t,e){var i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this},rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.elements,r=n[0],s=n[3],a=n[6],o=n[1],l=n[4],c=n[7];return n[0]=e*r+i*o,n[3]=e*s+i*l,n[6]=e*a+i*c,n[1]=-i*r+e*o,n[4]=-i*s+e*l,n[7]=-i*a+e*c,this},translate:function(t,e){var i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this},equals:function(t){for(var e=this.elements,i=t.elements,n=0;n<9;n++)if(e[n]!==i[n])return!1;return!0},fromArray:function(t,e){e===void 0&&(e=0);for(var i=0;i<9;i++)this.elements[i]=t[i+e];return this},toArray:function(t,e){t===void 0&&(t=[]),e===void 0&&(e=0);var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}});var _n,dn={getDataURL:function(t){var e;if(typeof HTMLCanvasElement>"u")return t.src;if(t instanceof HTMLCanvasElement)e=t;else{_n===void 0&&(_n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),_n.width=t.width,_n.height=t.height;var i=_n.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=_n}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}},ap=0;function Ye(t,e,i,n,r,s,a,o,l,c){Object.defineProperty(this,"id",{value:ap++}),this.uuid=Te.generateUUID(),this.name="",this.image=t!==void 0?t:Ye.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=e!==void 0?e:Ye.DEFAULT_MAPPING,this.wrapS=i!==void 0?i:qt,this.wrapT=n!==void 0?n:qt,this.magFilter=r!==void 0?r:ht,this.minFilter=s!==void 0?s:_a,this.anisotropy=l!==void 0?l:1,this.format=a!==void 0?a:Si,this.type=o!==void 0?o:Ll,this.offset=new X(0,0),this.repeat=new X(1,1),this.center=new X(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Rt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c!==void 0?c:Is,this.version=0,this.onUpdate=null}Ye.DEFAULT_IMAGE=void 0;Ye.DEFAULT_MAPPING=bl;Ye.prototype=Object.assign(Object.create(Zt.prototype),{constructor:Ye,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){var e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];var i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){var n=this.image;if(n.uuid===void 0&&(n.uuid=Te.generateUUID()),!e&&t.images[n.uuid]===void 0){var r;if(Array.isArray(n)){r=[];for(var s=0,a=n.length;s<a;s++)r.push(dn.getDataURL(n[s]))}else r=dn.getDataURL(n);t.images[n.uuid]={uuid:n.uuid,url:r}}i.image=n.uuid}return e||(t.textures[this.uuid]=i),i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(this.mapping!==bl)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case qi:t.x=t.x-Math.floor(t.x);break;case qt:t.x=t.x<0?0:1;break;case Un:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case qi:t.y=t.y-Math.floor(t.y);break;case qt:t.y=t.y<0?0:1;break;case Un:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}});Object.defineProperty(Ye.prototype,"needsUpdate",{set:function(t){t===!0&&this.version++}});function et(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=n!==void 0?n:1}Object.assign(et.prototype,{isVector4:!0,set:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this},add:function(t,e){return e!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return e!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,i=this.y,n=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n+s[12]*r,this.y=s[1]*e+s[5]*i+s[9]*n+s[13]*r,this.z=s[2]*e+s[6]*i+s[10]*n+s[14]*r,this.w=s[3]*e+s[7]*i+s[11]*n+s[15]*r,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,i,n,r,s=.01,a=.1,o=t.elements,l=o[0],c=o[4],h=o[8],u=o[1],f=o[5],d=o[9],p=o[2],m=o[6],g=o[10];if(Math.abs(c-u)<s&&Math.abs(h-p)<s&&Math.abs(d-m)<s){if(Math.abs(c+u)<a&&Math.abs(h+p)<a&&Math.abs(d+m)<a&&Math.abs(l+f+g-3)<a)return this.set(1,0,0,0),this;e=Math.PI;var v=(l+1)/2,x=(f+1)/2,y=(g+1)/2,b=(c+u)/4,E=(h+p)/4,w=(d+m)/4;return v>x&&v>y?v<s?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(v),n=b/i,r=E/i):x>y?x<s?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(x),i=b/n,r=w/n):y<s?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(y),i=E/r,n=w/r),this.set(i,n,r,e),this}var A=Math.sqrt((m-d)*(m-d)+(h-p)*(h-p)+(u-c)*(u-c));return Math.abs(A)<.001&&(A=1),this.x=(m-d)/A,this.y=(h-p)/A,this.z=(u-c)/A,this.w=Math.acos((l+f+g-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(){var t,e;return function(n,r){return t===void 0&&(t=new et,e=new et),t.set(n,n,n,n),e.set(r,r,r,r),this.clamp(t,e)}}(),clampLength:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return e===void 0&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,i){return i!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}});function Li(t,e,i){this.width=t,this.height=e,this.scissor=new et(0,0,t,e),this.scissorTest=!1,this.viewport=new et(0,0,t,e),i=i||{},this.texture=new Ye(void 0,void 0,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:ht,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!0,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null}Li.prototype=Object.assign(Object.create(Zt.prototype),{constructor:Li,isWebGLRenderTarget:!0,setSize:function(t,e){(this.width!==t||this.height!==e)&&(this.width=t,this.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});function uc(t,e,i){Li.call(this,t,e,i),this.samples=4}uc.prototype=Object.assign(Object.create(Li.prototype),{constructor:uc,isWebGLMultisampleRenderTarget:!0,copy:function(t){return Li.prototype.copy.call(this,t),this.samples=t.samples,this}});function Hn(t,e,i){Li.call(this,t,e,i)}Hn.prototype=Object.create(Li.prototype);Hn.prototype.constructor=Hn;Hn.prototype.isWebGLRenderTargetCube=!0;function Vn(t,e,i,n,r,s,a,o,l,c,h,u){Ye.call(this,null,s,a,o,l,c,n,r,h,u),this.image={data:t,width:e,height:i},this.magFilter=l!==void 0?l:Mt,this.minFilter=c!==void 0?c:Mt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}Vn.prototype=Object.create(Ye.prototype);Vn.prototype.constructor=Vn;Vn.prototype.isDataTexture=!0;function Ti(t,e){this.min=t!==void 0?t:new S(1/0,1/0,1/0),this.max=e!==void 0?e:new S(-1/0,-1/0,-1/0)}Object.assign(Ti.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,a=-1/0,o=0,l=t.length;o<l;o+=3){var c=t[o],h=t[o+1],u=t[o+2];c<e&&(e=c),h<i&&(i=h),u<n&&(n=u),c>r&&(r=c),h>s&&(s=h),u>a&&(a=u)}return this.min.set(e,i,n),this.max.set(r,s,a),this},setFromBufferAttribute:function(t){for(var e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,a=-1/0,o=0,l=t.count;o<l;o++){var c=t.getX(o),h=t.getY(o),u=t.getZ(o);c<e&&(e=c),h<i&&(i=h),u<n&&(n=u),c>r&&(r=c),h>s&&(s=h),u>a&&(a=u)}return this.min.set(e,i,n),this.max.set(r,s,a),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new S;return function(i,n){var r=t.copy(n).multiplyScalar(.5);return this.min.copy(i).sub(r),this.max.copy(i).add(r),this}}(),setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return t===void 0&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new S),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return t===void 0&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new S),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(){var t,e,i,n=new S;function r(s){var a=s.geometry;if(a!==void 0){if(a.isGeometry){var o=a.vertices;for(e=0,i=o.length;e<i;e++)n.copy(o[e]),n.applyMatrix4(s.matrixWorld),t.expandByPoint(n)}else if(a.isBufferGeometry){var l=a.attributes.position;if(l!==void 0)for(e=0,i=l.count;e<i;e++)n.fromBufferAttribute(l,e).applyMatrix4(s.matrixWorld),t.expandByPoint(n)}}}return function(a){return t=this,a.updateMatrixWorld(!0),a.traverse(r),this}}(),containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return e===void 0&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new S),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(){var t=new S;return function(i){return this.clampPoint(i.center,t),t.distanceToSquared(i.center)<=i.radius*i.radius}}(),intersectsPlane:function(t){var e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant},intersectsTriangle:function(){var t=new S,e=new S,i=new S,n=new S,r=new S,s=new S,a=new S,o=new S,l=new S,c=new S;function h(u){var f,d;for(f=0,d=u.length-3;f<=d;f+=3){a.fromArray(u,f);var p=l.x*Math.abs(a.x)+l.y*Math.abs(a.y)+l.z*Math.abs(a.z),m=t.dot(a),g=e.dot(a),v=i.dot(a);if(Math.max(-Math.max(m,g,v),Math.min(m,g,v))>p)return!1}return!0}return function(f){if(this.isEmpty())return!1;this.getCenter(o),l.subVectors(this.max,o),t.subVectors(f.a,o),e.subVectors(f.b,o),i.subVectors(f.c,o),n.subVectors(e,t),r.subVectors(i,e),s.subVectors(t,i);var d=[0,-n.z,n.y,0,-r.z,r.y,0,-s.z,s.y,n.z,0,-n.x,r.z,0,-r.x,s.z,0,-s.x,-n.y,n.x,0,-r.y,r.x,0,-s.y,s.x,0];return!h(d)||(d=[1,0,0,0,1,0,0,0,1],!h(d))?!1:(c.crossVectors(n,r),d=[c.x,c.y,c.z],h(d))}}(),clampPoint:function(t,e){return e===void 0&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new S),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new S;return function(i){var n=t.copy(i).clamp(this.min,this.max);return n.sub(i).length()}}(),getBoundingSphere:function(){var t=new S;return function(i){return i===void 0&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(i.center),i.radius=this.getSize(t).length()*.5,i}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(){var t=[new S,new S,new S,new S,new S,new S,new S,new S];return function(i){return this.isEmpty()?this:(t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(i),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(i),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(i),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(i),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(i),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(i),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(i),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(i),this.setFromPoints(t),this)}}(),translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});function Ui(t,e){this.center=t!==void 0?t:new S,this.radius=e!==void 0?e:0}Object.assign(Ui.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(){var t=new Ti;return function(i,n){var r=this.center;n!==void 0?r.copy(n):t.setFromPoints(i).getCenter(r);for(var s=0,a=0,o=i.length;a<o;a++)s=Math.max(s,r.distanceToSquared(i[a]));return this.radius=Math.sqrt(s),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var i=this.center.distanceToSquared(t);return e===void 0&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new S),e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return t===void 0&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new Ti),t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}});function Bi(t,e){this.normal=t!==void 0?t:new S(1,0,0),this.constant=e!==void 0?e:0}Object.assign(Bi.prototype,{set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new S,e=new S;return function(n,r,s){var a=t.subVectors(s,r).cross(e.subVectors(n,r)).normalize();return this.setFromNormalAndCoplanarPoint(a,n),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return e===void 0&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new S),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(){var t=new S;return function(i,n){n===void 0&&(console.warn("THREE.Plane: .intersectLine() target is now required"),n=new S);var r=i.delta(t),s=this.normal.dot(r);if(s===0)return this.distanceToPoint(i.start)===0?n.copy(i.start):void 0;var a=-(i.start.dot(this.normal)+this.constant)/s;if(!(a<0||a>1))return n.copy(r).multiplyScalar(a).add(i.start)}}(),intersectsLine:function(t){var e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return t===void 0&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new S),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new S,e=new Rt;return function(n,r){var s=r||e.getNormalMatrix(n),a=this.coplanarPoint(t).applyMatrix4(n),o=this.normal.applyMatrix3(s).normalize();return this.constant=-a.dot(o),this}}(),translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}});function Aa(t,e,i,n,r,s){this.planes=[t!==void 0?t:new Bi,e!==void 0?e:new Bi,i!==void 0?i:new Bi,n!==void 0?n:new Bi,r!==void 0?r:new Bi,s!==void 0?s:new Bi]}Object.assign(Aa.prototype,{set:function(t,e,i,n,r,s){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(s),this},clone:function(){return new this.constructor().copy(this)},copy:function(t){for(var e=this.planes,i=0;i<6;i++)e[i].copy(t.planes[i]);return this},setFromMatrix:function(t){var e=this.planes,i=t.elements,n=i[0],r=i[1],s=i[2],a=i[3],o=i[4],l=i[5],c=i[6],h=i[7],u=i[8],f=i[9],d=i[10],p=i[11],m=i[12],g=i[13],v=i[14],x=i[15];return e[0].setComponents(a-n,h-o,p-u,x-m).normalize(),e[1].setComponents(a+n,h+o,p+u,x+m).normalize(),e[2].setComponents(a+r,h+l,p+f,x+g).normalize(),e[3].setComponents(a-r,h-l,p-f,x-g).normalize(),e[4].setComponents(a-s,h-c,p-d,x-v).normalize(),e[5].setComponents(a+s,h+c,p+d,x+v).normalize(),this},intersectsObject:function(){var t=new Ui;return function(i){var n=i.geometry;return n.boundingSphere===null&&n.computeBoundingSphere(),t.copy(n.boundingSphere).applyMatrix4(i.matrixWorld),this.intersectsSphere(t)}}(),intersectsSprite:function(){var t=new Ui;return function(i){return t.center.set(0,0,0),t.radius=.7071067811865476,t.applyMatrix4(i.matrixWorld),this.intersectsSphere(t)}}(),intersectsSphere:function(t){for(var e=this.planes,i=t.center,n=-t.radius,r=0;r<6;r++){var s=e[r].distanceToPoint(i);if(s<n)return!1}return!0},intersectsBox:function(){var t=new S;return function(i){for(var n=this.planes,r=0;r<6;r++){var s=n[r];if(t.x=s.normal.x>0?i.max.x:i.min.x,t.y=s.normal.y>0?i.max.y:i.min.y,t.z=s.normal.z>0?i.max.z:i.min.z,s.distanceToPoint(t)<0)return!1}return!0}}(),containsPoint:function(t){for(var e=this.planes,i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}});function we(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(we.prototype,{isMatrix4:!0,set:function(t,e,i,n,r,s,a,o,l,c,h,u,f,d,p,m){var g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=n,g[1]=r,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=f,g[7]=d,g[11]=p,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return new we().fromArray(this.elements)},copy:function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this},copyPosition:function(t){var e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this},extractBasis:function(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this},extractRotation:function(){var t=new S;return function(i){var n=this.elements,r=i.elements,s=1/t.setFromMatrixColumn(i,0).length(),a=1/t.setFromMatrixColumn(i,1).length(),o=1/t.setFromMatrixColumn(i,2).length();return n[0]=r[0]*s,n[1]=r[1]*s,n[2]=r[2]*s,n[3]=0,n[4]=r[4]*a,n[5]=r[5]*a,n[6]=r[6]*a,n[7]=0,n[8]=r[8]*o,n[9]=r[9]*o,n[10]=r[10]*o,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}}(),makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,i=t.x,n=t.y,r=t.z,s=Math.cos(i),a=Math.sin(i),o=Math.cos(n),l=Math.sin(n),c=Math.cos(r),h=Math.sin(r);if(t.order==="XYZ"){var u=s*c,f=s*h,d=a*c,p=a*h;e[0]=o*c,e[4]=-o*h,e[8]=l,e[1]=f+d*l,e[5]=u-p*l,e[9]=-a*o,e[2]=p-u*l,e[6]=d+f*l,e[10]=s*o}else if(t.order==="YXZ"){var m=o*c,g=o*h,v=l*c,x=l*h;e[0]=m+x*a,e[4]=v*a-g,e[8]=s*l,e[1]=s*h,e[5]=s*c,e[9]=-a,e[2]=g*a-v,e[6]=x+m*a,e[10]=s*o}else if(t.order==="ZXY"){var m=o*c,g=o*h,v=l*c,x=l*h;e[0]=m-x*a,e[4]=-s*h,e[8]=v+g*a,e[1]=g+v*a,e[5]=s*c,e[9]=x-m*a,e[2]=-s*l,e[6]=a,e[10]=s*o}else if(t.order==="ZYX"){var u=s*c,f=s*h,d=a*c,p=a*h;e[0]=o*c,e[4]=d*l-f,e[8]=u*l+p,e[1]=o*h,e[5]=p*l+u,e[9]=f*l-d,e[2]=-l,e[6]=a*o,e[10]=s*o}else if(t.order==="YZX"){var y=s*o,b=s*l,E=a*o,w=a*l;e[0]=o*c,e[4]=w-y*h,e[8]=E*h+b,e[1]=h,e[5]=s*c,e[9]=-a*c,e[2]=-l*c,e[6]=b*h+E,e[10]=y-w*h}else if(t.order==="XZY"){var y=s*o,b=s*l,E=a*o,w=a*l;e[0]=o*c,e[4]=-h,e[8]=l*c,e[1]=y*h+w,e[5]=s*c,e[9]=b*h-E,e[2]=E*h-b,e[6]=a*c,e[10]=w*h+y}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(){var t=new S(0,0,0),e=new S(1,1,1);return function(n){return this.compose(t,n,e)}}(),lookAt:function(){var t=new S,e=new S,i=new S;return function(r,s,a){var o=this.elements;return i.subVectors(r,s),i.lengthSq()===0&&(i.z=1),i.normalize(),t.crossVectors(a,i),t.lengthSq()===0&&(Math.abs(a.z)===1?i.x+=1e-4:i.z+=1e-4,i.normalize(),t.crossVectors(a,i)),t.normalize(),e.crossVectors(i,t),o[0]=t.x,o[4]=e.x,o[8]=i.x,o[1]=t.y,o[5]=e.y,o[9]=i.y,o[2]=t.z,o[6]=e.z,o[10]=i.z,this}}(),multiply:function(t,e){return e!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var i=t.elements,n=e.elements,r=this.elements,s=i[0],a=i[4],o=i[8],l=i[12],c=i[1],h=i[5],u=i[9],f=i[13],d=i[2],p=i[6],m=i[10],g=i[14],v=i[3],x=i[7],y=i[11],b=i[15],E=n[0],w=n[4],A=n[8],D=n[12],O=n[1],P=n[5],L=n[9],C=n[13],U=n[2],j=n[6],K=n[10],z=n[14],$=n[3],k=n[7],G=n[11],q=n[15];return r[0]=s*E+a*O+o*U+l*$,r[4]=s*w+a*P+o*j+l*k,r[8]=s*A+a*L+o*K+l*G,r[12]=s*D+a*C+o*z+l*q,r[1]=c*E+h*O+u*U+f*$,r[5]=c*w+h*P+u*j+f*k,r[9]=c*A+h*L+u*K+f*G,r[13]=c*D+h*C+u*z+f*q,r[2]=d*E+p*O+m*U+g*$,r[6]=d*w+p*P+m*j+g*k,r[10]=d*A+p*L+m*K+g*G,r[14]=d*D+p*C+m*z+g*q,r[3]=v*E+x*O+y*U+b*$,r[7]=v*w+x*P+y*j+b*k,r[11]=v*A+x*L+y*K+b*G,r[15]=v*D+x*C+y*z+b*q,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToBufferAttribute:function(){var t=new S;return function(i){for(var n=0,r=i.count;n<r;n++)t.x=i.getX(n),t.y=i.getY(n),t.z=i.getZ(n),t.applyMatrix4(this),i.setXYZ(n,t.x,t.y,t.z);return i}}(),determinant:function(){var t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],s=t[1],a=t[5],o=t[9],l=t[13],c=t[2],h=t[6],u=t[10],f=t[14],d=t[3],p=t[7],m=t[11],g=t[15];return d*(+r*o*h-n*l*h-r*a*u+i*l*u+n*a*f-i*o*f)+p*(+e*o*f-e*l*u+r*s*u-n*s*f+n*l*c-r*o*c)+m*(+e*l*h-e*a*f-r*s*h+i*s*f+r*a*c-i*l*c)+g*(-n*a*c-e*o*h+e*a*u+n*s*h-i*s*u+i*o*c)},transpose:function(){var t=this.elements,e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(t,e,i){var n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this},getInverse:function(t,e){var i=this.elements,n=t.elements,r=n[0],s=n[1],a=n[2],o=n[3],l=n[4],c=n[5],h=n[6],u=n[7],f=n[8],d=n[9],p=n[10],m=n[11],g=n[12],v=n[13],x=n[14],y=n[15],b=d*x*u-v*p*u+v*h*m-c*x*m-d*h*y+c*p*y,E=g*p*u-f*x*u-g*h*m+l*x*m+f*h*y-l*p*y,w=f*v*u-g*d*u+g*c*m-l*v*m-f*c*y+l*d*y,A=g*d*h-f*v*h-g*c*p+l*v*p+f*c*x-l*d*x,D=r*b+s*E+a*w+o*A;if(D===0){var O="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(e===!0)throw new Error(O);return console.warn(O),this.identity()}var P=1/D;return i[0]=b*P,i[1]=(v*p*o-d*x*o-v*a*m+s*x*m+d*a*y-s*p*y)*P,i[2]=(c*x*o-v*h*o+v*a*u-s*x*u-c*a*y+s*h*y)*P,i[3]=(d*h*o-c*p*o-d*a*u+s*p*u+c*a*m-s*h*m)*P,i[4]=E*P,i[5]=(f*x*o-g*p*o+g*a*m-r*x*m-f*a*y+r*p*y)*P,i[6]=(g*h*o-l*x*o-g*a*u+r*x*u+l*a*y-r*h*y)*P,i[7]=(l*p*o-f*h*o+f*a*u-r*p*u-l*a*m+r*h*m)*P,i[8]=w*P,i[9]=(g*d*o-f*v*o-g*s*m+r*v*m+f*s*y-r*d*y)*P,i[10]=(l*v*o-g*c*o+g*s*u-r*v*u-l*s*y+r*c*y)*P,i[11]=(f*c*o-l*d*o-f*s*u+r*d*u+l*s*m-r*c*m)*P,i[12]=A*P,i[13]=(f*v*a-g*d*a+g*s*p-r*v*p-f*s*x+r*d*x)*P,i[14]=(g*c*a-l*v*a-g*s*h+r*v*h+l*s*x-r*c*x)*P,i[15]=(l*d*a-f*c*a+f*s*h-r*d*h-l*s*p+r*c*p)*P,this},scale:function(t){var e=this.elements,i=t.x,n=t.y,r=t.z;return e[0]*=i,e[4]*=n,e[8]*=r,e[1]*=i,e[5]*=n,e[9]*=r,e[2]*=i,e[6]*=n,e[10]*=r,e[3]*=i,e[7]*=n,e[11]*=r,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))},makeTranslation:function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var i=Math.cos(e),n=Math.sin(e),r=1-i,s=t.x,a=t.y,o=t.z,l=r*s,c=r*a;return this.set(l*s+i,l*a-n*o,l*o+n*a,0,l*a+n*o,c*a+i,c*o-n*s,0,l*o-n*a,c*o+n*s,r*o*o+i,0,0,0,0,1),this},makeScale:function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(t,e,i){return this.set(1,e,i,0,t,1,i,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,i){var n=this.elements,r=e._x,s=e._y,a=e._z,o=e._w,l=r+r,c=s+s,h=a+a,u=r*l,f=r*c,d=r*h,p=s*c,m=s*h,g=a*h,v=o*l,x=o*c,y=o*h,b=i.x,E=i.y,w=i.z;return n[0]=(1-(p+g))*b,n[1]=(f+y)*b,n[2]=(d-x)*b,n[3]=0,n[4]=(f-y)*E,n[5]=(1-(u+g))*E,n[6]=(m+v)*E,n[7]=0,n[8]=(d+x)*w,n[9]=(m-v)*w,n[10]=(1-(u+p))*w,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this},decompose:function(){var t=new S,e=new we;return function(n,r,s){var a=this.elements,o=t.set(a[0],a[1],a[2]).length(),l=t.set(a[4],a[5],a[6]).length(),c=t.set(a[8],a[9],a[10]).length(),h=this.determinant();h<0&&(o=-o),n.x=a[12],n.y=a[13],n.z=a[14],e.copy(this);var u=1/o,f=1/l,d=1/c;return e.elements[0]*=u,e.elements[1]*=u,e.elements[2]*=u,e.elements[4]*=f,e.elements[5]*=f,e.elements[6]*=f,e.elements[8]*=d,e.elements[9]*=d,e.elements[10]*=d,r.setFromRotationMatrix(e),s.x=o,s.y=l,s.z=c,this}}(),makePerspective:function(t,e,i,n,r,s){s===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,o=2*r/(e-t),l=2*r/(i-n),c=(e+t)/(e-t),h=(i+n)/(i-n),u=-(s+r)/(s-r),f=-2*s*r/(s-r);return a[0]=o,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=f,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(t,e,i,n,r,s){var a=this.elements,o=1/(e-t),l=1/(i-n),c=1/(s-r),h=(e+t)*o,u=(i+n)*l,f=(s+r)*c;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(t){for(var e=this.elements,i=t.elements,n=0;n<16;n++)if(e[n]!==i[n])return!1;return!0},fromArray:function(t,e){e===void 0&&(e=0);for(var i=0;i<16;i++)this.elements[i]=t[i+e];return this},toArray:function(t,e){t===void 0&&(t=[]),e===void 0&&(e=0);var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}});var op=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,lp=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,cp=`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,hp=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( PHYSICAL )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,up=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,fp="vec3 transformed = vec3( position );",dp=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,pp=`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {
	float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE  = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS  = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}`,mp=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 );
		fDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,gp=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;
	}
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;
		}
		if ( clipped ) discard;
	#endif
#endif`,vp=`#if NUM_CLIPPING_PLANES > 0
	#if ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )
		varying vec3 vViewPosition;
	#endif
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,yp=`#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )
	varying vec3 vViewPosition;
#endif`,xp=`#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )
	vViewPosition = - mvPosition.xyz;
#endif`,Ep=`#ifdef USE_COLOR
	diffuseColor.rgb *= vColor;
#endif`,bp=`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,Tp=`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,_p=`#ifdef USE_COLOR
	vColor.xyz = color.xyz;
#endif`,wp=`#define PI 3.14159265359
#define PI2 6.28318530718
#define PI_HALF 1.5707963267949
#define RECIPROCAL_PI 0.31830988618
#define RECIPROCAL_PI2 0.15915494
#define LOG2 1.442695
#define EPSILON 1e-6
#define saturate(a) clamp( a, 0.0, 1.0 )
#define whiteCompliment(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}`,Ap=`#ifdef ENVMAP_TYPE_CUBE_UV
#define cubeUV_textureSize (1024.0)
int getFaceFromDirection(vec3 direction) {
	vec3 absDirection = abs(direction);
	int face = -1;
	if( absDirection.x > absDirection.z ) {
		if(absDirection.x > absDirection.y )
			face = direction.x > 0.0 ? 0 : 3;
		else
			face = direction.y > 0.0 ? 1 : 4;
	}
	else {
		if(absDirection.z > absDirection.y )
			face = direction.z > 0.0 ? 2 : 5;
		else
			face = direction.y > 0.0 ? 1 : 4;
	}
	return face;
}
#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)
#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))
vec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {
	float scale = exp2(cubeUV_maxLods1 - roughnessLevel);
	float dxRoughness = dFdx(roughness);
	float dyRoughness = dFdy(roughness);
	vec3 dx = dFdx( vec * scale * dxRoughness );
	vec3 dy = dFdy( vec * scale * dyRoughness );
	float d = max( dot( dx, dx ), dot( dy, dy ) );
	d = clamp(d, 1.0, cubeUV_rangeClamp);
	float mipLevel = 0.5 * log2(d);
	return vec2(floor(mipLevel), fract(mipLevel));
}
#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)
#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)
vec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {
	mipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;
	float a = 16.0 * cubeUV_rcpTextureSize;
	vec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );
	vec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;
	float powScale = exp2_packed.x * exp2_packed.y;
	float scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;
	float mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;
	bool bRes = mipLevel == 0.0;
	scale =  bRes && (scale < a) ? a : scale;
	vec3 r;
	vec2 offset;
	int face = getFaceFromDirection(direction);
	float rcpPowScale = 1.0 / powScale;
	if( face == 0) {
		r = vec3(direction.x, -direction.z, direction.y);
		offset = vec2(0.0+mipOffset,0.75 * rcpPowScale);
		offset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;
	}
	else if( face == 1) {
		r = vec3(direction.y, direction.x, direction.z);
		offset = vec2(scale+mipOffset, 0.75 * rcpPowScale);
		offset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;
	}
	else if( face == 2) {
		r = vec3(direction.z, direction.x, direction.y);
		offset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);
		offset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;
	}
	else if( face == 3) {
		r = vec3(direction.x, direction.z, direction.y);
		offset = vec2(0.0+mipOffset,0.5 * rcpPowScale);
		offset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;
	}
	else if( face == 4) {
		r = vec3(direction.y, direction.x, -direction.z);
		offset = vec2(scale+mipOffset, 0.5 * rcpPowScale);
		offset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;
	}
	else {
		r = vec3(direction.z, -direction.x, direction.y);
		offset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);
		offset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;
	}
	r = normalize(r);
	float texelOffset = 0.5 * cubeUV_rcpTextureSize;
	vec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;
	vec2 base = offset + vec2( texelOffset );
	return base + s * ( scale - 2.0 * texelOffset );
}
#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)
vec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {
	float roughnessVal = roughness* cubeUV_maxLods3;
	float r1 = floor(roughnessVal);
	float r2 = r1 + 1.0;
	float t = fract(roughnessVal);
	vec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);
	float s = mipInfo.y;
	float level0 = mipInfo.x;
	float level1 = level0 + 1.0;
	level1 = level1 > 5.0 ? 5.0 : level1;
	level0 += min( floor( s + 0.5 ), 5.0 );
	vec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);
	vec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));
	vec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);
	vec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));
	vec4 result = mix(color10, color20, t);
	return vec4(result.rgb, 1.0);
}
#endif`,Sp=`vec3 transformedNormal = normalMatrix * objectNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = normalMatrix * objectTangent;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Lp=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Mp=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );
#endif`,Rp=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Ip=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Cp="gl_FragColor = linearToOutputTexel( gl_FragColor );",Dp=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = min( floor( D ) / 255.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value )  {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,Pp=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToVertex, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_EQUIREC )
		vec2 sampleUV;
		reflectVec = normalize( reflectVec );
		sampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
		sampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;
		vec4 envColor = texture2D( envMap, sampleUV );
	#elif defined( ENVMAP_TYPE_SPHERE )
		reflectVec = normalize( reflectVec );
		vec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );
		vec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	envColor = envMapTexelToLinear( envColor );
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Op=`#if defined( USE_ENVMAP ) || defined( PHYSICAL )
	uniform float reflectivity;
	uniform float envMapIntensity;
#endif
#ifdef USE_ENVMAP
	#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )
		varying vec3 vWorldPosition;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Fp=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,kp=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Np=`#ifdef USE_FOG
	fogDepth = -mvPosition.z;
#endif`,Bp=`#ifdef USE_FOG
	varying float fogDepth;
#endif`,Up=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Gp=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Hp=`#ifdef TOON
	uniform sampler2D gradientMap;
	vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
		float dotNL = dot( normal, lightDirection );
		vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
		#ifdef USE_GRADIENTMAP
			return texture2D( gradientMap, coord ).rgb;
		#else
			return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
		#endif
	}
#endif`,Vp=`#ifdef USE_LIGHTMAP
	reflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;
#endif`,zp=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Wp=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
#endif`,jp=`uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
		float shadowCameraNear;
		float shadowCameraFar;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,$p=`#if defined( USE_ENVMAP ) && defined( PHYSICAL )
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			vec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );
		#else
			vec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			vec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));
		#elif defined( ENVMAP_TYPE_EQUIREC )
			vec2 sampleUV;
			sampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
			sampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );
			#else
				vec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_SPHERE )
			vec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );
			#else
				vec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,Yp=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Kp=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3	diffuseColor;
	vec3	specularColor;
	float	specularShininess;
	float	specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	#ifdef TOON
		vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#else
		float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
		vec3 irradiance = dotNL * directLight.color;
	#endif
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,Xp=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
material.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );
#ifdef STANDARD
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );
	material.clearCoat = saturate( clearCoat );	material.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );
#endif`,qp=`struct PhysicalMaterial {
	vec3	diffuseColor;
	float	specularRoughness;
	vec3	specularColor;
	#ifndef STANDARD
		float clearCoat;
		float clearCoatRoughness;
	#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearCoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifndef STANDARD
		float clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );
	#else
		float clearCoatDHR = 0.0;
	#endif
	reflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );
	reflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	#ifndef STANDARD
		reflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );
	#endif
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	#ifndef ENVMAP_TYPE_CUBE_UV
		reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	#endif
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifndef STANDARD
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		float dotNL = dotNV;
		float clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );
	#else
		float clearCoatDHR = 0.0;
	#endif
	float clearCoatInv = 1.0 - clearCoatDHR;
	#if defined( ENVMAP_TYPE_CUBE_UV )
		vec3 singleScattering = vec3( 0.0 );
		vec3 multiScattering = vec3( 0.0 );
		vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
		BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
		vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
		reflectedLight.indirectSpecular += clearCoatInv * radiance * singleScattering;
		reflectedLight.indirectDiffuse += multiScattering * cosineWeightedIrradiance;
		reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
	#else
		reflectedLight.indirectSpecular += clearCoatInv * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );
	#endif
	#ifndef STANDARD
		reflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );
	#endif
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )
#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Zp=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = normalize( vViewPosition );
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#ifdef USE_SHADOWMAP
		directLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#ifdef USE_SHADOWMAP
		directLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#ifdef USE_SHADOWMAP
		directLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
#endif
#if defined( RE_IndirectDiffuse )
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearCoatRadiance = vec3( 0.0 );
#endif`,Jp=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )
		irradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );
	#ifndef STANDARD
		clearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );
	#endif
#endif`,Qp=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, irradiance, clearCoatRadiance, geometry, material, reflectedLight );
#endif`,em=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,tm=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
#endif`,im=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,nm=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
	#else
		gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
		gl_Position.z *= gl_Position.w;
	#endif
#endif`,rm=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,sm=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,am=`#ifdef USE_MAP
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif`,om=`#ifdef USE_MAP
	uniform mat3 uvTransform;
	uniform sampler2D map;
#endif`,lm=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,cm=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,hm=`#ifdef USE_MORPHNORMALS
	objectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];
	objectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];
	objectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];
	objectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];
#endif`,um=`#ifdef USE_MORPHTARGETS
	#ifndef USE_MORPHNORMALS
	uniform float morphTargetInfluences[ 8 ];
	#else
	uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,fm=`#ifdef USE_MORPHTARGETS
	transformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];
	transformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];
	transformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];
	transformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
	transformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];
	transformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];
	transformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];
	transformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];
	#endif
#endif`,dm=`#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
			bitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		#endif
	#endif
#endif`,pm=`#ifdef USE_NORMALMAP
	#ifdef OBJECTSPACE_NORMALMAP
		normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
		#ifdef FLIP_SIDED
			normal = - normal;
		#endif
		#ifdef DOUBLE_SIDED
			normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		#endif
		normal = normalize( normalMatrix * normal );
	#else
		#ifdef USE_TANGENT
			mat3 vTBN = mat3( tangent, bitangent, normal );
			vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
			mapN.xy = normalScale * mapN.xy;
			normal = normalize( vTBN * mapN );
		#else
			normal = perturbNormal2Arb( -vViewPosition, normal );
		#endif
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );
#endif`,mm=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
	#ifdef OBJECTSPACE_NORMALMAP
		uniform mat3 normalMatrix;
	#else
		vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {
			vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
			vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
			vec2 st0 = dFdx( vUv.st );
			vec2 st1 = dFdy( vUv.st );
			float scale = sign( st1.t * st0.s - st0.t * st1.s );
			vec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );
			vec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );
			vec3 N = normalize( surf_norm );
			mat3 tsn = mat3( S, T, N );
			vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
			mapN.xy *= normalScale;
			mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
			return normalize( tsn * mapN );
		}
	#endif
#endif`,gm=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,vm=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,ym=`vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );
gl_Position = projectionMatrix * mvPosition;`,xm=`#if defined( DITHERING )
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Em=`#if defined( DITHERING )
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,bm=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Tm=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,_m=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHTS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];
	#endif
	#if NUM_SPOT_LIGHTS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];
	#endif
	#if NUM_POINT_LIGHTS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	float texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {
		const vec2 offset = vec2( 0.0, 1.0 );
		vec2 texelSize = vec2( 1.0 ) / size;
		vec2 centroidUV = floor( uv * size + 0.5 ) / size;
		float lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );
		float lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );
		float rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );
		float rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );
		vec2 f = fract( uv * size + 0.5 );
		float a = mix( lb, lt, f.y );
		float b = mix( rb, rt, f.y );
		float c = mix( a, b, f.x );
		return c;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			shadow = (
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 9.0 );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,wm=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHTS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];
	#endif
	#if NUM_SPOT_LIGHTS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];
	#endif
	#if NUM_POINT_LIGHTS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];
	#endif
#endif`,Am=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;
	}
	#endif
	#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;
	}
	#endif
	#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;
	}
	#endif
#endif`,Sm=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHTS > 0
	DirectionalLight directionalLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		shadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#endif
	#if NUM_SPOT_LIGHTS > 0
	SpotLight spotLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		shadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#endif
	#if NUM_POINT_LIGHTS > 0
	PointLight pointLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		shadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#endif
	#endif
	return shadow;
}`,Lm=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Mm=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,Rm=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Im=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Cm=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Dm=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Pm=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Om=`#ifndef saturate
	#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
uniform float toneMappingWhitePoint;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );
}`,Fm=`#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )
	varying vec2 vUv;
#endif`,km=`#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif`,Nm=`#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,Bm=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,Um=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
#endif`,Gm=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = uv2;
#endif`,Hm=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
	vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );
#endif`,Vm=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,zm=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Wm=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = mapTexelToLinear( texColor );
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,jm=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,$m=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( gl_FragCoord.z );
	#endif
}`,Ym=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
}`,Km=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,Xm=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,qm=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV;
	sampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Zm=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,Jm=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <premultiplied_alpha_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Qm=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	vLineDistance = scale * lineDistance;
	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,eg=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		reflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <premultiplied_alpha_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,tg=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,ig=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	reflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ng=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,rg=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <premultiplied_alpha_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sg=`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,ag=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,og=`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,lg=`#define PHYSICAL
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifndef STANDARD
	uniform float clearCoat;
	uniform float clearCoatRoughness;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,cg=`#define PHYSICAL
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,hg=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,ug=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )
	vViewPosition = - mvPosition.xyz;
#endif
}`,fg=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <premultiplied_alpha_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,dg=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,pg=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <fog_fragment>
}`,mg=`#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,gg=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,vg=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,ze={alphamap_fragment:op,alphamap_pars_fragment:lp,alphatest_fragment:cp,aomap_fragment:hp,aomap_pars_fragment:up,begin_vertex:fp,beginnormal_vertex:dp,bsdfs:pp,bumpmap_pars_fragment:mp,clipping_planes_fragment:gp,clipping_planes_pars_fragment:vp,clipping_planes_pars_vertex:yp,clipping_planes_vertex:xp,color_fragment:Ep,color_pars_fragment:bp,color_pars_vertex:Tp,color_vertex:_p,common:wp,cube_uv_reflection_fragment:Ap,defaultnormal_vertex:Sp,displacementmap_pars_vertex:Lp,displacementmap_vertex:Mp,emissivemap_fragment:Rp,emissivemap_pars_fragment:Ip,encodings_fragment:Cp,encodings_pars_fragment:Dp,envmap_fragment:Pp,envmap_pars_fragment:Op,envmap_pars_vertex:Fp,envmap_physical_pars_fragment:$p,envmap_vertex:kp,fog_vertex:Np,fog_pars_vertex:Bp,fog_fragment:Up,fog_pars_fragment:Gp,gradientmap_pars_fragment:Hp,lightmap_fragment:Vp,lightmap_pars_fragment:zp,lights_lambert_vertex:Wp,lights_pars_begin:jp,lights_phong_fragment:Yp,lights_phong_pars_fragment:Kp,lights_physical_fragment:Xp,lights_physical_pars_fragment:qp,lights_fragment_begin:Zp,lights_fragment_maps:Jp,lights_fragment_end:Qp,logdepthbuf_fragment:em,logdepthbuf_pars_fragment:tm,logdepthbuf_pars_vertex:im,logdepthbuf_vertex:nm,map_fragment:rm,map_pars_fragment:sm,map_particle_fragment:am,map_particle_pars_fragment:om,metalnessmap_fragment:lm,metalnessmap_pars_fragment:cm,morphnormal_vertex:hm,morphtarget_pars_vertex:um,morphtarget_vertex:fm,normal_fragment_begin:dm,normal_fragment_maps:pm,normalmap_pars_fragment:mm,packing:gm,premultiplied_alpha_fragment:vm,project_vertex:ym,dithering_fragment:xm,dithering_pars_fragment:Em,roughnessmap_fragment:bm,roughnessmap_pars_fragment:Tm,shadowmap_pars_fragment:_m,shadowmap_pars_vertex:wm,shadowmap_vertex:Am,shadowmask_pars_fragment:Sm,skinbase_vertex:Lm,skinning_pars_vertex:Mm,skinning_vertex:Rm,skinnormal_vertex:Im,specularmap_fragment:Cm,specularmap_pars_fragment:Dm,tonemapping_fragment:Pm,tonemapping_pars_fragment:Om,uv_pars_fragment:Fm,uv_pars_vertex:km,uv_vertex:Nm,uv2_pars_fragment:Bm,uv2_pars_vertex:Um,uv2_vertex:Gm,worldpos_vertex:Hm,background_frag:Vm,background_vert:zm,cube_frag:Wm,cube_vert:jm,depth_frag:$m,depth_vert:Ym,distanceRGBA_frag:Km,distanceRGBA_vert:Xm,equirect_frag:qm,equirect_vert:Zm,linedashed_frag:Jm,linedashed_vert:Qm,meshbasic_frag:eg,meshbasic_vert:tg,meshlambert_frag:ig,meshlambert_vert:ng,meshmatcap_frag:rg,meshmatcap_vert:sg,meshphong_frag:ag,meshphong_vert:og,meshphysical_frag:lg,meshphysical_vert:cg,normal_frag:hg,normal_vert:ug,points_frag:fg,points_vert:dg,shadow_frag:pg,shadow_vert:mg,sprite_frag:gg,sprite_vert:vg};function Er(t){var e={};for(var i in t){e[i]={};for(var n in t[i]){var r=t[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?e[i][n]=r.clone():Array.isArray(r)?e[i][n]=r.slice():e[i][n]=r}}return e}function Jt(t){for(var e={},i=0;i<t.length;i++){var n=Er(t[i]);for(var r in n)e[r]=n[r]}return e}var yg={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function me(t,e,i){return e===void 0&&i===void 0?this.set(t):this.setRGB(t,e,i)}Object.assign(me.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,this},setRGB:function(t,e,i){return this.r=t,this.g=e,this.b=i,this},setHSL:function(){function t(e,i,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(i-e)*6*n:n<1/2?i:n<2/3?e+(i-e)*6*(2/3-n):e}return function(i,n,r){if(i=Te.euclideanModulo(i,1),n=Te.clamp(n,0,1),r=Te.clamp(r,0,1),n===0)this.r=this.g=this.b=r;else{var s=r<=.5?r*(1+n):r+n-r*n,a=2*r-s;this.r=t(a,s,i+1/3),this.g=t(a,s,i),this.b=t(a,s,i-1/3)}return this}}(),setStyle:function(t){function e(u){u!==void 0&&parseFloat(u)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var n,r=i[1],s=i[2];switch(r){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,e(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,e(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(s)){var a=parseFloat(n[1])/360,o=parseInt(n[2],10)/100,l=parseInt(n[3],10)/100;return e(n[5]),this.setHSL(a,o,l)}break}}else if(i=/^\#([A-Fa-f0-9]+)$/.exec(t)){var c=i[1],h=c.length;if(h===3)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(h===6)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}if(t&&t.length>0){var c=yg[t];c!==void 0?this.setHex(c):console.warn("THREE.Color: Unknown color "+t)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return e===void 0&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){e===void 0&&(e=2);var i=e>0?1/e:1;return this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(){function t(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}return function(i){return this.r=t(i.r),this.g=t(i.g),this.b=t(i.b),this}}(),copyLinearToSRGB:function(){function t(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}return function(i){return this.r=t(i.r),this.g=t(i.g),this.b=t(i.b),this}}(),convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){t===void 0&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e=this.r,i=this.g,n=this.b,r=Math.max(e,i,n),s=Math.min(e,i,n),a,o,l=(s+r)/2;if(s===r)a=0,o=0;else{var c=r-s;switch(o=l<=.5?c/(r+s):c/(2-r-s),r){case e:a=(i-n)/c+(i<n?6:0);break;case i:a=(n-e)/c+2;break;case n:a=(e-i)/c+4;break}a/=6}return t.h=a,t.s=o,t.l=l,t},getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(){var t={};return function(e,i,n){return this.getHSL(t),t.h+=e,t.s+=i,t.l+=n,this.setHSL(t.h,t.s,t.l),this}}(),add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},lerpHSL:function(){var t={h:0,s:0,l:0},e={h:0,s:0,l:0};return function(n,r){this.getHSL(t),n.getHSL(e);var s=Te.lerp(t.h,e.h,r),a=Te.lerp(t.s,e.s,r),o=Te.lerp(t.l,e.l,r);return this.setHSL(s,a,o),this}}(),equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return e===void 0&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}});var ge={common:{diffuse:{value:new me(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Rt},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new X(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new me(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new me(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new Rt}},sprite:{diffuse:{value:new me(15658734)},opacity:{value:1},center:{value:new X(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new Rt}}},xi={basic:{uniforms:Jt([ge.common,ge.specularmap,ge.envmap,ge.aomap,ge.lightmap,ge.fog]),vertexShader:ze.meshbasic_vert,fragmentShader:ze.meshbasic_frag},lambert:{uniforms:Jt([ge.common,ge.specularmap,ge.envmap,ge.aomap,ge.lightmap,ge.emissivemap,ge.fog,ge.lights,{emissive:{value:new me(0)}}]),vertexShader:ze.meshlambert_vert,fragmentShader:ze.meshlambert_frag},phong:{uniforms:Jt([ge.common,ge.specularmap,ge.envmap,ge.aomap,ge.lightmap,ge.emissivemap,ge.bumpmap,ge.normalmap,ge.displacementmap,ge.gradientmap,ge.fog,ge.lights,{emissive:{value:new me(0)},specular:{value:new me(1118481)},shininess:{value:30}}]),vertexShader:ze.meshphong_vert,fragmentShader:ze.meshphong_frag},standard:{uniforms:Jt([ge.common,ge.envmap,ge.aomap,ge.lightmap,ge.emissivemap,ge.bumpmap,ge.normalmap,ge.displacementmap,ge.roughnessmap,ge.metalnessmap,ge.fog,ge.lights,{emissive:{value:new me(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:ze.meshphysical_vert,fragmentShader:ze.meshphysical_frag},matcap:{uniforms:Jt([ge.common,ge.bumpmap,ge.normalmap,ge.displacementmap,ge.fog,{matcap:{value:null}}]),vertexShader:ze.meshmatcap_vert,fragmentShader:ze.meshmatcap_frag},points:{uniforms:Jt([ge.points,ge.fog]),vertexShader:ze.points_vert,fragmentShader:ze.points_frag},dashed:{uniforms:Jt([ge.common,ge.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ze.linedashed_vert,fragmentShader:ze.linedashed_frag},depth:{uniforms:Jt([ge.common,ge.displacementmap]),vertexShader:ze.depth_vert,fragmentShader:ze.depth_frag},normal:{uniforms:Jt([ge.common,ge.bumpmap,ge.normalmap,ge.displacementmap,{opacity:{value:1}}]),vertexShader:ze.normal_vert,fragmentShader:ze.normal_frag},sprite:{uniforms:Jt([ge.sprite,ge.fog]),vertexShader:ze.sprite_vert,fragmentShader:ze.sprite_frag},background:{uniforms:{uvTransform:{value:new Rt},t2D:{value:null}},vertexShader:ze.background_vert,fragmentShader:ze.background_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ze.cube_vert,fragmentShader:ze.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ze.equirect_vert,fragmentShader:ze.equirect_frag},distanceRGBA:{uniforms:Jt([ge.common,ge.displacementmap,{referencePosition:{value:new S},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ze.distanceRGBA_vert,fragmentShader:ze.distanceRGBA_frag},shadow:{uniforms:Jt([ge.lights,ge.fog,{color:{value:new me(0)},opacity:{value:1}}]),vertexShader:ze.shadow_vert,fragmentShader:ze.shadow_frag}};xi.physical={uniforms:Jt([xi.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:ze.meshphysical_vert,fragmentShader:ze.meshphysical_frag};function Il(){var t=null,e=!1,i=null;function n(r,s){e!==!1&&(i(r,s),t.requestAnimationFrame(n))}return{start:function(){e!==!0&&i!==null&&(t.requestAnimationFrame(n),e=!0)},stop:function(){e=!1},setAnimationLoop:function(r){i=r},setContext:function(r){t=r}}}function xg(t){var e=new WeakMap;function i(o,l){var c=o.array,h=o.dynamic?35048:35044,u=t.createBuffer();t.bindBuffer(l,u),t.bufferData(l,c,h),o.onUploadCallback();var f=5126;return c instanceof Float32Array?f=5126:c instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):c instanceof Uint16Array?f=5123:c instanceof Int16Array?f=5122:c instanceof Uint32Array?f=5125:c instanceof Int32Array?f=5124:c instanceof Int8Array?f=5120:c instanceof Uint8Array&&(f=5121),{buffer:u,type:f,bytesPerElement:c.BYTES_PER_ELEMENT,version:o.version}}function n(o,l,c){var h=l.array,u=l.updateRange;t.bindBuffer(c,o),l.dynamic===!1?t.bufferData(c,h,35044):u.count===-1?t.bufferSubData(c,0,h):u.count===0?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(t.bufferSubData(c,u.offset*h.BYTES_PER_ELEMENT,h.subarray(u.offset,u.offset+u.count)),u.count=-1)}function r(o){return o.isInterleavedBufferAttribute&&(o=o.data),e.get(o)}function s(o){o.isInterleavedBufferAttribute&&(o=o.data);var l=e.get(o);l&&(t.deleteBuffer(l.buffer),e.delete(o))}function a(o,l){o.isInterleavedBufferAttribute&&(o=o.data);var c=e.get(o);c===void 0?e.set(o,i(o,l)):c.version<o.version&&(n(c.buffer,o,l),c.version=o.version)}return{get:r,remove:s,update:a}}function Cs(t,e,i,n,r,s){this.a=t,this.b=e,this.c=i,this.normal=n&&n.isVector3?n:new S,this.vertexNormals=Array.isArray(n)?n:[],this.color=r&&r.isColor?r:new me,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=s!==void 0?s:0}Object.assign(Cs.prototype,{clone:function(){return new this.constructor().copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,i=t.vertexNormals.length;e<i;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(var e=0,i=t.vertexColors.length;e<i;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}});function bn(t,e,i,n){this._x=t||0,this._y=e||0,this._z=i||0,this._order=n||bn.DefaultOrder}bn.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];bn.DefaultOrder="XYZ";Object.defineProperties(bn.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this.onChangeCallback()}}});Object.assign(bn.prototype,{isEuler:!0,set:function(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._order=n||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e,i){var n=Te.clamp,r=t.elements,s=r[0],a=r[4],o=r[8],l=r[1],c=r[5],h=r[9],u=r[2],f=r[6],d=r[10];return e=e||this._order,e==="XYZ"?(this._y=Math.asin(n(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(-h,d),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(f,c),this._z=0)):e==="YXZ"?(this._x=Math.asin(-n(h,-1,1)),Math.abs(h)<.99999?(this._y=Math.atan2(o,d),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-u,s),this._z=0)):e==="ZXY"?(this._x=Math.asin(n(f,-1,1)),Math.abs(f)<.99999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,s))):e==="ZYX"?(this._y=Math.asin(-n(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(f,d),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-a,c))):e==="YZX"?(this._z=Math.asin(n(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-u,s)):(this._x=0,this._y=Math.atan2(o,d))):e==="XZY"?(this._z=Math.asin(-n(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(f,c),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-h,d),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,i!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var t=new we;return function(i,n,r){return t.makeRotationFromQuaternion(i),this.setFromRotationMatrix(t,n,r)}}(),setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(){var t=new tt;return function(i){return t.setFromEuler(this),this.setFromQuaternion(t,i)}}(),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new S(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}});function tu(){this.mask=1}Object.assign(tu.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},test:function(t){return(this.mask&t.mask)!==0}});var Eg=0;function ce(){Object.defineProperty(this,"id",{value:Eg++}),this.uuid=Te.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ce.DefaultUp.clone();var t=new S,e=new bn,i=new tt,n=new S(1,1,1);function r(){i.setFromEuler(e,!1)}function s(){e.setFromQuaternion(i,void 0,!1)}e.onChange(r),i.onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new we},normalMatrix:{value:new Rt}}),this.matrix=new we,this.matrixWorld=new we,this.matrixAutoUpdate=ce.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new tu,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}ce.DefaultUp=new S(0,1,0);ce.DefaultMatrixAutoUpdate=!0;ce.prototype=Object.assign(Object.create(Zt.prototype),{constructor:ce,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(){var t=new tt;return function(i,n){return t.setFromAxisAngle(i,n),this.quaternion.multiply(t),this}}(),rotateOnWorldAxis:function(){var t=new tt;return function(i,n){return t.setFromAxisAngle(i,n),this.quaternion.premultiply(t),this}}(),rotateX:function(){var t=new S(1,0,0);return function(i){return this.rotateOnAxis(t,i)}}(),rotateY:function(){var t=new S(0,1,0);return function(i){return this.rotateOnAxis(t,i)}}(),rotateZ:function(){var t=new S(0,0,1);return function(i){return this.rotateOnAxis(t,i)}}(),translateOnAxis:function(){var t=new S;return function(i,n){return t.copy(i).applyQuaternion(this.quaternion),this.position.add(t.multiplyScalar(n)),this}}(),translateX:function(){var t=new S(1,0,0);return function(i){return this.translateOnAxis(t,i)}}(),translateY:function(){var t=new S(0,1,0);return function(i){return this.translateOnAxis(t,i)}}(),translateZ:function(){var t=new S(0,0,1);return function(i){return this.translateOnAxis(t,i)}}(),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var t=new we;return function(i){return i.applyMatrix4(t.getInverse(this.matrixWorld))}}(),lookAt:function(){var t=new tt,e=new we,i=new S,n=new S;return function(s,a,o){s.isVector3?i.copy(s):i.set(s,a,o);var l=this.parent;this.updateWorldMatrix(!0,!1),n.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?e.lookAt(n,i,this.up):e.lookAt(i,n,this.up),this.quaternion.setFromRotationMatrix(e),l&&(e.extractRotation(l.matrixWorld),t.setFromRotationMatrix(e),this.quaternion.premultiply(t.inverse()))}}(),add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var i=this.children.indexOf(t);return i!==-1&&(t.parent=null,t.dispatchEvent({type:"removed"}),this.children.splice(i,1)),this},attach:function(){var t=new we;return function(i){return this.updateWorldMatrix(!0,!1),t.getInverse(this.matrixWorld),i.parent!==null&&(i.parent.updateWorldMatrix(!0,!1),t.multiply(i.parent.matrixWorld)),i.applyMatrix(t),i.updateWorldMatrix(!1,!1),this.add(i),this}}(),getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var i=0,n=this.children.length;i<n;i++){var r=this.children[i],s=r.getObjectByProperty(t,e);if(s!==void 0)return s}},getWorldPosition:function(t){return t===void 0&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new S),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var t=new S,e=new S;return function(n){return n===void 0&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),n=new tt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,n,e),n}}(),getWorldScale:function(){var t=new S,e=new tt;return function(n){return n===void 0&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),n=new S),this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,e,n),n}}(),getWorldDirection:function(t){t===void 0&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new S),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var e=this.children,i=0,n=e.length;i<n;i++)e[i].traverse(t)},traverseVisible:function(t){if(this.visible!==!1){t(this);for(var e=this.children,i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,i=0,n=e.length;i<n;i++)e[i].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){var i=this.parent;if(t===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0)for(var n=this.children,r=0,s=n.length;r<s;r++)n[r].updateWorldMatrix(!1,!0)},toJSON:function(t){var e=t===void 0||typeof t=="string",i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isMesh&&this.drawMode!==Rl&&(n.drawMode=this.drawMode);function r(g,v){return g[v.uuid]===void 0&&(g[v.uuid]=v.toJSON(t)),v.uuid}if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(t.geometries,this.geometry);var s=this.geometry.parameters;if(s!==void 0&&s.shapes!==void 0){var a=s.shapes;if(Array.isArray(a))for(var o=0,l=a.length;o<l;o++){var c=a[o];r(t.shapes,c)}else r(t.shapes,a)}}if(this.material!==void 0)if(Array.isArray(this.material)){for(var h=[],o=0,l=this.material.length;o<l;o++)h.push(r(t.materials,this.material[o]));n.material=h}else n.material=r(t.materials,this.material);if(this.children.length>0){n.children=[];for(var o=0;o<this.children.length;o++)n.children.push(this.children[o].toJSON(t).object)}if(e){var u=m(t.geometries),f=m(t.materials),d=m(t.textures),p=m(t.images),a=m(t.shapes);u.length>0&&(i.geometries=u),f.length>0&&(i.materials=f),d.length>0&&(i.textures=d),p.length>0&&(i.images=p),a.length>0&&(i.shapes=a)}return i.object=n,i;function m(g){var v=[];for(var x in g){var y=g[x];delete y.metadata,v.push(y)}return v}},clone:function(t){return new this.constructor().copy(this,t)},copy:function(t,e){if(e===void 0&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(var i=0;i<t.children.length;i++){var n=t.children[i];this.add(n.clone())}return this}});var bg=0;function Ie(){Object.defineProperty(this,"id",{value:bg+=2}),this.uuid=Te.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}Ie.prototype=Object.assign(Object.create(Zt.prototype),{constructor:Ie,isGeometry:!0,applyMatrix:function(t){for(var e=new Rt().getNormalMatrix(t),i=0,n=this.vertices.length;i<n;i++){var r=this.vertices[i];r.applyMatrix4(t)}for(var i=0,n=this.faces.length;i<n;i++){var s=this.faces[i];s.normal.applyMatrix3(e).normalize();for(var a=0,o=s.vertexNormals.length;a<o;a++)s.vertexNormals[a].applyMatrix3(e).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var t=new we;return function(i){return t.makeRotationX(i),this.applyMatrix(t),this}}(),rotateY:function(){var t=new we;return function(i){return t.makeRotationY(i),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new we;return function(i){return t.makeRotationZ(i),this.applyMatrix(t),this}}(),translate:function(){var t=new we;return function(i,n,r){return t.makeTranslation(i,n,r),this.applyMatrix(t),this}}(),scale:function(){var t=new we;return function(i,n,r){return t.makeScale(i,n,r),this.applyMatrix(t),this}}(),lookAt:function(){var t=new ce;return function(i){t.lookAt(i),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),fromBufferGeometry:function(t){var e=this,i=t.index!==null?t.index.array:void 0,n=t.attributes,r=n.position.array,s=n.normal!==void 0?n.normal.array:void 0,a=n.color!==void 0?n.color.array:void 0,o=n.uv!==void 0?n.uv.array:void 0,l=n.uv2!==void 0?n.uv2.array:void 0;l!==void 0&&(this.faceVertexUvs[1]=[]);for(var c=0;c<r.length;c+=3)e.vertices.push(new S().fromArray(r,c)),a!==void 0&&e.colors.push(new me().fromArray(a,c));function h(v,x,y,b){var E=a===void 0?[]:[e.colors[v].clone(),e.colors[x].clone(),e.colors[y].clone()],w=s===void 0?[]:[new S().fromArray(s,v*3),new S().fromArray(s,x*3),new S().fromArray(s,y*3)],A=new Cs(v,x,y,w,E,b);e.faces.push(A),o!==void 0&&e.faceVertexUvs[0].push([new X().fromArray(o,v*2),new X().fromArray(o,x*2),new X().fromArray(o,y*2)]),l!==void 0&&e.faceVertexUvs[1].push([new X().fromArray(l,v*2),new X().fromArray(l,x*2),new X().fromArray(l,y*2)])}var u=t.groups;if(u.length>0)for(var c=0;c<u.length;c++)for(var f=u[c],d=f.start,p=f.count,m=d,g=d+p;m<g;m+=3)i!==void 0?h(i[m],i[m+1],i[m+2],f.materialIndex):h(m,m+1,m+2,f.materialIndex);else if(i!==void 0)for(var c=0;c<i.length;c+=3)h(i[c],i[c+1],i[c+2]);else for(var c=0;c<r.length/3;c+=3)h(c,c+1,c+2);return this.computeFaceNormals(),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){var t=new S;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(t).negate(),this.translate(t.x,t.y,t.z),this}}(),normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,i=e===0?1:1/e,n=new we;return n.set(i,0,0,-i*t.x,0,i,0,-i*t.y,0,0,i,-i*t.z,0,0,0,1),this.applyMatrix(n),this},computeFaceNormals:function(){for(var t=new S,e=new S,i=0,n=this.faces.length;i<n;i++){var r=this.faces[i],s=this.vertices[r.a],a=this.vertices[r.b],o=this.vertices[r.c];t.subVectors(o,a),e.subVectors(s,a),t.cross(e),t.normalize(),r.normal.copy(t)}},computeVertexNormals:function(t){t===void 0&&(t=!0);var e,i,n,r,s,a;for(a=new Array(this.vertices.length),e=0,i=this.vertices.length;e<i;e++)a[e]=new S;if(t){var o,l,c,h=new S,u=new S;for(n=0,r=this.faces.length;n<r;n++)s=this.faces[n],o=this.vertices[s.a],l=this.vertices[s.b],c=this.vertices[s.c],h.subVectors(c,l),u.subVectors(o,l),h.cross(u),a[s.a].add(h),a[s.b].add(h),a[s.c].add(h)}else for(this.computeFaceNormals(),n=0,r=this.faces.length;n<r;n++)s=this.faces[n],a[s.a].add(s.normal),a[s.b].add(s.normal),a[s.c].add(s.normal);for(e=0,i=this.vertices.length;e<i;e++)a[e].normalize();for(n=0,r=this.faces.length;n<r;n++){s=this.faces[n];var f=s.vertexNormals;f.length===3?(f[0].copy(a[s.a]),f[1].copy(a[s.b]),f[2].copy(a[s.c])):(f[0]=a[s.a].clone(),f[1]=a[s.b].clone(),f[2]=a[s.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e,i;for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++){i=this.faces[t];var n=i.vertexNormals;n.length===3?(n[0].copy(i.normal),n[1].copy(i.normal),n[2].copy(i.normal)):(n[0]=i.normal.clone(),n[1]=i.normal.clone(),n[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,i,n,r;for(i=0,n=this.faces.length;i<n;i++)for(r=this.faces[i],r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]),t=0,e=r.vertexNormals.length;t<e;t++)r.__originalVertexNormals[t]?r.__originalVertexNormals[t].copy(r.vertexNormals[t]):r.__originalVertexNormals[t]=r.vertexNormals[t].clone();var s=new Ie;for(s.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var a=this.morphNormals[t].faceNormals,o=this.morphNormals[t].vertexNormals,c,h;for(i=0,n=this.faces.length;i<n;i++)c=new S,h={a:new S,b:new S,c:new S},a.push(c),o.push(h)}var l=this.morphNormals[t];s.vertices=this.morphTargets[t].vertices,s.computeFaceNormals(),s.computeVertexNormals();var c,h;for(i=0,n=this.faces.length;i<n;i++)r=this.faces[i],c=l.faceNormals[i],h=l.vertexNormals[i],c.copy(r.normal),h.a.copy(r.vertexNormals[0]),h.b.copy(r.vertexNormals[1]),h.c.copy(r.vertexNormals[2])}for(i=0,n=this.faces.length;i<n;i++)r=this.faces[i],r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new Ti),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new Ui),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,i){if(!(t&&t.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);return}var n,r=this.vertices.length,s=this.vertices,a=t.vertices,o=this.faces,l=t.faces,c=this.faceVertexUvs[0],h=t.faceVertexUvs[0],u=this.colors,f=t.colors;i===void 0&&(i=0),e!==void 0&&(n=new Rt().getNormalMatrix(e));for(var d=0,p=a.length;d<p;d++){var m=a[d],g=m.clone();e!==void 0&&g.applyMatrix4(e),s.push(g)}for(var d=0,p=f.length;d<p;d++)u.push(f[d].clone());for(d=0,p=l.length;d<p;d++){var v=l[d],x,y,b,E=v.vertexNormals,w=v.vertexColors;x=new Cs(v.a+r,v.b+r,v.c+r),x.normal.copy(v.normal),n!==void 0&&x.normal.applyMatrix3(n).normalize();for(var A=0,D=E.length;A<D;A++)y=E[A].clone(),n!==void 0&&y.applyMatrix3(n).normalize(),x.vertexNormals.push(y);x.color.copy(v.color);for(var A=0,D=w.length;A<D;A++)b=w[A],x.vertexColors.push(b.clone());x.materialIndex=v.materialIndex+i,o.push(x)}for(d=0,p=h.length;d<p;d++){var O=h[d],P=[];if(O!==void 0){for(var A=0,D=O.length;A<D;A++)P.push(O[A].clone());c.push(P)}}},mergeMesh:function(t){if(!(t&&t.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t);return}t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)},mergeVertices:function(){var t={},e=[],i=[],n,r,s=4,a=Math.pow(10,s),o,l,c,h,u,f;for(o=0,l=this.vertices.length;o<l;o++)n=this.vertices[o],r=Math.round(n.x*a)+"_"+Math.round(n.y*a)+"_"+Math.round(n.z*a),t[r]===void 0?(t[r]=o,e.push(this.vertices[o]),i[o]=e.length-1):i[o]=i[t[r]];var d=[];for(o=0,l=this.faces.length;o<l;o++){c=this.faces[o],c.a=i[c.a],c.b=i[c.b],c.c=i[c.c],h=[c.a,c.b,c.c];for(var p=0;p<3;p++)if(h[p]===h[(p+1)%3]){d.push(o);break}}for(o=d.length-1;o>=0;o--){var m=d[o];for(this.faces.splice(m,1),u=0,f=this.faceVertexUvs.length;u<f;u++)this.faceVertexUvs[u].splice(m,1)}var g=this.vertices.length-e.length;return this.vertices=e,g},setFromPoints:function(t){this.vertices=[];for(var e=0,i=t.length;e<i;e++){var n=t[e];this.vertices.push(new S(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,i=0;i<e;i++)t[i]._id=i;function n(c,h){return c.materialIndex-h.materialIndex}t.sort(n);var r=this.faceVertexUvs[0],s=this.faceVertexUvs[1],a,o;r&&r.length===e&&(a=[]),s&&s.length===e&&(o=[]);for(var i=0;i<e;i++){var l=t[i]._id;a&&a.push(r[l]),o&&o.push(s[l])}a&&(this.faceVertexUvs[0]=a),o&&(this.faceVertexUvs[1]=o)},toJSON:function(){var t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),this.parameters!==void 0){var e=this.parameters;for(var i in e)e[i]!==void 0&&(t[i]=e[i]);return t}for(var n=[],r=0;r<this.vertices.length;r++){var s=this.vertices[r];n.push(s.x,s.y,s.z)}for(var a=[],o=[],l={},c=[],h={},u=[],f={},r=0;r<this.faces.length;r++){var d=this.faces[r],p=!0,m=!1,g=this.faceVertexUvs[0][r]!==void 0,v=d.normal.length()>0,x=d.vertexNormals.length>0,y=d.color.r!==1||d.color.g!==1||d.color.b!==1,b=d.vertexColors.length>0,E=0;if(E=O(E,0,0),E=O(E,1,p),E=O(E,2,m),E=O(E,3,g),E=O(E,4,v),E=O(E,5,x),E=O(E,6,y),E=O(E,7,b),a.push(E),a.push(d.a,d.b,d.c),a.push(d.materialIndex),g){var w=this.faceVertexUvs[0][r];a.push(C(w[0]),C(w[1]),C(w[2]))}if(v&&a.push(P(d.normal)),x){var A=d.vertexNormals;a.push(P(A[0]),P(A[1]),P(A[2]))}if(y&&a.push(L(d.color)),b){var D=d.vertexColors;a.push(L(D[0]),L(D[1]),L(D[2]))}}function O(U,j,K){return K?U|1<<j:U&~(1<<j)}function P(U){var j=U.x.toString()+U.y.toString()+U.z.toString();return l[j]!==void 0||(l[j]=o.length/3,o.push(U.x,U.y,U.z)),l[j]}function L(U){var j=U.r.toString()+U.g.toString()+U.b.toString();return h[j]!==void 0||(h[j]=c.length,c.push(U.getHex())),h[j]}function C(U){var j=U.x.toString()+U.y.toString();return f[j]!==void 0||(f[j]=u.length/2,u.push(U.x,U.y)),f[j]}return t.data={},t.data.vertices=n,t.data.normals=o,c.length>0&&(t.data.colors=c),u.length>0&&(t.data.uvs=[u]),t.data.faces=a,t},clone:function(){return new Ie().copy(this)},copy:function(t){var e,i,n,r,s,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var o=t.vertices;for(e=0,i=o.length;e<i;e++)this.vertices.push(o[e].clone());var l=t.colors;for(e=0,i=l.length;e<i;e++)this.colors.push(l[e].clone());var c=t.faces;for(e=0,i=c.length;e<i;e++)this.faces.push(c[e].clone());for(e=0,i=t.faceVertexUvs.length;e<i;e++){var h=t.faceVertexUvs[e];for(this.faceVertexUvs[e]===void 0&&(this.faceVertexUvs[e]=[]),n=0,r=h.length;n<r;n++){var u=h[n],f=[];for(s=0,a=u.length;s<a;s++){var d=u[s];f.push(d.clone())}this.faceVertexUvs[e].push(f)}}var p=t.morphTargets;for(e=0,i=p.length;e<i;e++){var m={};if(m.name=p[e].name,p[e].vertices!==void 0)for(m.vertices=[],n=0,r=p[e].vertices.length;n<r;n++)m.vertices.push(p[e].vertices[n].clone());if(p[e].normals!==void 0)for(m.normals=[],n=0,r=p[e].normals.length;n<r;n++)m.normals.push(p[e].normals[n].clone());this.morphTargets.push(m)}var g=t.morphNormals;for(e=0,i=g.length;e<i;e++){var v={};if(g[e].vertexNormals!==void 0)for(v.vertexNormals=[],n=0,r=g[e].vertexNormals.length;n<r;n++){var x=g[e].vertexNormals[n],y={};y.a=x.a.clone(),y.b=x.b.clone(),y.c=x.c.clone(),v.vertexNormals.push(y)}if(g[e].faceNormals!==void 0)for(v.faceNormals=[],n=0,r=g[e].faceNormals.length;n<r;n++)v.faceNormals.push(g[e].faceNormals[n].clone());this.morphNormals.push(v)}var b=t.skinWeights;for(e=0,i=b.length;e<i;e++)this.skinWeights.push(b[e].clone());var E=t.skinIndices;for(e=0,i=E.length;e<i;e++)this.skinIndices.push(E[e].clone());var w=t.lineDistances;for(e=0,i=w.length;e<i;e++)this.lineDistances.push(w[e]);var A=t.boundingBox;A!==null&&(this.boundingBox=A.clone());var D=t.boundingSphere;return D!==null&&(this.boundingSphere=D.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});function Fe(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=i===!0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}Object.defineProperty(Fe.prototype,"needsUpdate",{set:function(t){t===!0&&this.version++}});Object.assign(Fe.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=t!==void 0?t.length/this.itemSize:0,this.array=t,this},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.dynamic=t.dynamic,this},copyAt:function(t,e,i){t*=this.itemSize,i*=e.itemSize;for(var n=0,r=this.itemSize;n<r;n++)this.array[t+n]=e.array[i+n];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var s=t[n];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),s=new me),e[i++]=s.r,e[i++]=s.g,e[i++]=s.b}return this},copyVector2sArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var s=t[n];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),s=new X),e[i++]=s.x,e[i++]=s.y}return this},copyVector3sArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var s=t[n];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),s=new S),e[i++]=s.x,e[i++]=s.y,e[i++]=s.z}return this},copyVector4sArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var s=t[n];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),s=new et),e[i++]=s.x,e[i++]=s.y,e[i++]=s.z,e[i++]=s.w}return this},set:function(t,e){return e===void 0&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this},setXYZ:function(t,e,i,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this},setXYZW:function(t,e,i,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=r,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}});function To(t,e,i){Fe.call(this,new Int8Array(t),e,i)}To.prototype=Object.create(Fe.prototype);To.prototype.constructor=To;function _o(t,e,i){Fe.call(this,new Uint8Array(t),e,i)}_o.prototype=Object.create(Fe.prototype);_o.prototype.constructor=_o;function wo(t,e,i){Fe.call(this,new Uint8ClampedArray(t),e,i)}wo.prototype=Object.create(Fe.prototype);wo.prototype.constructor=wo;function Ao(t,e,i){Fe.call(this,new Int16Array(t),e,i)}Ao.prototype=Object.create(Fe.prototype);Ao.prototype.constructor=Ao;function br(t,e,i){Fe.call(this,new Uint16Array(t),e,i)}br.prototype=Object.create(Fe.prototype);br.prototype.constructor=br;function So(t,e,i){Fe.call(this,new Int32Array(t),e,i)}So.prototype=Object.create(Fe.prototype);So.prototype.constructor=So;function Tr(t,e,i){Fe.call(this,new Uint32Array(t),e,i)}Tr.prototype=Object.create(Fe.prototype);Tr.prototype.constructor=Tr;function le(t,e,i){Fe.call(this,new Float32Array(t),e,i)}le.prototype=Object.create(Fe.prototype);le.prototype.constructor=le;function Lo(t,e,i){Fe.call(this,new Float64Array(t),e,i)}Lo.prototype=Object.create(Fe.prototype);Lo.prototype.constructor=Lo;function iu(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}Object.assign(iu.prototype,{computeGroups:function(t){for(var e,i=[],n=void 0,r=t.faces,s=0;s<r.length;s++){var a=r[s];a.materialIndex!==n&&(n=a.materialIndex,e!==void 0&&(e.count=s*3-e.start,i.push(e)),e={start:s*3,materialIndex:n})}e!==void 0&&(e.count=s*3-e.start,i.push(e)),this.groups=i},fromGeometry:function(t){var e=t.faces,i=t.vertices,n=t.faceVertexUvs,r=n[0]&&n[0].length>0,s=n[1]&&n[1].length>0,a=t.morphTargets,o=a.length,l;if(o>0){l=[];for(var c=0;c<o;c++)l[c]={name:a[c].name,data:[]};this.morphTargets.position=l}var h=t.morphNormals,u=h.length,f;if(u>0){f=[];for(var c=0;c<u;c++)f[c]={name:h[c].name,data:[]};this.morphTargets.normal=f}var d=t.skinIndices,p=t.skinWeights,m=d.length===i.length,g=p.length===i.length;i.length>0&&e.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(var c=0;c<e.length;c++){var v=e[c];this.vertices.push(i[v.a],i[v.b],i[v.c]);var x=v.vertexNormals;if(x.length===3)this.normals.push(x[0],x[1],x[2]);else{var y=v.normal;this.normals.push(y,y,y)}var b=v.vertexColors;if(b.length===3)this.colors.push(b[0],b[1],b[2]);else{var E=v.color;this.colors.push(E,E,E)}if(r===!0){var w=n[0][c];w!==void 0?this.uvs.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new X,new X,new X))}if(s===!0){var w=n[1][c];w!==void 0?this.uvs2.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new X,new X,new X))}for(var A=0;A<o;A++){var D=a[A].vertices;l[A].data.push(D[v.a],D[v.b],D[v.c])}for(var A=0;A<u;A++){var O=h[A].vertexNormals[c];f[A].data.push(O.a,O.b,O.c)}m&&this.skinIndices.push(d[v.a],d[v.b],d[v.c]),g&&this.skinWeights.push(p[v.a],p[v.b],p[v.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}});function nu(t){if(t.length===0)return-1/0;for(var e=t[0],i=1,n=t.length;i<n;++i)t[i]>e&&(e=t[i]);return e}var Tg=1;function he(){Object.defineProperty(this,"id",{value:Tg+=2}),this.uuid=Te.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}he.prototype=Object.assign(Object.create(Zt.prototype),{constructor:he,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(nu(t)>65535?Tr:br)(t,1):this.index=t},addAttribute:function(t,e){return!(e&&e.isBufferAttribute)&&!(e&&e.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(t,new Fe(arguments[1],arguments[2]))):t==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):(this.attributes[t]=e,this)},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,i){this.groups.push({start:t,count:e,materialIndex:i!==void 0?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix:function(t){var e=this.attributes.position;e!==void 0&&(t.applyToBufferAttribute(e),e.needsUpdate=!0);var i=this.attributes.normal;if(i!==void 0){var n=new Rt().getNormalMatrix(t);n.applyToBufferAttribute(i),i.needsUpdate=!0}var r=this.attributes.tangent;if(r!==void 0){var n=new Rt().getNormalMatrix(t);n.applyToBufferAttribute(r),r.needsUpdate=!0}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this},rotateX:function(){var t=new we;return function(i){return t.makeRotationX(i),this.applyMatrix(t),this}}(),rotateY:function(){var t=new we;return function(i){return t.makeRotationY(i),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new we;return function(i){return t.makeRotationZ(i),this.applyMatrix(t),this}}(),translate:function(){var t=new we;return function(i,n,r){return t.makeTranslation(i,n,r),this.applyMatrix(t),this}}(),scale:function(){var t=new we;return function(i,n,r){return t.makeScale(i,n,r),this.applyMatrix(t),this}}(),lookAt:function(){var t=new ce;return function(i){t.lookAt(i),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),center:function(){var t=new S;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(t).negate(),this.translate(t.x,t.y,t.z),this}}(),setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){var i=new le(e.vertices.length*3,3),n=new le(e.colors.length*3,3);if(this.addAttribute("position",i.copyVector3sArray(e.vertices)),this.addAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var r=new le(e.lineDistances.length,1);this.addAttribute("lineDistance",r.copyArray(e.lineDistances))}e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){for(var e=[],i=0,n=t.length;i<n;i++){var r=t[i];e.push(r.x,r.y,r.z||0)}return this.addAttribute("position",new le(e,3)),this},updateFromObject:function(t){var e=t.geometry;if(t.isMesh){var i=e.__directGeometry;if(e.elementsNeedUpdate===!0&&(i=void 0,e.elementsNeedUpdate=!1),i===void 0)return this.fromGeometry(e);i.verticesNeedUpdate=e.verticesNeedUpdate,i.normalsNeedUpdate=e.normalsNeedUpdate,i.colorsNeedUpdate=e.colorsNeedUpdate,i.uvsNeedUpdate=e.uvsNeedUpdate,i.groupsNeedUpdate=e.groupsNeedUpdate,e.verticesNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.groupsNeedUpdate=!1,e=i}var n;return e.verticesNeedUpdate===!0&&(n=this.attributes.position,n!==void 0&&(n.copyVector3sArray(e.vertices),n.needsUpdate=!0),e.verticesNeedUpdate=!1),e.normalsNeedUpdate===!0&&(n=this.attributes.normal,n!==void 0&&(n.copyVector3sArray(e.normals),n.needsUpdate=!0),e.normalsNeedUpdate=!1),e.colorsNeedUpdate===!0&&(n=this.attributes.color,n!==void 0&&(n.copyColorsArray(e.colors),n.needsUpdate=!0),e.colorsNeedUpdate=!1),e.uvsNeedUpdate&&(n=this.attributes.uv,n!==void 0&&(n.copyVector2sArray(e.uvs),n.needsUpdate=!0),e.uvsNeedUpdate=!1),e.lineDistancesNeedUpdate&&(n=this.attributes.lineDistance,n!==void 0&&(n.copyArray(e.lineDistances),n.needsUpdate=!0),e.lineDistancesNeedUpdate=!1),e.groupsNeedUpdate&&(e.computeGroups(t.geometry),this.groups=e.groups,e.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=new iu().fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(t.vertices.length*3);if(this.addAttribute("position",new Fe(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var i=new Float32Array(t.normals.length*3);this.addAttribute("normal",new Fe(i,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var n=new Float32Array(t.colors.length*3);this.addAttribute("color",new Fe(n,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var r=new Float32Array(t.uvs.length*2);this.addAttribute("uv",new Fe(r,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var s=new Float32Array(t.uvs2.length*2);this.addAttribute("uv2",new Fe(s,2).copyVector2sArray(t.uvs2))}this.groups=t.groups;for(var a in t.morphTargets){for(var o=[],l=t.morphTargets[a],c=0,h=l.length;c<h;c++){var u=l[c],f=new le(u.data.length*3,3);f.name=u.name,o.push(f.copyVector3sArray(u.data))}this.morphAttributes[a]=o}if(t.skinIndices.length>0){var d=new le(t.skinIndices.length*4,4);this.addAttribute("skinIndex",d.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var p=new le(t.skinWeights.length*4,4);this.addAttribute("skinWeight",p.copyVector4sArray(t.skinWeights))}return t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){var t=new Ti;return function(){this.boundingBox===null&&(this.boundingBox=new Ti);var i=this.attributes.position,n=this.morphAttributes.position;if(i!==void 0){if(this.boundingBox.setFromBufferAttribute(i),n)for(var r=0,s=n.length;r<s;r++){var a=n[r];t.setFromBufferAttribute(a),this.boundingBox.expandByPoint(t.min),this.boundingBox.expandByPoint(t.max)}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}}(),computeBoundingSphere:function(){var t=new Ti,e=new Ti,i=new S;return function(){this.boundingSphere===null&&(this.boundingSphere=new Ui);var r=this.attributes.position,s=this.morphAttributes.position;if(r){var a=this.boundingSphere.center;if(t.setFromBufferAttribute(r),s)for(var o=0,l=s.length;o<l;o++){var c=s[o];e.setFromBufferAttribute(c),t.expandByPoint(e.min),t.expandByPoint(e.max)}t.getCenter(a);for(var h=0,o=0,l=r.count;o<l;o++)i.fromBufferAttribute(r,o),h=Math.max(h,a.distanceToSquared(i));if(s)for(var o=0,l=s.length;o<l;o++)for(var c=s[o],u=0,f=c.count;u<f;u++)i.fromBufferAttribute(c,u),h=Math.max(h,a.distanceToSquared(i));this.boundingSphere.radius=Math.sqrt(h),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes;if(e.position){var i=e.position.array;if(e.normal===void 0)this.addAttribute("normal",new Fe(new Float32Array(i.length),3));else for(var n=e.normal.array,r=0,s=n.length;r<s;r++)n[r]=0;var a=e.normal.array,o,l,c,h=new S,u=new S,f=new S,d=new S,p=new S;if(t)for(var m=t.array,r=0,s=t.count;r<s;r+=3)o=m[r+0]*3,l=m[r+1]*3,c=m[r+2]*3,h.fromArray(i,o),u.fromArray(i,l),f.fromArray(i,c),d.subVectors(f,u),p.subVectors(h,u),d.cross(p),a[o]+=d.x,a[o+1]+=d.y,a[o+2]+=d.z,a[l]+=d.x,a[l+1]+=d.y,a[l+2]+=d.z,a[c]+=d.x,a[c+1]+=d.y,a[c+2]+=d.z;else for(var r=0,s=i.length;r<s;r+=9)h.fromArray(i,r),u.fromArray(i,r+3),f.fromArray(i,r+6),d.subVectors(f,u),p.subVectors(h,u),d.cross(p),a[r]=d.x,a[r+1]=d.y,a[r+2]=d.z,a[r+3]=d.x,a[r+4]=d.y,a[r+5]=d.z,a[r+6]=d.x,a[r+7]=d.y,a[r+8]=d.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(!(t&&t.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);return}e===void 0&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var i=this.attributes;for(var n in i)if(t.attributes[n]!==void 0)for(var r=i[n],s=r.array,a=t.attributes[n],o=a.array,l=a.itemSize*e,c=Math.min(o.length,s.length-l),h=0,u=l;h<c;h++,u++)s[u]=o[h];return this},normalizeNormals:function(){var t=new S;return function(){for(var i=this.attributes.normal,n=0,r=i.count;n<r;n++)t.x=i.getX(n),t.y=i.getY(n),t.z=i.getZ(n),t.normalize(),i.setXYZ(n,t.x,t.y,t.z)}}(),toNonIndexed:function(){function t(m,g){for(var v=m.array,x=m.itemSize,y=new v.constructor(g.length*x),b=0,E=0,w=0,A=g.length;w<A;w++){b=g[w]*x;for(var D=0;D<x;D++)y[E++]=v[b++]}return new Fe(y,x)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new he,i=this.index.array,n=this.attributes;for(var r in n){var s=n[r],a=t(s,i);e.addAttribute(r,a)}var o=this.morphAttributes;for(r in o){for(var l=[],c=o[r],h=0,u=c.length;h<u;h++){var s=c[h],a=t(s,i);l.push(a)}e.morphAttributes[r]=l}for(var f=this.groups,h=0,d=f.length;h<d;h++){var p=f[h];e.addGroup(p.start,p.count,p.materialIndex)}return e},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){var e=this.parameters;for(var i in e)e[i]!==void 0&&(t[i]=e[i]);return t}t.data={attributes:{}};var n=this.index;n!==null&&(t.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});var r=this.attributes;for(var i in r){var s=r[i],a=s.toJSON();s.name!==""&&(a.name=s.name),t.data.attributes[i]=a}var o={},l=!1;for(var i in this.morphAttributes){for(var c=this.morphAttributes[i],h=[],u=0,f=c.length;u<f;u++){var s=c[u],a=s.toJSON();s.name!==""&&(a.name=s.name),h.push(a)}h.length>0&&(o[i]=h,l=!0)}l&&(t.data.morphAttributes=o);var d=this.groups;d.length>0&&(t.data.groups=JSON.parse(JSON.stringify(d)));var p=this.boundingSphere;return p!==null&&(t.data.boundingSphere={center:p.center.toArray(),radius:p.radius}),t},clone:function(){return new he().copy(this)},copy:function(t){var e,i,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var r=t.index;r!==null&&this.setIndex(r.clone());var s=t.attributes;for(e in s){var a=s[e];this.addAttribute(e,a.clone())}var o=t.morphAttributes;for(e in o){var l=[],c=o[e];for(i=0,n=c.length;i<n;i++)l.push(c[i].clone());this.morphAttributes[e]=l}var h=t.groups;for(i=0,n=h.length;i<n;i++){var u=h[i];this.addGroup(u.start,u.count,u.materialIndex)}var f=t.boundingBox;f!==null&&(this.boundingBox=f.clone());var d=t.boundingSphere;return d!==null&&(this.boundingSphere=d.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});function Ds(t,e,i,n,r,s){Ie.call(this),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:s},this.fromBufferGeometry(new pn(t,e,i,n,r,s)),this.mergeVertices()}Ds.prototype=Object.create(Ie.prototype);Ds.prototype.constructor=Ds;function pn(t,e,i,n,r,s){he.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:s};var a=this;t=t||1,e=e||1,i=i||1,n=Math.floor(n)||1,r=Math.floor(r)||1,s=Math.floor(s)||1;var o=[],l=[],c=[],h=[],u=0,f=0;d("z","y","x",-1,-1,i,e,t,s,r,0),d("z","y","x",1,-1,i,e,-t,s,r,1),d("x","z","y",1,1,t,i,e,n,s,2),d("x","z","y",1,-1,t,i,-e,n,s,3),d("x","y","z",1,-1,t,e,i,n,r,4),d("x","y","z",-1,-1,t,e,-i,n,r,5),this.setIndex(o),this.addAttribute("position",new le(l,3)),this.addAttribute("normal",new le(c,3)),this.addAttribute("uv",new le(h,2));function d(p,m,g,v,x,y,b,E,w,A,D){var O=y/w,P=b/A,L=y/2,C=b/2,U=E/2,j=w+1,K=A+1,z=0,$=0,k,G,q=new S;for(G=0;G<K;G++){var ee=G*P-C;for(k=0;k<j;k++){var Q=k*O-L;q[p]=Q*v,q[m]=ee*x,q[g]=U,l.push(q.x,q.y,q.z),q[p]=0,q[m]=0,q[g]=E>0?1:-1,c.push(q.x,q.y,q.z),h.push(k/w),h.push(1-G/A),z+=1}}for(G=0;G<A;G++)for(k=0;k<w;k++){var ae=u+k+j*G,V=u+k+j*(G+1),oe=u+(k+1)+j*(G+1),ne=u+(k+1)+j*G;o.push(ae,V,ne),o.push(V,oe,ne),$+=6}a.addGroup(f,$,D),f+=$,u+=z}}pn.prototype=Object.create(he.prototype);pn.prototype.constructor=pn;function Ps(t,e,i,n){Ie.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n},this.fromBufferGeometry(new tn(t,e,i,n)),this.mergeVertices()}Ps.prototype=Object.create(Ie.prototype);Ps.prototype.constructor=Ps;function tn(t,e,i,n){he.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n},t=t||1,e=e||1;var r=t/2,s=e/2,a=Math.floor(i)||1,o=Math.floor(n)||1,l=a+1,c=o+1,h=t/a,u=e/o,f,d,p=[],m=[],g=[],v=[];for(d=0;d<c;d++){var x=d*u-s;for(f=0;f<l;f++){var y=f*h-r;m.push(y,-x,0),g.push(0,0,1),v.push(f/a),v.push(1-d/o)}}for(d=0;d<o;d++)for(f=0;f<a;f++){var b=f+l*d,E=f+l*(d+1),w=f+1+l*(d+1),A=f+1+l*d;p.push(b,E,A),p.push(E,w,A)}this.setIndex(p),this.addAttribute("position",new le(m,3)),this.addAttribute("normal",new le(g,3)),this.addAttribute("uv",new le(v,2))}tn.prototype=Object.create(he.prototype);tn.prototype.constructor=tn;var _g=0;function Pe(){Object.defineProperty(this,"id",{value:_g++}),this.uuid=Te.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=Fn,this.side=ss,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=Wh,this.opacity=1,this.transparent=!1,this.blendSrc=Yh,this.blendDst=Kh,this.blendEquation=Cn,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=xo,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.userData={},this.needsUpdate=!0}Pe.prototype=Object.assign(Object.create(Zt.prototype),{constructor:Pe,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(t!==void 0)for(var e in t){var i=t[e];if(i===void 0){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if(e==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===zh;continue}var n=this[e];if(n===void 0){console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.");continue}n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i}},toJSON:function(t){var e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});var i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearCoat!==void 0&&(i.clearCoat=this.clearCoat),this.clearCoatRoughness!==void 0&&(i.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,i.reflectivity=this.reflectivity,this.combine!==void 0&&(i.combine=this.combine),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),this.size!==void 0&&(i.size=this.size),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Fn&&(i.blending=this.blending),this.flatShading===!0&&(i.flatShading=this.flatShading),this.side!==ss&&(i.side=this.side),this.vertexColors!==Wh&&(i.vertexColors=this.vertexColors),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.morphTargets===!0&&(i.morphTargets=!0),this.skinning===!0&&(i.skinning=!0),this.visible===!1&&(i.visible=!1),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData);function n(a){var o=[];for(var l in a){var c=a[l];delete c.metadata,o.push(c)}return o}if(e){var r=n(t.textures),s=n(t.images);r.length>0&&(i.textures=r),s.length>0&&(i.images=s)}return i},clone:function(){return new this.constructor().copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.lights=t.lights,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.userData=JSON.parse(JSON.stringify(t.userData)),this.clipShadows=t.clipShadows,this.clipIntersection=t.clipIntersection;var e=t.clippingPlanes,i=null;if(e!==null){var n=e.length;i=new Array(n);for(var r=0;r!==n;++r)i[r]=e[r].clone()}return this.clippingPlanes=i,this.shadowSide=t.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var wg=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Ag=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;function Vt(t){Pe.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=wg,this.fragmentShader=Ag,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,t!==void 0&&(t.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}Vt.prototype=Object.create(Pe.prototype);Vt.prototype.constructor=Vt;Vt.prototype.isShaderMaterial=!0;Vt.prototype.copy=function(t){return Pe.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Er(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this};Vt.prototype.toJSON=function(t){var e=Pe.prototype.toJSON.call(this,t);e.uniforms={};for(var i in this.uniforms){var n=this.uniforms[i],r=n.value;r&&r.isTexture?e.uniforms[i]={type:"t",value:r.toJSON(t).uuid}:r&&r.isColor?e.uniforms[i]={type:"c",value:r.getHex()}:r&&r.isVector2?e.uniforms[i]={type:"v2",value:r.toArray()}:r&&r.isVector3?e.uniforms[i]={type:"v3",value:r.toArray()}:r&&r.isVector4?e.uniforms[i]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?e.uniforms[i]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?e.uniforms[i]={type:"m4",value:r.toArray()}:e.uniforms[i]={value:r}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;var s={};for(var a in this.extensions)this.extensions[a]===!0&&(s[a]=!0);return Object.keys(s).length>0&&(e.extensions=s),e};function ar(t,e){this.origin=t!==void 0?t:new S,this.direction=e!==void 0?e:new S}Object.assign(ar.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return e===void 0&&(console.warn("THREE.Ray: .at() target is now required"),e=new S),e.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(){var t=new S;return function(i){return this.origin.copy(this.at(i,t)),this}}(),closestPointToPoint:function(t,e){e===void 0&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new S),e.subVectors(t,this.origin);var i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(){var t=new S;return function(i){var n=t.subVectors(i,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(i):(t.copy(this.direction).multiplyScalar(n).add(this.origin),t.distanceToSquared(i))}}(),distanceSqToSegment:function(){var t=new S,e=new S,i=new S;return function(r,s,a,o){t.copy(r).add(s).multiplyScalar(.5),e.copy(s).sub(r).normalize(),i.copy(this.origin).sub(t);var l=r.distanceTo(s)*.5,c=-this.direction.dot(e),h=i.dot(this.direction),u=-i.dot(e),f=i.lengthSq(),d=Math.abs(1-c*c),p,m,g,v;if(d>0)if(p=c*u-h,m=c*h-u,v=l*d,p>=0)if(m>=-v)if(m<=v){var x=1/d;p*=x,m*=x,g=p*(p+c*m+2*h)+m*(c*p+m+2*u)+f}else m=l,p=Math.max(0,-(c*m+h)),g=-p*p+m*(m+2*u)+f;else m=-l,p=Math.max(0,-(c*m+h)),g=-p*p+m*(m+2*u)+f;else m<=-v?(p=Math.max(0,-(-c*l+h)),m=p>0?-l:Math.min(Math.max(-l,-u),l),g=-p*p+m*(m+2*u)+f):m<=v?(p=0,m=Math.min(Math.max(-l,-u),l),g=m*(m+2*u)+f):(p=Math.max(0,-(c*l+h)),m=p>0?l:Math.min(Math.max(-l,-u),l),g=-p*p+m*(m+2*u)+f);else m=c>0?-l:l,p=Math.max(0,-(c*m+h)),g=-p*p+m*(m+2*u)+f;return a&&a.copy(this.direction).multiplyScalar(p).add(this.origin),o&&o.copy(e).multiplyScalar(m).add(t),g}}(),intersectSphere:function(){var t=new S;return function(i,n){t.subVectors(i.center,this.origin);var r=t.dot(this.direction),s=t.dot(t)-r*r,a=i.radius*i.radius;if(s>a)return null;var o=Math.sqrt(a-s),l=r-o,c=r+o;return l<0&&c<0?null:l<0?this.at(c,n):this.at(l,n)}}(),intersectsSphere:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;var i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null},intersectPlane:function(t,e){var i=this.distanceToPlane(t);return i===null?null:this.at(i,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);if(e===0)return!0;var i=t.normal.dot(this.direction);return i*e<0},intersectBox:function(t,e){var i,n,r,s,a,o,l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(i=(t.min.x-u.x)*l,n=(t.max.x-u.x)*l):(i=(t.max.x-u.x)*l,n=(t.min.x-u.x)*l),c>=0?(r=(t.min.y-u.y)*c,s=(t.max.y-u.y)*c):(r=(t.max.y-u.y)*c,s=(t.min.y-u.y)*c),i>s||r>n||((r>i||i!==i)&&(i=r),(s<n||n!==n)&&(n=s),h>=0?(a=(t.min.z-u.z)*h,o=(t.max.z-u.z)*h):(a=(t.max.z-u.z)*h,o=(t.min.z-u.z)*h),i>o||a>n)||((a>i||i!==i)&&(i=a),(o<n||n!==n)&&(n=o),n<0)?null:this.at(i>=0?i:n,e)},intersectsBox:function(){var t=new S;return function(i){return this.intersectBox(i,t)!==null}}(),intersectTriangle:function(){var t=new S,e=new S,i=new S,n=new S;return function(s,a,o,l,c){e.subVectors(a,s),i.subVectors(o,s),n.crossVectors(e,i);var h=this.direction.dot(n),u;if(h>0){if(l)return null;u=1}else if(h<0)u=-1,h=-h;else return null;t.subVectors(this.origin,s);var f=u*this.direction.dot(i.crossVectors(t,i));if(f<0)return null;var d=u*this.direction.dot(e.cross(t));if(d<0||f+d>h)return null;var p=-u*t.dot(n);return p<0?null:this.at(p/h,c)}}(),applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}});function Ft(t,e,i){this.a=t!==void 0?t:new S,this.b=e!==void 0?e:new S,this.c=i!==void 0?i:new S}Object.assign(Ft,{getNormal:function(){var t=new S;return function(i,n,r,s){s===void 0&&(console.warn("THREE.Triangle: .getNormal() target is now required"),s=new S),s.subVectors(r,n),t.subVectors(i,n),s.cross(t);var a=s.lengthSq();return a>0?s.multiplyScalar(1/Math.sqrt(a)):s.set(0,0,0)}}(),getBarycoord:function(){var t=new S,e=new S,i=new S;return function(r,s,a,o,l){t.subVectors(o,s),e.subVectors(a,s),i.subVectors(r,s);var c=t.dot(t),h=t.dot(e),u=t.dot(i),f=e.dot(e),d=e.dot(i),p=c*f-h*h;if(l===void 0&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),l=new S),p===0)return l.set(-2,-1,-1);var m=1/p,g=(f*u-h*d)*m,v=(c*d-h*u)*m;return l.set(1-g-v,v,g)}}(),containsPoint:function(){var t=new S;return function(i,n,r,s){return Ft.getBarycoord(i,n,r,s,t),t.x>=0&&t.y>=0&&t.x+t.y<=1}}(),getUV:function(){var t=new S;return function(i,n,r,s,a,o,l,c){return this.getBarycoord(i,n,r,s,t),c.set(0,0),c.addScaledVector(a,t.x),c.addScaledVector(o,t.y),c.addScaledVector(l,t.z),c}}(),isFrontFacing:function(){var t=new S,e=new S;return function(n,r,s,a){return t.subVectors(s,r),e.subVectors(n,r),t.cross(e).dot(a)<0}}()});Object.assign(Ft.prototype,{set:function(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this},setFromPointsAndIndices:function(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){var t=new S,e=new S;return function(){return t.subVectors(this.c,this.b),e.subVectors(this.a,this.b),t.cross(e).length()*.5}}(),getMidpoint:function(t){return t===void 0&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new S),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return Ft.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return t===void 0&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new S),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,e){return Ft.getBarycoord(t,this.a,this.b,this.c,e)},getUV:function(t,e,i,n,r){return Ft.getUV(t,this.a,this.b,this.c,e,i,n,r)},containsPoint:function(t){return Ft.containsPoint(t,this.a,this.b,this.c)},isFrontFacing:function(t){return Ft.isFrontFacing(this.a,this.b,this.c,t)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(){var t=new S,e=new S,i=new S,n=new S,r=new S,s=new S;return function(o,l){l===void 0&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),l=new S);var c=this.a,h=this.b,u=this.c,f,d;t.subVectors(h,c),e.subVectors(u,c),n.subVectors(o,c);var p=t.dot(n),m=e.dot(n);if(p<=0&&m<=0)return l.copy(c);r.subVectors(o,h);var g=t.dot(r),v=e.dot(r);if(g>=0&&v<=g)return l.copy(h);var x=p*v-g*m;if(x<=0&&p>=0&&g<=0)return f=p/(p-g),l.copy(c).addScaledVector(t,f);s.subVectors(o,u);var y=t.dot(s),b=e.dot(s);if(b>=0&&y<=b)return l.copy(u);var E=y*m-p*b;if(E<=0&&m>=0&&b<=0)return d=m/(m-b),l.copy(c).addScaledVector(e,d);var w=g*b-y*v;if(w<=0&&v-g>=0&&y-b>=0)return i.subVectors(u,h),d=(v-g)/(v-g+(y-b)),l.copy(h).addScaledVector(i,d);var A=1/(w+E+x);return f=E*A,d=x*A,l.copy(c).addScaledVector(t,f).addScaledVector(e,d)}}(),equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}});function It(t){Pe.call(this),this.type="MeshBasicMaterial",this.color=new me(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ta,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(t)}It.prototype=Object.create(Pe.prototype);It.prototype.constructor=It;It.prototype.isMeshBasicMaterial=!0;It.prototype.copy=function(t){return Pe.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};function Et(t,e){ce.call(this),this.type="Mesh",this.geometry=t!==void 0?t:new he,this.material=e!==void 0?e:new It({color:Math.random()*16777215}),this.drawMode=Rl,this.updateMorphTargets()}Et.prototype=Object.assign(Object.create(ce.prototype),{constructor:Et,isMesh:!0,setDrawMode:function(t){this.drawMode=t},copy:function(t){return ce.prototype.copy.call(this,t),this.drawMode=t.drawMode,t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t=this.geometry,e,i,n;if(t.isBufferGeometry){var r=t.morphAttributes,s=Object.keys(r);if(s.length>0){var a=r[s[0]];if(a!==void 0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,i=a.length;e<i;e++)n=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{var o=t.morphTargets;o!==void 0&&o.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(){var t=new we,e=new ar,i=new Ui,n=new S,r=new S,s=new S,a=new S,o=new S,l=new S,c=new S,h=new S,u=new S,f=new X,d=new X,p=new X,m=new S,g=new S;function v(y,b,E,w,A,D,O,P){var L;if(b.side===xt?L=w.intersectTriangle(O,D,A,!0,P):L=w.intersectTriangle(A,D,O,b.side!==rr,P),L===null)return null;g.copy(P),g.applyMatrix4(y.matrixWorld);var C=E.ray.origin.distanceTo(g);return C<E.near||C>E.far?null:{distance:C,point:g.clone(),object:y}}function x(y,b,E,w,A,D,O,P,L,C){n.fromBufferAttribute(A,P),r.fromBufferAttribute(A,L),s.fromBufferAttribute(A,C);var U=y.morphTargetInfluences;if(b.morphTargets&&D&&U){c.set(0,0,0),h.set(0,0,0),u.set(0,0,0);for(var j=0,K=D.length;j<K;j++){var z=U[j],$=D[j];z!==0&&(a.fromBufferAttribute($,P),o.fromBufferAttribute($,L),l.fromBufferAttribute($,C),c.addScaledVector(a.sub(n),z),h.addScaledVector(o.sub(r),z),u.addScaledVector(l.sub(s),z))}n.add(c),r.add(h),s.add(u)}var k=v(y,b,E,w,n,r,s,m);if(k){O&&(f.fromBufferAttribute(O,P),d.fromBufferAttribute(O,L),p.fromBufferAttribute(O,C),k.uv=Ft.getUV(m,n,r,s,f,d,p,new X));var G=new Cs(P,L,C);Ft.getNormal(n,r,s,G.normal),k.face=G}return k}return function(b,E){var w=this.geometry,A=this.material,D=this.matrixWorld;if(A!==void 0&&(w.boundingSphere===null&&w.computeBoundingSphere(),i.copy(w.boundingSphere),i.applyMatrix4(D),b.ray.intersectsSphere(i)!==!1&&(t.getInverse(D),e.copy(b.ray).applyMatrix4(t),!(w.boundingBox!==null&&e.intersectsBox(w.boundingBox)===!1)))){var O;if(w.isBufferGeometry){var P,L,C,U=w.index,j=w.attributes.position,K=w.morphAttributes.position,z=w.attributes.uv,$=w.groups,k=w.drawRange,G,q,ee,Q,ae,V,oe,ne;if(U!==null)if(Array.isArray(A))for(G=0,ee=$.length;G<ee;G++)for(ae=$[G],V=A[ae.materialIndex],oe=Math.max(ae.start,k.start),ne=Math.min(ae.start+ae.count,k.start+k.count),q=oe,Q=ne;q<Q;q+=3)P=U.getX(q),L=U.getX(q+1),C=U.getX(q+2),O=x(this,V,b,e,j,K,z,P,L,C),O&&(O.faceIndex=Math.floor(q/3),O.face.materialIndex=ae.materialIndex,E.push(O));else for(oe=Math.max(0,k.start),ne=Math.min(U.count,k.start+k.count),G=oe,ee=ne;G<ee;G+=3)P=U.getX(G),L=U.getX(G+1),C=U.getX(G+2),O=x(this,A,b,e,j,K,z,P,L,C),O&&(O.faceIndex=Math.floor(G/3),E.push(O));else if(j!==void 0)if(Array.isArray(A))for(G=0,ee=$.length;G<ee;G++)for(ae=$[G],V=A[ae.materialIndex],oe=Math.max(ae.start,k.start),ne=Math.min(ae.start+ae.count,k.start+k.count),q=oe,Q=ne;q<Q;q+=3)P=q,L=q+1,C=q+2,O=x(this,V,b,e,j,K,z,P,L,C),O&&(O.faceIndex=Math.floor(q/3),O.face.materialIndex=ae.materialIndex,E.push(O));else for(oe=Math.max(0,k.start),ne=Math.min(j.count,k.start+k.count),G=oe,ee=ne;G<ee;G+=3)P=G,L=G+1,C=G+2,O=x(this,A,b,e,j,K,z,P,L,C),O&&(O.faceIndex=Math.floor(G/3),E.push(O))}else if(w.isGeometry){var ve,Ee,Ge,I=Array.isArray(A),M=w.vertices,J=w.faces,re,W=w.faceVertexUvs[0];W.length>0&&(re=W);for(var te=0,se=J.length;te<se;te++){var Le=J[te],Re=I?A[Le.materialIndex]:A;if(Re!==void 0&&(ve=M[Le.a],Ee=M[Le.b],Ge=M[Le.c],O=v(this,Re,b,e,ve,Ee,Ge,m),O)){if(re&&re[te]){var ke=re[te];f.copy(ke[0]),d.copy(ke[1]),p.copy(ke[2]),O.uv=Ft.getUV(m,ve,Ee,Ge,f,d,p,new X)}O.face=Le,O.faceIndex=te,E.push(O)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});function Sg(t,e,i,n){var r=new me(0),s=0,a,o,l=null,c=0;function h(f,d,p,m){var g=d.background,v=t.vr,x=v.getSession&&v.getSession();if(x&&x.environmentBlendMode==="additive"&&(g=null),g===null?(u(r,s),l=null,c=0):g&&g.isColor&&(u(g,1),m=!0,l=null,c=0),(t.autoClear||m)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),g&&(g.isCubeTexture||g.isWebGLRenderTargetCube)){o===void 0&&(o=new Et(new pn(1,1,1),new Vt({type:"BackgroundCubeMaterial",uniforms:Er(xi.cube.uniforms),vertexShader:xi.cube.vertexShader,fragmentShader:xi.cube.fragmentShader,side:xt,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.removeAttribute("normal"),o.geometry.removeAttribute("uv"),o.onBeforeRender=function(b,E,w){this.matrixWorld.copyPosition(w.matrixWorld)},Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.tCube.value}}),i.update(o));var y=g.isWebGLRenderTargetCube?g.texture:g;o.material.uniforms.tCube.value=y,o.material.uniforms.tFlip.value=g.isWebGLRenderTargetCube?1:-1,(l!==g||c!==y.version)&&(o.material.needsUpdate=!0,l=g,c=y.version),f.unshift(o,o.geometry,o.material,0,0,null)}else g&&g.isTexture&&(a===void 0&&(a=new Et(new tn(2,2),new Vt({type:"BackgroundMaterial",uniforms:Er(xi.background.uniforms),vertexShader:xi.background.vertexShader,fragmentShader:xi.background.fragmentShader,side:ss,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.removeAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(a)),a.material.uniforms.t2D.value=g,g.matrixAutoUpdate===!0&&g.updateMatrix(),a.material.uniforms.uvTransform.value.copy(g.matrix),(l!==g||c!==g.version)&&(a.material.needsUpdate=!0,l=g,c=g.version),f.unshift(a,a.geometry,a.material,0,0,null))}function u(f,d){e.buffers.color.setClear(f.r,f.g,f.b,d,n)}return{getClearColor:function(){return r},setClearColor:function(f,d){r.set(f),s=d!==void 0?d:1,u(r,s)},getClearAlpha:function(){return s},setClearAlpha:function(f){s=f,u(r,s)},render:h}}function Lg(t,e,i,n){var r;function s(l){r=l}function a(l,c){t.drawArrays(r,l,c),i.update(c,r)}function o(l,c,h){var u;if(n.isWebGL2)u=t;else if(u=e.get("ANGLE_instanced_arrays"),u===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}u[n.isWebGL2?"drawArraysInstanced":"drawArraysInstancedANGLE"](r,c,h,l.maxInstancedCount),i.update(h,r,l.maxInstancedCount)}this.setMode=s,this.render=a,this.renderInstances=o}function Mg(t,e,i){var n;function r(){if(n!==void 0)return n;var w=e.get("EXT_texture_filter_anisotropic");return w!==null?n=t.getParameter(w.MAX_TEXTURE_MAX_ANISOTROPY_EXT):n=0,n}function s(w){if(w==="highp"){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";w="mediump"}return w==="mediump"&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var a=typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext,o=i.precision!==void 0?i.precision:"highp",l=s(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);var c=i.logarithmicDepthBuffer===!0,h=t.getParameter(34930),u=t.getParameter(35660),f=t.getParameter(3379),d=t.getParameter(34076),p=t.getParameter(34921),m=t.getParameter(36347),g=t.getParameter(36348),v=t.getParameter(36349),x=u>0,y=a||!!e.get("OES_texture_float"),b=x&&y,E=a?t.getParameter(36183):0;return{isWebGL2:a,getMaxAnisotropy:r,getMaxPrecision:s,precision:o,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:u,maxTextureSize:f,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:x,floatFragmentTextures:y,floatVertexTextures:b,maxSamples:E}}function Rg(){var t=this,e=null,i=0,n=!1,r=!1,s=new Bi,a=new Rt,o={value:null,needsUpdate:!1};this.uniform=o,this.numPlanes=0,this.numIntersection=0,this.init=function(h,u,f){var d=h.length!==0||u||i!==0||n;return n=u,e=c(h,f,0),i=h.length,d},this.beginShadows=function(){r=!0,c(null)},this.endShadows=function(){r=!1,l()},this.setState=function(h,u,f,d,p,m){if(!n||h===null||h.length===0||r&&!f)r?c(null):l();else{var g=r?0:i,v=g*4,x=p.clippingState||null;o.value=x,x=c(h,d,v,m);for(var y=0;y!==v;++y)x[y]=e[y];p.clippingState=x,this.numIntersection=u?this.numPlanes:0,this.numPlanes+=g}};function l(){o.value!==e&&(o.value=e,o.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function c(h,u,f,d){var p=h!==null?h.length:0,m=null;if(p!==0){if(m=o.value,d!==!0||m===null){var g=f+p*4,v=u.matrixWorldInverse;a.getNormalMatrix(v),(m===null||m.length<g)&&(m=new Float32Array(g));for(var x=0,y=f;x!==p;++x,y+=4)s.copy(h[x]).applyMatrix4(v,a),s.normal.toArray(m,y),m[y+3]=s.constant}o.value=m,o.needsUpdate=!0}return t.numPlanes=p,m}}function Ig(t){var e={};return{get:function(i){if(e[i]!==void 0)return e[i];var n;switch(i){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(i)}return n===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),e[i]=n,n}}}function Cg(t,e,i){var n={},r={};function s(c){var h=c.target,u=n[h.id];u.index!==null&&e.remove(u.index);for(var f in u.attributes)e.remove(u.attributes[f]);h.removeEventListener("dispose",s),delete n[h.id];var d=r[u.id];d&&(e.remove(d),delete r[u.id]),i.memory.geometries--}function a(c,h){var u=n[h.id];return u||(h.addEventListener("dispose",s),h.isBufferGeometry?u=h:h.isGeometry&&(h._bufferGeometry===void 0&&(h._bufferGeometry=new he().setFromObject(c)),u=h._bufferGeometry),n[h.id]=u,i.memory.geometries++,u)}function o(c){var h=c.index,u=c.attributes;h!==null&&e.update(h,34963);for(var f in u)e.update(u[f],34962);var d=c.morphAttributes;for(var f in d)for(var p=d[f],m=0,g=p.length;m<g;m++)e.update(p[m],34962)}function l(c){var h=r[c.id];if(h)return h;var u=[],f=c.index,d=c.attributes;if(f!==null)for(var p=f.array,m=0,g=p.length;m<g;m+=3){var v=p[m+0],x=p[m+1],y=p[m+2];u.push(v,x,x,y,y,v)}else for(var p=d.position.array,m=0,g=p.length/3-1;m<g;m+=3){var v=m+0,x=m+1,y=m+2;u.push(v,x,x,y,y,v)}return h=new(nu(u)>65535?Tr:br)(u,1),e.update(h,34963),r[c.id]=h,h}return{get:a,update:o,getWireframeAttribute:l}}function Dg(t,e,i,n){var r;function s(u){r=u}var a,o;function l(u){a=u.type,o=u.bytesPerElement}function c(u,f){t.drawElements(r,f,a,u*o),i.update(f,r)}function h(u,f,d){var p;if(n.isWebGL2)p=t;else{var p=e.get("ANGLE_instanced_arrays");if(p===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}}p[n.isWebGL2?"drawElementsInstanced":"drawElementsInstancedANGLE"](r,d,a,f*o,u.maxInstancedCount),i.update(d,r,u.maxInstancedCount)}this.setMode=s,this.setIndex=l,this.render=c,this.renderInstances=h}function Pg(t){var e={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,a,o){switch(o=o||1,i.calls++,a){case 4:i.triangles+=o*(s/3);break;case 5:case 6:i.triangles+=o*(s-2);break;case 1:i.lines+=o*(s/2);break;case 3:i.lines+=o*(s-1);break;case 2:i.lines+=o*s;break;case 0:i.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function r(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:e,render:i,programs:null,autoReset:!0,reset:r,update:n}}function Og(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Fg(t){var e={},i=new Float32Array(8);function n(r,s,a,o){var l=r.morphTargetInfluences,c=l.length,h=e[s.id];if(h===void 0){h=[];for(var u=0;u<c;u++)h[u]=[u,0];e[s.id]=h}for(var f=a.morphTargets&&s.morphAttributes.position,d=a.morphNormals&&s.morphAttributes.normal,u=0;u<c;u++){var p=h[u];p[1]!==0&&(f&&s.removeAttribute("morphTarget"+u),d&&s.removeAttribute("morphNormal"+u))}for(var u=0;u<c;u++){var p=h[u];p[0]=u,p[1]=l[u]}h.sort(Og);for(var u=0;u<8;u++){var p=h[u];if(p){var m=p[0],g=p[1];if(g){f&&s.addAttribute("morphTarget"+u,f[m]),d&&s.addAttribute("morphNormal"+u,d[m]),i[u]=g;continue}}i[u]=0}o.getUniforms().setValue(t,"morphTargetInfluences",i)}return{update:n}}function kg(t,e){var i={};function n(s){var a=e.render.frame,o=s.geometry,l=t.get(s,o);return i[l.id]!==a&&(o.isGeometry&&l.updateFromObject(s),t.update(l),i[l.id]=a),l}function r(){i={}}return{update:n,dispose:r}}function Mi(t,e,i,n,r,s,a,o,l,c){t=t!==void 0?t:[],e=e!==void 0?e:Tl,a=a!==void 0?a:Ai,Ye.call(this,t,e,i,n,r,s,a,o,l,c),this.flipY=!1}Mi.prototype=Object.create(Ye.prototype);Mi.prototype.constructor=Mi;Mi.prototype.isCubeTexture=!0;Object.defineProperty(Mi.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}});function _r(t,e,i,n){Ye.call(this,null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=Mt,this.minFilter=Mt,this.wrapR=qt,this.generateMipmaps=!1,this.flipY=!1}_r.prototype=Object.create(Ye.prototype);_r.prototype.constructor=_r;_r.prototype.isDataTexture2DArray=!0;function wr(t,e,i,n){Ye.call(this,null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=Mt,this.minFilter=Mt,this.wrapR=qt,this.generateMipmaps=!1,this.flipY=!1}wr.prototype=Object.create(Ye.prototype);wr.prototype.constructor=wr;wr.prototype.isDataTexture3D=!0;var ru=new Ye,Ng=new _r,Bg=new wr,su=new Mi,fc=[],dc=[],pc=new Float32Array(16),mc=new Float32Array(9),gc=new Float32Array(4);function or(t,e,i){var n=t[0];if(n<=0||n>0)return t;var r=e*i,s=fc[r];if(s===void 0&&(s=new Float32Array(r),fc[r]=s),e!==0){n.toArray(s,0);for(var a=1,o=0;a!==e;++a)o+=i,t[a].toArray(s,o)}return s}function ci(t,e){if(t.length!==e.length)return!1;for(var i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0}function ei(t,e){for(var i=0,n=e.length;i<n;i++)t[i]=e[i]}function au(t,e){var i=dc[e];i===void 0&&(i=new Int32Array(e),dc[e]=i);for(var n=0;n!==e;++n)i[n]=t.allocateTextureUnit();return i}function Ug(t,e){var i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function Gg(t,e){var i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(ci(i,e))return;t.uniform2fv(this.addr,e),ei(i,e)}}function Hg(t,e){var i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(e.r!==void 0)(i[0]!==e.r||i[1]!==e.g||i[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(ci(i,e))return;t.uniform3fv(this.addr,e),ei(i,e)}}function Vg(t,e){var i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(ci(i,e))return;t.uniform4fv(this.addr,e),ei(i,e)}}function zg(t,e){var i=this.cache,n=e.elements;if(n===void 0){if(ci(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),ei(i,e)}else{if(ci(i,n))return;gc.set(n),t.uniformMatrix2fv(this.addr,!1,gc),ei(i,n)}}function Wg(t,e){var i=this.cache,n=e.elements;if(n===void 0){if(ci(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),ei(i,e)}else{if(ci(i,n))return;mc.set(n),t.uniformMatrix3fv(this.addr,!1,mc),ei(i,n)}}function jg(t,e){var i=this.cache,n=e.elements;if(n===void 0){if(ci(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),ei(i,e)}else{if(ci(i,n))return;pc.set(n),t.uniformMatrix4fv(this.addr,!1,pc),ei(i,n)}}function $g(t,e,i){var n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.safeSetTexture2D(e||ru,r)}function Yg(t,e,i){var n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(e||Ng,r)}function Kg(t,e,i){var n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(e||Bg,r)}function Xg(t,e,i){var n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.safeSetTextureCube(e||su,r)}function qg(t,e){var i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function Zg(t,e){var i=this.cache;ci(i,e)||(t.uniform2iv(this.addr,e),ei(i,e))}function Jg(t,e){var i=this.cache;ci(i,e)||(t.uniform3iv(this.addr,e),ei(i,e))}function Qg(t,e){var i=this.cache;ci(i,e)||(t.uniform4iv(this.addr,e),ei(i,e))}function ev(t){switch(t){case 5126:return Ug;case 35664:return Gg;case 35665:return Hg;case 35666:return Vg;case 35674:return zg;case 35675:return Wg;case 35676:return jg;case 35678:case 36198:return $g;case 35679:return Kg;case 35680:return Xg;case 36289:return Yg;case 5124:case 35670:return qg;case 35667:case 35671:return Zg;case 35668:case 35672:return Jg;case 35669:case 35673:return Qg}}function tv(t,e){t.uniform1fv(this.addr,e)}function iv(t,e){t.uniform1iv(this.addr,e)}function nv(t,e){t.uniform2iv(this.addr,e)}function rv(t,e){t.uniform3iv(this.addr,e)}function sv(t,e){t.uniform4iv(this.addr,e)}function av(t,e){var i=or(e,this.size,2);t.uniform2fv(this.addr,i)}function ov(t,e){var i=or(e,this.size,3);t.uniform3fv(this.addr,i)}function lv(t,e){var i=or(e,this.size,4);t.uniform4fv(this.addr,i)}function cv(t,e){var i=or(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function hv(t,e){var i=or(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function uv(t,e){var i=or(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function fv(t,e,i){var n=e.length,r=au(i,n);t.uniform1iv(this.addr,r);for(var s=0;s!==n;++s)i.safeSetTexture2D(e[s]||ru,r[s])}function dv(t,e,i){var n=e.length,r=au(i,n);t.uniform1iv(this.addr,r);for(var s=0;s!==n;++s)i.safeSetTextureCube(e[s]||su,r[s])}function pv(t){switch(t){case 5126:return tv;case 35664:return av;case 35665:return ov;case 35666:return lv;case 35674:return cv;case 35675:return hv;case 35676:return uv;case 35678:return fv;case 35680:return dv;case 5124:case 35670:return iv;case 35667:case 35671:return nv;case 35668:case 35672:return rv;case 35669:case 35673:return sv}}function mv(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=ev(e.type)}function ou(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=pv(e.type)}ou.prototype.updateCache=function(t){var e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),ei(e,t)};function lu(t){this.id=t,this.seq=[],this.map={}}lu.prototype.setValue=function(t,e,i){for(var n=this.seq,r=0,s=n.length;r!==s;++r){var a=n[r];a.setValue(t,e[a.id],i)}};var Ua=/([\w\d_]+)(\])?(\[|\.)?/g;function vc(t,e){t.seq.push(e),t.map[e.id]=e}function gv(t,e,i){var n=t.name,r=n.length;for(Ua.lastIndex=0;;){var s=Ua.exec(n),a=Ua.lastIndex,o=s[1],l=s[2]==="]",c=s[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===r){vc(i,c===void 0?new mv(o,t,e):new ou(o,t,e));break}else{var h=i.map,u=h[o];u===void 0&&(u=new lu(o),vc(i,u)),i=u}}}function Ji(t,e){this.seq=[],this.map={};for(var i=t.getProgramParameter(e,35718),n=0;n<i;++n){var r=t.getActiveUniform(e,n),s=t.getUniformLocation(e,r.name);gv(r,s,this)}}Ji.prototype.setValue=function(t,e,i,n){var r=this.map[e];r!==void 0&&r.setValue(t,i,n)};Ji.prototype.setOptional=function(t,e,i){var n=e[i];n!==void 0&&this.setValue(t,i,n)};Ji.upload=function(t,e,i,n){for(var r=0,s=e.length;r!==s;++r){var a=e[r],o=i[a.id];o.needsUpdate!==!1&&a.setValue(t,o.value,n)}};Ji.seqWithValue=function(t,e){for(var i=[],n=0,r=t.length;n!==r;++n){var s=t[n];s.id in e&&i.push(s)}return i};function vv(t){for(var e=t.split(`
`),i=0;i<e.length;i++)e[i]=i+1+": "+e[i];return e.join(`
`)}function yc(t,e,i,n){var r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),n===!0&&(t.getShaderParameter(r,35713)===!1&&console.error("THREE.WebGLShader: Shader couldn't compile."),t.getShaderInfoLog(r)!==""&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",e===35633?"vertex":"fragment",t.getShaderInfoLog(r),vv(i))),r}var yv=0;function cu(t){switch(t){case Is:return["Linear","( value )"];case Jd:return["sRGB","( value )"];case Qd:return["RGBE","( value )"];case ep:return["RGBM","( value, 7.0 )"];case tp:return["RGBM","( value, 16.0 )"];case ip:return["RGBD","( value, 256.0 )"];case eu:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+t)}}function hs(t,e){var i=cu(e);return"vec4 "+t+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function xv(t,e){var i=cu(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Ev(t,e){var i;switch(e){case Xh:i="Linear";break;case yd:i="Reinhard";break;case xd:i="Uncharted2";break;case Ed:i="OptimizedCineon";break;case bd:i="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+e)}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function bv(t,e,i){t=t||{};var n=[t.derivatives||e.envMapCubeUV||e.bumpMap||e.normalMap&&!e.objectSpaceNormalMap||e.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(t.fragDepth||e.logarithmicDepthBuffer)&&i.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",t.drawBuffers&&i.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(t.shaderTextureLOD||e.envMap)&&i.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""];return n.filter(fr).join(`
`)}function Tv(t){var e=[];for(var i in t){var n=t[i];n!==!1&&e.push("#define "+i+" "+n)}return e.join(`
`)}function _v(t,e){for(var i={},n=t.getProgramParameter(e,35721),r=0;r<n;r++){var s=t.getActiveAttrib(e,r),a=s.name;i[a]=t.getAttribLocation(e,a)}return i}function fr(t){return t!==""}function xc(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights)}function Ec(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}function Mo(t){var e=/^[ \t]*#include +<([\w\d./]+)>/gm;function i(n,r){var s=ze[r];if(s===void 0)throw new Error("Can not resolve #include <"+r+">");return Mo(s)}return t.replace(e,i)}function bc(t){var e=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function i(n,r,s,a){for(var o="",l=parseInt(r);l<parseInt(s);l++)o+=a.replace(/\[ i \]/g,"[ "+l+" ]");return o}return t.replace(e,i)}function wv(t,e,i,n,r,s,a,o){var l=t.context,c=n.defines,h=r.vertexShader,u=r.fragmentShader,f="SHADOWMAP_TYPE_BASIC";s.shadowMapType===Vh?f="SHADOWMAP_TYPE_PCF":s.shadowMapType===Zf&&(f="SHADOWMAP_TYPE_PCF_SOFT");var d="ENVMAP_TYPE_CUBE",p="ENVMAP_MODE_REFLECTION",m="ENVMAP_BLENDING_MULTIPLY";if(s.envMap){switch(n.envMap.mapping){case Tl:case Eo:d="ENVMAP_TYPE_CUBE";break;case _l:case wl:d="ENVMAP_TYPE_CUBE_UV";break;case qh:case bo:d="ENVMAP_TYPE_EQUIREC";break;case Zh:d="ENVMAP_TYPE_SPHERE";break}switch(n.envMap.mapping){case Eo:case bo:p="ENVMAP_MODE_REFRACTION";break}switch(n.combine){case Ta:m="ENVMAP_BLENDING_MULTIPLY";break;case gd:m="ENVMAP_BLENDING_MIX";break;case vd:m="ENVMAP_BLENDING_ADD";break}}var g=t.gammaFactor>0?t.gammaFactor:1,v=a.isWebGL2?"":bv(n.extensions,s,e),x=Tv(c),y=l.createProgram(),b,E;if(n.isRawShaderMaterial?(b=[x].filter(fr).join(`
`),b.length>0&&(b+=`
`),E=[v,x].filter(fr).join(`
`),E.length>0&&(E+=`
`)):(b=["precision "+s.precision+" float;","precision "+s.precision+" int;","#define SHADER_NAME "+r.name,x,s.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+g,"#define MAX_BONES "+s.maxBones,s.useFog&&s.fog?"#define USE_FOG":"",s.useFog&&s.fogExp?"#define FOG_EXP2":"",s.map?"#define USE_MAP":"",s.envMap?"#define USE_ENVMAP":"",s.envMap?"#define "+p:"",s.lightMap?"#define USE_LIGHTMAP":"",s.aoMap?"#define USE_AOMAP":"",s.emissiveMap?"#define USE_EMISSIVEMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.normalMap&&s.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",s.displacementMap&&s.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.roughnessMap?"#define USE_ROUGHNESSMAP":"",s.metalnessMap?"#define USE_METALNESSMAP":"",s.alphaMap?"#define USE_ALPHAMAP":"",s.vertexTangents?"#define USE_TANGENT":"",s.vertexColors?"#define USE_COLOR":"",s.flatShading?"#define FLAT_SHADED":"",s.skinning?"#define USE_SKINNING":"",s.useVertexTexture?"#define BONE_TEXTURE":"",s.morphTargets?"#define USE_MORPHTARGETS":"",s.morphNormals&&s.flatShading===!1?"#define USE_MORPHNORMALS":"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+f:"",s.sizeAttenuation?"#define USE_SIZEATTENUATION":"",s.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",s.logarithmicDepthBuffer&&(a.isWebGL2||e.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(fr).join(`
`),E=[v,"precision "+s.precision+" float;","precision "+s.precision+" int;","#define SHADER_NAME "+r.name,x,s.alphaTest?"#define ALPHATEST "+s.alphaTest+(s.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+g,s.useFog&&s.fog?"#define USE_FOG":"",s.useFog&&s.fogExp?"#define FOG_EXP2":"",s.map?"#define USE_MAP":"",s.matcap?"#define USE_MATCAP":"",s.envMap?"#define USE_ENVMAP":"",s.envMap?"#define "+d:"",s.envMap?"#define "+p:"",s.envMap?"#define "+m:"",s.lightMap?"#define USE_LIGHTMAP":"",s.aoMap?"#define USE_AOMAP":"",s.emissiveMap?"#define USE_EMISSIVEMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.normalMap&&s.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.roughnessMap?"#define USE_ROUGHNESSMAP":"",s.metalnessMap?"#define USE_METALNESSMAP":"",s.alphaMap?"#define USE_ALPHAMAP":"",s.vertexTangents?"#define USE_TANGENT":"",s.vertexColors?"#define USE_COLOR":"",s.gradientMap?"#define USE_GRADIENTMAP":"",s.flatShading?"#define FLAT_SHADED":"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+f:"",s.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",s.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",s.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",s.logarithmicDepthBuffer&&(a.isWebGL2||e.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",s.envMap&&(a.isWebGL2||e.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",s.toneMapping!==Na?"#define TONE_MAPPING":"",s.toneMapping!==Na?ze.tonemapping_pars_fragment:"",s.toneMapping!==Na?Ev("toneMapping",s.toneMapping):"",s.dithering?"#define DITHERING":"",s.outputEncoding||s.mapEncoding||s.matcapEncoding||s.envMapEncoding||s.emissiveMapEncoding?ze.encodings_pars_fragment:"",s.mapEncoding?hs("mapTexelToLinear",s.mapEncoding):"",s.matcapEncoding?hs("matcapTexelToLinear",s.matcapEncoding):"",s.envMapEncoding?hs("envMapTexelToLinear",s.envMapEncoding):"",s.emissiveMapEncoding?hs("emissiveMapTexelToLinear",s.emissiveMapEncoding):"",s.outputEncoding?xv("linearToOutputTexel",s.outputEncoding):"",s.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(fr).join(`
`)),h=Mo(h),h=xc(h,s),h=Ec(h,s),u=Mo(u),u=xc(u,s),u=Ec(u,s),h=bc(h),u=bc(u),a.isWebGL2&&!n.isRawShaderMaterial){var w=!1,A=/^\s*#version\s+300\s+es\s*\n/;n.isShaderMaterial&&h.match(A)!==null&&u.match(A)!==null&&(w=!0,h=h.replace(A,""),u=u.replace(A,"")),b=[`#version 300 es
`,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+b,E=[`#version 300 es
`,"#define varying in",w?"":"out highp vec4 pc_fragColor;",w?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+E}var D=b+h,O=E+u,P=yc(l,35633,D,t.debug.checkShaderErrors),L=yc(l,35632,O,t.debug.checkShaderErrors);if(l.attachShader(y,P),l.attachShader(y,L),n.index0AttributeName!==void 0?l.bindAttribLocation(y,0,n.index0AttributeName):s.morphTargets===!0&&l.bindAttribLocation(y,0,"position"),l.linkProgram(y),t.debug.checkShaderErrors){var C=l.getProgramInfoLog(y).trim(),U=l.getShaderInfoLog(P).trim(),j=l.getShaderInfoLog(L).trim(),K=!0,z=!0;l.getProgramParameter(y,35714)===!1?(K=!1,console.error("THREE.WebGLProgram: shader error: ",l.getError(),"35715",l.getProgramParameter(y,35715),"gl.getProgramInfoLog",C,U,j)):C!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",C):(U===""||j==="")&&(z=!1),z&&(this.diagnostics={runnable:K,material:n,programLog:C,vertexShader:{log:U,prefix:b},fragmentShader:{log:j,prefix:E}})}l.deleteShader(P),l.deleteShader(L);var $;this.getUniforms=function(){return $===void 0&&($=new Ji(l,y)),$};var k;return this.getAttributes=function(){return k===void 0&&(k=_v(l,y)),k},this.destroy=function(){l.deleteProgram(y),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.name=r.name,this.id=yv++,this.code=i,this.usedTimes=1,this.program=y,this.vertexShader=P,this.fragmentShader=L,this}function Av(t,e,i,n){var r=[],s={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},a=["precision","supportsVertexTextures","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function o(c){var h=c.skeleton,u=h.bones;if(i.floatVertexTextures)return 1024;var f=i.maxVertexUniforms,d=Math.floor((f-20)/4),p=Math.min(d,u.length);return p<u.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+u.length+" bones. This GPU supports "+p+"."),0):p}function l(c,h){var u;return c?c.isTexture?u=c.encoding:c.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),u=c.texture.encoding):u=Is,u===Is&&h&&(u=eu),u}this.getParameters=function(c,h,u,f,d,p,m){var g=s[c.type],v=m.isSkinnedMesh?o(m):0,x=i.precision;c.precision!==null&&(x=i.getMaxPrecision(c.precision),x!==c.precision&&console.warn("THREE.WebGLProgram.getParameters:",c.precision,"not supported, using",x,"instead."));var y=t.getRenderTarget(),b={shaderID:g,precision:x,supportsVertexTextures:i.vertexTextures,outputEncoding:l(y?y.texture:null,t.gammaOutput),map:!!c.map,mapEncoding:l(c.map,t.gammaInput),matcap:!!c.matcap,matcapEncoding:l(c.matcap,t.gammaInput),envMap:!!c.envMap,envMapMode:c.envMap&&c.envMap.mapping,envMapEncoding:l(c.envMap,t.gammaInput),envMapCubeUV:!!c.envMap&&(c.envMap.mapping===_l||c.envMap.mapping===wl),lightMap:!!c.lightMap,aoMap:!!c.aoMap,emissiveMap:!!c.emissiveMap,emissiveMapEncoding:l(c.emissiveMap,t.gammaInput),bumpMap:!!c.bumpMap,normalMap:!!c.normalMap,objectSpaceNormalMap:c.normalMapType===sp,displacementMap:!!c.displacementMap,roughnessMap:!!c.roughnessMap,metalnessMap:!!c.metalnessMap,specularMap:!!c.specularMap,alphaMap:!!c.alphaMap,gradientMap:!!c.gradientMap,combine:c.combine,vertexTangents:c.normalMap&&c.vertexTangents,vertexColors:c.vertexColors,fog:!!f,useFog:c.fog,fogExp:f&&f.isFogExp2,flatShading:c.flatShading,sizeAttenuation:c.sizeAttenuation,logarithmicDepthBuffer:i.logarithmicDepthBuffer,skinning:c.skinning&&v>0,maxBones:v,useVertexTexture:i.floatVertexTextures,morphTargets:c.morphTargets,morphNormals:c.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:h.directional.length,numPointLights:h.point.length,numSpotLights:h.spot.length,numRectAreaLights:h.rectArea.length,numHemiLights:h.hemi.length,numClippingPlanes:d,numClipIntersection:p,dithering:c.dithering,shadowMapEnabled:t.shadowMap.enabled&&m.receiveShadow&&u.length>0,shadowMapType:t.shadowMap.type,toneMapping:t.toneMapping,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:c.premultipliedAlpha,alphaTest:c.alphaTest,doubleSided:c.side===rr,flipSided:c.side===xt,depthPacking:c.depthPacking!==void 0?c.depthPacking:!1};return b},this.getProgramCode=function(c,h){var u=[];if(h.shaderID?u.push(h.shaderID):(u.push(c.fragmentShader),u.push(c.vertexShader)),c.defines!==void 0)for(var f in c.defines)u.push(f),u.push(c.defines[f]);for(var d=0;d<a.length;d++)u.push(h[a[d]]);return u.push(c.onBeforeCompile.toString()),u.push(t.gammaOutput),u.push(t.gammaFactor),u.join()},this.acquireProgram=function(c,h,u,f){for(var d,p=0,m=r.length;p<m;p++){var g=r[p];if(g.code===f){d=g,++d.usedTimes;break}}return d===void 0&&(d=new wv(t,e,f,c,h,u,i),r.push(d)),d},this.releaseProgram=function(c){if(--c.usedTimes===0){var h=r.indexOf(c);r[h]=r[r.length-1],r.pop(),c.destroy()}},this.programs=r}function Sv(){var t=new WeakMap;function e(s){var a=t.get(s);return a===void 0&&(a={},t.set(s,a)),a}function i(s){t.delete(s)}function n(s,a,o){t.get(s)[a]=o}function r(){t=new WeakMap}return{get:e,remove:i,update:n,dispose:r}}function Lv(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Mv(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Tc(){var t=[],e=0,i=[],n=[],r={id:-1};function s(){e=0,i.length=0,n.length=0}function a(h,u,f,d,p,m){var g=t[e];return g===void 0?(g={id:h.id,object:h,geometry:u,material:f,program:f.program||r,groupOrder:d,renderOrder:h.renderOrder,z:p,group:m},t[e]=g):(g.id=h.id,g.object=h,g.geometry=u,g.material=f,g.program=f.program||r,g.groupOrder=d,g.renderOrder=h.renderOrder,g.z=p,g.group=m),e++,g}function o(h,u,f,d,p,m){var g=a(h,u,f,d,p,m);(f.transparent===!0?n:i).push(g)}function l(h,u,f,d,p,m){var g=a(h,u,f,d,p,m);(f.transparent===!0?n:i).unshift(g)}function c(){i.length>1&&i.sort(Lv),n.length>1&&n.sort(Mv)}return{opaque:i,transparent:n,init:s,push:o,unshift:l,sort:c}}function Rv(){var t={};function e(r){var s=r.target;s.removeEventListener("dispose",e),delete t[s.id]}function i(r,s){var a=t[r.id],o;return a===void 0?(o=new Tc,t[r.id]={},t[r.id][s.id]=o,r.addEventListener("dispose",e)):(o=a[s.id],o===void 0&&(o=new Tc,a[s.id]=o)),o}function n(){t={}}return{get:i,dispose:n}}function Iv(){var t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];var i;switch(e.type){case"DirectionalLight":i={direction:new S,color:new me,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new X};break;case"SpotLight":i={position:new S,direction:new S,color:new me,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new X};break;case"PointLight":i={position:new S,color:new me,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new X,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":i={direction:new S,skyColor:new me,groundColor:new me};break;case"RectAreaLight":i={color:new me,position:new S,halfWidth:new S,halfHeight:new S};break}return t[e.id]=i,i}}}var Cv=0;function Dv(){for(var t=new Iv,e={id:Cv++,hash:{stateID:-1,directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},i=0;i<9;i++)e.probe.push(new S);var n=new S,r=new we,s=new we;function a(o,l,c){for(var h=0,u=0,f=0,d=0;d<9;d++)e.probe[d].set(0,0,0);for(var p=0,m=0,g=0,v=0,x=0,y=c.matrixWorldInverse,d=0,b=o.length;d<b;d++){var E=o[d],w=E.color,A=E.intensity,D=E.distance,O=E.shadow&&E.shadow.map?E.shadow.map.texture:null;if(E.isAmbientLight)h+=w.r*A,u+=w.g*A,f+=w.b*A;else if(E.isLightProbe)for(var P=0;P<9;P++)e.probe[P].addScaledVector(E.sh.coefficients[P],A);else if(E.isDirectionalLight){var L=t.get(E);if(L.color.copy(E.color).multiplyScalar(E.intensity),L.direction.setFromMatrixPosition(E.matrixWorld),n.setFromMatrixPosition(E.target.matrixWorld),L.direction.sub(n),L.direction.transformDirection(y),L.shadow=E.castShadow,E.castShadow){var C=E.shadow;L.shadowBias=C.bias,L.shadowRadius=C.radius,L.shadowMapSize=C.mapSize}e.directionalShadowMap[p]=O,e.directionalShadowMatrix[p]=E.shadow.matrix,e.directional[p]=L,p++}else if(E.isSpotLight){var L=t.get(E);if(L.position.setFromMatrixPosition(E.matrixWorld),L.position.applyMatrix4(y),L.color.copy(w).multiplyScalar(A),L.distance=D,L.direction.setFromMatrixPosition(E.matrixWorld),n.setFromMatrixPosition(E.target.matrixWorld),L.direction.sub(n),L.direction.transformDirection(y),L.coneCos=Math.cos(E.angle),L.penumbraCos=Math.cos(E.angle*(1-E.penumbra)),L.decay=E.decay,L.shadow=E.castShadow,E.castShadow){var C=E.shadow;L.shadowBias=C.bias,L.shadowRadius=C.radius,L.shadowMapSize=C.mapSize}e.spotShadowMap[g]=O,e.spotShadowMatrix[g]=E.shadow.matrix,e.spot[g]=L,g++}else if(E.isRectAreaLight){var L=t.get(E);L.color.copy(w).multiplyScalar(A),L.position.setFromMatrixPosition(E.matrixWorld),L.position.applyMatrix4(y),s.identity(),r.copy(E.matrixWorld),r.premultiply(y),s.extractRotation(r),L.halfWidth.set(E.width*.5,0,0),L.halfHeight.set(0,E.height*.5,0),L.halfWidth.applyMatrix4(s),L.halfHeight.applyMatrix4(s),e.rectArea[v]=L,v++}else if(E.isPointLight){var L=t.get(E);if(L.position.setFromMatrixPosition(E.matrixWorld),L.position.applyMatrix4(y),L.color.copy(E.color).multiplyScalar(E.intensity),L.distance=E.distance,L.decay=E.decay,L.shadow=E.castShadow,E.castShadow){var C=E.shadow;L.shadowBias=C.bias,L.shadowRadius=C.radius,L.shadowMapSize=C.mapSize,L.shadowCameraNear=C.camera.near,L.shadowCameraFar=C.camera.far}e.pointShadowMap[m]=O,e.pointShadowMatrix[m]=E.shadow.matrix,e.point[m]=L,m++}else if(E.isHemisphereLight){var L=t.get(E);L.direction.setFromMatrixPosition(E.matrixWorld),L.direction.transformDirection(y),L.direction.normalize(),L.skyColor.copy(E.color).multiplyScalar(A),L.groundColor.copy(E.groundColor).multiplyScalar(A),e.hemi[x]=L,x++}}e.ambient[0]=h,e.ambient[1]=u,e.ambient[2]=f,e.directional.length=p,e.spot.length=g,e.rectArea.length=v,e.point.length=m,e.hemi.length=x,e.hash.stateID=e.id,e.hash.directionalLength=p,e.hash.pointLength=m,e.hash.spotLength=g,e.hash.rectAreaLength=v,e.hash.hemiLength=x,e.hash.shadowsLength=l.length}return{setup:a,state:e}}function _c(){var t=new Dv,e=[],i=[];function n(){e.length=0,i.length=0}function r(l){e.push(l)}function s(l){i.push(l)}function a(l){t.setup(e,i,l)}var o={lightsArray:e,shadowsArray:i,lights:t};return{init:n,state:o,setupLights:a,pushLight:r,pushShadow:s}}function Pv(){var t={};function e(r){var s=r.target;s.removeEventListener("dispose",e),delete t[s.id]}function i(r,s){var a;return t[r.id]===void 0?(a=new _c,t[r.id]={},t[r.id][s.id]=a,r.addEventListener("dispose",e)):t[r.id][s.id]===void 0?(a=new _c,t[r.id][s.id]=a):a=t[r.id][s.id],a}function n(){t={}}return{get:i,dispose:n}}function mn(t){Pe.call(this),this.type="MeshDepthMaterial",this.depthPacking=np,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(t)}mn.prototype=Object.create(Pe.prototype);mn.prototype.constructor=mn;mn.prototype.isMeshDepthMaterial=!0;mn.prototype.copy=function(t){return Pe.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this};function gn(t){Pe.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new S,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(t)}gn.prototype=Object.create(Pe.prototype);gn.prototype.constructor=gn;gn.prototype.isMeshDistanceMaterial=!0;gn.prototype.copy=function(t){return Pe.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this};function hu(t,e,i){for(var n=new Aa,r=new we,s=new X,a=new X(i,i),o=new S,l=new S,c=1,h=2,u=(c|h)+1,f=new Array(u),d=new Array(u),p={},m={0:xt,1:ss,2:rr},g=[new S(1,0,0),new S(-1,0,0),new S(0,0,1),new S(0,0,-1),new S(0,1,0),new S(0,-1,0)],v=[new S(0,1,0),new S(0,1,0),new S(0,1,0),new S(0,1,0),new S(0,0,1),new S(0,0,-1)],x=[new et,new et,new et,new et,new et,new et],y=0;y!==u;++y){var b=(y&c)!==0,E=(y&h)!==0,w=new mn({depthPacking:rp,morphTargets:b,skinning:E});f[y]=w;var A=new gn({morphTargets:b,skinning:E});d[y]=A}var D=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Vh,this.render=function(L,C,U){if(D.enabled!==!1&&!(D.autoUpdate===!1&&D.needsUpdate===!1)&&L.length!==0){var j=t.getRenderTarget(),K=t.getActiveCubeFace(),z=t.getActiveMipMapLevel(),$=t.state;$.setBlending(dr),$.buffers.color.setClear(1,1,1,1),$.buffers.depth.setTest(!0),$.setScissorTest(!1);for(var k,G=0,q=L.length;G<q;G++){var ee=L[G],Q=ee.shadow,ae=ee&&ee.isPointLight;if(Q===void 0){console.warn("THREE.WebGLShadowMap:",ee,"has no shadow.");continue}var V=Q.camera;if(s.copy(Q.mapSize),s.min(a),ae){var oe=s.x,ne=s.y;x[0].set(oe*2,ne,oe,ne),x[1].set(0,ne,oe,ne),x[2].set(oe*3,ne,oe,ne),x[3].set(oe,ne,oe,ne),x[4].set(oe*3,0,oe,ne),x[5].set(oe,0,oe,ne),s.x*=4,s.y*=2}if(Q.map===null){var ve={minFilter:Mt,magFilter:Mt,format:Si};Q.map=new Li(s.x,s.y,ve),Q.map.texture.name=ee.name+".shadowMap",V.updateProjectionMatrix()}Q.isSpotLightShadow&&Q.update(ee);var Ee=Q.map,Ge=Q.matrix;l.setFromMatrixPosition(ee.matrixWorld),V.position.copy(l),ae?(k=6,Ge.makeTranslation(-l.x,-l.y,-l.z)):(k=1,o.setFromMatrixPosition(ee.target.matrixWorld),V.lookAt(o),V.updateMatrixWorld(),Ge.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),Ge.multiply(V.projectionMatrix),Ge.multiply(V.matrixWorldInverse)),t.setRenderTarget(Ee),t.clear();for(var I=0;I<k;I++){if(ae){o.copy(V.position),o.add(g[I]),V.up.copy(v[I]),V.lookAt(o),V.updateMatrixWorld();var M=x[I];$.viewport(M)}r.multiplyMatrices(V.projectionMatrix,V.matrixWorldInverse),n.setFromMatrix(r),P(C,U,V,ae)}}D.needsUpdate=!1,t.setRenderTarget(j,K,z)}};function O(L,C,U,j,K,z){var $=L.geometry,k=null,G=f,q=L.customDepthMaterial;if(U&&(G=d,q=L.customDistanceMaterial),q)k=q;else{var ee=!1;C.morphTargets&&($&&$.isBufferGeometry?ee=$.morphAttributes&&$.morphAttributes.position&&$.morphAttributes.position.length>0:$&&$.isGeometry&&(ee=$.morphTargets&&$.morphTargets.length>0)),L.isSkinnedMesh&&C.skinning===!1&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",L);var Q=L.isSkinnedMesh&&C.skinning,ae=0;ee&&(ae|=c),Q&&(ae|=h),k=G[ae]}if(t.localClippingEnabled&&C.clipShadows===!0&&C.clippingPlanes.length!==0){var V=k.uuid,oe=C.uuid,ne=p[V];ne===void 0&&(ne={},p[V]=ne);var ve=ne[oe];ve===void 0&&(ve=k.clone(),ne[oe]=ve),k=ve}return k.visible=C.visible,k.wireframe=C.wireframe,k.side=C.shadowSide!=null?C.shadowSide:m[C.side],k.clipShadows=C.clipShadows,k.clippingPlanes=C.clippingPlanes,k.clipIntersection=C.clipIntersection,k.wireframeLinewidth=C.wireframeLinewidth,k.linewidth=C.linewidth,U&&k.isMeshDistanceMaterial&&(k.referencePosition.copy(j),k.nearDistance=K,k.farDistance=z),k}function P(L,C,U,j){if(L.visible!==!1){var K=L.layers.test(C.layers);if(K&&(L.isMesh||L.isLine||L.isPoints)&&L.castShadow&&(!L.frustumCulled||n.intersectsObject(L))){L.modelViewMatrix.multiplyMatrices(U.matrixWorldInverse,L.matrixWorld);var z=e.update(L),$=L.material;if(Array.isArray($))for(var k=z.groups,G=0,q=k.length;G<q;G++){var ee=k[G],Q=$[ee.materialIndex];if(Q&&Q.visible){var ae=O(L,Q,j,l,U.near,U.far);t.renderBufferDirect(U,null,z,ae,L,ee)}}else if($.visible){var ae=O(L,$,j,l,U.near,U.far);t.renderBufferDirect(U,null,z,ae,L,null)}}for(var V=L.children,oe=0,ne=V.length;oe<ne;oe++)P(V[oe],C,U,j)}}}function Ov(t,e,i,n){function r(){var B=!1,ue=new et,ye=null,Oe=new et(0,0,0,0);return{setMask:function(xe){ye!==xe&&!B&&(t.colorMask(xe,xe,xe,xe),ye=xe)},setLocked:function(xe){B=xe},setClear:function(xe,Ve,Ze,Xe,Tt){Tt===!0&&(xe*=Xe,Ve*=Xe,Ze*=Xe),ue.set(xe,Ve,Ze,Xe),Oe.equals(ue)===!1&&(t.clearColor(xe,Ve,Ze,Xe),Oe.copy(ue))},reset:function(){B=!1,ye=null,Oe.set(-1,0,0,0)}}}function s(){var B=!1,ue=null,ye=null,Oe=null;return{setTest:function(xe){xe?Ge(2929):I(2929)},setMask:function(xe){ue!==xe&&!B&&(t.depthMask(xe),ue=xe)},setFunc:function(xe){if(ye!==xe){if(xe)switch(xe){case cd:t.depthFunc(512);break;case hd:t.depthFunc(519);break;case ud:t.depthFunc(513);break;case xo:t.depthFunc(515);break;case fd:t.depthFunc(514);break;case dd:t.depthFunc(518);break;case pd:t.depthFunc(516);break;case md:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);ye=xe}},setLocked:function(xe){B=xe},setClear:function(xe){Oe!==xe&&(t.clearDepth(xe),Oe=xe)},reset:function(){B=!1,ue=null,ye=null,Oe=null}}}function a(){var B=!1,ue=null,ye=null,Oe=null,xe=null,Ve=null,Ze=null,Xe=null,Tt=null;return{setTest:function(Ke){Ke?Ge(2960):I(2960)},setMask:function(Ke){ue!==Ke&&!B&&(t.stencilMask(Ke),ue=Ke)},setFunc:function(Ke,jt,$t){(ye!==Ke||Oe!==jt||xe!==$t)&&(t.stencilFunc(Ke,jt,$t),ye=Ke,Oe=jt,xe=$t)},setOp:function(Ke,jt,$t){(Ve!==Ke||Ze!==jt||Xe!==$t)&&(t.stencilOp(Ke,jt,$t),Ve=Ke,Ze=jt,Xe=$t)},setLocked:function(Ke){B=Ke},setClear:function(Ke){Tt!==Ke&&(t.clearStencil(Ke),Tt=Ke)},reset:function(){B=!1,ue=null,ye=null,Oe=null,xe=null,Ve=null,Ze=null,Xe=null,Tt=null}}}var o=new r,l=new s,c=new a,h=t.getParameter(34921),u=new Uint8Array(h),f=new Uint8Array(h),d=new Uint8Array(h),p={},m=null,g=null,v=null,x=null,y=null,b=null,E=null,w=null,A=null,D=null,O=!1,P=null,L=null,C=null,U=null,j=null,K=t.getParameter(35661),z=!1,$=0,k=t.getParameter(7938);k.indexOf("WebGL")!==-1?($=parseFloat(/^WebGL\ ([0-9])/.exec(k)[1]),z=$>=1):k.indexOf("OpenGL ES")!==-1&&($=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(k)[1]),z=$>=2);var G=null,q={},ee=new et,Q=new et;function ae(B,ue,ye){var Oe=new Uint8Array(4),xe=t.createTexture();t.bindTexture(B,xe),t.texParameteri(B,10241,9728),t.texParameteri(B,10240,9728);for(var Ve=0;Ve<ye;Ve++)t.texImage2D(ue+Ve,0,6408,1,1,0,6408,5121,Oe);return xe}var V={};V[3553]=ae(3553,3553,1),V[34067]=ae(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),c.setClear(0),Ge(2929),l.setFunc(xo),te(!1),se(ic),Ge(2884),re(dr);function oe(){for(var B=0,ue=u.length;B<ue;B++)u[B]=0}function ne(B){ve(B,0)}function ve(B,ue){if(u[B]=1,f[B]===0&&(t.enableVertexAttribArray(B),f[B]=1),d[B]!==ue){var ye=n.isWebGL2?t:e.get("ANGLE_instanced_arrays");ye[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](B,ue),d[B]=ue}}function Ee(){for(var B=0,ue=f.length;B!==ue;++B)f[B]!==u[B]&&(t.disableVertexAttribArray(B),f[B]=0)}function Ge(B){p[B]!==!0&&(t.enable(B),p[B]=!0)}function I(B){p[B]!==!1&&(t.disable(B),p[B]=!1)}function M(){if(m===null&&(m=[],e.get("WEBGL_compressed_texture_pvrtc")||e.get("WEBGL_compressed_texture_s3tc")||e.get("WEBGL_compressed_texture_etc1")||e.get("WEBGL_compressed_texture_astc")))for(var B=t.getParameter(34467),ue=0;ue<B.length;ue++)m.push(B[ue]);return m}function J(B){return g!==B?(t.useProgram(B),g=B,!0):!1}function re(B,ue,ye,Oe,xe,Ve,Ze,Xe){if(B===dr){v&&(I(3042),v=!1);return}if(v||(Ge(3042),v=!0),B!==$h){if(B!==x||Xe!==O){if((y!==Cn||w!==Cn)&&(t.blendEquation(32774),y=Cn,w=Cn),Xe)switch(B){case Fn:t.blendFuncSeparate(1,771,1,771);break;case go:t.blendFunc(1,1);break;case vo:t.blendFuncSeparate(0,0,769,771);break;case yo:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",B);break}else switch(B){case Fn:t.blendFuncSeparate(770,771,1,771);break;case go:t.blendFunc(770,1);break;case vo:t.blendFunc(0,769);break;case yo:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",B);break}b=null,E=null,A=null,D=null,x=B,O=Xe}return}xe=xe||ue,Ve=Ve||ye,Ze=Ze||Oe,(ue!==y||xe!==w)&&(t.blendEquationSeparate(i.convert(ue),i.convert(xe)),y=ue,w=xe),(ye!==b||Oe!==E||Ve!==A||Ze!==D)&&(t.blendFuncSeparate(i.convert(ye),i.convert(Oe),i.convert(Ve),i.convert(Ze)),b=ye,E=Oe,A=Ve,D=Ze),x=B,O=null}function W(B,ue){B.side===rr?I(2884):Ge(2884);var ye=B.side===xt;ue&&(ye=!ye),te(ye),B.blending===Fn&&B.transparent===!1?re(dr):re(B.blending,B.blendEquation,B.blendSrc,B.blendDst,B.blendEquationAlpha,B.blendSrcAlpha,B.blendDstAlpha,B.premultipliedAlpha),l.setFunc(B.depthFunc),l.setTest(B.depthTest),l.setMask(B.depthWrite),o.setMask(B.colorWrite),Re(B.polygonOffset,B.polygonOffsetFactor,B.polygonOffsetUnits)}function te(B){P!==B&&(B?t.frontFace(2304):t.frontFace(2305),P=B)}function se(B){B!==Xf?(Ge(2884),B!==L&&(B===ic?t.cullFace(1029):B===qf?t.cullFace(1028):t.cullFace(1032))):I(2884),L=B}function Le(B){B!==C&&(z&&t.lineWidth(B),C=B)}function Re(B,ue,ye){B?(Ge(32823),(U!==ue||j!==ye)&&(t.polygonOffset(ue,ye),U=ue,j=ye)):I(32823)}function ke(B){B?Ge(3089):I(3089)}function qe(B){B===void 0&&(B=33984+K-1),G!==B&&(t.activeTexture(B),G=B)}function lt(B,ue){G===null&&qe();var ye=q[G];ye===void 0&&(ye={type:void 0,texture:void 0},q[G]=ye),(ye.type!==B||ye.texture!==ue)&&(t.bindTexture(B,ue||V[B]),ye.type=B,ye.texture=ue)}function Ce(){try{t.compressedTexImage2D.apply(t,arguments)}catch(B){console.error("THREE.WebGLState:",B)}}function vt(){try{t.texImage2D.apply(t,arguments)}catch(B){console.error("THREE.WebGLState:",B)}}function yt(){try{t.texImage3D.apply(t,arguments)}catch(B){console.error("THREE.WebGLState:",B)}}function Ct(B){ee.equals(B)===!1&&(t.scissor(B.x,B.y,B.z,B.w),ee.copy(B))}function Wt(B){Q.equals(B)===!1&&(t.viewport(B.x,B.y,B.z,B.w),Q.copy(B))}function He(){for(var B=0;B<f.length;B++)f[B]===1&&(t.disableVertexAttribArray(B),f[B]=0);p={},m=null,G=null,q={},g=null,x=null,P=null,L=null,o.reset(),l.reset(),c.reset()}return{buffers:{color:o,depth:l,stencil:c},initAttributes:oe,enableAttribute:ne,enableAttributeAndDivisor:ve,disableUnusedAttributes:Ee,enable:Ge,disable:I,getCompressedTextureFormats:M,useProgram:J,setBlending:re,setMaterial:W,setFlipSided:te,setCullFace:se,setLineWidth:Le,setPolygonOffset:Re,setScissorTest:ke,activeTexture:qe,bindTexture:lt,compressedTexImage2D:Ce,texImage2D:vt,texImage3D:yt,scissor:Ct,viewport:Wt,reset:He}}function Fv(t,e,i,n,r,s,a){var o={},l,c=typeof OffscreenCanvas<"u";function h(I,M){return c?new OffscreenCanvas(I,M):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function u(I,M,J,re){var W=1;if((I.width>re||I.height>re)&&(W=re/Math.max(I.width,I.height)),W<1||M===!0)if(typeof HTMLImageElement<"u"&&I instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&I instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&I instanceof ImageBitmap){var te=M?Te.floorPowerOfTwo:Math.floor,se=te(W*I.width),Le=te(W*I.height);l===void 0&&(l=h(se,Le));var Re=J?h(se,Le):l;Re.width=se,Re.height=Le;var ke=Re.getContext("2d");return ke.drawImage(I,0,0,se,Le),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+I.width+"x"+I.height+") to ("+se+"x"+Le+")."),Re}else return"data"in I&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+I.width+"x"+I.height+")."),I;return I}function f(I){return Te.isPowerOfTwo(I.width)&&Te.isPowerOfTwo(I.height)}function d(I){return r.isWebGL2?!1:I.wrapS!==qt||I.wrapT!==qt||I.minFilter!==Mt&&I.minFilter!==ht}function p(I,M){return I.generateMipmaps&&M&&I.minFilter!==Mt&&I.minFilter!==ht}function m(I,M,J,re){t.generateMipmap(I);var W=n.get(M);W.__maxMipLevel=Math.log(Math.max(J,re))*Math.LOG2E}function g(I,M){if(!r.isWebGL2)return I;var J=I;return I===6403&&(M===5126&&(J=33326),M===5131&&(J=33325),M===5121&&(J=33321)),I===6407&&(M===5126&&(J=34837),M===5131&&(J=34843),M===5121&&(J=32849)),I===6408&&(M===5126&&(J=34836),M===5131&&(J=34842),M===5121&&(J=32856)),J===33325||J===33326||J===34842||J===34836?e.get("EXT_color_buffer_float"):(J===34843||J===34837)&&console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),J}function v(I){return I===Mt||I===Al||I===Sl?9728:9729}function x(I){var M=I.target;M.removeEventListener("dispose",x),b(M),M.isVideoTexture&&delete o[M.id],a.memory.textures--}function y(I){var M=I.target;M.removeEventListener("dispose",y),E(M),a.memory.textures--}function b(I){var M=n.get(I);M.__webglInit!==void 0&&(t.deleteTexture(M.__webglTexture),n.remove(I))}function E(I){var M=n.get(I),J=n.get(I.texture);if(I){if(J.__webglTexture!==void 0&&t.deleteTexture(J.__webglTexture),I.depthTexture&&I.depthTexture.dispose(),I.isWebGLRenderTargetCube)for(var re=0;re<6;re++)t.deleteFramebuffer(M.__webglFramebuffer[re]),M.__webglDepthbuffer&&t.deleteRenderbuffer(M.__webglDepthbuffer[re]);else t.deleteFramebuffer(M.__webglFramebuffer),M.__webglDepthbuffer&&t.deleteRenderbuffer(M.__webglDepthbuffer);n.remove(I.texture),n.remove(I)}}var w=0;function A(){w=0}function D(){var I=w;return I>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+I+" texture units while this GPU supports only "+r.maxTextures),w+=1,I}function O(I,M){var J=n.get(I);if(I.isVideoTexture&&oe(I),I.version>0&&J.__version!==I.version){var re=I.image;if(re===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(re.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{z(J,I,M);return}}i.activeTexture(33984+M),i.bindTexture(3553,J.__webglTexture)}function P(I,M){var J=n.get(I);if(I.version>0&&J.__version!==I.version){z(J,I,M);return}i.activeTexture(33984+M),i.bindTexture(35866,J.__webglTexture)}function L(I,M){var J=n.get(I);if(I.version>0&&J.__version!==I.version){z(J,I,M);return}i.activeTexture(33984+M),i.bindTexture(32879,J.__webglTexture)}function C(I,M){var J=n.get(I);if(I.image.length===6)if(I.version>0&&J.__version!==I.version){K(J,I),i.activeTexture(33984+M),i.bindTexture(34067,J.__webglTexture),t.pixelStorei(37440,I.flipY);for(var re=I&&I.isCompressedTexture,W=I.image[0]&&I.image[0].isDataTexture,te=[],se=0;se<6;se++)!re&&!W?te[se]=u(I.image[se],!1,!0,r.maxCubemapSize):te[se]=W?I.image[se].image:I.image[se];var Le=te[0],Re=f(Le)||r.isWebGL2,ke=s.convert(I.format),qe=s.convert(I.type),lt=g(ke,qe);j(34067,I,Re);for(var se=0;se<6;se++)if(!re)W?i.texImage2D(34069+se,0,lt,te[se].width,te[se].height,0,ke,qe,te[se].data):i.texImage2D(34069+se,0,lt,ke,qe,te[se]);else for(var Ce,vt=te[se].mipmaps,yt=0,Ct=vt.length;yt<Ct;yt++)Ce=vt[yt],I.format!==Si&&I.format!==Ai?i.getCompressedTextureFormats().indexOf(ke)>-1?i.compressedTexImage2D(34069+se,yt,lt,Ce.width,Ce.height,0,Ce.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+se,yt,lt,Ce.width,Ce.height,0,ke,qe,Ce.data);re?J.__maxMipLevel=vt.length-1:J.__maxMipLevel=0,p(I,Re)&&m(34067,I,Le.width,Le.height),J.__version=I.version,I.onUpdate&&I.onUpdate(I)}else i.activeTexture(33984+M),i.bindTexture(34067,J.__webglTexture)}function U(I,M){i.activeTexture(33984+M),i.bindTexture(34067,n.get(I).__webglTexture)}function j(I,M,J){var re;if(J?(t.texParameteri(I,10242,s.convert(M.wrapS)),t.texParameteri(I,10243,s.convert(M.wrapT)),(I===32879||I===35866)&&t.texParameteri(I,32882,s.convert(M.wrapR)),t.texParameteri(I,10240,s.convert(M.magFilter)),t.texParameteri(I,10241,s.convert(M.minFilter))):(t.texParameteri(I,10242,33071),t.texParameteri(I,10243,33071),(I===32879||I===35866)&&t.texParameteri(I,32882,33071),(M.wrapS!==qt||M.wrapT!==qt)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(I,10240,v(M.magFilter)),t.texParameteri(I,10241,v(M.minFilter)),M.minFilter!==Mt&&M.minFilter!==ht&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),re=e.get("EXT_texture_filter_anisotropic"),re){if(M.type===yr&&e.get("OES_texture_float_linear")===null||M.type===Ml&&(r.isWebGL2||e.get("OES_texture_half_float_linear"))===null)return;(M.anisotropy>1||n.get(M).__currentAnisotropy)&&(t.texParameterf(I,re.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(M.anisotropy,r.getMaxAnisotropy())),n.get(M).__currentAnisotropy=M.anisotropy)}}function K(I,M){I.__webglInit===void 0&&(I.__webglInit=!0,M.addEventListener("dispose",x),I.__webglTexture=t.createTexture(),a.memory.textures++)}function z(I,M,J){var re=3553;M.isDataTexture2DArray&&(re=35866),M.isDataTexture3D&&(re=32879),K(I,M),i.activeTexture(33984+J),i.bindTexture(re,I.__webglTexture),t.pixelStorei(37440,M.flipY),t.pixelStorei(37441,M.premultiplyAlpha),t.pixelStorei(3317,M.unpackAlignment);var W=d(M)&&f(M.image)===!1,te=u(M.image,W,!1,r.maxTextureSize),se=f(te)||r.isWebGL2,Le=s.convert(M.format),Re=s.convert(M.type),ke=g(Le,Re);j(re,M,se);var qe,lt=M.mipmaps;if(M.isDepthTexture){if(ke=6402,M.type===yr){if(!r.isWebGL2)throw new Error("Float Depth Texture only supported in WebGL2.0");ke=36012}else r.isWebGL2&&(ke=33189);M.format===kn&&ke===6402&&M.type!==Ss&&M.type!==Qh&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),M.type=Ss,Re=s.convert(M.type)),M.format===xr&&(ke=34041,M.type!==Ls&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),M.type=Ls,Re=s.convert(M.type))),i.texImage2D(3553,0,ke,te.width,te.height,0,Le,Re,null)}else if(M.isDataTexture)if(lt.length>0&&se){for(var Ce=0,vt=lt.length;Ce<vt;Ce++)qe=lt[Ce],i.texImage2D(3553,Ce,ke,qe.width,qe.height,0,Le,Re,qe.data);M.generateMipmaps=!1,I.__maxMipLevel=lt.length-1}else i.texImage2D(3553,0,ke,te.width,te.height,0,Le,Re,te.data),I.__maxMipLevel=0;else if(M.isCompressedTexture){for(var Ce=0,vt=lt.length;Ce<vt;Ce++)qe=lt[Ce],M.format!==Si&&M.format!==Ai?i.getCompressedTextureFormats().indexOf(Le)>-1?i.compressedTexImage2D(3553,Ce,ke,qe.width,qe.height,0,qe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,Ce,ke,qe.width,qe.height,0,Le,Re,qe.data);I.__maxMipLevel=lt.length-1}else if(M.isDataTexture2DArray)i.texImage3D(35866,0,ke,te.width,te.height,te.depth,0,Le,Re,te.data),I.__maxMipLevel=0;else if(M.isDataTexture3D)i.texImage3D(32879,0,ke,te.width,te.height,te.depth,0,Le,Re,te.data),I.__maxMipLevel=0;else if(lt.length>0&&se){for(var Ce=0,vt=lt.length;Ce<vt;Ce++)qe=lt[Ce],i.texImage2D(3553,Ce,ke,Le,Re,qe);M.generateMipmaps=!1,I.__maxMipLevel=lt.length-1}else i.texImage2D(3553,0,ke,Le,Re,te),I.__maxMipLevel=0;p(M,se)&&m(3553,M,te.width,te.height),I.__version=M.version,M.onUpdate&&M.onUpdate(M)}function $(I,M,J,re){var W=s.convert(M.texture.format),te=s.convert(M.texture.type),se=g(W,te);i.texImage2D(re,0,se,M.width,M.height,0,W,te,null),t.bindFramebuffer(36160,I),t.framebufferTexture2D(36160,J,re,n.get(M.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function k(I,M,J){if(t.bindRenderbuffer(36161,I),M.depthBuffer&&!M.stencilBuffer){if(J){var re=V(M);t.renderbufferStorageMultisample(36161,re,33189,M.width,M.height)}else t.renderbufferStorage(36161,33189,M.width,M.height);t.framebufferRenderbuffer(36160,36096,36161,I)}else if(M.depthBuffer&&M.stencilBuffer){if(J){var re=V(M);t.renderbufferStorageMultisample(36161,re,34041,M.width,M.height)}else t.renderbufferStorage(36161,34041,M.width,M.height);t.framebufferRenderbuffer(36160,33306,36161,I)}else{var W=s.convert(M.texture.format),te=s.convert(M.texture.type),se=g(W,te);if(J){var re=V(M);t.renderbufferStorageMultisample(36161,re,se,M.width,M.height)}else t.renderbufferStorage(36161,se,M.width,M.height)}t.bindRenderbuffer(36161,null)}function G(I,M){var J=M&&M.isWebGLRenderTargetCube;if(J)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,I),!(M.depthTexture&&M.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(M.depthTexture).__webglTexture||M.depthTexture.image.width!==M.width||M.depthTexture.image.height!==M.height)&&(M.depthTexture.image.width=M.width,M.depthTexture.image.height=M.height,M.depthTexture.needsUpdate=!0),O(M.depthTexture,0);var re=n.get(M.depthTexture).__webglTexture;if(M.depthTexture.format===kn)t.framebufferTexture2D(36160,36096,3553,re,0);else if(M.depthTexture.format===xr)t.framebufferTexture2D(36160,33306,3553,re,0);else throw new Error("Unknown depthTexture format")}function q(I){var M=n.get(I),J=I.isWebGLRenderTargetCube===!0;if(I.depthTexture){if(J)throw new Error("target.depthTexture not supported in Cube render targets");G(M.__webglFramebuffer,I)}else if(J){M.__webglDepthbuffer=[];for(var re=0;re<6;re++)t.bindFramebuffer(36160,M.__webglFramebuffer[re]),M.__webglDepthbuffer[re]=t.createRenderbuffer(),k(M.__webglDepthbuffer[re],I)}else t.bindFramebuffer(36160,M.__webglFramebuffer),M.__webglDepthbuffer=t.createRenderbuffer(),k(M.__webglDepthbuffer,I);t.bindFramebuffer(36160,null)}function ee(I){var M=n.get(I),J=n.get(I.texture);I.addEventListener("dispose",y),J.__webglTexture=t.createTexture(),a.memory.textures++;var re=I.isWebGLRenderTargetCube===!0,W=I.isWebGLMultisampleRenderTarget===!0,te=f(I)||r.isWebGL2;if(re){M.__webglFramebuffer=[];for(var se=0;se<6;se++)M.__webglFramebuffer[se]=t.createFramebuffer()}else if(M.__webglFramebuffer=t.createFramebuffer(),W)if(r.isWebGL2){M.__webglMultisampledFramebuffer=t.createFramebuffer(),M.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,M.__webglColorRenderbuffer);var Le=s.convert(I.texture.format),Re=s.convert(I.texture.type),ke=g(Le,Re),qe=V(I);t.renderbufferStorageMultisample(36161,qe,ke,I.width,I.height),t.bindFramebuffer(36160,M.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,M.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),I.depthBuffer&&(M.__webglDepthRenderbuffer=t.createRenderbuffer(),k(M.__webglDepthRenderbuffer,I,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(re){i.bindTexture(34067,J.__webglTexture),j(34067,I.texture,te);for(var se=0;se<6;se++)$(M.__webglFramebuffer[se],I,36064,34069+se);p(I.texture,te)&&m(34067,I.texture,I.width,I.height),i.bindTexture(34067,null)}else i.bindTexture(3553,J.__webglTexture),j(3553,I.texture,te),$(M.__webglFramebuffer,I,36064,3553),p(I.texture,te)&&m(3553,I.texture,I.width,I.height),i.bindTexture(3553,null);I.depthBuffer&&q(I)}function Q(I){var M=I.texture,J=f(I)||r.isWebGL2;if(p(M,J)){var re=I.isWebGLRenderTargetCube?34067:3553,W=n.get(M).__webglTexture;i.bindTexture(re,W),m(re,M,I.width,I.height),i.bindTexture(re,null)}}function ae(I){if(I.isWebGLMultisampleRenderTarget)if(r.isWebGL2){var M=n.get(I);t.bindFramebuffer(36008,M.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,M.__webglFramebuffer);var J=I.width,re=I.height,W=16384;I.depthBuffer&&(W|=256),I.stencilBuffer&&(W|=1024),t.blitFramebuffer(0,0,J,re,0,0,J,re,W,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function V(I){return r.isWebGL2&&I.isWebGLMultisampleRenderTarget?Math.min(r.maxSamples,I.samples):0}function oe(I){var M=I.id,J=a.render.frame;o[M]!==J&&(o[M]=J,I.update())}var ne=!1,ve=!1;function Ee(I,M){I&&I.isWebGLRenderTarget&&(ne===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),ne=!0),I=I.texture),O(I,M)}function Ge(I,M){I&&I.isWebGLRenderTargetCube&&(ve===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),ve=!0),I=I.texture),I&&I.isCubeTexture||Array.isArray(I.image)&&I.image.length===6?C(I,M):U(I,M)}this.allocateTextureUnit=D,this.resetTextureUnits=A,this.setTexture2D=O,this.setTexture2DArray=P,this.setTexture3D=L,this.setTextureCube=C,this.setTextureCubeDynamic=U,this.setupRenderTarget=ee,this.updateRenderTargetMipmap=Q,this.updateMultisampleRenderTarget=ae,this.safeSetTexture2D=Ee,this.safeSetTextureCube=Ge}function kv(t,e,i){function n(r){var s;if(r===qi)return 10497;if(r===qt)return 33071;if(r===Un)return 33648;if(r===Mt)return 9728;if(r===Al)return 9984;if(r===Sl)return 9986;if(r===ht)return 9729;if(r===Jh)return 9985;if(r===_a)return 9987;if(r===Ll)return 5121;if(r===Ad)return 32819;if(r===Sd)return 32820;if(r===Ld)return 33635;if(r===Td)return 5120;if(r===_d)return 5122;if(r===Ss)return 5123;if(r===wd)return 5124;if(r===Qh)return 5125;if(r===yr)return 5126;if(r===Ml){if(i.isWebGL2)return 5131;if(s=e.get("OES_texture_half_float"),s!==null)return s.HALF_FLOAT_OES}if(r===Md)return 6406;if(r===Ai)return 6407;if(r===Si)return 6408;if(r===Rd)return 6409;if(r===Id)return 6410;if(r===kn)return 6402;if(r===xr)return 34041;if(r===Cd)return 6403;if(r===Cn)return 32774;if(r===Jf)return 32778;if(r===Qf)return 32779;if(r===ed)return 0;if(r===td)return 1;if(r===id)return 768;if(r===nd)return 769;if(r===Yh)return 770;if(r===Kh)return 771;if(r===rd)return 772;if(r===sd)return 773;if(r===ad)return 774;if(r===od)return 775;if(r===ld)return 776;if((r===nc||r===rc||r===sc||r===ac)&&(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null)){if(r===nc)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===rc)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===sc)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===ac)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((r===oc||r===lc||r===cc||r===hc)&&(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null)){if(r===oc)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===lc)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===cc)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===hc)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(r===Dd&&(s=e.get("WEBGL_compressed_texture_etc1"),s!==null))return s.COMPRESSED_RGB_ETC1_WEBGL;if((r===Pd||r===Od||r===Fd||r===kd||r===Nd||r===Bd||r===Ud||r===Gd||r===Hd||r===Vd||r===zd||r===Wd||r===jd||r===$d)&&(s=e.get("WEBGL_compressed_texture_astc"),s!==null))return r;if(r===Fa||r===ka){if(i.isWebGL2){if(r===Fa)return 32775;if(r===ka)return 32776}if(s=e.get("EXT_blend_minmax"),s!==null){if(r===Fa)return s.MIN_EXT;if(r===ka)return s.MAX_EXT}}if(r===Ls){if(i.isWebGL2)return 34042;if(s=e.get("WEBGL_depth_texture"),s!==null)return s.UNSIGNED_INT_24_8_WEBGL}return 0}return{convert:n}}function Ar(){ce.call(this),this.type="Group"}Ar.prototype=Object.assign(Object.create(ce.prototype),{constructor:Ar,isGroup:!0});function Gi(){ce.call(this),this.type="Camera",this.matrixWorldInverse=new we,this.projectionMatrix=new we,this.projectionMatrixInverse=new we}Gi.prototype=Object.assign(Object.create(ce.prototype),{constructor:Gi,isCamera:!0,copy:function(t,e){return ce.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){t===void 0&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new S),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){ce.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return new this.constructor().copy(this)}});function ct(t,e,i,n){Gi.call(this),this.type="PerspectiveCamera",this.fov=t!==void 0?t:50,this.zoom=1,this.near=i!==void 0?i:.1,this.far=n!==void 0?n:2e3,this.focus=10,this.aspect=e!==void 0?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}ct.prototype=Object.assign(Object.create(Gi.prototype),{constructor:ct,isPerspectiveCamera:!0,copy:function(t,e){return Gi.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var e=.5*this.getFilmHeight()/t;this.fov=Te.RAD2DEG*2*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(Te.DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/t},getEffectiveFOV:function(){return Te.RAD2DEG*2*Math.atan(Math.tan(Te.DEG2RAD*.5*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,i,n,r,s){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(Te.DEG2RAD*.5*this.fov)/this.zoom,i=2*e,n=this.aspect*i,r=-.5*n,s=this.view;if(this.view!==null&&this.view.enabled){var a=s.fullWidth,o=s.fullHeight;r+=s.offsetX*n/a,e-=s.offsetY*i/o,n*=s.width/a,i*=s.height/o}var l=this.filmOffset;l!==0&&(r+=t*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,e,e-i,t,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){var e=ce.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}});function Os(t){ct.call(this),this.cameras=t||[]}Os.prototype=Object.assign(Object.create(ct.prototype),{constructor:Os,isArrayCamera:!0});var wc=new S,Ac=new S;function uu(t,e,i){wc.setFromMatrixPosition(e.matrixWorld),Ac.setFromMatrixPosition(i.matrixWorld);var n=wc.distanceTo(Ac),r=e.projectionMatrix.elements,s=i.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],h=(r[8]-1)/r[0],u=(s[8]+1)/s[0],f=a*h,d=a*u,p=n/(-h+u),m=p*-h;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(p),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.getInverse(t.matrixWorld);var g=a+p,v=o+p,x=f-m,y=d+(n-m),b=l*o/v*g,E=c*o/v*g;t.projectionMatrix.makePerspective(x,y,b,E,g,v)}function fu(t){var e,i,n=this,r=null,s=null,a=null,o=[],l=new we,c=new we,h=1,u="local-floor";typeof window<"u"&&"VRFrameData"in window&&(s=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",E,!1));var f=new we,d=new tt,p=new S,m=new ct;m.viewport=new et,m.layers.enable(1);var g=new ct;g.viewport=new et,g.layers.enable(2);var v=new Os([m,g]);v.layers.enable(1),v.layers.enable(2);function x(){return r!==null&&r.isPresenting===!0}var y=new X,b;function E(){if(x()){var L=r.getEyeParameters("left");e=2*L.renderWidth*h,i=L.renderHeight*h,b=t.getPixelRatio(),t.getSize(y),t.setDrawingBufferSize(e,i,1),m.viewport.set(0,0,e/2,i),g.viewport.set(e/2,0,e/2,i),P.start()}else n.enabled&&t.setDrawingBufferSize(y.width,y.height,b),P.stop()}var w=[];function A(L){for(var C=navigator.getGamepads&&navigator.getGamepads(),U=0,j=0,K=C.length;U<K;U++){var z=C[U];if(z&&(z.id==="Daydream Controller"||z.id==="Gear VR Controller"||z.id==="Oculus Go Controller"||z.id==="OpenVR Gamepad"||z.id.startsWith("Oculus Touch")||z.id.startsWith("Spatial Controller"))){if(j===L)return z;j++}}}function D(){for(var L=0;L<o.length;L++){var C=o[L],U=A(L);if(U!==void 0&&U.pose!==void 0){if(U.pose===null)return;var j=U.pose;j.hasPosition===!1&&C.position.set(.2,-.6,-.05),j.position!==null&&C.position.fromArray(j.position),j.orientation!==null&&C.quaternion.fromArray(j.orientation),C.matrix.compose(C.position,C.quaternion,C.scale),C.matrix.premultiply(l),C.matrix.decompose(C.position,C.quaternion,C.scale),C.matrixWorldNeedsUpdate=!0,C.visible=!0;var K=U.id==="Daydream Controller"?0:1;w[L]===void 0&&(w[L]=!1),w[L]!==U.buttons[K].pressed&&(w[L]=U.buttons[K].pressed,w[L]===!0?C.dispatchEvent({type:"selectstart"}):(C.dispatchEvent({type:"selectend"}),C.dispatchEvent({type:"select"})))}else C.visible=!1}}function O(L,C){C!==null&&C.length===4&&L.set(C[0]*e,C[1]*i,C[2]*e,C[3]*i)}this.enabled=!1,this.getController=function(L){var C=o[L];return C===void 0&&(C=new Ar,C.matrixAutoUpdate=!1,C.visible=!1,o[L]=C),C},this.getDevice=function(){return r},this.setDevice=function(L){L!==void 0&&(r=L),P.setContext(L)},this.setFramebufferScaleFactor=function(L){h=L},this.setReferenceSpaceType=function(L){u=L},this.setPoseTarget=function(L){L!==void 0&&(a=L)},this.getCamera=function(L){var C=u==="local-floor"?1.6:0;if(x()===!1)return L.position.set(0,C,0),L.rotation.set(0,0,0),L;if(r.depthNear=L.near,r.depthFar=L.far,r.getFrameData(s),u==="local-floor"){var U=r.stageParameters;U?l.fromArray(U.sittingToStandingTransform):l.makeTranslation(0,C,0)}var j=s.pose,K=a!==null?a:L;K.matrix.copy(l),K.matrix.decompose(K.position,K.quaternion,K.scale),j.orientation!==null&&(d.fromArray(j.orientation),K.quaternion.multiply(d)),j.position!==null&&(d.setFromRotationMatrix(l),p.fromArray(j.position),p.applyQuaternion(d),K.position.add(p)),K.updateMatrixWorld(),m.near=L.near,g.near=L.near,m.far=L.far,g.far=L.far,m.matrixWorldInverse.fromArray(s.leftViewMatrix),g.matrixWorldInverse.fromArray(s.rightViewMatrix),c.getInverse(l),u==="local-floor"&&(m.matrixWorldInverse.multiply(c),g.matrixWorldInverse.multiply(c));var z=K.parent;z!==null&&(f.getInverse(z.matrixWorld),m.matrixWorldInverse.multiply(f),g.matrixWorldInverse.multiply(f)),m.matrixWorld.getInverse(m.matrixWorldInverse),g.matrixWorld.getInverse(g.matrixWorldInverse),m.projectionMatrix.fromArray(s.leftProjectionMatrix),g.projectionMatrix.fromArray(s.rightProjectionMatrix),uu(v,m,g);var $=r.getLayers();if($.length){var k=$[0];O(m.viewport,k.leftBounds),O(g.viewport,k.rightBounds)}return D(),v},this.getStandingMatrix=function(){return l},this.isPresenting=x;var P=new Il;this.setAnimationLoop=function(L){P.setAnimationLoop(L),x()&&P.start()},this.submitFrame=function(){x()&&r.submitFrame()},this.dispose=function(){typeof window<"u"&&window.removeEventListener("vrdisplaypresentchange",E)},this.setFrameOfReferenceType=function(){console.warn("THREE.WebVRManager: setFrameOfReferenceType() has been deprecated.")}}function Nv(t){var e=t.context,i=null,n=null,r="local-floor",s=null,a=[],o=[];function l(){return i!==null&&n!==null}var c=new ct;c.layers.enable(1),c.viewport=new et;var h=new ct;h.layers.enable(2),h.viewport=new et;var u=new Os([c,h]);u.layers.enable(1),u.layers.enable(2),this.enabled=!1,this.getController=function(y){var b=a[y];return b===void 0&&(b=new Ar,b.matrixAutoUpdate=!1,b.visible=!1,a[y]=b),b};function f(y){for(var b=0;b<a.length;b++)o[b]===y.inputSource&&a[b].dispatchEvent({type:y.type})}function d(){t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),x.stop()}function p(y){n=y,x.setContext(i),x.start()}this.setFramebufferScaleFactor=function(y){},this.setReferenceSpaceType=function(y){r=y},this.getSession=function(){return i},this.setSession=function(y){i=y,i!==null&&(i.addEventListener("select",f),i.addEventListener("selectstart",f),i.addEventListener("selectend",f),i.addEventListener("end",d),i.updateRenderState({baseLayer:new XRWebGLLayer(i,e)}),i.requestReferenceSpace(r).then(p),o=i.inputSources,i.addEventListener("inputsourceschange",function(){o=i.inputSources,console.log(o);for(var b=0;b<a.length;b++){var E=a[b];E.userData.inputSource=o[b]}}))};function m(y,b){b===null?y.matrixWorld.copy(y.matrix):y.matrixWorld.multiplyMatrices(b.matrixWorld,y.matrix),y.matrixWorldInverse.getInverse(y.matrixWorld)}this.getCamera=function(y){if(l()){var b=y.parent,E=u.cameras;m(u,b);for(var w=0;w<E.length;w++)m(E[w],b);y.matrixWorld.copy(u.matrixWorld);for(var A=y.children,w=0,D=A.length;w<D;w++)A[w].updateMatrixWorld(!0);return uu(u,c,h),u}return y},this.isPresenting=l;var g=null;function v(y,b){if(s=b.getViewerPose(n),s!==null){var E=s.views,w=i.renderState.baseLayer;t.setFramebuffer(w.framebuffer);for(var A=0;A<E.length;A++){var D=E[A],O=w.getViewport(D),P=D.transform.inverse.matrix,L=u.cameras[A];L.matrix.fromArray(P).getInverse(L.matrix),L.projectionMatrix.fromArray(D.projectionMatrix),L.viewport.set(O.x,O.y,O.width,O.height),A===0&&u.matrix.copy(L.matrix)}}for(var A=0;A<a.length;A++){var C=a[A],U=o[A];if(U){var j=b.getPose(U.targetRaySpace,n);if(j!==null){C.matrix.fromArray(j.transform.matrix),C.matrix.decompose(C.position,C.rotation,C.scale),C.visible=!0;continue}}C.visible=!1}g&&g(y)}var x=new Il;x.setAnimationLoop(v),this.setAnimationLoop=function(y){g=y},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed."),new we},this.getDevice=function(){console.warn("THREE.WebXRManager: getDevice() has been deprecated.")},this.setDevice=function(){console.warn("THREE.WebXRManager: setDevice() has been deprecated.")},this.setFrameOfReferenceType=function(){console.warn("THREE.WebXRManager: setFrameOfReferenceType() has been deprecated.")},this.submitFrame=function(){}}function Cl(t){console.log("THREE.WebGLRenderer",Hh),t=t||{};var e=t.canvas!==void 0?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),i=t.context!==void 0?t.context:null,n=t.alpha!==void 0?t.alpha:!1,r=t.depth!==void 0?t.depth:!0,s=t.stencil!==void 0?t.stencil:!0,a=t.antialias!==void 0?t.antialias:!1,o=t.premultipliedAlpha!==void 0?t.premultipliedAlpha:!0,l=t.preserveDrawingBuffer!==void 0?t.preserveDrawingBuffer:!1,c=t.powerPreference!==void 0?t.powerPreference:"default",h=t.failIfMajorPerformanceCaveat!==void 0?t.failIfMajorPerformanceCaveat:!1,u=null,f=null;this.domElement=e,this.context=null,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=Xh,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var d=this,p=!1,m=null,g=0,v=0,x=null,y=null,b=-1,E={geometry:null,program:null,wireframe:!1},w=null,A=null,D=new et,O=new et,P=null,L=e.width,C=e.height,U=1,j=new et(0,0,L,C),K=new et(0,0,L,C),z=!1,$=new Aa,k=new Rg,G=!1,q=!1,ee=new we,Q=new S;function ae(){return x===null?U:1}var V;try{var oe={alpha:n,depth:r,stencil:s,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h,xrCompatible:!0};if(e.addEventListener("webglcontextlost",Wt,!1),e.addEventListener("webglcontextrestored",He,!1),V=i||e.getContext("webgl",oe)||e.getContext("experimental-webgl",oe),V===null)throw e.getContext("webgl")!==null?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");V.getShaderPrecisionFormat===void 0&&(V.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(_){throw console.error("THREE.WebGLRenderer: "+_.message),_}var ne,ve,Ee,Ge,I,M,J,re,W,te,se,Le,Re,ke,qe,lt,Ce;function vt(){ne=new Ig(V),ve=new Mg(V,ne,t),ve.isWebGL2||(ne.get("WEBGL_depth_texture"),ne.get("OES_texture_float"),ne.get("OES_texture_half_float"),ne.get("OES_texture_half_float_linear"),ne.get("OES_standard_derivatives"),ne.get("OES_element_index_uint"),ne.get("ANGLE_instanced_arrays")),ne.get("OES_texture_float_linear"),Ce=new kv(V,ne,ve),Ee=new Ov(V,ne,Ce,ve),Ee.scissor(O.copy(K).multiplyScalar(U)),Ee.viewport(D.copy(j).multiplyScalar(U)),Ge=new Pg,I=new Sv,M=new Fv(V,ne,Ee,I,ve,Ce,Ge),J=new xg(V),re=new Cg(V,J,Ge),W=new kg(re,Ge),ke=new Fg(V),te=new Av(d,ne,ve),se=new Rv,Le=new Pv,Re=new Sg(d,Ee,W,o),qe=new Lg(V,ne,Ge,ve),lt=new Dg(V,ne,Ge,ve),Ge.programs=te.programs,d.context=V,d.capabilities=ve,d.extensions=ne,d.properties=I,d.renderLists=se,d.state=Ee,d.info=Ge}vt();var yt=typeof navigator<"u"&&"xr"in navigator&&"supportsSession"in navigator.xr?new Nv(d):new fu(d);this.vr=yt;var Ct=new hu(d,W,ve.maxTextureSize);this.shadowMap=Ct,this.getContext=function(){return V},this.getContextAttributes=function(){return V.getContextAttributes()},this.forceContextLoss=function(){var _=ne.get("WEBGL_lose_context");_&&_.loseContext()},this.forceContextRestore=function(){var _=ne.get("WEBGL_lose_context");_&&_.restoreContext()},this.getPixelRatio=function(){return U},this.setPixelRatio=function(_){_!==void 0&&(U=_,this.setSize(L,C,!1))},this.getSize=function(_){return _===void 0&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),_=new X),_.set(L,C)},this.setSize=function(_,R,F){if(yt.isPresenting()){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}L=_,C=R,e.width=_*U,e.height=R*U,F!==!1&&(e.style.width=_+"px",e.style.height=R+"px"),this.setViewport(0,0,_,R)},this.getDrawingBufferSize=function(_){return _===void 0&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),_=new X),_.set(L*U,C*U)},this.setDrawingBufferSize=function(_,R,F){L=_,C=R,U=F,e.width=_*F,e.height=R*F,this.setViewport(0,0,_,R)},this.getCurrentViewport=function(_){return _===void 0&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),_=new et),_.copy(D)},this.getViewport=function(_){return _.copy(j)},this.setViewport=function(_,R,F,ie){_.isVector4?j.set(_.x,_.y,_.z,_.w):j.set(_,R,F,ie),Ee.viewport(D.copy(j).multiplyScalar(U))},this.getScissor=function(_){return _.copy(K)},this.setScissor=function(_,R,F,ie){_.isVector4?K.set(_.x,_.y,_.z,_.w):K.set(_,R,F,ie),Ee.scissor(O.copy(K).multiplyScalar(U))},this.getScissorTest=function(){return z},this.setScissorTest=function(_){Ee.setScissorTest(z=_)},this.getClearColor=function(){return Re.getClearColor()},this.setClearColor=function(){Re.setClearColor.apply(Re,arguments)},this.getClearAlpha=function(){return Re.getClearAlpha()},this.setClearAlpha=function(){Re.setClearAlpha.apply(Re,arguments)},this.clear=function(_,R,F){var ie=0;(_===void 0||_)&&(ie|=16384),(R===void 0||R)&&(ie|=256),(F===void 0||F)&&(ie|=1024),V.clear(ie)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Wt,!1),e.removeEventListener("webglcontextrestored",He,!1),se.dispose(),Le.dispose(),I.dispose(),W.dispose(),yt.dispose(),Xe.stop()};function Wt(_){_.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),p=!0}function He(){console.log("THREE.WebGLRenderer: Context Restored."),p=!1,vt()}function B(_){var R=_.target;R.removeEventListener("dispose",B),ue(R)}function ue(_){ye(_),I.remove(_)}function ye(_){var R=I.get(_).program;_.program=void 0,R!==void 0&&te.releaseProgram(R)}function Oe(_,R){_.render(function(F){d.renderBufferImmediate(F,R)})}this.renderBufferImmediate=function(_,R){Ee.initAttributes();var F=I.get(_);_.hasPositions&&!F.position&&(F.position=V.createBuffer()),_.hasNormals&&!F.normal&&(F.normal=V.createBuffer()),_.hasUvs&&!F.uv&&(F.uv=V.createBuffer()),_.hasColors&&!F.color&&(F.color=V.createBuffer());var ie=R.getAttributes();_.hasPositions&&(V.bindBuffer(34962,F.position),V.bufferData(34962,_.positionArray,35048),Ee.enableAttribute(ie.position),V.vertexAttribPointer(ie.position,3,5126,!1,0,0)),_.hasNormals&&(V.bindBuffer(34962,F.normal),V.bufferData(34962,_.normalArray,35048),Ee.enableAttribute(ie.normal),V.vertexAttribPointer(ie.normal,3,5126,!1,0,0)),_.hasUvs&&(V.bindBuffer(34962,F.uv),V.bufferData(34962,_.uvArray,35048),Ee.enableAttribute(ie.uv),V.vertexAttribPointer(ie.uv,2,5126,!1,0,0)),_.hasColors&&(V.bindBuffer(34962,F.color),V.bufferData(34962,_.colorArray,35048),Ee.enableAttribute(ie.color),V.vertexAttribPointer(ie.color,3,5126,!1,0,0)),Ee.disableUnusedAttributes(),V.drawArrays(4,0,_.count),_.count=0},this.renderBufferDirect=function(_,R,F,ie,fe,Be){var de=fe.isMesh&&fe.matrixWorld.determinant()<0;Ee.setMaterial(ie,de);var pe=cr(_,R,ie,fe),Ne=!1;(E.geometry!==F.id||E.program!==pe.id||E.wireframe!==(ie.wireframe===!0))&&(E.geometry=F.id,E.program=pe.id,E.wireframe=ie.wireframe===!0,Ne=!0),fe.morphTargetInfluences&&(ke.update(fe,F,ie,pe),Ne=!0);var nt=F.index,it=F.attributes.position,$e=1;ie.wireframe===!0&&(nt=re.getWireframeAttribute(F),$e=2);var pt,Ue=qe;nt!==null&&(pt=J.get(nt),Ue=lt,Ue.setIndex(pt)),Ne&&(xe(ie,pe,F),nt!==null&&V.bindBuffer(34963,pt.buffer));var Ae=1/0;nt!==null?Ae=nt.count:it!==void 0&&(Ae=it.count);var Je=F.drawRange.start*$e,Dt=F.drawRange.count*$e,$i=Be!==null?Be.start*$e:0,_t=Be!==null?Be.count*$e:1/0,an=Math.max(Je,$i),cs=Math.min(Ae,Je+Dt,$i+_t)-1,Da=Math.max(0,cs-an+1);if(Da!==0){if(fe.isMesh)if(ie.wireframe===!0)Ee.setLineWidth(ie.wireframeLinewidth*ae()),Ue.setMode(1);else switch(fe.drawMode){case Rl:Ue.setMode(4);break;case qd:Ue.setMode(5);break;case Zd:Ue.setMode(6);break}else if(fe.isLine){var Pa=ie.linewidth;Pa===void 0&&(Pa=1),Ee.setLineWidth(Pa*ae()),fe.isLineSegments?Ue.setMode(1):fe.isLineLoop?Ue.setMode(2):Ue.setMode(3)}else fe.isPoints?Ue.setMode(0):fe.isSprite&&Ue.setMode(4);F&&F.isInstancedBufferGeometry?F.maxInstancedCount>0&&Ue.renderInstances(F,an,Da):Ue.render(an,Da)}};function xe(_,R,F){if(F&&F.isInstancedBufferGeometry&&!ve.isWebGL2&&ne.get("ANGLE_instanced_arrays")===null){console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}Ee.initAttributes();var ie=F.attributes,fe=R.getAttributes(),Be=_.defaultAttributeValues;for(var de in fe){var pe=fe[de];if(pe>=0){var Ne=ie[de];if(Ne!==void 0){var nt=Ne.normalized,it=Ne.itemSize,$e=J.get(Ne);if($e===void 0)continue;var pt=$e.buffer,Ue=$e.type,Ae=$e.bytesPerElement;if(Ne.isInterleavedBufferAttribute){var Je=Ne.data,Dt=Je.stride,$i=Ne.offset;Je&&Je.isInstancedInterleavedBuffer?(Ee.enableAttributeAndDivisor(pe,Je.meshPerAttribute),F.maxInstancedCount===void 0&&(F.maxInstancedCount=Je.meshPerAttribute*Je.count)):Ee.enableAttribute(pe),V.bindBuffer(34962,pt),V.vertexAttribPointer(pe,it,Ue,nt,Dt*Ae,$i*Ae)}else Ne.isInstancedBufferAttribute?(Ee.enableAttributeAndDivisor(pe,Ne.meshPerAttribute),F.maxInstancedCount===void 0&&(F.maxInstancedCount=Ne.meshPerAttribute*Ne.count)):Ee.enableAttribute(pe),V.bindBuffer(34962,pt),V.vertexAttribPointer(pe,it,Ue,nt,0,0)}else if(Be!==void 0){var _t=Be[de];if(_t!==void 0)switch(_t.length){case 2:V.vertexAttrib2fv(pe,_t);break;case 3:V.vertexAttrib3fv(pe,_t);break;case 4:V.vertexAttrib4fv(pe,_t);break;default:V.vertexAttrib1fv(pe,_t)}}}}Ee.disableUnusedAttributes()}this.compile=function(_,R){f=Le.get(_,R),f.init(),_.traverse(function(F){F.isLight&&(f.pushLight(F),F.castShadow&&f.pushShadow(F))}),f.setupLights(R),_.traverse(function(F){if(F.material)if(Array.isArray(F.material))for(var ie=0;ie<F.material.length;ie++)$t(F.material[ie],_.fog,F);else $t(F.material,_.fog,F)})};var Ve=null;function Ze(_){yt.isPresenting()||Ve&&Ve(_)}var Xe=new Il;Xe.setAnimationLoop(Ze),typeof window<"u"&&Xe.setContext(window),this.setAnimationLoop=function(_){Ve=_,yt.setAnimationLoop(_),Xe.start()},this.render=function(_,R){var F,ie;if(arguments[2]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),F=arguments[2]),arguments[3]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),ie=arguments[3]),!(R&&R.isCamera)){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(!p){E.geometry=null,E.program=null,E.wireframe=!1,b=-1,w=null,_.autoUpdate===!0&&_.updateMatrixWorld(),R.parent===null&&R.updateMatrixWorld(),yt.enabled&&(R=yt.getCamera(R)),f=Le.get(_,R),f.init(),_.onBeforeRender(d,_,R,F||x),ee.multiplyMatrices(R.projectionMatrix,R.matrixWorldInverse),$.setFromMatrix(ee),q=this.localClippingEnabled,G=k.init(this.clippingPlanes,q,R),u=se.get(_,R),u.init(),Tt(_,R,0,d.sortObjects),d.sortObjects===!0&&u.sort(),G&&k.beginShadows();var fe=f.state.shadowsArray;Ct.render(fe,_,R),f.setupLights(R),G&&k.endShadows(),this.info.autoReset&&this.info.reset(),F!==void 0&&this.setRenderTarget(F),Re.render(u,_,R,ie);var Be=u.opaque,de=u.transparent;if(_.overrideMaterial){var pe=_.overrideMaterial;Be.length&&Ke(Be,_,R,pe),de.length&&Ke(de,_,R,pe)}else Be.length&&Ke(Be,_,R),de.length&&Ke(de,_,R);_.onAfterRender(d,_,R),x!==null&&(M.updateRenderTargetMipmap(x),M.updateMultisampleRenderTarget(x)),Ee.buffers.depth.setTest(!0),Ee.buffers.depth.setMask(!0),Ee.buffers.color.setMask(!0),Ee.setPolygonOffset(!1),yt.enabled&&yt.submitFrame(),u=null,f=null}};function Tt(_,R,F,ie){if(_.visible!==!1){var fe=_.layers.test(R.layers);if(fe){if(_.isGroup)F=_.renderOrder;else if(_.isLight)f.pushLight(_),_.castShadow&&f.pushShadow(_);else if(_.isSprite){if(!_.frustumCulled||$.intersectsSprite(_)){ie&&Q.setFromMatrixPosition(_.matrixWorld).applyMatrix4(ee);var Be=W.update(_),de=_.material;de.visible&&u.push(_,Be,de,F,Q.z,null)}}else if(_.isImmediateRenderObject)ie&&Q.setFromMatrixPosition(_.matrixWorld).applyMatrix4(ee),u.push(_,null,_.material,F,Q.z,null);else if((_.isMesh||_.isLine||_.isPoints)&&(_.isSkinnedMesh&&_.skeleton.update(),!_.frustumCulled||$.intersectsObject(_))){ie&&Q.setFromMatrixPosition(_.matrixWorld).applyMatrix4(ee);var Be=W.update(_),de=_.material;if(Array.isArray(de))for(var pe=Be.groups,Ne=0,nt=pe.length;Ne<nt;Ne++){var it=pe[Ne],$e=de[it.materialIndex];$e&&$e.visible&&u.push(_,Be,$e,F,Q.z,it)}else de.visible&&u.push(_,Be,de,F,Q.z,null)}}for(var pt=_.children,Ne=0,nt=pt.length;Ne<nt;Ne++)Tt(pt[Ne],R,F,ie)}}function Ke(_,R,F,ie){for(var fe=0,Be=_.length;fe<Be;fe++){var de=_[fe],pe=de.object,Ne=de.geometry,nt=ie===void 0?de.material:ie,it=de.group;if(F.isArrayCamera){A=F;for(var $e=F.cameras,pt=0,Ue=$e.length;pt<Ue;pt++){var Ae=$e[pt];pe.layers.test(Ae.layers)&&(Ee.viewport(D.copy(Ae.viewport)),f.setupLights(Ae),jt(pe,R,Ae,Ne,nt,it))}}else A=null,jt(pe,R,F,Ne,nt,it)}}function jt(_,R,F,ie,fe,Be){if(_.onBeforeRender(d,R,F,ie,fe,Be),f=Le.get(R,A||F),_.modelViewMatrix.multiplyMatrices(F.matrixWorldInverse,_.matrixWorld),_.normalMatrix.getNormalMatrix(_.modelViewMatrix),_.isImmediateRenderObject){Ee.setMaterial(fe);var de=cr(F,R.fog,fe,_);E.geometry=null,E.program=null,E.wireframe=!1,Oe(_,de)}else d.renderBufferDirect(F,R.fog,ie,fe,_,Be);_.onAfterRender(d,R,F,ie,fe,Be),f=Le.get(R,A||F)}function $t(_,R,F){var ie=I.get(_),fe=f.state.lights,Be=f.state.shadowsArray,de=ie.lightsHash,pe=fe.state.hash,Ne=te.getParameters(_,fe.state,Be,R,k.numPlanes,k.numIntersection,F),nt=te.getProgramCode(_,Ne),it=ie.program,$e=!0;if(it===void 0)_.addEventListener("dispose",B);else if(it.code!==nt)ye(_);else if(de.stateID!==pe.stateID||de.directionalLength!==pe.directionalLength||de.pointLength!==pe.pointLength||de.spotLength!==pe.spotLength||de.rectAreaLength!==pe.rectAreaLength||de.hemiLength!==pe.hemiLength||de.shadowsLength!==pe.shadowsLength)de.stateID=pe.stateID,de.directionalLength=pe.directionalLength,de.pointLength=pe.pointLength,de.spotLength=pe.spotLength,de.rectAreaLength=pe.rectAreaLength,de.hemiLength=pe.hemiLength,de.shadowsLength=pe.shadowsLength,$e=!1;else{if(Ne.shaderID!==void 0)return;$e=!1}if($e){if(Ne.shaderID){var pt=xi[Ne.shaderID];ie.shader={name:_.type,uniforms:Er(pt.uniforms),vertexShader:pt.vertexShader,fragmentShader:pt.fragmentShader}}else ie.shader={name:_.type,uniforms:_.uniforms,vertexShader:_.vertexShader,fragmentShader:_.fragmentShader};_.onBeforeCompile(ie.shader,d),nt=te.getProgramCode(_,Ne),it=te.acquireProgram(_,ie.shader,Ne,nt),ie.program=it,_.program=it}var Ue=it.getAttributes();if(_.morphTargets){_.numSupportedMorphTargets=0;for(var Ae=0;Ae<d.maxMorphTargets;Ae++)Ue["morphTarget"+Ae]>=0&&_.numSupportedMorphTargets++}if(_.morphNormals){_.numSupportedMorphNormals=0;for(var Ae=0;Ae<d.maxMorphNormals;Ae++)Ue["morphNormal"+Ae]>=0&&_.numSupportedMorphNormals++}var Je=ie.shader.uniforms;(!_.isShaderMaterial&&!_.isRawShaderMaterial||_.clipping===!0)&&(ie.numClippingPlanes=k.numPlanes,ie.numIntersection=k.numIntersection,Je.clippingPlanes=k.uniform),ie.fog=R,de===void 0&&(ie.lightsHash=de={}),de.stateID=pe.stateID,de.directionalLength=pe.directionalLength,de.pointLength=pe.pointLength,de.spotLength=pe.spotLength,de.rectAreaLength=pe.rectAreaLength,de.hemiLength=pe.hemiLength,de.shadowsLength=pe.shadowsLength,_.lights&&(Je.ambientLightColor.value=fe.state.ambient,Je.lightProbe.value=fe.state.probe,Je.directionalLights.value=fe.state.directional,Je.spotLights.value=fe.state.spot,Je.rectAreaLights.value=fe.state.rectArea,Je.pointLights.value=fe.state.point,Je.hemisphereLights.value=fe.state.hemi,Je.directionalShadowMap.value=fe.state.directionalShadowMap,Je.directionalShadowMatrix.value=fe.state.directionalShadowMatrix,Je.spotShadowMap.value=fe.state.spotShadowMap,Je.spotShadowMatrix.value=fe.state.spotShadowMatrix,Je.pointShadowMap.value=fe.state.pointShadowMap,Je.pointShadowMatrix.value=fe.state.pointShadowMatrix);var Dt=ie.program.getUniforms(),$i=Ji.seqWithValue(Dt.seq,Je);ie.uniformsList=$i}function cr(_,R,F,ie){M.resetTextureUnits();var fe=I.get(F),Be=f.state.lights,de=fe.lightsHash,pe=Be.state.hash;if(G&&(q||_!==w)){var Ne=_===w&&F.id===b;k.setState(F.clippingPlanes,F.clipIntersection,F.clipShadows,_,fe,Ne)}F.needsUpdate===!1&&(fe.program===void 0||F.fog&&fe.fog!==R||F.lights&&(de.stateID!==pe.stateID||de.directionalLength!==pe.directionalLength||de.pointLength!==pe.pointLength||de.spotLength!==pe.spotLength||de.rectAreaLength!==pe.rectAreaLength||de.hemiLength!==pe.hemiLength||de.shadowsLength!==pe.shadowsLength)||fe.numClippingPlanes!==void 0&&(fe.numClippingPlanes!==k.numPlanes||fe.numIntersection!==k.numIntersection))&&(F.needsUpdate=!0),F.needsUpdate&&($t(F,R,ie),F.needsUpdate=!1);var nt=!1,it=!1,$e=!1,pt=fe.program,Ue=pt.getUniforms(),Ae=fe.shader.uniforms;if(Ee.useProgram(pt.program)&&(nt=!0,it=!0,$e=!0),F.id!==b&&(b=F.id,it=!0),nt||w!==_){if(Ue.setValue(V,"projectionMatrix",_.projectionMatrix),ve.logarithmicDepthBuffer&&Ue.setValue(V,"logDepthBufFC",2/(Math.log(_.far+1)/Math.LN2)),w!==_&&(w=_,it=!0,$e=!0),F.isShaderMaterial||F.isMeshPhongMaterial||F.isMeshStandardMaterial||F.envMap){var Je=Ue.map.cameraPosition;Je!==void 0&&Je.setValue(V,Q.setFromMatrixPosition(_.matrixWorld))}(F.isMeshPhongMaterial||F.isMeshLambertMaterial||F.isMeshBasicMaterial||F.isMeshStandardMaterial||F.isShaderMaterial||F.skinning)&&Ue.setValue(V,"viewMatrix",_.matrixWorldInverse)}if(F.skinning){Ue.setOptional(V,ie,"bindMatrix"),Ue.setOptional(V,ie,"bindMatrixInverse");var Dt=ie.skeleton;if(Dt){var $i=Dt.bones;if(ve.floatVertexTextures){if(Dt.boneTexture===void 0){var _t=Math.sqrt($i.length*4);_t=Te.ceilPowerOfTwo(_t),_t=Math.max(_t,4);var an=new Float32Array(_t*_t*4);an.set(Dt.boneMatrices);var cs=new Vn(an,_t,_t,Si,yr);cs.needsUpdate=!0,Dt.boneMatrices=an,Dt.boneTexture=cs,Dt.boneTextureSize=_t}Ue.setValue(V,"boneTexture",Dt.boneTexture,M),Ue.setValue(V,"boneTextureSize",Dt.boneTextureSize)}else Ue.setOptional(V,Dt,"boneMatrices")}}return it&&(Ue.setValue(V,"toneMappingExposure",d.toneMappingExposure),Ue.setValue(V,"toneMappingWhitePoint",d.toneMappingWhitePoint),F.lights&&Wf(Ae,$e),R&&F.fog&&ls(Ae,R),F.isMeshBasicMaterial?ui(Ae,F):F.isMeshLambertMaterial?(ui(Ae,F),Tn(Ae,F)):F.isMeshPhongMaterial?(ui(Ae,F),F.isMeshToonMaterial?Bf(Ae,F):ec(Ae,F)):F.isMeshStandardMaterial?(ui(Ae,F),F.isMeshPhysicalMaterial?Uf(Ae,F):tc(Ae,F)):F.isMeshMatcapMaterial?(ui(Ae,F),Gf(Ae,F)):F.isMeshDepthMaterial?(ui(Ae,F),Hf(Ae,F)):F.isMeshDistanceMaterial?(ui(Ae,F),Vf(Ae,F)):F.isMeshNormalMaterial?(ui(Ae,F),zf(Ae,F)):F.isLineBasicMaterial?(as(Ae,F),F.isLineDashedMaterial&&Ia(Ae,F)):F.isPointsMaterial?Ca(Ae,F):F.isSpriteMaterial?os(Ae,F):F.isShadowMaterial&&(Ae.color.value.copy(F.color),Ae.opacity.value=F.opacity),Ae.ltc_1!==void 0&&(Ae.ltc_1.value=ge.LTC_1),Ae.ltc_2!==void 0&&(Ae.ltc_2.value=ge.LTC_2),Ji.upload(V,fe.uniformsList,Ae,M)),F.isShaderMaterial&&F.uniformsNeedUpdate===!0&&(Ji.upload(V,fe.uniformsList,Ae,M),F.uniformsNeedUpdate=!1),F.isSpriteMaterial&&Ue.setValue(V,"center",ie.center),Ue.setValue(V,"modelViewMatrix",ie.modelViewMatrix),Ue.setValue(V,"normalMatrix",ie.normalMatrix),Ue.setValue(V,"modelMatrix",ie.matrixWorld),pt}function ui(_,R){_.opacity.value=R.opacity,R.color&&_.diffuse.value.copy(R.color),R.emissive&&_.emissive.value.copy(R.emissive).multiplyScalar(R.emissiveIntensity),R.map&&(_.map.value=R.map),R.alphaMap&&(_.alphaMap.value=R.alphaMap),R.specularMap&&(_.specularMap.value=R.specularMap),R.envMap&&(_.envMap.value=R.envMap,_.flipEnvMap.value=R.envMap.isCubeTexture?-1:1,_.reflectivity.value=R.reflectivity,_.refractionRatio.value=R.refractionRatio,_.maxMipLevel.value=I.get(R.envMap).__maxMipLevel),R.lightMap&&(_.lightMap.value=R.lightMap,_.lightMapIntensity.value=R.lightMapIntensity),R.aoMap&&(_.aoMap.value=R.aoMap,_.aoMapIntensity.value=R.aoMapIntensity);var F;R.map?F=R.map:R.specularMap?F=R.specularMap:R.displacementMap?F=R.displacementMap:R.normalMap?F=R.normalMap:R.bumpMap?F=R.bumpMap:R.roughnessMap?F=R.roughnessMap:R.metalnessMap?F=R.metalnessMap:R.alphaMap?F=R.alphaMap:R.emissiveMap&&(F=R.emissiveMap),F!==void 0&&(F.isWebGLRenderTarget&&(F=F.texture),F.matrixAutoUpdate===!0&&F.updateMatrix(),_.uvTransform.value.copy(F.matrix))}function as(_,R){_.diffuse.value.copy(R.color),_.opacity.value=R.opacity}function Ia(_,R){_.dashSize.value=R.dashSize,_.totalSize.value=R.dashSize+R.gapSize,_.scale.value=R.scale}function Ca(_,R){_.diffuse.value.copy(R.color),_.opacity.value=R.opacity,_.size.value=R.size*U,_.scale.value=C*.5,_.map.value=R.map,R.map!==null&&(R.map.matrixAutoUpdate===!0&&R.map.updateMatrix(),_.uvTransform.value.copy(R.map.matrix))}function os(_,R){_.diffuse.value.copy(R.color),_.opacity.value=R.opacity,_.rotation.value=R.rotation,_.map.value=R.map,R.map!==null&&(R.map.matrixAutoUpdate===!0&&R.map.updateMatrix(),_.uvTransform.value.copy(R.map.matrix))}function ls(_,R){_.fogColor.value.copy(R.color),R.isFog?(_.fogNear.value=R.near,_.fogFar.value=R.far):R.isFogExp2&&(_.fogDensity.value=R.density)}function Tn(_,R){R.emissiveMap&&(_.emissiveMap.value=R.emissiveMap)}function ec(_,R){_.specular.value.copy(R.specular),_.shininess.value=Math.max(R.shininess,1e-4),R.emissiveMap&&(_.emissiveMap.value=R.emissiveMap),R.bumpMap&&(_.bumpMap.value=R.bumpMap,_.bumpScale.value=R.bumpScale,R.side===xt&&(_.bumpScale.value*=-1)),R.normalMap&&(_.normalMap.value=R.normalMap,_.normalScale.value.copy(R.normalScale),R.side===xt&&_.normalScale.value.negate()),R.displacementMap&&(_.displacementMap.value=R.displacementMap,_.displacementScale.value=R.displacementScale,_.displacementBias.value=R.displacementBias)}function Bf(_,R){ec(_,R),R.gradientMap&&(_.gradientMap.value=R.gradientMap)}function tc(_,R){_.roughness.value=R.roughness,_.metalness.value=R.metalness,R.roughnessMap&&(_.roughnessMap.value=R.roughnessMap),R.metalnessMap&&(_.metalnessMap.value=R.metalnessMap),R.emissiveMap&&(_.emissiveMap.value=R.emissiveMap),R.bumpMap&&(_.bumpMap.value=R.bumpMap,_.bumpScale.value=R.bumpScale,R.side===xt&&(_.bumpScale.value*=-1)),R.normalMap&&(_.normalMap.value=R.normalMap,_.normalScale.value.copy(R.normalScale),R.side===xt&&_.normalScale.value.negate()),R.displacementMap&&(_.displacementMap.value=R.displacementMap,_.displacementScale.value=R.displacementScale,_.displacementBias.value=R.displacementBias),R.envMap&&(_.envMapIntensity.value=R.envMapIntensity)}function Uf(_,R){tc(_,R),_.reflectivity.value=R.reflectivity,_.clearCoat.value=R.clearCoat,_.clearCoatRoughness.value=R.clearCoatRoughness}function Gf(_,R){R.matcap&&(_.matcap.value=R.matcap),R.bumpMap&&(_.bumpMap.value=R.bumpMap,_.bumpScale.value=R.bumpScale,R.side===xt&&(_.bumpScale.value*=-1)),R.normalMap&&(_.normalMap.value=R.normalMap,_.normalScale.value.copy(R.normalScale),R.side===xt&&_.normalScale.value.negate()),R.displacementMap&&(_.displacementMap.value=R.displacementMap,_.displacementScale.value=R.displacementScale,_.displacementBias.value=R.displacementBias)}function Hf(_,R){R.displacementMap&&(_.displacementMap.value=R.displacementMap,_.displacementScale.value=R.displacementScale,_.displacementBias.value=R.displacementBias)}function Vf(_,R){R.displacementMap&&(_.displacementMap.value=R.displacementMap,_.displacementScale.value=R.displacementScale,_.displacementBias.value=R.displacementBias),_.referencePosition.value.copy(R.referencePosition),_.nearDistance.value=R.nearDistance,_.farDistance.value=R.farDistance}function zf(_,R){R.bumpMap&&(_.bumpMap.value=R.bumpMap,_.bumpScale.value=R.bumpScale,R.side===xt&&(_.bumpScale.value*=-1)),R.normalMap&&(_.normalMap.value=R.normalMap,_.normalScale.value.copy(R.normalScale),R.side===xt&&_.normalScale.value.negate()),R.displacementMap&&(_.displacementMap.value=R.displacementMap,_.displacementScale.value=R.displacementScale,_.displacementBias.value=R.displacementBias)}function Wf(_,R){_.ambientLightColor.needsUpdate=R,_.lightProbe.needsUpdate=R,_.directionalLights.needsUpdate=R,_.pointLights.needsUpdate=R,_.spotLights.needsUpdate=R,_.rectAreaLights.needsUpdate=R,_.hemisphereLights.needsUpdate=R}this.setFramebuffer=function(_){m!==_&&V.bindFramebuffer(36160,_),m=_},this.getActiveCubeFace=function(){return g},this.getActiveMipMapLevel=function(){return v},this.getRenderTarget=function(){return x},this.setRenderTarget=function(_,R,F){x=_,g=R,v=F,_&&I.get(_).__webglFramebuffer===void 0&&M.setupRenderTarget(_);var ie=m,fe=!1;if(_){var Be=I.get(_).__webglFramebuffer;_.isWebGLRenderTargetCube?(ie=Be[R||0],fe=!0):_.isWebGLMultisampleRenderTarget?ie=I.get(_).__webglMultisampledFramebuffer:ie=Be,D.copy(_.viewport),O.copy(_.scissor),P=_.scissorTest}else D.copy(j).multiplyScalar(U),O.copy(K).multiplyScalar(U),P=z;if(y!==ie&&(V.bindFramebuffer(36160,ie),y=ie),Ee.viewport(D),Ee.scissor(O),Ee.setScissorTest(P),fe){var de=I.get(_.texture);V.framebufferTexture2D(36160,36064,34069+(R||0),de.__webglTexture,F||0)}},this.readRenderTargetPixels=function(_,R,F,ie,fe,Be,de){if(!(_&&_.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}var pe=I.get(_).__webglFramebuffer;if(_.isWebGLRenderTargetCube&&de!==void 0&&(pe=pe[de]),pe){var Ne=!1;pe!==y&&(V.bindFramebuffer(36160,pe),Ne=!0);try{var nt=_.texture,it=nt.format,$e=nt.type;if(it!==Si&&Ce.convert(it)!==V.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if($e!==Ll&&Ce.convert($e)!==V.getParameter(35738)&&!($e===yr&&(ve.isWebGL2||ne.get("OES_texture_float")||ne.get("WEBGL_color_buffer_float")))&&!($e===Ml&&(ve.isWebGL2?ne.get("EXT_color_buffer_float"):ne.get("EXT_color_buffer_half_float")))){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}V.checkFramebufferStatus(36160)===36053?R>=0&&R<=_.width-ie&&F>=0&&F<=_.height-fe&&V.readPixels(R,F,ie,fe,Ce.convert(it),Ce.convert($e),Be):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{Ne&&V.bindFramebuffer(36160,y)}}},this.copyFramebufferToTexture=function(_,R,F){var ie=R.image.width,fe=R.image.height,Be=Ce.convert(R.format);M.setTexture2D(R,0),V.copyTexImage2D(3553,F||0,Be,_.x,_.y,ie,fe,0)},this.copyTextureToTexture=function(_,R,F,ie){var fe=R.image.width,Be=R.image.height,de=Ce.convert(F.format),pe=Ce.convert(F.type);M.setTexture2D(F,0),R.isDataTexture?V.texSubImage2D(3553,ie||0,_.x,_.y,fe,Be,de,pe,R.image.data):V.texSubImage2D(3553,ie||0,_.x,_.y,de,pe,R.image)}}function Ro(t,e){this.name="",this.color=new me(t),this.density=e!==void 0?e:25e-5}Object.assign(Ro.prototype,{isFogExp2:!0,clone:function(){return new Ro(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}});function Io(t,e,i){this.name="",this.color=new me(t),this.near=e!==void 0?e:1,this.far=i!==void 0?i:1e3}Object.assign(Io.prototype,{isFog:!0,clone:function(){return new Io(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}});function zn(){ce.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}zn.prototype=Object.assign(Object.create(ce.prototype),{constructor:zn,isScene:!0,copy:function(t,e){return ce.prototype.copy.call(this,t,e),t.background!==null&&(this.background=t.background.clone()),t.fog!==null&&(this.fog=t.fog.clone()),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var e=ce.prototype.toJSON.call(this,t);return this.background!==null&&(e.object.background=this.background.toJSON(t)),this.fog!==null&&(e.object.fog=this.fog.toJSON()),e},dispose:function(){this.dispatchEvent({type:"dispose"})}});function Wn(t,e){this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}Object.defineProperty(Wn.prototype,"needsUpdate",{set:function(t){t===!0&&this.version++}});Object.assign(Wn.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=t!==void 0?t.length/this.stride:0,this.array=t,this},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.dynamic=t.dynamic,this},copyAt:function(t,e,i){t*=this.stride,i*=e.stride;for(var n=0,r=this.stride;n<r;n++)this.array[t+n]=e.array[i+n];return this},set:function(t,e){return e===void 0&&(e=0),this.array.set(t,e),this},clone:function(){return new this.constructor().copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}});function Fs(t,e,i,n){this.data=t,this.itemSize=e,this.offset=i,this.normalized=n===!0}Object.defineProperties(Fs.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}});Object.assign(Fs.prototype,{isInterleavedBufferAttribute:!0,setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this},setXYZ:function(t,e,i,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this},setXYZW:function(t,e,i,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=r,this}});function nn(t){Pe.call(this),this.type="SpriteMaterial",this.color=new me(16777215),this.map=null,this.rotation=0,this.sizeAttenuation=!0,this.lights=!1,this.transparent=!0,this.setValues(t)}nn.prototype=Object.create(Pe.prototype);nn.prototype.constructor=nn;nn.prototype.isSpriteMaterial=!0;nn.prototype.copy=function(t){return Pe.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};var wn;function vn(t){if(ce.call(this),this.type="Sprite",wn===void 0){wn=new he;var e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new Wn(e,5);wn.setIndex([0,1,2,0,2,3]),wn.addAttribute("position",new Fs(i,3,0,!1)),wn.addAttribute("uv",new Fs(i,2,3,!1))}this.geometry=wn,this.material=t!==void 0?t:new nn,this.center=new X(.5,.5)}vn.prototype=Object.assign(Object.create(ce.prototype),{constructor:vn,isSprite:!0,raycast:function(){var t=new S,e=new S,i=new S,n=new X,r=new X,s=new we,a=new S,o=new S,l=new S,c=new X,h=new X,u=new X;function f(d,p,m,g,v,x){n.subVectors(d,m).addScalar(.5).multiply(g),v!==void 0?(r.x=x*n.x-v*n.y,r.y=v*n.x+x*n.y):r.copy(n),d.copy(p),d.x+=r.x,d.y+=r.y,d.applyMatrix4(s)}return function(p,m){e.setFromMatrixScale(this.matrixWorld),s.getInverse(this.modelViewMatrix).premultiply(this.matrixWorld),i.setFromMatrixPosition(this.modelViewMatrix);var g=this.material.rotation,v,x;g!==0&&(x=Math.cos(g),v=Math.sin(g));var y=this.center;f(a.set(-.5,-.5,0),i,y,e,v,x),f(o.set(.5,-.5,0),i,y,e,v,x),f(l.set(.5,.5,0),i,y,e,v,x),c.set(0,0),h.set(1,0),u.set(1,1);var b=p.ray.intersectTriangle(a,o,l,!1,t);if(!(b===null&&(f(o.set(-.5,.5,0),i,y,e,v,x),h.set(0,1),b=p.ray.intersectTriangle(a,l,o,!1,t),b===null))){var E=p.ray.origin.distanceTo(t);E<p.near||E>p.far||m.push({distance:E,point:t.clone(),uv:Ft.getUV(t,a,o,l,c,h,u,new X),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(t){return ce.prototype.copy.call(this,t),t.center!==void 0&&this.center.copy(t.center),this}});function ks(){ce.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}ks.prototype=Object.assign(Object.create(ce.prototype),{constructor:ks,isLOD:!0,copy:function(t){ce.prototype.copy.call(this,t,!1);for(var e=t.levels,i=0,n=e.length;i<n;i++){var r=e[i];this.addLevel(r.object.clone(),r.distance)}return this},addLevel:function(t,e){e===void 0&&(e=0),e=Math.abs(e);for(var i=this.levels,n=0;n<i.length&&!(e<i[n].distance);n++);return i.splice(n,0,{distance:e,object:t}),this.add(t),this},getObjectForDistance:function(t){for(var e=this.levels,i=1,n=e.length;i<n&&!(t<e[i].distance);i++);return e[i-1].object},raycast:function(){var t=new S;return function(i,n){t.setFromMatrixPosition(this.matrixWorld);var r=i.ray.origin.distanceTo(t);this.getObjectForDistance(r).raycast(i,n)}}(),update:function(){var t=new S,e=new S;return function(n){var r=this.levels;if(r.length>1){t.setFromMatrixPosition(n.matrixWorld),e.setFromMatrixPosition(this.matrixWorld);var s=t.distanceTo(e);r[0].object.visible=!0;for(var a=1,o=r.length;a<o&&s>=r[a].distance;a++)r[a-1].object.visible=!1,r[a].object.visible=!0;for(;a<o;a++)r[a].object.visible=!1}}}(),toJSON:function(t){var e=ce.prototype.toJSON.call(this,t);e.object.levels=[];for(var i=this.levels,n=0,r=i.length;n<r;n++){var s=i[n];e.object.levels.push({object:s.object.uuid,distance:s.distance})}return e}});function Ns(t,e){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Et.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new we,this.bindMatrixInverse=new we}Ns.prototype=Object.assign(Object.create(Et.prototype),{constructor:Ns,isSkinnedMesh:!0,bind:function(t,e){this.skeleton=t,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var t=new et,e=this.geometry.attributes.skinWeight,i=0,n=e.count;i<n;i++){t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.w=e.getW(i);var r=1/t.manhattanLength();r!==1/0?t.multiplyScalar(r):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){Et.prototype.updateMatrixWorld.call(this,t),this.bindMode==="attached"?this.bindMatrixInverse.getInverse(this.matrixWorld):this.bindMode==="detached"?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});function Co(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(this.bones.length*16),e===void 0)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var i=0,n=this.bones.length;i<n;i++)this.boneInverses.push(new we)}}Object.assign(Co.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var i=new we;this.bones[t]&&i.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(i)}},pose:function(){var t,e,i;for(e=0,i=this.bones.length;e<i;e++)t=this.bones[e],t&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,i=this.bones.length;e<i;e++)t=this.bones[e],t&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){var t=new we,e=new we;return function(){for(var n=this.bones,r=this.boneInverses,s=this.boneMatrices,a=this.boneTexture,o=0,l=n.length;o<l;o++){var c=n[o]?n[o].matrixWorld:e;t.multiplyMatrices(c,r[o]),t.toArray(s,o*16)}a!==void 0&&(a.needsUpdate=!0)}}(),clone:function(){return new Co(this.bones,this.boneInverses)},getBoneByName:function(t){for(var e=0,i=this.bones.length;e<i;e++){var n=this.bones[e];if(n.name===t)return n}}});function Sc(){ce.call(this),this.type="Bone"}Sc.prototype=Object.assign(Object.create(ce.prototype),{constructor:Sc,isBone:!0});function st(t){Pe.call(this),this.type="LineBasicMaterial",this.color=new me(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(t)}st.prototype=Object.create(Pe.prototype);st.prototype.constructor=st;st.prototype.isLineBasicMaterial=!0;st.prototype.copy=function(t){return Pe.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this};function kt(t,e,i){i===1&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),ce.call(this),this.type="Line",this.geometry=t!==void 0?t:new he,this.material=e!==void 0?e:new st({color:Math.random()*16777215})}kt.prototype=Object.assign(Object.create(ce.prototype),{constructor:kt,isLine:!0,computeLineDistances:function(){var t=new S,e=new S;return function(){var n=this.geometry;if(n.isBufferGeometry)if(n.index===null){for(var r=n.attributes.position,s=[0],a=1,o=r.count;a<o;a++)t.fromBufferAttribute(r,a-1),e.fromBufferAttribute(r,a),s[a]=s[a-1],s[a]+=t.distanceTo(e);n.addAttribute("lineDistance",new le(s,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(n.isGeometry){var l=n.vertices,s=n.lineDistances;s[0]=0;for(var a=1,o=l.length;a<o;a++)s[a]=s[a-1],s[a]+=l[a-1].distanceTo(l[a])}return this}}(),raycast:function(){var t=new we,e=new ar,i=new Ui;return function(r,s){var a=r.linePrecision,o=this.geometry,l=this.matrixWorld;if(o.boundingSphere===null&&o.computeBoundingSphere(),i.copy(o.boundingSphere),i.applyMatrix4(l),i.radius+=a,r.ray.intersectsSphere(i)!==!1){t.getInverse(l),e.copy(r.ray).applyMatrix4(t);var c=a/((this.scale.x+this.scale.y+this.scale.z)/3),h=c*c,u=new S,f=new S,d=new S,p=new S,m=this&&this.isLineSegments?2:1;if(o.isBufferGeometry){var g=o.index,v=o.attributes,x=v.position.array;if(g!==null)for(var y=g.array,b=0,E=y.length-1;b<E;b+=m){var w=y[b],A=y[b+1];u.fromArray(x,w*3),f.fromArray(x,A*3);var D=e.distanceSqToSegment(u,f,p,d);if(!(D>h)){p.applyMatrix4(this.matrixWorld);var O=r.ray.origin.distanceTo(p);O<r.near||O>r.far||s.push({distance:O,point:d.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}else for(var b=0,E=x.length/3-1;b<E;b+=m){u.fromArray(x,3*b),f.fromArray(x,3*b+3);var D=e.distanceSqToSegment(u,f,p,d);if(!(D>h)){p.applyMatrix4(this.matrixWorld);var O=r.ray.origin.distanceTo(p);O<r.near||O>r.far||s.push({distance:O,point:d.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}}else if(o.isGeometry)for(var P=o.vertices,L=P.length,b=0;b<L-1;b+=m){var D=e.distanceSqToSegment(P[b],P[b+1],p,d);if(!(D>h)){p.applyMatrix4(this.matrixWorld);var O=r.ray.origin.distanceTo(p);O<r.near||O>r.far||s.push({distance:O,point:d.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});function ut(t,e){kt.call(this,t,e),this.type="LineSegments"}ut.prototype=Object.assign(Object.create(kt.prototype),{constructor:ut,isLineSegments:!0,computeLineDistances:function(){var t=new S,e=new S;return function(){var n=this.geometry;if(n.isBufferGeometry)if(n.index===null){for(var r=n.attributes.position,s=[],a=0,o=r.count;a<o;a+=2)t.fromBufferAttribute(r,a),e.fromBufferAttribute(r,a+1),s[a]=a===0?0:s[a-1],s[a+1]=s[a]+t.distanceTo(e);n.addAttribute("lineDistance",new le(s,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(n.isGeometry)for(var l=n.vertices,s=n.lineDistances,a=0,o=l.length;a<o;a+=2)t.copy(l[a]),e.copy(l[a+1]),s[a]=a===0?0:s[a-1],s[a+1]=s[a]+t.distanceTo(e);return this}}()});function Do(t,e){kt.call(this,t,e),this.type="LineLoop"}Do.prototype=Object.assign(Object.create(kt.prototype),{constructor:Do,isLineLoop:!0});function yn(t){Pe.call(this),this.type="PointsMaterial",this.color=new me(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.lights=!1,this.setValues(t)}yn.prototype=Object.create(Pe.prototype);yn.prototype.constructor=yn;yn.prototype.isPointsMaterial=!0;yn.prototype.copy=function(t){return Pe.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this};function Po(t,e){ce.call(this),this.type="Points",this.geometry=t!==void 0?t:new he,this.material=e!==void 0?e:new yn({color:Math.random()*16777215})}Po.prototype=Object.assign(Object.create(ce.prototype),{constructor:Po,isPoints:!0,raycast:function(){var t=new we,e=new ar,i=new Ui;return function(r,s){var a=this,o=this.geometry,l=this.matrixWorld,c=r.params.Points.threshold;if(o.boundingSphere===null&&o.computeBoundingSphere(),i.copy(o.boundingSphere),i.applyMatrix4(l),i.radius+=c,r.ray.intersectsSphere(i)===!1)return;t.getInverse(l),e.copy(r.ray).applyMatrix4(t);var h=c/((this.scale.x+this.scale.y+this.scale.z)/3),u=h*h,f=new S,d=new S;function p(D,O){var P=e.distanceSqToPoint(D);if(P<u){e.closestPointToPoint(D,d),d.applyMatrix4(l);var L=r.ray.origin.distanceTo(d);if(L<r.near||L>r.far)return;s.push({distance:L,distanceToRay:Math.sqrt(P),point:d.clone(),index:O,face:null,object:a})}}if(o.isBufferGeometry){var m=o.index,g=o.attributes,v=g.position.array;if(m!==null)for(var x=m.array,y=0,b=x.length;y<b;y++){var E=x[y];f.fromArray(v,E*3),p(f,E)}else for(var y=0,w=v.length/3;y<w;y++)f.fromArray(v,y*3),p(f,y)}else for(var A=o.vertices,y=0,w=A.length;y<w;y++)p(A[y],y)}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});function Bs(t,e,i,n,r,s,a,o,l){Ye.call(this,t,e,i,n,r,s,a,o,l),this.format=a!==void 0?a:Ai,this.minFilter=s!==void 0?s:ht,this.magFilter=r!==void 0?r:ht,this.generateMipmaps=!1}Bs.prototype=Object.assign(Object.create(Ye.prototype),{constructor:Bs,isVideoTexture:!0,update:function(){var t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}});function Sr(t,e,i,n,r,s,a,o,l,c,h,u){Ye.call(this,null,s,a,o,l,c,n,r,h,u),this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}Sr.prototype=Object.create(Ye.prototype);Sr.prototype.constructor=Sr;Sr.prototype.isCompressedTexture=!0;function Lr(t,e,i,n,r,s,a,o,l){Ye.call(this,t,e,i,n,r,s,a,o,l),this.needsUpdate=!0}Lr.prototype=Object.create(Ye.prototype);Lr.prototype.constructor=Lr;Lr.prototype.isCanvasTexture=!0;function Us(t,e,i,n,r,s,a,o,l,c){if(c=c!==void 0?c:kn,c!==kn&&c!==xr)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&c===kn&&(i=Ss),i===void 0&&c===xr&&(i=Ls),Ye.call(this,null,n,r,s,a,o,c,i,l),this.image={width:t,height:e},this.magFilter=a!==void 0?a:Mt,this.minFilter=o!==void 0?o:Mt,this.flipY=!1,this.generateMipmaps=!1}Us.prototype=Object.create(Ye.prototype);Us.prototype.constructor=Us;Us.prototype.isDepthTexture=!0;function Gs(t){he.call(this),this.type="WireframeGeometry";var e=[],i,n,r,s,a,o=[0,0],l={},c,h,u,f,d=["a","b","c"],p;if(t&&t.isGeometry){var m=t.faces;for(i=0,r=m.length;i<r;i++){var g=m[i];for(n=0;n<3;n++)h=g[d[n]],u=g[d[(n+1)%3]],o[0]=Math.min(h,u),o[1]=Math.max(h,u),f=o[0]+","+o[1],l[f]===void 0&&(l[f]={index1:o[0],index2:o[1]})}for(f in l)c=l[f],p=t.vertices[c.index1],e.push(p.x,p.y,p.z),p=t.vertices[c.index2],e.push(p.x,p.y,p.z)}else if(t&&t.isBufferGeometry){var v,x,y,b,E,w,A,D;if(p=new S,t.index!==null){for(v=t.attributes.position,x=t.index,y=t.groups,y.length===0&&(y=[{start:0,count:x.count,materialIndex:0}]),s=0,a=y.length;s<a;++s)for(b=y[s],E=b.start,w=b.count,i=E,r=E+w;i<r;i+=3)for(n=0;n<3;n++)h=x.getX(i+n),u=x.getX(i+(n+1)%3),o[0]=Math.min(h,u),o[1]=Math.max(h,u),f=o[0]+","+o[1],l[f]===void 0&&(l[f]={index1:o[0],index2:o[1]});for(f in l)c=l[f],p.fromBufferAttribute(v,c.index1),e.push(p.x,p.y,p.z),p.fromBufferAttribute(v,c.index2),e.push(p.x,p.y,p.z)}else for(v=t.attributes.position,i=0,r=v.count/3;i<r;i++)for(n=0;n<3;n++)A=3*i+n,p.fromBufferAttribute(v,A),e.push(p.x,p.y,p.z),D=3*i+(n+1)%3,p.fromBufferAttribute(v,D),e.push(p.x,p.y,p.z)}this.addAttribute("position",new le(e,3))}Gs.prototype=Object.create(he.prototype);Gs.prototype.constructor=Gs;function Hs(t,e,i){Ie.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:i},this.fromBufferGeometry(new Mr(t,e,i)),this.mergeVertices()}Hs.prototype=Object.create(Ie.prototype);Hs.prototype.constructor=Hs;function Mr(t,e,i){he.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:i};var n=[],r=[],s=[],a=[],o=1e-5,l=new S,c=new S,h=new S,u=new S,f=new S,d,p;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var m=e+1;for(d=0;d<=i;d++){var g=d/i;for(p=0;p<=e;p++){var v=p/e;t(v,g,c),r.push(c.x,c.y,c.z),v-o>=0?(t(v-o,g,h),u.subVectors(c,h)):(t(v+o,g,h),u.subVectors(h,c)),g-o>=0?(t(v,g-o,h),f.subVectors(c,h)):(t(v,g+o,h),f.subVectors(h,c)),l.crossVectors(u,f).normalize(),s.push(l.x,l.y,l.z),a.push(v,g)}}for(d=0;d<i;d++)for(p=0;p<e;p++){var x=d*m+p,y=d*m+p+1,b=(d+1)*m+p+1,E=(d+1)*m+p;n.push(x,y,E),n.push(y,b,E)}this.setIndex(n),this.addAttribute("position",new le(r,3)),this.addAttribute("normal",new le(s,3)),this.addAttribute("uv",new le(a,2))}Mr.prototype=Object.create(he.prototype);Mr.prototype.constructor=Mr;function Vs(t,e,i,n){Ie.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:n},this.fromBufferGeometry(new ti(t,e,i,n)),this.mergeVertices()}Vs.prototype=Object.create(Ie.prototype);Vs.prototype.constructor=Vs;function ti(t,e,i,n){he.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:n},i=i||1,n=n||0;var r=[],s=[];a(n),l(i),c(),this.addAttribute("position",new le(r,3)),this.addAttribute("normal",new le(r.slice(),3)),this.addAttribute("uv",new le(s,2)),n===0?this.computeVertexNormals():this.normalizeNormals();function a(v){for(var x=new S,y=new S,b=new S,E=0;E<e.length;E+=3)f(e[E+0],x),f(e[E+1],y),f(e[E+2],b),o(x,y,b,v)}function o(v,x,y,b){var E=Math.pow(2,b),w=[],A,D;for(A=0;A<=E;A++){w[A]=[];var O=v.clone().lerp(y,A/E),P=x.clone().lerp(y,A/E),L=E-A;for(D=0;D<=L;D++)D===0&&A===E?w[A][D]=O:w[A][D]=O.clone().lerp(P,D/L)}for(A=0;A<E;A++)for(D=0;D<2*(E-A)-1;D++){var C=Math.floor(D/2);D%2===0?(u(w[A][C+1]),u(w[A+1][C]),u(w[A][C])):(u(w[A][C+1]),u(w[A+1][C+1]),u(w[A+1][C]))}}function l(v){for(var x=new S,y=0;y<r.length;y+=3)x.x=r[y+0],x.y=r[y+1],x.z=r[y+2],x.normalize().multiplyScalar(v),r[y+0]=x.x,r[y+1]=x.y,r[y+2]=x.z}function c(){for(var v=new S,x=0;x<r.length;x+=3){v.x=r[x+0],v.y=r[x+1],v.z=r[x+2];var y=m(v)/2/Math.PI+.5,b=g(v)/Math.PI+.5;s.push(y,1-b)}d(),h()}function h(){for(var v=0;v<s.length;v+=6){var x=s[v+0],y=s[v+2],b=s[v+4],E=Math.max(x,y,b),w=Math.min(x,y,b);E>.9&&w<.1&&(x<.2&&(s[v+0]+=1),y<.2&&(s[v+2]+=1),b<.2&&(s[v+4]+=1))}}function u(v){r.push(v.x,v.y,v.z)}function f(v,x){var y=v*3;x.x=t[y+0],x.y=t[y+1],x.z=t[y+2]}function d(){for(var v=new S,x=new S,y=new S,b=new S,E=new X,w=new X,A=new X,D=0,O=0;D<r.length;D+=9,O+=6){v.set(r[D+0],r[D+1],r[D+2]),x.set(r[D+3],r[D+4],r[D+5]),y.set(r[D+6],r[D+7],r[D+8]),E.set(s[O+0],s[O+1]),w.set(s[O+2],s[O+3]),A.set(s[O+4],s[O+5]),b.copy(v).add(x).add(y).divideScalar(3);var P=m(b);p(E,O+0,v,P),p(w,O+2,x,P),p(A,O+4,y,P)}}function p(v,x,y,b){b<0&&v.x===1&&(s[x]=v.x-1),y.x===0&&y.z===0&&(s[x]=b/2/Math.PI+.5)}function m(v){return Math.atan2(v.z,-v.x)}function g(v){return Math.atan2(-v.y,Math.sqrt(v.x*v.x+v.z*v.z))}}ti.prototype=Object.create(he.prototype);ti.prototype.constructor=ti;function zs(t,e){Ie.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Rr(t,e)),this.mergeVertices()}zs.prototype=Object.create(Ie.prototype);zs.prototype.constructor=zs;function Rr(t,e){var i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],n=[2,1,0,0,3,2,1,3,0,2,3,1];ti.call(this,i,n,t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}Rr.prototype=Object.create(ti.prototype);Rr.prototype.constructor=Rr;function Ws(t,e){Ie.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new jn(t,e)),this.mergeVertices()}Ws.prototype=Object.create(Ie.prototype);Ws.prototype.constructor=Ws;function jn(t,e){var i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];ti.call(this,i,n,t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}jn.prototype=Object.create(ti.prototype);jn.prototype.constructor=jn;function js(t,e){Ie.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Ir(t,e)),this.mergeVertices()}js.prototype=Object.create(Ie.prototype);js.prototype.constructor=js;function Ir(t,e){var i=(1+Math.sqrt(5))/2,n=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];ti.call(this,n,r,t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}Ir.prototype=Object.create(ti.prototype);Ir.prototype.constructor=Ir;function $s(t,e){Ie.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Cr(t,e)),this.mergeVertices()}$s.prototype=Object.create(Ie.prototype);$s.prototype.constructor=$s;function Cr(t,e){var i=(1+Math.sqrt(5))/2,n=1/i,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];ti.call(this,r,s,t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}Cr.prototype=Object.create(ti.prototype);Cr.prototype.constructor=Cr;function Ys(t,e,i,n,r,s){Ie.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:n,closed:r},s!==void 0&&console.warn("THREE.TubeGeometry: taper has been removed.");var a=new $n(t,e,i,n,r);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}Ys.prototype=Object.create(Ie.prototype);Ys.prototype.constructor=Ys;function $n(t,e,i,n,r){he.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:n,closed:r},e=e||64,i=i||1,n=n||8,r=r||!1;var s=t.computeFrenetFrames(e,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;var a=new S,o=new S,l=new X,c=new S,h,u,f=[],d=[],p=[],m=[];g(),this.setIndex(m),this.addAttribute("position",new le(f,3)),this.addAttribute("normal",new le(d,3)),this.addAttribute("uv",new le(p,2));function g(){for(h=0;h<e;h++)v(h);v(r===!1?e:0),y(),x()}function v(b){c=t.getPointAt(b/e,c);var E=s.normals[b],w=s.binormals[b];for(u=0;u<=n;u++){var A=u/n*Math.PI*2,D=Math.sin(A),O=-Math.cos(A);o.x=O*E.x+D*w.x,o.y=O*E.y+D*w.y,o.z=O*E.z+D*w.z,o.normalize(),d.push(o.x,o.y,o.z),a.x=c.x+i*o.x,a.y=c.y+i*o.y,a.z=c.z+i*o.z,f.push(a.x,a.y,a.z)}}function x(){for(u=1;u<=e;u++)for(h=1;h<=n;h++){var b=(n+1)*(u-1)+(h-1),E=(n+1)*u+(h-1),w=(n+1)*u+h,A=(n+1)*(u-1)+h;m.push(b,E,A),m.push(E,w,A)}}function y(){for(h=0;h<=e;h++)for(u=0;u<=n;u++)l.x=h/e,l.y=u/n,p.push(l.x,l.y)}}$n.prototype=Object.create(he.prototype);$n.prototype.constructor=$n;$n.prototype.toJSON=function(){var t=he.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t};function Ks(t,e,i,n,r,s,a){Ie.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:n,p:r,q:s},a!==void 0&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Dr(t,e,i,n,r,s)),this.mergeVertices()}Ks.prototype=Object.create(Ie.prototype);Ks.prototype.constructor=Ks;function Dr(t,e,i,n,r,s){he.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:n,p:r,q:s},t=t||1,e=e||.4,i=Math.floor(i)||64,n=Math.floor(n)||8,r=r||2,s=s||3;var a=[],o=[],l=[],c=[],h,u,f=new S,d=new S,p=new S,m=new S,g=new S,v=new S,x=new S;for(h=0;h<=i;++h){var y=h/i*r*Math.PI*2;for(L(y,r,s,t,p),L(y+.01,r,s,t,m),v.subVectors(m,p),x.addVectors(m,p),g.crossVectors(v,x),x.crossVectors(g,v),g.normalize(),x.normalize(),u=0;u<=n;++u){var b=u/n*Math.PI*2,E=-e*Math.cos(b),w=e*Math.sin(b);f.x=p.x+(E*x.x+w*g.x),f.y=p.y+(E*x.y+w*g.y),f.z=p.z+(E*x.z+w*g.z),o.push(f.x,f.y,f.z),d.subVectors(f,p).normalize(),l.push(d.x,d.y,d.z),c.push(h/i),c.push(u/n)}}for(u=1;u<=i;u++)for(h=1;h<=n;h++){var A=(n+1)*(u-1)+(h-1),D=(n+1)*u+(h-1),O=(n+1)*u+h,P=(n+1)*(u-1)+h;a.push(A,D,P),a.push(D,O,P)}this.setIndex(a),this.addAttribute("position",new le(o,3)),this.addAttribute("normal",new le(l,3)),this.addAttribute("uv",new le(c,2));function L(C,U,j,K,z){var $=Math.cos(C),k=Math.sin(C),G=j/U*C,q=Math.cos(G);z.x=K*(2+q)*.5*$,z.y=K*(2+q)*k*.5,z.z=K*Math.sin(G)*.5}}Dr.prototype=Object.create(he.prototype);Dr.prototype.constructor=Dr;function Xs(t,e,i,n,r){Ie.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:r},this.fromBufferGeometry(new Pr(t,e,i,n,r)),this.mergeVertices()}Xs.prototype=Object.create(Ie.prototype);Xs.prototype.constructor=Xs;function Pr(t,e,i,n,r){he.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:r},t=t||1,e=e||.4,i=Math.floor(i)||8,n=Math.floor(n)||6,r=r||Math.PI*2;var s=[],a=[],o=[],l=[],c=new S,h=new S,u=new S,f,d;for(f=0;f<=i;f++)for(d=0;d<=n;d++){var p=d/n*r,m=f/i*Math.PI*2;h.x=(t+e*Math.cos(m))*Math.cos(p),h.y=(t+e*Math.cos(m))*Math.sin(p),h.z=e*Math.sin(m),a.push(h.x,h.y,h.z),c.x=t*Math.cos(p),c.y=t*Math.sin(p),u.subVectors(h,c).normalize(),o.push(u.x,u.y,u.z),l.push(d/n),l.push(f/i)}for(f=1;f<=i;f++)for(d=1;d<=n;d++){var g=(n+1)*f+d-1,v=(n+1)*(f-1)+d-1,x=(n+1)*(f-1)+d,y=(n+1)*f+d;s.push(g,v,y),s.push(v,x,y)}this.setIndex(s),this.addAttribute("position",new le(a,3)),this.addAttribute("normal",new le(o,3)),this.addAttribute("uv",new le(l,2))}Pr.prototype=Object.create(he.prototype);Pr.prototype.constructor=Pr;var Bv={triangulate:function(t,e,i){i=i||2;var n=e&&e.length,r=n?e[0]*i:t.length,s=du(t,0,r,i,!0),a=[];if(!s)return a;var o,l,c,h,u,f,d;if(n&&(s=zv(t,e,s,i)),t.length>80*i){o=c=t[0],l=h=t[1];for(var p=i;p<r;p+=i)u=t[p],f=t[p+1],u<o&&(o=u),f<l&&(l=f),u>c&&(c=u),f>h&&(h=f);d=Math.max(c-o,h-l),d=d!==0?1/d:0}return Fr(s,a,i,o,l,d),a}};function du(t,e,i,n,r){var s,a;if(r===Qv(t,e,i,n)>0)for(s=e;s<i;s+=n)a=Lc(s,t[s],t[s+1],a);else for(s=i-n;s>=e;s-=n)a=Lc(s,t[s],t[s+1],a);return a&&hn(a,a.next)&&(Nr(a),a=a.next),a}function Or(t,e){if(!t)return t;e||(e=t);var i=t,n;do if(n=!1,!i.steiner&&(hn(i,i.next)||Ut(i.prev,i,i.next)===0)){if(Nr(i),i=e=i.prev,i===i.next)break;n=!0}else i=i.next;while(n||i!==e);return e}function Fr(t,e,i,n,r,s,a){if(t){!a&&s&&Yv(t,n,r,s);for(var o=t,l,c;t.prev!==t.next;){if(l=t.prev,c=t.next,s?Gv(t,n,r,s):Uv(t)){e.push(l.i/i),e.push(t.i/i),e.push(c.i/i),Nr(t),t=c.next,o=c.next;continue}if(t=c,t===o){a?a===1?(t=Hv(t,e,i),Fr(t,e,i,n,r,s,2)):a===2&&Vv(t,e,i,n,r,s):Fr(Or(t),e,i,n,r,s,1);break}}}}function Uv(t){var e=t.prev,i=t,n=t.next;if(Ut(e,i,n)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(qs(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&Ut(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function Gv(t,e,i,n){var r=t.prev,s=t,a=t.next;if(Ut(r,s,a)>=0)return!1;for(var o=r.x<s.x?r.x<a.x?r.x:a.x:s.x<a.x?s.x:a.x,l=r.y<s.y?r.y<a.y?r.y:a.y:s.y<a.y?s.y:a.y,c=r.x>s.x?r.x>a.x?r.x:a.x:s.x>a.x?s.x:a.x,h=r.y>s.y?r.y>a.y?r.y:a.y:s.y>a.y?s.y:a.y,u=Oo(o,l,e,i,n),f=Oo(c,h,e,i,n),d=t.nextZ;d&&d.z<=f;){if(d!==t.prev&&d!==t.next&&qs(r.x,r.y,s.x,s.y,a.x,a.y,d.x,d.y)&&Ut(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(d=t.prevZ;d&&d.z>=u;){if(d!==t.prev&&d!==t.next&&qs(r.x,r.y,s.x,s.y,a.x,a.y,d.x,d.y)&&Ut(d.prev,d,d.next)>=0)return!1;d=d.prevZ}return!0}function Hv(t,e,i){var n=t;do{var r=n.prev,s=n.next.next;!hn(r,s)&&pu(r,n,n.next,s)&&kr(r,s)&&kr(s,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(s.i/i),Nr(n),Nr(n.next),n=t=s),n=n.next}while(n!==t);return n}function Vv(t,e,i,n,r,s){var a=t;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&qv(a,o)){var l=mu(a,o);a=Or(a,a.next),l=Or(l,l.next),Fr(a,e,i,n,r,s),Fr(l,e,i,n,r,s);return}o=o.next}a=a.next}while(a!==t)}function zv(t,e,i,n){var r=[],s,a,o,l,c;for(s=0,a=e.length;s<a;s++)o=e[s]*n,l=s<a-1?e[s+1]*n:t.length,c=du(t,o,l,n,!1),c===c.next&&(c.steiner=!0),r.push(Xv(c));for(r.sort(Wv),s=0;s<r.length;s++)jv(r[s],i),i=Or(i,i.next);return i}function Wv(t,e){return t.x-e.x}function jv(t,e){if(e=$v(t,e),e){var i=mu(e,t);Or(i,i.next)}}function $v(t,e){var i=e,n=t.x,r=t.y,s=-1/0,a;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){var o=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=n&&o>s){if(s=o,o===n){if(r===i.y)return i;if(r===i.next.y)return i.next}a=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!a)return null;if(n===s)return a.prev;var l=a,c=a.x,h=a.y,u=1/0,f;for(i=a.next;i!==l;)n>=i.x&&i.x>=c&&n!==i.x&&qs(r<h?n:s,r,c,h,r<h?s:n,r,i.x,i.y)&&(f=Math.abs(r-i.y)/(n-i.x),(f<u||f===u&&i.x>a.x)&&kr(i,t)&&(a=i,u=f)),i=i.next;return a}function Yv(t,e,i,n){var r=t;do r.z===null&&(r.z=Oo(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,Kv(r)}function Kv(t){var e,i,n,r,s,a,o,l,c=1;do{for(i=t,t=null,s=null,a=0;i;){for(a++,n=i,o=0,e=0;e<c&&(o++,n=n.nextZ,!!n);e++);for(l=c;o>0||l>0&&n;)o!==0&&(l===0||!n||i.z<=n.z)?(r=i,i=i.nextZ,o--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,c*=2}while(a>1);return t}function Oo(t,e,i,n,r){return t=32767*(t-i)*r,e=32767*(e-n)*r,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function Xv(t){var e=t,i=t;do e.x<i.x&&(i=e),e=e.next;while(e!==t);return i}function qs(t,e,i,n,r,s,a,o){return(r-a)*(e-o)-(t-a)*(s-o)>=0&&(t-a)*(n-o)-(i-a)*(e-o)>=0&&(i-a)*(s-o)-(r-a)*(n-o)>=0}function qv(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!Zv(t,e)&&kr(t,e)&&kr(e,t)&&Jv(t,e)}function Ut(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function hn(t,e){return t.x===e.x&&t.y===e.y}function pu(t,e,i,n){return hn(t,e)&&hn(i,n)||hn(t,n)&&hn(i,e)?!0:Ut(t,e,i)>0!=Ut(t,e,n)>0&&Ut(i,n,t)>0!=Ut(i,n,e)>0}function Zv(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&pu(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function kr(t,e){return Ut(t.prev,t,t.next)<0?Ut(t,e,t.next)>=0&&Ut(t,t.prev,e)>=0:Ut(t,e,t.prev)<0||Ut(t,t.next,e)<0}function Jv(t,e){var i=t,n=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;while(i!==t);return n}function mu(t,e){var i=new Fo(t.i,t.x,t.y),n=new Fo(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function Lc(t,e,i,n){var r=new Fo(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function Nr(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Fo(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Qv(t,e,i,n){for(var r=0,s=e,a=i-n;s<i;s+=n)r+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return r}var Qi={area:function(t){for(var e=t.length,i=0,n=e-1,r=0;r<e;n=r++)i+=t[n].x*t[r].y-t[r].x*t[n].y;return i*.5},isClockWise:function(t){return Qi.area(t)<0},triangulateShape:function(t,e){var i=[],n=[],r=[];Mc(t),Rc(i,t);var s=t.length;e.forEach(Mc);for(var a=0;a<e.length;a++)n.push(s),s+=e[a].length,Rc(i,e[a]);for(var o=Bv.triangulate(i,n),a=0;a<o.length;a+=3)r.push(o.slice(a,a+3));return r}};function Mc(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function Rc(t,e){for(var i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}function Yn(t,e){Ie.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new Hi(t,e)),this.mergeVertices()}Yn.prototype=Object.create(Ie.prototype);Yn.prototype.constructor=Yn;Yn.prototype.toJSON=function(){var t=Ie.prototype.toJSON.call(this),e=this.parameters.shapes,i=this.parameters.options;return gu(e,i,t)};function Hi(t,e){he.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];for(var i=this,n=[],r=[],s=0,a=t.length;s<a;s++){var o=t[s];l(o)}this.addAttribute("position",new le(n,3)),this.addAttribute("uv",new le(r,2)),this.computeVertexNormals();function l(c){var h=[],u=e.curveSegments!==void 0?e.curveSegments:12,f=e.steps!==void 0?e.steps:1,d=e.depth!==void 0?e.depth:100,p=e.bevelEnabled!==void 0?e.bevelEnabled:!0,m=e.bevelThickness!==void 0?e.bevelThickness:6,g=e.bevelSize!==void 0?e.bevelSize:m-2,v=e.bevelOffset!==void 0?e.bevelOffset:0,x=e.bevelSegments!==void 0?e.bevelSegments:3,y=e.extrudePath,b=e.UVGenerator!==void 0?e.UVGenerator:e0;e.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),d=e.amount);var E,w=!1,A,D,O,P;y&&(E=y.getSpacedPoints(f),w=!0,p=!1,A=y.computeFrenetFrames(f,!1),D=new S,O=new S,P=new S),p||(x=0,m=0,g=0,v=0);var L,C,U,j=c.extractPoints(u),K=j.shape,z=j.holes,$=!Qi.isClockWise(K);if($)for(K=K.reverse(),C=0,U=z.length;C<U;C++)L=z[C],Qi.isClockWise(L)&&(z[C]=L.reverse());var k=Qi.triangulateShape(K,z),G=K;for(C=0,U=z.length;C<U;C++)L=z[C],K=K.concat(L);function q(He,B,ue){return B||console.error("THREE.ExtrudeGeometry: vec does not exist"),B.clone().multiplyScalar(ue).add(He)}var ee,Q,ae,V,oe,ne=K.length,ve,Ee=k.length;function Ge(He,B,ue){var ye,Oe,xe,Ve=He.x-B.x,Ze=He.y-B.y,Xe=ue.x-He.x,Tt=ue.y-He.y,Ke=Ve*Ve+Ze*Ze,jt=Ve*Tt-Ze*Xe;if(Math.abs(jt)>Number.EPSILON){var $t=Math.sqrt(Ke),cr=Math.sqrt(Xe*Xe+Tt*Tt),ui=B.x-Ze/$t,as=B.y+Ve/$t,Ia=ue.x-Tt/cr,Ca=ue.y+Xe/cr,os=((Ia-ui)*Tt-(Ca-as)*Xe)/(Ve*Tt-Ze*Xe);ye=ui+Ve*os-He.x,Oe=as+Ze*os-He.y;var ls=ye*ye+Oe*Oe;if(ls<=2)return new X(ye,Oe);xe=Math.sqrt(ls/2)}else{var Tn=!1;Ve>Number.EPSILON?Xe>Number.EPSILON&&(Tn=!0):Ve<-Number.EPSILON?Xe<-Number.EPSILON&&(Tn=!0):Math.sign(Ze)===Math.sign(Tt)&&(Tn=!0),Tn?(ye=-Ze,Oe=Ve,xe=Math.sqrt(Ke)):(ye=Ve,Oe=Ze,xe=Math.sqrt(Ke/2))}return new X(ye/xe,Oe/xe)}for(var I=[],M=0,J=G.length,re=J-1,W=M+1;M<J;M++,re++,W++)re===J&&(re=0),W===J&&(W=0),I[M]=Ge(G[M],G[re],G[W]);var te=[],se,Le=I.concat();for(C=0,U=z.length;C<U;C++){for(L=z[C],se=[],M=0,J=L.length,re=J-1,W=M+1;M<J;M++,re++,W++)re===J&&(re=0),W===J&&(W=0),se[M]=Ge(L[M],L[re],L[W]);te.push(se),Le=Le.concat(se)}for(ee=0;ee<x;ee++){for(ae=ee/x,V=m*Math.cos(ae*Math.PI/2),Q=g*Math.sin(ae*Math.PI/2)+v,M=0,J=G.length;M<J;M++)oe=q(G[M],I[M],Q),Ce(oe.x,oe.y,-V);for(C=0,U=z.length;C<U;C++)for(L=z[C],se=te[C],M=0,J=L.length;M<J;M++)oe=q(L[M],se[M],Q),Ce(oe.x,oe.y,-V)}for(Q=g+v,M=0;M<ne;M++)oe=p?q(K[M],Le[M],Q):K[M],w?(O.copy(A.normals[0]).multiplyScalar(oe.x),D.copy(A.binormals[0]).multiplyScalar(oe.y),P.copy(E[0]).add(O).add(D),Ce(P.x,P.y,P.z)):Ce(oe.x,oe.y,0);var Re;for(Re=1;Re<=f;Re++)for(M=0;M<ne;M++)oe=p?q(K[M],Le[M],Q):K[M],w?(O.copy(A.normals[Re]).multiplyScalar(oe.x),D.copy(A.binormals[Re]).multiplyScalar(oe.y),P.copy(E[Re]).add(O).add(D),Ce(P.x,P.y,P.z)):Ce(oe.x,oe.y,d/f*Re);for(ee=x-1;ee>=0;ee--){for(ae=ee/x,V=m*Math.cos(ae*Math.PI/2),Q=g*Math.sin(ae*Math.PI/2)+v,M=0,J=G.length;M<J;M++)oe=q(G[M],I[M],Q),Ce(oe.x,oe.y,d+V);for(C=0,U=z.length;C<U;C++)for(L=z[C],se=te[C],M=0,J=L.length;M<J;M++)oe=q(L[M],se[M],Q),w?Ce(oe.x,oe.y+E[f-1].y,E[f-1].x+V):Ce(oe.x,oe.y,d+V)}ke(),qe();function ke(){var He=n.length/3;if(p){var B=0,ue=ne*B;for(M=0;M<Ee;M++)ve=k[M],vt(ve[2]+ue,ve[1]+ue,ve[0]+ue);for(B=f+x*2,ue=ne*B,M=0;M<Ee;M++)ve=k[M],vt(ve[0]+ue,ve[1]+ue,ve[2]+ue)}else{for(M=0;M<Ee;M++)ve=k[M],vt(ve[2],ve[1],ve[0]);for(M=0;M<Ee;M++)ve=k[M],vt(ve[0]+ne*f,ve[1]+ne*f,ve[2]+ne*f)}i.addGroup(He,n.length/3-He,0)}function qe(){var He=n.length/3,B=0;for(lt(G,B),B+=G.length,C=0,U=z.length;C<U;C++)L=z[C],lt(L,B),B+=L.length;i.addGroup(He,n.length/3-He,1)}function lt(He,B){var ue,ye;for(M=He.length;--M>=0;){ue=M,ye=M-1,ye<0&&(ye=He.length-1);var Oe=0,xe=f+x*2;for(Oe=0;Oe<xe;Oe++){var Ve=ne*Oe,Ze=ne*(Oe+1),Xe=B+ue+Ve,Tt=B+ye+Ve,Ke=B+ye+Ze,jt=B+ue+Ze;yt(Xe,Tt,Ke,jt)}}}function Ce(He,B,ue){h.push(He),h.push(B),h.push(ue)}function vt(He,B,ue){Ct(He),Ct(B),Ct(ue);var ye=n.length/3,Oe=b.generateTopUV(i,n,ye-3,ye-2,ye-1);Wt(Oe[0]),Wt(Oe[1]),Wt(Oe[2])}function yt(He,B,ue,ye){Ct(He),Ct(B),Ct(ye),Ct(B),Ct(ue),Ct(ye);var Oe=n.length/3,xe=b.generateSideWallUV(i,n,Oe-6,Oe-3,Oe-2,Oe-1);Wt(xe[0]),Wt(xe[1]),Wt(xe[3]),Wt(xe[1]),Wt(xe[2]),Wt(xe[3])}function Ct(He){n.push(h[He*3+0]),n.push(h[He*3+1]),n.push(h[He*3+2])}function Wt(He){r.push(He.x),r.push(He.y)}}}Hi.prototype=Object.create(he.prototype);Hi.prototype.constructor=Hi;Hi.prototype.toJSON=function(){var t=he.prototype.toJSON.call(this),e=this.parameters.shapes,i=this.parameters.options;return gu(e,i,t)};var e0={generateTopUV:function(t,e,i,n,r){var s=e[i*3],a=e[i*3+1],o=e[n*3],l=e[n*3+1],c=e[r*3],h=e[r*3+1];return[new X(s,a),new X(o,l),new X(c,h)]},generateSideWallUV:function(t,e,i,n,r,s){var a=e[i*3],o=e[i*3+1],l=e[i*3+2],c=e[n*3],h=e[n*3+1],u=e[n*3+2],f=e[r*3],d=e[r*3+1],p=e[r*3+2],m=e[s*3],g=e[s*3+1],v=e[s*3+2];return Math.abs(o-h)<.01?[new X(a,1-l),new X(c,1-u),new X(f,1-p),new X(m,1-v)]:[new X(o,1-l),new X(h,1-u),new X(d,1-p),new X(g,1-v)]}};function gu(t,e,i){if(i.shapes=[],Array.isArray(t))for(var n=0,r=t.length;n<r;n++){var s=t[n];i.shapes.push(s.uuid)}else i.shapes.push(t.uuid);return e.extrudePath!==void 0&&(i.options.extrudePath=e.extrudePath.toJSON()),i}function Zs(t,e){Ie.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new Br(t,e)),this.mergeVertices()}Zs.prototype=Object.create(Ie.prototype);Zs.prototype.constructor=Zs;function Br(t,e){e=e||{};var i=e.font;if(!(i&&i.isFont))return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Ie;var n=i.generateShapes(t,e.size);e.depth=e.height!==void 0?e.height:50,e.bevelThickness===void 0&&(e.bevelThickness=10),e.bevelSize===void 0&&(e.bevelSize=8),e.bevelEnabled===void 0&&(e.bevelEnabled=!1),Hi.call(this,n,e),this.type="TextBufferGeometry"}Br.prototype=Object.create(Hi.prototype);Br.prototype.constructor=Br;function Js(t,e,i,n,r,s,a){Ie.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:s,thetaLength:a},this.fromBufferGeometry(new Ri(t,e,i,n,r,s,a)),this.mergeVertices()}Js.prototype=Object.create(Ie.prototype);Js.prototype.constructor=Js;function Ri(t,e,i,n,r,s,a){he.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:s,thetaLength:a},t=t||1,e=Math.max(3,Math.floor(e)||8),i=Math.max(2,Math.floor(i)||6),n=n!==void 0?n:0,r=r!==void 0?r:Math.PI*2,s=s!==void 0?s:0,a=a!==void 0?a:Math.PI;var o=Math.min(s+a,Math.PI),l,c,h=0,u=[],f=new S,d=new S,p=[],m=[],g=[],v=[];for(c=0;c<=i;c++){var x=[],y=c/i,b=0;for(c==0&&s==0?b=.5/e:c==i&&o==Math.PI&&(b=-.5/e),l=0;l<=e;l++){var E=l/e;f.x=-t*Math.cos(n+E*r)*Math.sin(s+y*a),f.y=t*Math.cos(s+y*a),f.z=t*Math.sin(n+E*r)*Math.sin(s+y*a),m.push(f.x,f.y,f.z),d.copy(f).normalize(),g.push(d.x,d.y,d.z),v.push(E+b,1-y),x.push(h++)}u.push(x)}for(c=0;c<i;c++)for(l=0;l<e;l++){var w=u[c][l+1],A=u[c][l],D=u[c+1][l],O=u[c+1][l+1];(c!==0||s>0)&&p.push(w,A,O),(c!==i-1||o<Math.PI)&&p.push(A,D,O)}this.setIndex(p),this.addAttribute("position",new le(m,3)),this.addAttribute("normal",new le(g,3)),this.addAttribute("uv",new le(v,2))}Ri.prototype=Object.create(he.prototype);Ri.prototype.constructor=Ri;function Qs(t,e,i,n,r,s){Ie.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:s},this.fromBufferGeometry(new Ur(t,e,i,n,r,s)),this.mergeVertices()}Qs.prototype=Object.create(Ie.prototype);Qs.prototype.constructor=Qs;function Ur(t,e,i,n,r,s){he.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:s},t=t||.5,e=e||1,r=r!==void 0?r:0,s=s!==void 0?s:Math.PI*2,i=i!==void 0?Math.max(3,i):8,n=n!==void 0?Math.max(1,n):1;var a=[],o=[],l=[],c=[],h,u=t,f=(e-t)/n,d=new S,p=new X,m,g;for(m=0;m<=n;m++){for(g=0;g<=i;g++)h=r+g/i*s,d.x=u*Math.cos(h),d.y=u*Math.sin(h),o.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/e+1)/2,p.y=(d.y/e+1)/2,c.push(p.x,p.y);u+=f}for(m=0;m<n;m++){var v=m*(i+1);for(g=0;g<i;g++){h=g+v;var x=h,y=h+i+1,b=h+i+2,E=h+1;a.push(x,y,E),a.push(y,b,E)}}this.setIndex(a),this.addAttribute("position",new le(o,3)),this.addAttribute("normal",new le(l,3)),this.addAttribute("uv",new le(c,2))}Ur.prototype=Object.create(he.prototype);Ur.prototype.constructor=Ur;function ea(t,e,i,n){Ie.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:n},this.fromBufferGeometry(new Gr(t,e,i,n)),this.mergeVertices()}ea.prototype=Object.create(Ie.prototype);ea.prototype.constructor=ea;function Gr(t,e,i,n){he.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:n},e=Math.floor(e)||12,i=i||0,n=n||Math.PI*2,n=Te.clamp(n,0,Math.PI*2);var r=[],s=[],a=[],o,l=1/e,c=new S,h=new X,u,f;for(u=0;u<=e;u++){var d=i+u*l*n,p=Math.sin(d),m=Math.cos(d);for(f=0;f<=t.length-1;f++)c.x=t[f].x*p,c.y=t[f].y,c.z=t[f].x*m,s.push(c.x,c.y,c.z),h.x=u/e,h.y=f/(t.length-1),a.push(h.x,h.y)}for(u=0;u<e;u++)for(f=0;f<t.length-1;f++){o=f+u*t.length;var g=o,v=o+t.length,x=o+t.length+1,y=o+1;r.push(g,v,y),r.push(v,x,y)}if(this.setIndex(r),this.addAttribute("position",new le(s,3)),this.addAttribute("uv",new le(a,2)),this.computeVertexNormals(),n===Math.PI*2){var b=this.attributes.normal.array,E=new S,w=new S,A=new S;for(o=e*t.length*3,u=0,f=0;u<t.length;u++,f+=3)E.x=b[f+0],E.y=b[f+1],E.z=b[f+2],w.x=b[o+f+0],w.y=b[o+f+1],w.z=b[o+f+2],A.addVectors(E,w).normalize(),b[f+0]=b[o+f+0]=A.x,b[f+1]=b[o+f+1]=A.y,b[f+2]=b[o+f+2]=A.z}}Gr.prototype=Object.create(he.prototype);Gr.prototype.constructor=Gr;function Kn(t,e){Ie.call(this),this.type="ShapeGeometry",typeof e=="object"&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new Xn(t,e)),this.mergeVertices()}Kn.prototype=Object.create(Ie.prototype);Kn.prototype.constructor=Kn;Kn.prototype.toJSON=function(){var t=Ie.prototype.toJSON.call(this),e=this.parameters.shapes;return vu(e,t)};function Xn(t,e){he.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;var i=[],n=[],r=[],s=[],a=0,o=0;if(Array.isArray(t)===!1)c(t);else for(var l=0;l<t.length;l++)c(t[l]),this.addGroup(a,o,l),a+=o,o=0;this.setIndex(i),this.addAttribute("position",new le(n,3)),this.addAttribute("normal",new le(r,3)),this.addAttribute("uv",new le(s,2));function c(h){var u,f,d,p=n.length/3,m=h.extractPoints(e),g=m.shape,v=m.holes;for(Qi.isClockWise(g)===!1&&(g=g.reverse()),u=0,f=v.length;u<f;u++)d=v[u],Qi.isClockWise(d)===!0&&(v[u]=d.reverse());var x=Qi.triangulateShape(g,v);for(u=0,f=v.length;u<f;u++)d=v[u],g=g.concat(d);for(u=0,f=g.length;u<f;u++){var y=g[u];n.push(y.x,y.y,0),r.push(0,0,1),s.push(y.x,y.y)}for(u=0,f=x.length;u<f;u++){var b=x[u],E=b[0]+p,w=b[1]+p,A=b[2]+p;i.push(E,w,A),o+=3}}}Xn.prototype=Object.create(he.prototype);Xn.prototype.constructor=Xn;Xn.prototype.toJSON=function(){var t=he.prototype.toJSON.call(this),e=this.parameters.shapes;return vu(e,t)};function vu(t,e){if(e.shapes=[],Array.isArray(t))for(var i=0,n=t.length;i<n;i++){var r=t[i];e.shapes.push(r.uuid)}else e.shapes.push(t.uuid);return e}function ta(t,e){he.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=e!==void 0?e:1;var i=[],n=Math.cos(Te.DEG2RAD*e),r=[0,0],s={},a,o,l,c=["a","b","c"],h;t.isBufferGeometry?(h=new Ie,h.fromBufferGeometry(t)):h=t.clone(),h.mergeVertices(),h.computeFaceNormals();for(var u=h.vertices,f=h.faces,d=0,p=f.length;d<p;d++)for(var m=f[d],g=0;g<3;g++)a=m[c[g]],o=m[c[(g+1)%3]],r[0]=Math.min(a,o),r[1]=Math.max(a,o),l=r[0]+","+r[1],s[l]===void 0?s[l]={index1:r[0],index2:r[1],face1:d,face2:void 0}:s[l].face2=d;for(l in s){var v=s[l];if(v.face2===void 0||f[v.face1].normal.dot(f[v.face2].normal)<=n){var x=u[v.index1];i.push(x.x,x.y,x.z),x=u[v.index2],i.push(x.x,x.y,x.z)}}this.addAttribute("position",new le(i,3))}ta.prototype=Object.create(he.prototype);ta.prototype.constructor=ta;function qn(t,e,i,n,r,s,a,o){Ie.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new rn(t,e,i,n,r,s,a,o)),this.mergeVertices()}qn.prototype=Object.create(Ie.prototype);qn.prototype.constructor=qn;function rn(t,e,i,n,r,s,a,o){he.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o};var l=this;t=t!==void 0?t:1,e=e!==void 0?e:1,i=i||1,n=Math.floor(n)||8,r=Math.floor(r)||1,s=s!==void 0?s:!1,a=a!==void 0?a:0,o=o!==void 0?o:Math.PI*2;var c=[],h=[],u=[],f=[],d=0,p=[],m=i/2,g=0;v(),s===!1&&(t>0&&x(!0),e>0&&x(!1)),this.setIndex(c),this.addAttribute("position",new le(h,3)),this.addAttribute("normal",new le(u,3)),this.addAttribute("uv",new le(f,2));function v(){var y,b,E=new S,w=new S,A=0,D=(e-t)/i;for(b=0;b<=r;b++){var O=[],P=b/r,L=P*(e-t)+t;for(y=0;y<=n;y++){var C=y/n,U=C*o+a,j=Math.sin(U),K=Math.cos(U);w.x=L*j,w.y=-P*i+m,w.z=L*K,h.push(w.x,w.y,w.z),E.set(j,D,K).normalize(),u.push(E.x,E.y,E.z),f.push(C,1-P),O.push(d++)}p.push(O)}for(y=0;y<n;y++)for(b=0;b<r;b++){var z=p[b][y],$=p[b+1][y],k=p[b+1][y+1],G=p[b][y+1];c.push(z,$,G),c.push($,k,G),A+=6}l.addGroup(g,A,0),g+=A}function x(y){var b,E,w,A=new X,D=new S,O=0,P=y===!0?t:e,L=y===!0?1:-1;for(E=d,b=1;b<=n;b++)h.push(0,m*L,0),u.push(0,L,0),f.push(.5,.5),d++;for(w=d,b=0;b<=n;b++){var C=b/n,U=C*o+a,j=Math.cos(U),K=Math.sin(U);D.x=P*K,D.y=m*L,D.z=P*j,h.push(D.x,D.y,D.z),u.push(0,L,0),A.x=j*.5+.5,A.y=K*.5*L+.5,f.push(A.x,A.y),d++}for(b=0;b<n;b++){var z=E+b,$=w+b;y===!0?c.push($,$+1,z):c.push($+1,$,z),O+=3}l.addGroup(g,O,y===!0?1:2),g+=O}}rn.prototype=Object.create(he.prototype);rn.prototype.constructor=rn;function ia(t,e,i,n,r,s,a){qn.call(this,0,t,e,i,n,r,s,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:s,thetaLength:a}}ia.prototype=Object.create(qn.prototype);ia.prototype.constructor=ia;function na(t,e,i,n,r,s,a){rn.call(this,0,t,e,i,n,r,s,a),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:s,thetaLength:a}}na.prototype=Object.create(rn.prototype);na.prototype.constructor=na;function ra(t,e,i,n){Ie.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:n},this.fromBufferGeometry(new Hr(t,e,i,n)),this.mergeVertices()}ra.prototype=Object.create(Ie.prototype);ra.prototype.constructor=ra;function Hr(t,e,i,n){he.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:n},t=t||1,e=e!==void 0?Math.max(3,e):8,i=i!==void 0?i:0,n=n!==void 0?n:Math.PI*2;var r=[],s=[],a=[],o=[],l,c,h=new S,u=new X;for(s.push(0,0,0),a.push(0,0,1),o.push(.5,.5),c=0,l=3;c<=e;c++,l+=3){var f=i+c/e*n;h.x=t*Math.cos(f),h.y=t*Math.sin(f),s.push(h.x,h.y,h.z),a.push(0,0,1),u.x=(s[l]/t+1)/2,u.y=(s[l+1]/t+1)/2,o.push(u.x,u.y)}for(l=1;l<=e;l++)r.push(l,l+1,0);this.setIndex(r),this.addAttribute("position",new le(s,3)),this.addAttribute("normal",new le(a,3)),this.addAttribute("uv",new le(o,2))}Hr.prototype=Object.create(he.prototype);Hr.prototype.constructor=Hr;var Bt=Object.freeze({WireframeGeometry:Gs,ParametricGeometry:Hs,ParametricBufferGeometry:Mr,TetrahedronGeometry:zs,TetrahedronBufferGeometry:Rr,OctahedronGeometry:Ws,OctahedronBufferGeometry:jn,IcosahedronGeometry:js,IcosahedronBufferGeometry:Ir,DodecahedronGeometry:$s,DodecahedronBufferGeometry:Cr,PolyhedronGeometry:Vs,PolyhedronBufferGeometry:ti,TubeGeometry:Ys,TubeBufferGeometry:$n,TorusKnotGeometry:Ks,TorusKnotBufferGeometry:Dr,TorusGeometry:Xs,TorusBufferGeometry:Pr,TextGeometry:Zs,TextBufferGeometry:Br,SphereGeometry:Js,SphereBufferGeometry:Ri,RingGeometry:Qs,RingBufferGeometry:Ur,PlaneGeometry:Ps,PlaneBufferGeometry:tn,LatheGeometry:ea,LatheBufferGeometry:Gr,ShapeGeometry:Kn,ShapeBufferGeometry:Xn,ExtrudeGeometry:Yn,ExtrudeBufferGeometry:Hi,EdgesGeometry:ta,ConeGeometry:ia,ConeBufferGeometry:na,CylinderGeometry:qn,CylinderBufferGeometry:rn,CircleGeometry:ra,CircleBufferGeometry:Hr,BoxGeometry:Ds,BoxBufferGeometry:pn});function Zn(t){Pe.call(this),this.type="ShadowMaterial",this.color=new me(0),this.transparent=!0,this.setValues(t)}Zn.prototype=Object.create(Pe.prototype);Zn.prototype.constructor=Zn;Zn.prototype.isShadowMaterial=!0;Zn.prototype.copy=function(t){return Pe.prototype.copy.call(this,t),this.color.copy(t.color),this};function Vr(t){Vt.call(this,t),this.type="RawShaderMaterial"}Vr.prototype=Object.create(Vt.prototype);Vr.prototype.constructor=Vr;Vr.prototype.isRawShaderMaterial=!0;function Vi(t){Pe.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new me(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new me(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wa,this.normalScale=new X(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}Vi.prototype=Object.create(Pe.prototype);Vi.prototype.constructor=Vi;Vi.prototype.isMeshStandardMaterial=!0;Vi.prototype.copy=function(t){return Pe.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this};function Jn(t){Vi.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(t)}Jn.prototype=Object.create(Vi.prototype);Jn.prototype.constructor=Jn;Jn.prototype.isMeshPhysicalMaterial=!0;Jn.prototype.copy=function(t){return Vi.prototype.copy.call(this,t),this.defines={PHYSICAL:""},this.reflectivity=t.reflectivity,this.clearCoat=t.clearCoat,this.clearCoatRoughness=t.clearCoatRoughness,this};function Ii(t){Pe.call(this),this.type="MeshPhongMaterial",this.color=new me(16777215),this.specular=new me(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new me(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wa,this.normalScale=new X(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ta,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}Ii.prototype=Object.create(Pe.prototype);Ii.prototype.constructor=Ii;Ii.prototype.isMeshPhongMaterial=!0;Ii.prototype.copy=function(t){return Pe.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this};function Qn(t){Ii.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(t)}Qn.prototype=Object.create(Ii.prototype);Qn.prototype.constructor=Qn;Qn.prototype.isMeshToonMaterial=!0;Qn.prototype.copy=function(t){return Ii.prototype.copy.call(this,t),this.gradientMap=t.gradientMap,this};function er(t){Pe.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wa,this.normalScale=new X(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}er.prototype=Object.create(Pe.prototype);er.prototype.constructor=er;er.prototype.isMeshNormalMaterial=!0;er.prototype.copy=function(t){return Pe.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this};function tr(t){Pe.call(this),this.type="MeshLambertMaterial",this.color=new me(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new me(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ta,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}tr.prototype=Object.create(Pe.prototype);tr.prototype.constructor=tr;tr.prototype.isMeshLambertMaterial=!0;tr.prototype.copy=function(t){return Pe.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this};function ir(t){Pe.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new me(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wa,this.normalScale=new X(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.lights=!1,this.setValues(t)}ir.prototype=Object.create(Pe.prototype);ir.prototype.constructor=ir;ir.prototype.isMeshMatcapMaterial=!0;ir.prototype.copy=function(t){return Pe.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this};function nr(t){st.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}nr.prototype=Object.create(st.prototype);nr.prototype.constructor=nr;nr.prototype.isLineDashedMaterial=!0;nr.prototype.copy=function(t){return st.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var t0=Object.freeze({ShadowMaterial:Zn,SpriteMaterial:nn,RawShaderMaterial:Vr,ShaderMaterial:Vt,PointsMaterial:yn,MeshPhysicalMaterial:Jn,MeshStandardMaterial:Vi,MeshPhongMaterial:Ii,MeshToonMaterial:Qn,MeshNormalMaterial:er,MeshLambertMaterial:tr,MeshDepthMaterial:mn,MeshDistanceMaterial:gn,MeshBasicMaterial:It,MeshMatcapMaterial:ir,LineDashedMaterial:nr,LineBasicMaterial:st,Material:Pe}),Lt={arraySlice:function(t,e,i){return Lt.isTypedArray(t)?new t.constructor(t.subarray(e,i!==void 0?i:t.length)):t.slice(e,i)},convertArray:function(t,e,i){return!t||!i&&t.constructor===e?t:typeof e.BYTES_PER_ELEMENT=="number"?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){function e(s,a){return t[s]-t[a]}for(var i=t.length,n=new Array(i),r=0;r!==i;++r)n[r]=r;return n.sort(e),n},sortedArray:function(t,e,i){for(var n=t.length,r=new t.constructor(n),s=0,a=0;a!==n;++s)for(var o=i[s]*e,l=0;l!==e;++l)r[a++]=t[o+l];return r},flattenJSON:function(t,e,i,n){for(var r=1,s=t[0];s!==void 0&&s[n]===void 0;)s=t[r++];if(s!==void 0){var a=s[n];if(a!==void 0)if(Array.isArray(a))do a=s[n],a!==void 0&&(e.push(s.time),i.push.apply(i,a)),s=t[r++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[n],a!==void 0&&(e.push(s.time),a.toArray(i,i.length)),s=t[r++];while(s!==void 0);else do a=s[n],a!==void 0&&(e.push(s.time),i.push(a)),s=t[r++];while(s!==void 0)}}};function li(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=n!==void 0?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i}Object.assign(li.prototype,{evaluate:function(t){var e=this.parameterPositions,i=this._cachedIndex,n=e[i],r=e[i-1];e:{t:{var s;i:{n:if(!(t<n)){for(var a=i+2;;){if(n===void 0){if(t<r)break n;return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,t,r)}if(i===a)break;if(r=n,n=e[++i],t<n)break t}s=e.length;break i}if(!(t>=r)){var o=e[1];t<o&&(i=2,r=o);for(var a=i-2;;){if(r===void 0)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(i===a)break;if(n=r,r=e[--i-1],t>=r)break t}s=i,i=0;break i}break e}for(;i<s;){var l=i+s>>>1;t<e[l]?s=l:i=l+1}if(n=e[i],r=e[i-1],r===void 0)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(n===void 0)return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,r,t)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,t,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=t*n,s=0;s!==n;++s)e[s]=i[r+s];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}});//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(li.prototype,{beforeStart_:li.prototype.copySampleValue_,afterEnd_:li.prototype.copySampleValue_});function ko(t,e,i,n){li.call(this,t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}ko.prototype=Object.assign(Object.create(li.prototype),{constructor:ko,DefaultSettings_:{endingStart:Gn,endingEnd:Gn},intervalChanged_:function(t,e,i){var n=this.parameterPositions,r=t-2,s=t+1,a=n[r],o=n[s];if(a===void 0)switch(this.getSettings_().endingStart){case Dn:r=t,a=2*e-i;break;case Rs:r=n.length-2,a=e+n[r]-n[r+1];break;default:r=t,a=i}if(o===void 0)switch(this.getSettings_().endingEnd){case Dn:s=t,o=2*i-e;break;case Rs:s=1,o=i+n[1]-n[0];break;default:s=t-1,o=e}var l=(i-e)*.5,c=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(o-i),this._offsetPrev=r*c,this._offsetNext=s*c},interpolate_:function(t,e,i,n){for(var r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,f=this._weightNext,d=(i-e)/(n-e),p=d*d,m=p*d,g=-u*m+2*u*p-u*d,v=(1+u)*m+(-1.5-2*u)*p+(-.5+u)*d+1,x=(-1-f)*m+(1.5+f)*p+.5*d,y=f*m-f*p,b=0;b!==a;++b)r[b]=g*s[c+b]+v*s[l+b]+x*s[o+b]+y*s[h+b];return r}});function sa(t,e,i,n){li.call(this,t,e,i,n)}sa.prototype=Object.assign(Object.create(li.prototype),{constructor:sa,interpolate_:function(t,e,i,n){for(var r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,c=(i-e)/(n-e),h=1-c,u=0;u!==a;++u)r[u]=s[l+u]*h+s[o+u]*c;return r}});function No(t,e,i,n){li.call(this,t,e,i,n)}No.prototype=Object.assign(Object.create(li.prototype),{constructor:No,interpolate_:function(t){return this.copySampleValue_(t-1)}});function Nt(t,e,i,n){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Lt.convertArray(e,this.TimeBufferType),this.values=Lt.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}Object.assign(Nt,{toJSON:function(t){var e=t.constructor,i;if(e.toJSON!==void 0)i=e.toJSON(t);else{i={name:t.name,times:Lt.convertArray(t.times,Array),values:Lt.convertArray(t.values,Array)};var n=t.getInterpolation();n!==t.DefaultInterpolation&&(i.interpolation=n)}return i.type=t.ValueTypeName,i}});Object.assign(Nt.prototype,{constructor:Nt,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:ws,InterpolantFactoryMethodDiscrete:function(t){return new No(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new sa(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new ko(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case Ms:e=this.InterpolantFactoryMethodDiscrete;break;case ws:e=this.InterpolantFactoryMethodLinear;break;case Ba:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){var i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ms;case this.InterpolantFactoryMethodLinear:return ws;case this.InterpolantFactoryMethodSmooth:return Ba}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(t!==0)for(var e=this.times,i=0,n=e.length;i!==n;++i)e[i]+=t;return this},scale:function(t){if(t!==1)for(var e=this.times,i=0,n=e.length;i!==n;++i)e[i]*=t;return this},trim:function(t,e){for(var i=this.times,n=i.length,r=0,s=n-1;r!==n&&i[r]<t;)++r;for(;s!==-1&&i[s]>e;)--s;if(++s,r!==0||s!==n){r>=s&&(s=Math.max(s,1),r=s-1);var a=this.getValueSize();this.times=Lt.arraySlice(i,r,s),this.values=Lt.arraySlice(this.values,r*a,s*a)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var i=this.times,n=this.values,r=i.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var s=null,a=0;a!==r;a++){var o=i[a];if(typeof o=="number"&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,o),t=!1;break}if(s!==null&&s>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,o,s),t=!1;break}s=o}if(n!==void 0&&Lt.isTypedArray(n))for(var a=0,l=n.length;a!==l;++a){var c=n[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),t=!1;break}}return t},optimize:function(){for(var t=this.times,e=this.values,i=this.getValueSize(),n=this.getInterpolation()===Ba,r=1,s=t.length-1,a=1;a<s;++a){var o=!1,l=t[a],c=t[a+1];if(l!==c&&(a!==1||l!==l[0]))if(n)o=!0;else for(var h=a*i,u=h-i,f=h+i,d=0;d!==i;++d){var p=e[h+d];if(p!==e[u+d]||p!==e[f+d]){o=!0;break}}if(o){if(a!==r){t[r]=t[a];for(var m=a*i,g=r*i,d=0;d!==i;++d)e[g+d]=e[m+d]}++r}}if(s>0){t[r]=t[s];for(var m=s*i,g=r*i,d=0;d!==i;++d)e[g+d]=e[m+d];++r}return r!==t.length&&(this.times=Lt.arraySlice(t,0,r),this.values=Lt.arraySlice(e,0,r*i)),this},clone:function(){var t=Lt.arraySlice(this.times,0),e=Lt.arraySlice(this.values,0),i=this.constructor,n=new i(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}});function Bo(t,e,i){Nt.call(this,t,e,i)}Bo.prototype=Object.assign(Object.create(Nt.prototype),{constructor:Bo,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Ms,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});function Uo(t,e,i,n){Nt.call(this,t,e,i,n)}Uo.prototype=Object.assign(Object.create(Nt.prototype),{constructor:Uo,ValueTypeName:"color"});function zr(t,e,i,n){Nt.call(this,t,e,i,n)}zr.prototype=Object.assign(Object.create(Nt.prototype),{constructor:zr,ValueTypeName:"number"});function Go(t,e,i,n){li.call(this,t,e,i,n)}Go.prototype=Object.assign(Object.create(li.prototype),{constructor:Go,interpolate_:function(t,e,i,n){for(var r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=(i-e)/(n-e),c=o+a;o!==c;o+=4)tt.slerpFlat(r,0,s,o-a,s,o,l);return r}});function aa(t,e,i,n){Nt.call(this,t,e,i,n)}aa.prototype=Object.assign(Object.create(Nt.prototype),{constructor:aa,ValueTypeName:"quaternion",DefaultInterpolation:ws,InterpolantFactoryMethodLinear:function(t){return new Go(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0});function Ho(t,e,i,n){Nt.call(this,t,e,i,n)}Ho.prototype=Object.assign(Object.create(Nt.prototype),{constructor:Ho,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Ms,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});function Wr(t,e,i,n){Nt.call(this,t,e,i,n)}Wr.prototype=Object.assign(Object.create(Nt.prototype),{constructor:Wr,ValueTypeName:"vector"});function mi(t,e,i){this.name=t,this.tracks=i,this.duration=e!==void 0?e:-1,this.uuid=Te.generateUUID(),this.duration<0&&this.resetDuration()}function i0(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return zr;case"vector":case"vector2":case"vector3":case"vector4":return Wr;case"color":return Uo;case"quaternion":return aa;case"bool":case"boolean":return Bo;case"string":return Ho}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function n0(t){if(t.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=i0(t.type);if(t.times===void 0){var i=[],n=[];Lt.flattenJSON(t.keys,i,n,"value"),t.times=i,t.values=n}return e.parse!==void 0?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}Object.assign(mi,{parse:function(t){for(var e=[],i=t.tracks,n=1/(t.fps||1),r=0,s=i.length;r!==s;++r)e.push(n0(i[r]).scale(n));return new mi(t.name,t.duration,e)},toJSON:function(t){for(var e=[],i=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid},r=0,s=i.length;r!==s;++r)e.push(Nt.toJSON(i[r]));return n},CreateFromMorphTargetSequence:function(t,e,i,n){for(var r=e.length,s=[],a=0;a<r;a++){var o=[],l=[];o.push((a+r-1)%r,a,(a+1)%r),l.push(0,1,0);var c=Lt.getKeyframeOrder(o);o=Lt.sortedArray(o,1,c),l=Lt.sortedArray(l,1,c),!n&&o[0]===0&&(o.push(r),l.push(l[0])),s.push(new zr(".morphTargetInfluences["+e[a].name+"]",o,l).scale(1/i))}return new mi(t,-1,s)},findByName:function(t,e){var i=t;if(!Array.isArray(t)){var n=t;i=n.geometry&&n.geometry.animations||n.animations}for(var r=0;r<i.length;r++)if(i[r].name===e)return i[r];return null},CreateClipsFromMorphTargetSequences:function(t,e,i){for(var n={},r=/^([\w-]*?)([\d]+)$/,s=0,a=t.length;s<a;s++){var o=t[s],l=o.name.match(r);if(l&&l.length>1){var c=l[1],h=n[c];h||(n[c]=h=[]),h.push(o)}}var u=[];for(var c in n)u.push(mi.CreateFromMorphTargetSequence(c,n[c],e,i));return u},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var i=function(y,b,E,w,A){if(E.length!==0){var D=[],O=[];Lt.flattenJSON(E,D,O,w),D.length!==0&&A.push(new y(b,D,O))}},n=[],r=t.name||"default",s=t.length||-1,a=t.fps||30,o=t.hierarchy||[],l=0;l<o.length;l++){var c=o[l].keys;if(!(!c||c.length===0))if(c[0].morphTargets){for(var h={},u=0;u<c.length;u++)if(c[u].morphTargets)for(var f=0;f<c[u].morphTargets.length;f++)h[c[u].morphTargets[f]]=-1;for(var d in h){for(var p=[],m=[],f=0;f!==c[u].morphTargets.length;++f){var g=c[u];p.push(g.time),m.push(g.morphTarget===d?1:0)}n.push(new zr(".morphTargetInfluence["+d+"]",p,m))}s=h.length*(a||1)}else{var v=".bones["+e[l].name+"]";i(Wr,v+".position",c,"pos",n),i(aa,v+".quaternion",c,"rot",n),i(Wr,v+".scale",c,"scl",n)}}if(n.length===0)return null;var x=new mi(r,s,n);return x}});Object.assign(mi.prototype,{resetDuration:function(){for(var t=this.tracks,e=0,i=0,n=t.length;i!==n;++i){var r=this.tracks[i];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){for(var t=!0,e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){for(var t=[],e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new mi(this.name,this.duration,t)}});var Gt={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function yu(t,e,i){var n=this,r=!1,s=0,a=0,o=void 0;this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(l){a++,r===!1&&n.onStart!==void 0&&n.onStart(l,s,a),r=!0},this.itemEnd=function(l){s++,n.onProgress!==void 0&&n.onProgress(l,s,a),s===a&&(r=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(l){n.onError!==void 0&&n.onError(l)},this.resolveURL=function(l){return o?o(l):l},this.setURLModifier=function(l){return o=l,this}}var ri=new yu,fi={};function ji(t){this.manager=t!==void 0?t:ri}Object.assign(ji.prototype,{load:function(t,e,i,n){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);var r=this,s=Gt.get(t);if(s!==void 0)return r.manager.itemStart(t),setTimeout(function(){e&&e(s),r.manager.itemEnd(t)},0),s;if(fi[t]!==void 0){fi[t].push({onLoad:e,onProgress:i,onError:n});return}var a=/^data:(.*?)(;base64)?,(.*)$/,o=t.match(a);if(o){var l=o[1],c=!!o[2],h=o[3];h=decodeURIComponent(h),c&&(h=atob(h));try{var u,f=(this.responseType||"").toLowerCase();switch(f){case"arraybuffer":case"blob":for(var d=new Uint8Array(h.length),p=0;p<h.length;p++)d[p]=h.charCodeAt(p);f==="blob"?u=new Blob([d.buffer],{type:l}):u=d.buffer;break;case"document":var m=new DOMParser;u=m.parseFromString(h,l);break;case"json":u=JSON.parse(h);break;default:u=h;break}setTimeout(function(){e&&e(u),r.manager.itemEnd(t)},0)}catch(x){setTimeout(function(){n&&n(x),r.manager.itemError(t),r.manager.itemEnd(t)},0)}}else{fi[t]=[],fi[t].push({onLoad:e,onProgress:i,onError:n});var g=new XMLHttpRequest;g.open("GET",t,!0),g.addEventListener("load",function(x){var y=this.response;Gt.add(t,y);var b=fi[t];if(delete fi[t],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received.");for(var E=0,w=b.length;E<w;E++){var A=b[E];A.onLoad&&A.onLoad(y)}r.manager.itemEnd(t)}else{for(var E=0,w=b.length;E<w;E++){var A=b[E];A.onError&&A.onError(x)}r.manager.itemError(t),r.manager.itemEnd(t)}},!1),g.addEventListener("progress",function(x){for(var y=fi[t],b=0,E=y.length;b<E;b++){var w=y[b];w.onProgress&&w.onProgress(x)}},!1),g.addEventListener("error",function(x){var y=fi[t];delete fi[t];for(var b=0,E=y.length;b<E;b++){var w=y[b];w.onError&&w.onError(x)}r.manager.itemError(t),r.manager.itemEnd(t)},!1),g.addEventListener("abort",function(x){var y=fi[t];delete fi[t];for(var b=0,E=y.length;b<E;b++){var w=y[b];w.onError&&w.onError(x)}r.manager.itemError(t),r.manager.itemEnd(t)},!1),this.responseType!==void 0&&(g.responseType=this.responseType),this.withCredentials!==void 0&&(g.withCredentials=this.withCredentials),g.overrideMimeType&&g.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(var v in this.requestHeader)g.setRequestHeader(v,this.requestHeader[v]);g.send(null)}return r.manager.itemStart(t),g},setPath:function(t){return this.path=t,this},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}});function r0(t){this.manager=t!==void 0?t:ri}Object.assign(r0.prototype,{load:function(t,e,i,n){var r=this,s=new ji(r.manager);s.setPath(r.path),s.load(t,function(a){e(r.parse(JSON.parse(a)))},i,n)},parse:function(t){for(var e=[],i=0;i<t.length;i++){var n=mi.parse(t[i]);e.push(n)}return e},setPath:function(t){return this.path=t,this}});function s0(t){this.manager=t!==void 0?t:ri,this._parser=null}Object.assign(s0.prototype,{load:function(t,e,i,n){var r=this,s=[],a=new Sr;a.image=s;var o=new ji(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer");function l(f){o.load(t[f],function(d){var p=r._parser(d,!0);s[f]={width:p.width,height:p.height,format:p.format,mipmaps:p.mipmaps},c+=1,c===6&&(p.mipmapCount===1&&(a.minFilter=ht),a.format=p.format,a.needsUpdate=!0,e&&e(a))},i,n)}if(Array.isArray(t))for(var c=0,h=0,u=t.length;h<u;++h)l(h);else o.load(t,function(f){var d=r._parser(f,!0);if(d.isCubemap)for(var p=d.mipmaps.length/d.mipmapCount,m=0;m<p;m++){s[m]={mipmaps:[]};for(var g=0;g<d.mipmapCount;g++)s[m].mipmaps.push(d.mipmaps[m*d.mipmapCount+g]),s[m].format=d.format,s[m].width=d.width,s[m].height=d.height}else a.image.width=d.width,a.image.height=d.height,a.mipmaps=d.mipmaps;d.mipmapCount===1&&(a.minFilter=ht),a.format=d.format,a.needsUpdate=!0,e&&e(a)},i,n);return a},setPath:function(t){return this.path=t,this}});function a0(t){this.manager=t!==void 0?t:ri,this._parser=null}Object.assign(a0.prototype,{load:function(t,e,i,n){var r=this,s=new Vn,a=new ji(this.manager);return a.setResponseType("arraybuffer"),a.setPath(this.path),a.load(t,function(o){var l=r._parser(o);l&&(l.image!==void 0?s.image=l.image:l.data!==void 0&&(s.image.width=l.width,s.image.height=l.height,s.image.data=l.data),s.wrapS=l.wrapS!==void 0?l.wrapS:qt,s.wrapT=l.wrapT!==void 0?l.wrapT:qt,s.magFilter=l.magFilter!==void 0?l.magFilter:ht,s.minFilter=l.minFilter!==void 0?l.minFilter:_a,s.anisotropy=l.anisotropy!==void 0?l.anisotropy:1,l.format!==void 0&&(s.format=l.format),l.type!==void 0&&(s.type=l.type),l.mipmaps!==void 0&&(s.mipmaps=l.mipmaps),l.mipmapCount===1&&(s.minFilter=ht),s.needsUpdate=!0,e&&e(s,l))},i,n),s},setPath:function(t){return this.path=t,this}});function Sa(t){this.manager=t!==void 0?t:ri}Object.assign(Sa.prototype,{crossOrigin:"anonymous",load:function(t,e,i,n){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);var r=this,s=Gt.get(t);if(s!==void 0)return r.manager.itemStart(t),setTimeout(function(){e&&e(s),r.manager.itemEnd(t)},0),s;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function o(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1),Gt.add(t,this),e&&e(this),r.manager.itemEnd(t)}function l(c){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1),n&&n(c),r.manager.itemError(t),r.manager.itemEnd(t)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),t.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(t),a.src=t,a},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}});function xu(t){this.manager=t!==void 0?t:ri}Object.assign(xu.prototype,{crossOrigin:"anonymous",load:function(t,e,i,n){var r=new Mi,s=new Sa(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);var a=0;function o(c){s.load(t[c],function(h){r.images[c]=h,a++,a===6&&(r.needsUpdate=!0,e&&e(r))},void 0,n)}for(var l=0;l<t.length;++l)o(l);return r},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}});function Dl(t){this.manager=t!==void 0?t:ri}Object.assign(Dl.prototype,{crossOrigin:"anonymous",load:function(t,e,i,n){var r=new Ye,s=new Sa(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,function(a){r.image=a;var o=t.search(/\.jpe?g($|\?)/i)>0||t.search(/^data\:image\/jpeg/)===0;r.format=o?Ai:Si,r.needsUpdate=!0,e!==void 0&&e(r)},i,n),r},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}});function _e(){this.type="Curve",this.arcLengthDivisions=200}Object.assign(_e.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){var i=this.getUtoTmapping(t);return this.getPoint(i,e)},getPoints:function(t){t===void 0&&(t=5);for(var e=[],i=0;i<=t;i++)e.push(this.getPoint(i/t));return e},getSpacedPoints:function(t){t===void 0&&(t=5);for(var e=[],i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(t===void 0&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e=[],i,n=this.getPoint(0),r,s=0;for(e.push(0),r=1;r<=t;r++)i=this.getPoint(r/t),s+=i.distanceTo(n),e.push(s),n=i;return this.cacheArcLengths=e,e},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var i=this.getLengths(),n=0,r=i.length,s;e?s=e:s=t*i[r-1];for(var a=0,o=r-1,l;a<=o;)if(n=Math.floor(a+(o-a)/2),l=i[n]-s,l<0)a=n+1;else if(l>0)o=n-1;else{o=n;break}if(n=o,i[n]===s)return n/(r-1);var c=i[n],h=i[n+1],u=h-c,f=(s-c)/u,d=(n+f)/(r-1);return d},getTangent:function(t){var e=1e-4,i=t-e,n=t+e;i<0&&(i=0),n>1&&(n=1);var r=this.getPoint(i),s=this.getPoint(n),a=s.clone().sub(r);return a.normalize()},getTangentAt:function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)},computeFrenetFrames:function(t,e){var i=new S,n=[],r=[],s=[],a=new S,o=new we,l,c,h;for(l=0;l<=t;l++)c=l/t,n[l]=this.getTangentAt(c),n[l].normalize();r[0]=new S,s[0]=new S;var u=Number.MAX_VALUE,f=Math.abs(n[0].x),d=Math.abs(n[0].y),p=Math.abs(n[0].z);for(f<=u&&(u=f,i.set(1,0,0)),d<=u&&(u=d,i.set(0,1,0)),p<=u&&i.set(0,0,1),a.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],a),s[0].crossVectors(n[0],r[0]),l=1;l<=t;l++)r[l]=r[l-1].clone(),s[l]=s[l-1].clone(),a.crossVectors(n[l-1],n[l]),a.length()>Number.EPSILON&&(a.normalize(),h=Math.acos(Te.clamp(n[l-1].dot(n[l]),-1,1)),r[l].applyMatrix4(o.makeRotationAxis(a,h))),s[l].crossVectors(n[l],r[l]);if(e===!0)for(h=Math.acos(Te.clamp(r[0].dot(r[t]),-1,1)),h/=t,n[0].dot(a.crossVectors(r[0],r[t]))>0&&(h=-h),l=1;l<=t;l++)r[l].applyMatrix4(o.makeRotationAxis(n[l],h*l)),s[l].crossVectors(n[l],r[l]);return{tangents:n,normals:r,binormals:s}},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}});function hi(t,e,i,n,r,s,a,o){_e.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=i||1,this.yRadius=n||1,this.aStartAngle=r||0,this.aEndAngle=s||2*Math.PI,this.aClockwise=a||!1,this.aRotation=o||0}hi.prototype=Object.create(_e.prototype);hi.prototype.constructor=hi;hi.prototype.isEllipseCurve=!0;hi.prototype.getPoint=function(t,e){for(var i=e||new X,n=Math.PI*2,r=this.aEndAngle-this.aStartAngle,s=Math.abs(r)<Number.EPSILON;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(s?r=0:r=n),this.aClockwise===!0&&!s&&(r===n?r=-n:r=r-n);var a=this.aStartAngle+t*r,o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){var c=Math.cos(this.aRotation),h=Math.sin(this.aRotation),u=o-this.aX,f=l-this.aY;o=u*c-f*h+this.aX,l=u*h+f*c+this.aY}return i.set(o,l)};hi.prototype.copy=function(t){return _e.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this};hi.prototype.toJSON=function(){var t=_e.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t};hi.prototype.fromJSON=function(t){return _e.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this};function jr(t,e,i,n,r,s){hi.call(this,t,e,i,i,n,r,s),this.type="ArcCurve"}jr.prototype=Object.create(hi.prototype);jr.prototype.constructor=jr;jr.prototype.isArcCurve=!0;function Pl(){var t=0,e=0,i=0,n=0;function r(s,a,o,l){t=s,e=o,i=-3*s+3*a-2*o-l,n=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,c){r(a,o,c*(o-s),c*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,c,h,u){var f=(a-s)/c-(o-s)/(c+h)+(o-a)/h,d=(o-a)/h-(l-a)/(h+u)+(l-o)/u;f*=h,d*=h,r(a,o,f,d)},calc:function(s){var a=s*s,o=a*s;return t+e*s+i*a+n*o}}}var us=new S,Ga=new Pl,Ha=new Pl,Va=new Pl;function ii(t,e,i,n){_e.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=i||"centripetal",this.tension=n||.5}ii.prototype=Object.create(_e.prototype);ii.prototype.constructor=ii;ii.prototype.isCatmullRomCurve3=!0;ii.prototype.getPoint=function(t,e){var i=e||new S,n=this.points,r=n.length,s=(r-(this.closed?0:1))*t,a=Math.floor(s),o=s-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/r)+1)*r:o===0&&a===r-1&&(a=r-2,o=1);var l,c,h,u;if(this.closed||a>0?l=n[(a-1)%r]:(us.subVectors(n[0],n[1]).add(n[0]),l=us),c=n[a%r],h=n[(a+1)%r],this.closed||a+2<r?u=n[(a+2)%r]:(us.subVectors(n[r-1],n[r-2]).add(n[r-1]),u=us),this.curveType==="centripetal"||this.curveType==="chordal"){var f=this.curveType==="chordal"?.5:.25,d=Math.pow(l.distanceToSquared(c),f),p=Math.pow(c.distanceToSquared(h),f),m=Math.pow(h.distanceToSquared(u),f);p<1e-4&&(p=1),d<1e-4&&(d=p),m<1e-4&&(m=p),Ga.initNonuniformCatmullRom(l.x,c.x,h.x,u.x,d,p,m),Ha.initNonuniformCatmullRom(l.y,c.y,h.y,u.y,d,p,m),Va.initNonuniformCatmullRom(l.z,c.z,h.z,u.z,d,p,m)}else this.curveType==="catmullrom"&&(Ga.initCatmullRom(l.x,c.x,h.x,u.x,this.tension),Ha.initCatmullRom(l.y,c.y,h.y,u.y,this.tension),Va.initCatmullRom(l.z,c.z,h.z,u.z,this.tension));return i.set(Ga.calc(o),Ha.calc(o),Va.calc(o)),i};ii.prototype.copy=function(t){_e.prototype.copy.call(this,t),this.points=[];for(var e=0,i=t.points.length;e<i;e++){var n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this};ii.prototype.toJSON=function(){var t=_e.prototype.toJSON.call(this);t.points=[];for(var e=0,i=this.points.length;e<i;e++){var n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t};ii.prototype.fromJSON=function(t){_e.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,i=t.points.length;e<i;e++){var n=t.points[e];this.points.push(new S().fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this};function Ic(t,e,i,n,r){var s=(n-e)*.5,a=(r-i)*.5,o=t*t,l=t*o;return(2*i-2*n+s+a)*l+(-3*i+3*n-2*s-a)*o+s*t+i}function o0(t,e){var i=1-t;return i*i*e}function l0(t,e){return 2*(1-t)*t*e}function c0(t,e){return t*t*e}function pr(t,e,i,n){return o0(t,e)+l0(t,i)+c0(t,n)}function h0(t,e){var i=1-t;return i*i*i*e}function u0(t,e){var i=1-t;return 3*i*i*t*e}function f0(t,e){return 3*(1-t)*t*t*e}function d0(t,e){return t*t*t*e}function mr(t,e,i,n,r){return h0(t,e)+u0(t,i)+f0(t,n)+d0(t,r)}function Ci(t,e,i,n){_e.call(this),this.type="CubicBezierCurve",this.v0=t||new X,this.v1=e||new X,this.v2=i||new X,this.v3=n||new X}Ci.prototype=Object.create(_e.prototype);Ci.prototype.constructor=Ci;Ci.prototype.isCubicBezierCurve=!0;Ci.prototype.getPoint=function(t,e){var i=e||new X,n=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set(mr(t,n.x,r.x,s.x,a.x),mr(t,n.y,r.y,s.y,a.y)),i};Ci.prototype.copy=function(t){return _e.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this};Ci.prototype.toJSON=function(){var t=_e.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t};Ci.prototype.fromJSON=function(t){return _e.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this};function zi(t,e,i,n){_e.call(this),this.type="CubicBezierCurve3",this.v0=t||new S,this.v1=e||new S,this.v2=i||new S,this.v3=n||new S}zi.prototype=Object.create(_e.prototype);zi.prototype.constructor=zi;zi.prototype.isCubicBezierCurve3=!0;zi.prototype.getPoint=function(t,e){var i=e||new S,n=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set(mr(t,n.x,r.x,s.x,a.x),mr(t,n.y,r.y,s.y,a.y),mr(t,n.z,r.z,s.z,a.z)),i};zi.prototype.copy=function(t){return _e.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this};zi.prototype.toJSON=function(){var t=_e.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t};zi.prototype.fromJSON=function(t){return _e.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this};function ni(t,e){_e.call(this),this.type="LineCurve",this.v1=t||new X,this.v2=e||new X}ni.prototype=Object.create(_e.prototype);ni.prototype.constructor=ni;ni.prototype.isLineCurve=!0;ni.prototype.getPoint=function(t,e){var i=e||new X;return t===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i};ni.prototype.getPointAt=function(t,e){return this.getPoint(t,e)};ni.prototype.getTangent=function(){var t=this.v2.clone().sub(this.v1);return t.normalize()};ni.prototype.copy=function(t){return _e.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this};ni.prototype.toJSON=function(){var t=_e.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t};ni.prototype.fromJSON=function(t){return _e.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this};function Di(t,e){_e.call(this),this.type="LineCurve3",this.v1=t||new S,this.v2=e||new S}Di.prototype=Object.create(_e.prototype);Di.prototype.constructor=Di;Di.prototype.isLineCurve3=!0;Di.prototype.getPoint=function(t,e){var i=e||new S;return t===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i};Di.prototype.getPointAt=function(t,e){return this.getPoint(t,e)};Di.prototype.copy=function(t){return _e.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this};Di.prototype.toJSON=function(){var t=_e.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t};Di.prototype.fromJSON=function(t){return _e.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this};function Pi(t,e,i){_e.call(this),this.type="QuadraticBezierCurve",this.v0=t||new X,this.v1=e||new X,this.v2=i||new X}Pi.prototype=Object.create(_e.prototype);Pi.prototype.constructor=Pi;Pi.prototype.isQuadraticBezierCurve=!0;Pi.prototype.getPoint=function(t,e){var i=e||new X,n=this.v0,r=this.v1,s=this.v2;return i.set(pr(t,n.x,r.x,s.x),pr(t,n.y,r.y,s.y)),i};Pi.prototype.copy=function(t){return _e.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this};Pi.prototype.toJSON=function(){var t=_e.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t};Pi.prototype.fromJSON=function(t){return _e.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this};function Wi(t,e,i){_e.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new S,this.v1=e||new S,this.v2=i||new S}Wi.prototype=Object.create(_e.prototype);Wi.prototype.constructor=Wi;Wi.prototype.isQuadraticBezierCurve3=!0;Wi.prototype.getPoint=function(t,e){var i=e||new S,n=this.v0,r=this.v1,s=this.v2;return i.set(pr(t,n.x,r.x,s.x),pr(t,n.y,r.y,s.y),pr(t,n.z,r.z,s.z)),i};Wi.prototype.copy=function(t){return _e.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this};Wi.prototype.toJSON=function(){var t=_e.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t};Wi.prototype.fromJSON=function(t){return _e.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this};function Oi(t){_e.call(this),this.type="SplineCurve",this.points=t||[]}Oi.prototype=Object.create(_e.prototype);Oi.prototype.constructor=Oi;Oi.prototype.isSplineCurve=!0;Oi.prototype.getPoint=function(t,e){var i=e||new X,n=this.points,r=(n.length-1)*t,s=Math.floor(r),a=r-s,o=n[s===0?s:s-1],l=n[s],c=n[s>n.length-2?n.length-1:s+1],h=n[s>n.length-3?n.length-1:s+2];return i.set(Ic(a,o.x,l.x,c.x,h.x),Ic(a,o.y,l.y,c.y,h.y)),i};Oi.prototype.copy=function(t){_e.prototype.copy.call(this,t),this.points=[];for(var e=0,i=t.points.length;e<i;e++){var n=t.points[e];this.points.push(n.clone())}return this};Oi.prototype.toJSON=function(){var t=_e.prototype.toJSON.call(this);t.points=[];for(var e=0,i=this.points.length;e<i;e++){var n=this.points[e];t.points.push(n.toArray())}return t};Oi.prototype.fromJSON=function(t){_e.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,i=t.points.length;e<i;e++){var n=t.points[e];this.points.push(new X().fromArray(n))}return this};var Vo=Object.freeze({ArcCurve:jr,CatmullRomCurve3:ii,CubicBezierCurve:Ci,CubicBezierCurve3:zi,EllipseCurve:hi,LineCurve:ni,LineCurve3:Di,QuadraticBezierCurve:Pi,QuadraticBezierCurve3:Wi,SplineCurve:Oi});function Zi(){_e.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}Zi.prototype=Object.assign(Object.create(_e.prototype),{constructor:Zi,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new ni(e,t))},getPoint:function(t){for(var e=t*this.getLength(),i=this.getCurveLengths(),n=0;n<i.length;){if(i[n]>=e){var r=i[n]-e,s=this.curves[n],a=s.getLength(),o=a===0?0:1-r/a;return s.getPointAt(o)}n++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){t===void 0&&(t=40);for(var e=[],i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e=[],i,n=0,r=this.curves;n<r.length;n++)for(var s=r[n],a=s&&s.isEllipseCurve?t*2:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?t*s.points.length:t,o=s.getPoints(a),l=0;l<o.length;l++){var c=o[l];i&&i.equals(c)||(e.push(c),i=c)}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e},copy:function(t){_e.prototype.copy.call(this,t),this.curves=[];for(var e=0,i=t.curves.length;e<i;e++){var n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this},toJSON:function(){var t=_e.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var e=0,i=this.curves.length;e<i;e++){var n=this.curves[e];t.curves.push(n.toJSON())}return t},fromJSON:function(t){_e.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var e=0,i=t.curves.length;e<i;e++){var n=t.curves[e];this.curves.push(new Vo[n.type]().fromJSON(n))}return this}});function bi(t){Zi.call(this),this.type="Path",this.currentPoint=new X,t&&this.setFromPoints(t)}bi.prototype=Object.assign(Object.create(Zi.prototype),{constructor:bi,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y)},moveTo:function(t,e){this.currentPoint.set(t,e)},lineTo:function(t,e){var i=new ni(this.currentPoint.clone(),new X(t,e));this.curves.push(i),this.currentPoint.set(t,e)},quadraticCurveTo:function(t,e,i,n){var r=new Pi(this.currentPoint.clone(),new X(t,e),new X(i,n));this.curves.push(r),this.currentPoint.set(i,n)},bezierCurveTo:function(t,e,i,n,r,s){var a=new Ci(this.currentPoint.clone(),new X(t,e),new X(i,n),new X(r,s));this.curves.push(a),this.currentPoint.set(r,s)},splineThru:function(t){var e=[this.currentPoint.clone()].concat(t),i=new Oi(e);this.curves.push(i),this.currentPoint.copy(t[t.length-1])},arc:function(t,e,i,n,r,s){var a=this.currentPoint.x,o=this.currentPoint.y;this.absarc(t+a,e+o,i,n,r,s)},absarc:function(t,e,i,n,r,s){this.absellipse(t,e,i,i,n,r,s)},ellipse:function(t,e,i,n,r,s,a,o){var l=this.currentPoint.x,c=this.currentPoint.y;this.absellipse(t+l,e+c,i,n,r,s,a,o)},absellipse:function(t,e,i,n,r,s,a,o){var l=new hi(t,e,i,n,r,s,a,o);if(this.curves.length>0){var c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);var h=l.getPoint(1);this.currentPoint.copy(h)},copy:function(t){return Zi.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){var t=Zi.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return Zi.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}});function un(t){bi.call(this,t),this.uuid=Te.generateUUID(),this.type="Shape",this.holes=[]}un.prototype=Object.assign(Object.create(bi.prototype),{constructor:un,getPointsHoles:function(t){for(var e=[],i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){bi.prototype.copy.call(this,t),this.holes=[];for(var e=0,i=t.holes.length;e<i;e++){var n=t.holes[e];this.holes.push(n.clone())}return this},toJSON:function(){var t=bi.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(var e=0,i=this.holes.length;e<i;e++){var n=this.holes[e];t.holes.push(n.toJSON())}return t},fromJSON:function(t){bi.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(var e=0,i=t.holes.length;e<i;e++){var n=t.holes[e];this.holes.push(new bi().fromJSON(n))}return this}});function ot(t,e){ce.call(this),this.type="Light",this.color=new me(t),this.intensity=e!==void 0?e:1,this.receiveShadow=void 0}ot.prototype=Object.assign(Object.create(ce.prototype),{constructor:ot,isLight:!0,copy:function(t){return ce.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){var e=ce.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}});function zo(t,e,i){ot.call(this,t,i),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(ce.DefaultUp),this.updateMatrix(),this.groundColor=new me(e)}zo.prototype=Object.assign(Object.create(ot.prototype),{constructor:zo,isHemisphereLight:!0,copy:function(t){return ot.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}});function lr(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new X(512,512),this.map=null,this.matrix=new we}Object.assign(lr.prototype,{copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var t={};return this.bias!==0&&(t.bias=this.bias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}});function Wo(){lr.call(this,new ct(50,1,.5,500))}Wo.prototype=Object.assign(Object.create(lr.prototype),{constructor:Wo,isSpotLightShadow:!0,update:function(t){var e=this.camera,i=Te.RAD2DEG*2*t.angle,n=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;(i!==e.fov||n!==e.aspect||r!==e.far)&&(e.fov=i,e.aspect=n,e.far=r,e.updateProjectionMatrix())}});function jo(t,e,i,n,r,s){ot.call(this,t,e),this.type="SpotLight",this.position.copy(ce.DefaultUp),this.updateMatrix(),this.target=new ce,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(a){this.intensity=a/Math.PI}}),this.distance=i!==void 0?i:0,this.angle=n!==void 0?n:Math.PI/3,this.penumbra=r!==void 0?r:0,this.decay=s!==void 0?s:1,this.shadow=new Wo}jo.prototype=Object.assign(Object.create(ot.prototype),{constructor:jo,isSpotLight:!0,copy:function(t){return ot.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}});function $o(t,e,i,n){ot.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return this.intensity*4*Math.PI},set:function(r){this.intensity=r/(4*Math.PI)}}),this.distance=i!==void 0?i:0,this.decay=n!==void 0?n:1,this.shadow=new lr(new ct(90,1,.5,500))}$o.prototype=Object.assign(Object.create(ot.prototype),{constructor:$o,isPointLight:!0,copy:function(t){return ot.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}});function en(t,e,i,n,r,s){Gi.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t!==void 0?t:-1,this.right=e!==void 0?e:1,this.top=i!==void 0?i:1,this.bottom=n!==void 0?n:-1,this.near=r!==void 0?r:.1,this.far=s!==void 0?s:2e3,this.updateProjectionMatrix()}en.prototype=Object.assign(Object.create(Gi.prototype),{constructor:en,isOrthographicCamera:!0,copy:function(t,e){return Gi.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this},setViewOffset:function(t,e,i,n,r,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2,r=i-t,s=i+t,a=n+e,o=n-e;if(this.view!==null&&this.view.enabled){var l=this.zoom/(this.view.width/this.view.fullWidth),c=this.zoom/(this.view.height/this.view.fullHeight),h=(this.right-this.left)/this.view.width,u=(this.top-this.bottom)/this.view.height;r+=h*(this.view.offsetX/l),s=r+h*(this.view.width/l),a-=u*(this.view.offsetY/c),o=a-u*(this.view.height/c)}this.projectionMatrix.makeOrthographic(r,s,a,o,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){var e=ce.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}});function Yo(){lr.call(this,new en(-5,5,5,-5,.5,500))}Yo.prototype=Object.assign(Object.create(lr.prototype),{constructor:Yo});function Ko(t,e){ot.call(this,t,e),this.type="DirectionalLight",this.position.copy(ce.DefaultUp),this.updateMatrix(),this.target=new ce,this.shadow=new Yo}Ko.prototype=Object.assign(Object.create(ot.prototype),{constructor:Ko,isDirectionalLight:!0,copy:function(t){return ot.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}});function Xo(t,e){ot.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}Xo.prototype=Object.assign(Object.create(ot.prototype),{constructor:Xo,isAmbientLight:!0});function qo(t,e,i,n){ot.call(this,t,e),this.type="RectAreaLight",this.width=i!==void 0?i:10,this.height=n!==void 0?n:10}qo.prototype=Object.assign(Object.create(ot.prototype),{constructor:qo,isRectAreaLight:!0,copy:function(t){return ot.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){var e=ot.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}});function Ol(t){this.manager=t!==void 0?t:ri,this.textures={}}Object.assign(Ol.prototype,{load:function(t,e,i,n){var r=this,s=new ji(r.manager);s.setPath(r.path),s.load(t,function(a){e(r.parse(JSON.parse(a)))},i,n)},parse:function(t){var e=this.textures;function i(l){return e[l]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",l),e[l]}var n=new t0[t.type];if(t.uuid!==void 0&&(n.uuid=t.uuid),t.name!==void 0&&(n.name=t.name),t.color!==void 0&&n.color.setHex(t.color),t.roughness!==void 0&&(n.roughness=t.roughness),t.metalness!==void 0&&(n.metalness=t.metalness),t.emissive!==void 0&&n.emissive.setHex(t.emissive),t.specular!==void 0&&n.specular.setHex(t.specular),t.shininess!==void 0&&(n.shininess=t.shininess),t.clearCoat!==void 0&&(n.clearCoat=t.clearCoat),t.clearCoatRoughness!==void 0&&(n.clearCoatRoughness=t.clearCoatRoughness),t.vertexColors!==void 0&&(n.vertexColors=t.vertexColors),t.fog!==void 0&&(n.fog=t.fog),t.flatShading!==void 0&&(n.flatShading=t.flatShading),t.blending!==void 0&&(n.blending=t.blending),t.combine!==void 0&&(n.combine=t.combine),t.side!==void 0&&(n.side=t.side),t.opacity!==void 0&&(n.opacity=t.opacity),t.transparent!==void 0&&(n.transparent=t.transparent),t.alphaTest!==void 0&&(n.alphaTest=t.alphaTest),t.depthTest!==void 0&&(n.depthTest=t.depthTest),t.depthWrite!==void 0&&(n.depthWrite=t.depthWrite),t.colorWrite!==void 0&&(n.colorWrite=t.colorWrite),t.wireframe!==void 0&&(n.wireframe=t.wireframe),t.wireframeLinewidth!==void 0&&(n.wireframeLinewidth=t.wireframeLinewidth),t.wireframeLinecap!==void 0&&(n.wireframeLinecap=t.wireframeLinecap),t.wireframeLinejoin!==void 0&&(n.wireframeLinejoin=t.wireframeLinejoin),t.rotation!==void 0&&(n.rotation=t.rotation),t.linewidth!==1&&(n.linewidth=t.linewidth),t.dashSize!==void 0&&(n.dashSize=t.dashSize),t.gapSize!==void 0&&(n.gapSize=t.gapSize),t.scale!==void 0&&(n.scale=t.scale),t.polygonOffset!==void 0&&(n.polygonOffset=t.polygonOffset),t.polygonOffsetFactor!==void 0&&(n.polygonOffsetFactor=t.polygonOffsetFactor),t.polygonOffsetUnits!==void 0&&(n.polygonOffsetUnits=t.polygonOffsetUnits),t.skinning!==void 0&&(n.skinning=t.skinning),t.morphTargets!==void 0&&(n.morphTargets=t.morphTargets),t.dithering!==void 0&&(n.dithering=t.dithering),t.visible!==void 0&&(n.visible=t.visible),t.userData!==void 0&&(n.userData=t.userData),t.uniforms!==void 0)for(var r in t.uniforms){var s=t.uniforms[r];switch(n.uniforms[r]={},s.type){case"t":n.uniforms[r].value=i(s.value);break;case"c":n.uniforms[r].value=new me().setHex(s.value);break;case"v2":n.uniforms[r].value=new X().fromArray(s.value);break;case"v3":n.uniforms[r].value=new S().fromArray(s.value);break;case"v4":n.uniforms[r].value=new et().fromArray(s.value);break;case"m3":n.uniforms[r].value=new Rt().fromArray(s.value);case"m4":n.uniforms[r].value=new we().fromArray(s.value);break;default:n.uniforms[r].value=s.value}}if(t.defines!==void 0&&(n.defines=t.defines),t.vertexShader!==void 0&&(n.vertexShader=t.vertexShader),t.fragmentShader!==void 0&&(n.fragmentShader=t.fragmentShader),t.extensions!==void 0)for(var a in t.extensions)n.extensions[a]=t.extensions[a];if(t.shading!==void 0&&(n.flatShading=t.shading===1),t.size!==void 0&&(n.size=t.size),t.sizeAttenuation!==void 0&&(n.sizeAttenuation=t.sizeAttenuation),t.map!==void 0&&(n.map=i(t.map)),t.matcap!==void 0&&(n.matcap=i(t.matcap)),t.alphaMap!==void 0&&(n.alphaMap=i(t.alphaMap),n.transparent=!0),t.bumpMap!==void 0&&(n.bumpMap=i(t.bumpMap)),t.bumpScale!==void 0&&(n.bumpScale=t.bumpScale),t.normalMap!==void 0&&(n.normalMap=i(t.normalMap)),t.normalMapType!==void 0&&(n.normalMapType=t.normalMapType),t.normalScale!==void 0){var o=t.normalScale;Array.isArray(o)===!1&&(o=[o,o]),n.normalScale=new X().fromArray(o)}return t.displacementMap!==void 0&&(n.displacementMap=i(t.displacementMap)),t.displacementScale!==void 0&&(n.displacementScale=t.displacementScale),t.displacementBias!==void 0&&(n.displacementBias=t.displacementBias),t.roughnessMap!==void 0&&(n.roughnessMap=i(t.roughnessMap)),t.metalnessMap!==void 0&&(n.metalnessMap=i(t.metalnessMap)),t.emissiveMap!==void 0&&(n.emissiveMap=i(t.emissiveMap)),t.emissiveIntensity!==void 0&&(n.emissiveIntensity=t.emissiveIntensity),t.specularMap!==void 0&&(n.specularMap=i(t.specularMap)),t.envMap!==void 0&&(n.envMap=i(t.envMap)),t.envMapIntensity!==void 0&&(n.envMapIntensity=t.envMapIntensity),t.reflectivity!==void 0&&(n.reflectivity=t.reflectivity),t.lightMap!==void 0&&(n.lightMap=i(t.lightMap)),t.lightMapIntensity!==void 0&&(n.lightMapIntensity=t.lightMapIntensity),t.aoMap!==void 0&&(n.aoMap=i(t.aoMap)),t.aoMapIntensity!==void 0&&(n.aoMapIntensity=t.aoMapIntensity),t.gradientMap!==void 0&&(n.gradientMap=i(t.gradientMap)),n},setPath:function(t){return this.path=t,this},setTextures:function(t){return this.textures=t,this}});var Eu={decodeText:function(t){if(typeof TextDecoder<"u")return new TextDecoder().decode(t);for(var e="",i=0,n=t.length;i<n;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch{return e}},extractUrlBase:function(t){var e=t.lastIndexOf("/");return e===-1?"./":t.substr(0,e+1)}};function Zo(){he.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}Zo.prototype=Object.assign(Object.create(he.prototype),{constructor:Zo,isInstancedBufferGeometry:!0,copy:function(t){return he.prototype.copy.call(this,t),this.maxInstancedCount=t.maxInstancedCount,this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var t=he.prototype.toJSON.call(this);return t.maxInstancedCount=this.maxInstancedCount,t.isInstancedBufferGeometry=!0,t}});function Jo(t,e,i,n){typeof i=="number"&&(n=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),Fe.call(this,t,e,i),this.meshPerAttribute=n||1}Jo.prototype=Object.assign(Object.create(Fe.prototype),{constructor:Jo,isInstancedBufferAttribute:!0,copy:function(t){return Fe.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){var t=Fe.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}});function bu(t){this.manager=t!==void 0?t:ri}Object.assign(bu.prototype,{load:function(t,e,i,n){var r=this,s=new ji(r.manager);s.setPath(r.path),s.load(t,function(a){e(r.parse(JSON.parse(a)))},i,n)},parse:function(t){var e=t.isInstancedBufferGeometry?new Zo:new he,i=t.data.index;if(i!==void 0){var n=new za[i.type](i.array);e.setIndex(new Fe(n,1))}var r=t.data.attributes;for(var s in r){var a=r[s],n=new za[a.type](a.array),o=a.isInstancedBufferAttribute?Jo:Fe,l=new o(n,a.itemSize,a.normalized);a.name!==void 0&&(l.name=a.name),e.addAttribute(s,l)}var c=t.data.morphAttributes;if(c)for(var s in c){for(var h=c[s],u=[],f=0,d=h.length;f<d;f++){var a=h[f],n=new za[a.type](a.array),l=new Fe(n,a.itemSize,a.normalized);a.name!==void 0&&(l.name=a.name),u.push(l)}e.morphAttributes[s]=u}var p=t.data.groups||t.data.drawcalls||t.data.offsets;if(p!==void 0)for(var f=0,m=p.length;f!==m;++f){var g=p[f];e.addGroup(g.start,g.count,g.materialIndex)}var v=t.data.boundingSphere;if(v!==void 0){var x=new S;v.center!==void 0&&x.fromArray(v.center),e.boundingSphere=new Ui(x,v.radius)}return t.name&&(e.name=t.name),t.userData&&(e.userData=t.userData),e},setPath:function(t){return this.path=t,this}});var za={Int8Array,Uint8Array,Uint8ClampedArray:typeof Uint8ClampedArray<"u"?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Tu(t){this.manager=t!==void 0?t:ri,this.resourcePath=""}Object.assign(Tu.prototype,{crossOrigin:"anonymous",load:function(t,e,i,n){var r=this,s=this.path===void 0?Eu.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||s;var a=new ji(r.manager);a.setPath(this.path),a.load(t,function(o){var l=null;try{l=JSON.parse(o)}catch(h){n!==void 0&&n(h),console.error("THREE:ObjectLoader: Can't parse "+t+".",h.message);return}var c=l.metadata;if(c===void 0||c.type===void 0||c.type.toLowerCase()==="geometry"){console.error("THREE.ObjectLoader: Can't load "+t);return}r.parse(l,e)},i,n)},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setCrossOrigin:function(t){return this.crossOrigin=t,this},parse:function(t,e){var i=this.parseShape(t.shapes),n=this.parseGeometries(t.geometries,i),r=this.parseImages(t.images,function(){e!==void 0&&e(o)}),s=this.parseTextures(t.textures,r),a=this.parseMaterials(t.materials,s),o=this.parseObject(t.object,n,a);return t.animations&&(o.animations=this.parseAnimations(t.animations)),(t.images===void 0||t.images.length===0)&&e!==void 0&&e(o),o},parseShape:function(t){var e={};if(t!==void 0)for(var i=0,n=t.length;i<n;i++){var r=new un().fromJSON(t[i]);e[r.uuid]=r}return e},parseGeometries:function(t,e){var i={};if(t!==void 0)for(var n=new bu,r=0,s=t.length;r<s;r++){var a,o=t[r];switch(o.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new Bt[o.type](o.width,o.height,o.widthSegments,o.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new Bt[o.type](o.width,o.height,o.depth,o.widthSegments,o.heightSegments,o.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new Bt[o.type](o.radius,o.segments,o.thetaStart,o.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new Bt[o.type](o.radiusTop,o.radiusBottom,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new Bt[o.type](o.radius,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new Bt[o.type](o.radius,o.widthSegments,o.heightSegments,o.phiStart,o.phiLength,o.thetaStart,o.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new Bt[o.type](o.radius,o.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new Bt[o.type](o.innerRadius,o.outerRadius,o.thetaSegments,o.phiSegments,o.thetaStart,o.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new Bt[o.type](o.radius,o.tube,o.radialSegments,o.tubularSegments,o.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new Bt[o.type](o.radius,o.tube,o.tubularSegments,o.radialSegments,o.p,o.q);break;case"TubeGeometry":case"TubeBufferGeometry":a=new Bt[o.type](new Vo[o.path.type]().fromJSON(o.path),o.tubularSegments,o.radius,o.radialSegments,o.closed);break;case"LatheGeometry":case"LatheBufferGeometry":a=new Bt[o.type](o.points,o.segments,o.phiStart,o.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new Bt[o.type](o.vertices,o.indices,o.radius,o.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var u=[],l=0,c=o.shapes.length;l<c;l++){var h=e[o.shapes[l]];u.push(h)}a=new Bt[o.type](u,o.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(var u=[],l=0,c=o.shapes.length;l<c;l++){var h=e[o.shapes[l]];u.push(h)}var f=o.options.extrudePath;f!==void 0&&(o.options.extrudePath=new Vo[f.type]().fromJSON(f)),a=new Bt[o.type](u,o.options);break;case"BufferGeometry":case"InstancedBufferGeometry":a=n.parse(o);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE){var d=new THREE.LegacyJSONLoader;a=d.parse(o,this.resourcePath).geometry}else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+o.type+'"');continue}a.uuid=o.uuid,o.name!==void 0&&(a.name=o.name),a.isBufferGeometry===!0&&o.userData!==void 0&&(a.userData=o.userData),i[o.uuid]=a}return i},parseMaterials:function(t,e){var i={},n={};if(t!==void 0){var r=new Ol;r.setTextures(e);for(var s=0,a=t.length;s<a;s++){var o=t[s];if(o.type==="MultiMaterial"){for(var l=[],c=0;c<o.materials.length;c++){var h=o.materials[c];i[h.uuid]===void 0&&(i[h.uuid]=r.parse(h)),l.push(i[h.uuid])}n[o.uuid]=l}else i[o.uuid]===void 0&&(i[o.uuid]=r.parse(o)),n[o.uuid]=i[o.uuid]}}return n},parseAnimations:function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i],r=mi.parse(n);n.uuid!==void 0&&(r.uuid=n.uuid),e.push(r)}return e},parseImages:function(t,e){var i=this,n={};function r(m){return i.manager.itemStart(m),a.load(m,function(){i.manager.itemEnd(m)},void 0,function(){i.manager.itemError(m),i.manager.itemEnd(m)})}if(t!==void 0&&t.length>0){var s=new yu(e),a=new Sa(s);a.setCrossOrigin(this.crossOrigin);for(var o=0,l=t.length;o<l;o++){var c=t[o],h=c.url;if(Array.isArray(h)){n[c.uuid]=[];for(var u=0,f=h.length;u<f;u++){var d=h[u],p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(d)?d:i.resourcePath+d;n[c.uuid].push(r(p))}}else{var p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c.url)?c.url:i.resourcePath+c.url;n[c.uuid]=r(p)}}}return n},parseTextures:function(t,e){function i(l,c){return typeof l=="number"?l:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",l),c[l])}var n={};if(t!==void 0)for(var r=0,s=t.length;r<s;r++){var a=t[r];a.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),e[a.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",a.image);var o;Array.isArray(e[a.image])?o=new Mi(e[a.image]):o=new Ye(e[a.image]),o.needsUpdate=!0,o.uuid=a.uuid,a.name!==void 0&&(o.name=a.name),a.mapping!==void 0&&(o.mapping=i(a.mapping,p0)),a.offset!==void 0&&o.offset.fromArray(a.offset),a.repeat!==void 0&&o.repeat.fromArray(a.repeat),a.center!==void 0&&o.center.fromArray(a.center),a.rotation!==void 0&&(o.rotation=a.rotation),a.wrap!==void 0&&(o.wrapS=i(a.wrap[0],Cc),o.wrapT=i(a.wrap[1],Cc)),a.format!==void 0&&(o.format=a.format),a.type!==void 0&&(o.type=a.type),a.encoding!==void 0&&(o.encoding=a.encoding),a.minFilter!==void 0&&(o.minFilter=i(a.minFilter,Dc)),a.magFilter!==void 0&&(o.magFilter=i(a.magFilter,Dc)),a.anisotropy!==void 0&&(o.anisotropy=a.anisotropy),a.flipY!==void 0&&(o.flipY=a.flipY),a.premultiplyAlpha!==void 0&&(o.premultiplyAlpha=a.premultiplyAlpha),a.unpackAlignment!==void 0&&(o.unpackAlignment=a.unpackAlignment),n[a.uuid]=o}return n},parseObject:function(t,e,i){var n;function r(p){return e[p]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",p),e[p]}function s(p){if(p!==void 0){if(Array.isArray(p)){for(var m=[],g=0,v=p.length;g<v;g++){var x=p[g];i[x]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",x),m.push(i[x])}return m}return i[p]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",p),i[p]}}switch(t.type){case"Scene":n=new zn,t.background!==void 0&&Number.isInteger(t.background)&&(n.background=new me(t.background)),t.fog!==void 0&&(t.fog.type==="Fog"?n.fog=new Io(t.fog.color,t.fog.near,t.fog.far):t.fog.type==="FogExp2"&&(n.fog=new Ro(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":n=new ct(t.fov,t.aspect,t.near,t.far),t.focus!==void 0&&(n.focus=t.focus),t.zoom!==void 0&&(n.zoom=t.zoom),t.filmGauge!==void 0&&(n.filmGauge=t.filmGauge),t.filmOffset!==void 0&&(n.filmOffset=t.filmOffset),t.view!==void 0&&(n.view=Object.assign({},t.view));break;case"OrthographicCamera":n=new en(t.left,t.right,t.top,t.bottom,t.near,t.far),t.zoom!==void 0&&(n.zoom=t.zoom),t.view!==void 0&&(n.view=Object.assign({},t.view));break;case"AmbientLight":n=new Xo(t.color,t.intensity);break;case"DirectionalLight":n=new Ko(t.color,t.intensity);break;case"PointLight":n=new $o(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":n=new qo(t.color,t.intensity,t.width,t.height);break;case"SpotLight":n=new jo(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":n=new zo(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var a=r(t.geometry),o=s(t.material);a.bones&&a.bones.length>0?n=new Ns(a,o):n=new Et(a,o),t.drawMode!==void 0&&n.setDrawMode(t.drawMode);break;case"LOD":n=new ks;break;case"Line":n=new kt(r(t.geometry),s(t.material),t.mode);break;case"LineLoop":n=new Do(r(t.geometry),s(t.material));break;case"LineSegments":n=new ut(r(t.geometry),s(t.material));break;case"PointCloud":case"Points":n=new Po(r(t.geometry),s(t.material));break;case"Sprite":n=new vn(s(t.material));break;case"Group":n=new Ar;break;default:n=new ce}if(n.uuid=t.uuid,t.name!==void 0&&(n.name=t.name),t.matrix!==void 0?(n.matrix.fromArray(t.matrix),t.matrixAutoUpdate!==void 0&&(n.matrixAutoUpdate=t.matrixAutoUpdate),n.matrixAutoUpdate&&n.matrix.decompose(n.position,n.quaternion,n.scale)):(t.position!==void 0&&n.position.fromArray(t.position),t.rotation!==void 0&&n.rotation.fromArray(t.rotation),t.quaternion!==void 0&&n.quaternion.fromArray(t.quaternion),t.scale!==void 0&&n.scale.fromArray(t.scale)),t.castShadow!==void 0&&(n.castShadow=t.castShadow),t.receiveShadow!==void 0&&(n.receiveShadow=t.receiveShadow),t.shadow&&(t.shadow.bias!==void 0&&(n.shadow.bias=t.shadow.bias),t.shadow.radius!==void 0&&(n.shadow.radius=t.shadow.radius),t.shadow.mapSize!==void 0&&n.shadow.mapSize.fromArray(t.shadow.mapSize),t.shadow.camera!==void 0&&(n.shadow.camera=this.parseObject(t.shadow.camera))),t.visible!==void 0&&(n.visible=t.visible),t.frustumCulled!==void 0&&(n.frustumCulled=t.frustumCulled),t.renderOrder!==void 0&&(n.renderOrder=t.renderOrder),t.userData!==void 0&&(n.userData=t.userData),t.layers!==void 0&&(n.layers.mask=t.layers),t.children!==void 0)for(var l=t.children,c=0;c<l.length;c++)n.add(this.parseObject(l[c],e,i));if(t.type==="LOD")for(var h=t.levels,u=0;u<h.length;u++){var f=h[u],d=n.getObjectByProperty("uuid",f.object);d!==void 0&&n.addLevel(d,f.distance)}return n}});var p0={UVMapping:bl,CubeReflectionMapping:Tl,CubeRefractionMapping:Eo,EquirectangularReflectionMapping:qh,EquirectangularRefractionMapping:bo,SphericalReflectionMapping:Zh,CubeUVReflectionMapping:_l,CubeUVRefractionMapping:wl},Cc={RepeatWrapping:qi,ClampToEdgeWrapping:qt,MirroredRepeatWrapping:Un},Dc={NearestFilter:Mt,NearestMipMapNearestFilter:Al,NearestMipMapLinearFilter:Sl,LinearFilter:ht,LinearMipMapNearestFilter:Jh,LinearMipMapLinearFilter:_a};function Pc(t){typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.manager=t!==void 0?t:ri,this.options=void 0}Pc.prototype={constructor:Pc,setOptions:function(e){return this.options=e,this},load:function(t,e,i,n){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);var r=this,s=Gt.get(t);if(s!==void 0)return r.manager.itemStart(t),setTimeout(function(){e&&e(s),r.manager.itemEnd(t)},0),s;fetch(t).then(function(a){return a.blob()}).then(function(a){return r.options===void 0?createImageBitmap(a):createImageBitmap(a,r.options)}).then(function(a){Gt.add(t,a),e&&e(a),r.manager.itemEnd(t)}).catch(function(a){n&&n(a),r.manager.itemError(t),r.manager.itemEnd(t)}),r.manager.itemStart(t)},setCrossOrigin:function(){return this},setPath:function(t){return this.path=t,this}};function _u(){this.type="ShapePath",this.color=new me,this.subPaths=[],this.currentPath=null}Object.assign(_u.prototype,{moveTo:function(t,e){this.currentPath=new bi,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e)},lineTo:function(t,e){this.currentPath.lineTo(t,e)},quadraticCurveTo:function(t,e,i,n){this.currentPath.quadraticCurveTo(t,e,i,n)},bezierCurveTo:function(t,e,i,n,r,s){this.currentPath.bezierCurveTo(t,e,i,n,r,s)},splineThru:function(t){this.currentPath.splineThru(t)},toShapes:function(t,e){function i(K){for(var z=[],$=0,k=K.length;$<k;$++){var G=K[$],q=new un;q.curves=G.curves,z.push(q)}return z}function n(K,z){for(var $=z.length,k=!1,G=$-1,q=0;q<$;G=q++){var ee=z[G],Q=z[q],ae=Q.x-ee.x,V=Q.y-ee.y;if(Math.abs(V)>Number.EPSILON){if(V<0&&(ee=z[q],ae=-ae,Q=z[G],V=-V),K.y<ee.y||K.y>Q.y)continue;if(K.y===ee.y){if(K.x===ee.x)return!0}else{var oe=V*(K.x-ee.x)-ae*(K.y-ee.y);if(oe===0)return!0;if(oe<0)continue;k=!k}}else{if(K.y!==ee.y)continue;if(Q.x<=K.x&&K.x<=ee.x||ee.x<=K.x&&K.x<=Q.x)return!0}}return k}var r=Qi.isClockWise,s=this.subPaths;if(s.length===0)return[];if(e===!0)return i(s);var a,o,l,c=[];if(s.length===1)return o=s[0],l=new un,l.curves=o.curves,c.push(l),c;var h=!r(s[0].getPoints());h=t?!h:h;var u=[],f=[],d=[],p=0,m;f[p]=void 0,d[p]=[];for(var g=0,v=s.length;g<v;g++)o=s[g],m=o.getPoints(),a=r(m),a=t?!a:a,a?(!h&&f[p]&&p++,f[p]={s:new un,p:m},f[p].s.curves=o.curves,h&&p++,d[p]=[]):d[p].push({h:o,p:m[0]});if(!f[0])return i(s);if(f.length>1){for(var x=!1,y=[],b=0,E=f.length;b<E;b++)u[b]=[];for(var b=0,E=f.length;b<E;b++)for(var w=d[b],A=0;A<w.length;A++){for(var D=w[A],O=!0,P=0;P<f.length;P++)n(D.p,f[P].p)&&(b!==P&&y.push({froms:b,tos:P,hole:A}),O?(O=!1,u[P].push(D)):x=!0);O&&u[b].push(D)}y.length>0&&(x||(d=u))}for(var L,g=0,C=f.length;g<C;g++){l=f[g].s,c.push(l),L=d[g];for(var U=0,j=L.length;U<j;U++)l.holes.push(L[U].h)}return c}});function wu(t){this.type="Font",this.data=t}Object.assign(wu.prototype,{isFont:!0,generateShapes:function(t,e){e===void 0&&(e=100);for(var i=[],n=m0(t,e,this.data),r=0,s=n.length;r<s;r++)Array.prototype.push.apply(i,n[r].toShapes());return i}});function m0(t,e,i){for(var n=Array.from?Array.from(t):String(t).split(""),r=e/i.resolution,s=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*r,a=[],o=0,l=0,c=0;c<n.length;c++){var h=n[c];if(h===`
`)o=0,l-=s;else{var u=g0(h,r,o,l,i);o+=u.offsetX,a.push(u.path)}}return a}function g0(t,e,i,n,r){var s=r.glyphs[t]||r.glyphs["?"];if(s){var a=new _u,o,l,c,h,u,f,d,p;if(s.o)for(var m=s._cachedOutline||(s._cachedOutline=s.o.split(" ")),g=0,v=m.length;g<v;){var x=m[g++];switch(x){case"m":o=m[g++]*e+i,l=m[g++]*e+n,a.moveTo(o,l);break;case"l":o=m[g++]*e+i,l=m[g++]*e+n,a.lineTo(o,l);break;case"q":c=m[g++]*e+i,h=m[g++]*e+n,u=m[g++]*e+i,f=m[g++]*e+n,a.quadraticCurveTo(u,f,c,h);break;case"b":c=m[g++]*e+i,h=m[g++]*e+n,u=m[g++]*e+i,f=m[g++]*e+n,d=m[g++]*e+i,p=m[g++]*e+n,a.bezierCurveTo(u,f,d,p,c,h);break}}return{offsetX:s.ha*e,path:a}}}function v0(t){this.manager=t!==void 0?t:ri}Object.assign(v0.prototype,{load:function(t,e,i,n){var r=this,s=new ji(this.manager);s.setPath(this.path),s.load(t,function(a){var o;try{o=JSON.parse(a)}catch{console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),o=JSON.parse(a.substring(65,a.length-2))}var l=r.parse(o);e&&e(l)},i,n)},parse:function(t){return new wu(t)},setPath:function(t){return this.path=t,this}});function oa(){}oa.Handlers={handlers:[],add:function(t,e){this.handlers.push(t,e)},get:function(t){for(var e=this.handlers,i=0,n=e.length;i<n;i+=2){var r=e[i],s=e[i+1];if(r.test(t))return s}return null}};Object.assign(oa.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(t,e,i){for(var n=[],r=0;r<t.length;++r)n[r]=this.createMaterial(t[r],e,i);return n},createMaterial:function(){var t={NoBlending:dr,NormalBlending:Fn,AdditiveBlending:go,SubtractiveBlending:vo,MultiplyBlending:yo,CustomBlending:$h},e=new me,i=new Dl,n=new Ol;return function(s,a,o){var l={};function c(d,p,m,g,v){var x=a+d,y=oa.Handlers.get(x),b;y!==null?b=y.load(x):(i.setCrossOrigin(o),b=i.load(x)),p!==void 0&&(b.repeat.fromArray(p),p[0]!==1&&(b.wrapS=qi),p[1]!==1&&(b.wrapT=qi)),m!==void 0&&b.offset.fromArray(m),g!==void 0&&(g[0]==="repeat"&&(b.wrapS=qi),g[0]==="mirror"&&(b.wrapS=Un),g[1]==="repeat"&&(b.wrapT=qi),g[1]==="mirror"&&(b.wrapT=Un)),v!==void 0&&(b.anisotropy=v);var E=Te.generateUUID();return l[E]=b,E}var h={uuid:Te.generateUUID(),type:"MeshLambertMaterial"};for(var u in s){var f=s[u];switch(u){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":h.name=f;break;case"blending":h.blending=t[f];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",u,"is no longer supported.");break;case"colorDiffuse":h.color=e.fromArray(f).getHex();break;case"colorSpecular":h.specular=e.fromArray(f).getHex();break;case"colorEmissive":h.emissive=e.fromArray(f).getHex();break;case"specularCoef":h.shininess=f;break;case"shading":f.toLowerCase()==="basic"&&(h.type="MeshBasicMaterial"),f.toLowerCase()==="phong"&&(h.type="MeshPhongMaterial"),f.toLowerCase()==="standard"&&(h.type="MeshStandardMaterial");break;case"mapDiffuse":h.map=c(f,s.mapDiffuseRepeat,s.mapDiffuseOffset,s.mapDiffuseWrap,s.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":h.emissiveMap=c(f,s.mapEmissiveRepeat,s.mapEmissiveOffset,s.mapEmissiveWrap,s.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":h.lightMap=c(f,s.mapLightRepeat,s.mapLightOffset,s.mapLightWrap,s.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":h.aoMap=c(f,s.mapAORepeat,s.mapAOOffset,s.mapAOWrap,s.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":h.bumpMap=c(f,s.mapBumpRepeat,s.mapBumpOffset,s.mapBumpWrap,s.mapBumpAnisotropy);break;case"mapBumpScale":h.bumpScale=f;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":h.normalMap=c(f,s.mapNormalRepeat,s.mapNormalOffset,s.mapNormalWrap,s.mapNormalAnisotropy);break;case"mapNormalFactor":h.normalScale=f;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":h.specularMap=c(f,s.mapSpecularRepeat,s.mapSpecularOffset,s.mapSpecularWrap,s.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":h.metalnessMap=c(f,s.mapMetalnessRepeat,s.mapMetalnessOffset,s.mapMetalnessWrap,s.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":h.roughnessMap=c(f,s.mapRoughnessRepeat,s.mapRoughnessOffset,s.mapRoughnessWrap,s.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":h.alphaMap=c(f,s.mapAlphaRepeat,s.mapAlphaOffset,s.mapAlphaWrap,s.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":h.side=xt;break;case"doubleSided":h.side=rr;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),h.opacity=f;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":h[u]=f;break;case"vertexColors":f===!0&&(h.vertexColors=sr),f==="face"&&(h.vertexColors=jh);break;default:console.error("THREE.Loader.createMaterial: Unsupported",u,f);break}}return h.type==="MeshBasicMaterial"&&delete h.emissive,h.type!=="MeshPhongMaterial"&&delete h.specular,h.opacity<1&&(h.transparent=!0),n.setTextures(l),n.parse(h)}}()});var fs,Au={getContext:function(){return fs===void 0&&(fs=new(window.AudioContext||window.webkitAudioContext)),fs},setContext:function(t){fs=t}};function Su(t){this.manager=t!==void 0?t:ri}Object.assign(Su.prototype,{load:function(t,e,i,n){var r=new ji(this.manager);r.setResponseType("arraybuffer"),r.setPath(this.path),r.load(t,function(s){var a=s.slice(0),o=Au.getContext();o.decodeAudioData(a,function(l){e(l)})},i,n)},setPath:function(t){return this.path=t,this}});function Fl(){this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new S)}Object.assign(Fl.prototype,{isSphericalHarmonics3:!0,set:function(t){for(var e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this},zero:function(){for(var t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this},getAt:function(t,e){var i=t.x,n=t.y,r=t.z,s=this.coefficients;return e=s[0]*.282095,e+=s[1]*.488603*n,e+=s[2]*.488603*r,e+=s[3]*.488603*i,e+=s[4]*1.092548*(i*n),e+=s[5]*1.092548*(n*r),e+=s[6]*.315392*(3*r*r-1),e+=s[7]*1.092548*(i*r),e+=s[8]*.546274*(i*i-n*n),e},getIrradianceAt:function(t,e){var i=t.x,n=t.y,r=t.z,s=this.coefficients;return e=s[0]*.886227,e+=s[1]*2*.511664*n,e+=s[2]*2*.511664*r,e+=s[3]*2*.511664*i,e+=s[4]*2*.429043*i*n,e+=s[5]*2*.429043*n*r,e+=s[6]*(.743125*r*r-.247708),e+=s[7]*2*.429043*i*r,e+=s[8]*.429043*(i*i-n*n),e},add:function(t){for(var e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this},scale:function(t){for(var e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this},lerp:function(t,e){for(var i=0;i<9;i++)this.coefficients[i].lerp(t.coefficients[i],e);return this},equals:function(t){for(var e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0},copy:function(t){return this.set(t.coefficients)},clone:function(){return new this.constructor().copy(this)},fromArray:function(t){for(var e=this.coefficients,i=0;i<9;i++)e[i].fromArray(t,i*3);return this},toArray:function(){for(var t=[],e=this.coefficients,i=0;i<9;i++)e[i].toArray(t,i*3);return t}});Object.assign(Fl,{getBasisAt:function(t,e){var i=t.x,n=t.y,r=t.z;e[0]=.282095,e[1]=.488603*n,e[2]=.488603*r,e[3]=.488603*i,e[4]=1.092548*i*n,e[5]=1.092548*n*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*i*r,e[8]=.546274*(i*i-n*n)}});function _i(t,e){ot.call(this,void 0,e),this.sh=t!==void 0?t:new Fl}_i.prototype=Object.assign(Object.create(ot.prototype),{constructor:_i,isLightProbe:!0,copy:function(t){return ot.prototype.copy.call(this,t),this.sh.copy(t.sh),this.intensity=t.intensity,this},toJSON:function(t){var e=ot.prototype.toJSON.call(this,t);return e}});function Oc(t,e,i){_i.call(this,void 0,i);var n=new me().set(t),r=new me().set(e),s=new S(n.r,n.g,n.b),a=new S(r.r,r.g,r.b),o=Math.sqrt(Math.PI),l=o*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(a).multiplyScalar(o),this.sh.coefficients[1].copy(s).sub(a).multiplyScalar(l)}Oc.prototype=Object.assign(Object.create(_i.prototype),{constructor:Oc,isHemisphereLightProbe:!0,copy:function(t){return _i.prototype.copy.call(this,t),this},toJSON:function(t){var e=_i.prototype.toJSON.call(this,t);return e}});function Fc(t,e){_i.call(this,void 0,e);var i=new me().set(t);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}Fc.prototype=Object.assign(Object.create(_i.prototype),{constructor:Fc,isAmbientLightProbe:!0,copy:function(t){return _i.prototype.copy.call(this,t),this},toJSON:function(t){var e=_i.prototype.toJSON.call(this,t);return e}});function kl(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ct,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ct,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}Object.assign(kl.prototype,{update:function(){var t,e,i,n,r,s,a,o,l=new we,c=new we;return function(u){var f=t!==this||e!==u.focus||i!==u.fov||n!==u.aspect*this.aspect||r!==u.near||s!==u.far||a!==u.zoom||o!==this.eyeSep;if(f){t=this,e=u.focus,i=u.fov,n=u.aspect*this.aspect,r=u.near,s=u.far,a=u.zoom;var d=u.projectionMatrix.clone();o=this.eyeSep/2;var p=o*r/e,m=r*Math.tan(Te.DEG2RAD*i*.5)/a,g,v;c.elements[12]=-o,l.elements[12]=o,g=-m*n+p,v=m*n+p,d.elements[0]=2*r/(v-g),d.elements[8]=(v+g)/(v-g),this.cameraL.projectionMatrix.copy(d),g=-m*n-p,v=m*n-p,d.elements[0]=2*r/(v-g),d.elements[8]=(v+g)/(v-g),this.cameraR.projectionMatrix.copy(d)}this.cameraL.matrixWorld.copy(u.matrixWorld).multiply(c),this.cameraR.matrixWorld.copy(u.matrixWorld).multiply(l)}}()});var An=90,Sn=1;function la(t,e,i,n){ce.call(this),this.type="CubeCamera";var r=new ct(An,Sn,t,e);r.up.set(0,-1,0),r.lookAt(new S(1,0,0)),this.add(r);var s=new ct(An,Sn,t,e);s.up.set(0,-1,0),s.lookAt(new S(-1,0,0)),this.add(s);var a=new ct(An,Sn,t,e);a.up.set(0,0,1),a.lookAt(new S(0,1,0)),this.add(a);var o=new ct(An,Sn,t,e);o.up.set(0,0,-1),o.lookAt(new S(0,-1,0)),this.add(o);var l=new ct(An,Sn,t,e);l.up.set(0,-1,0),l.lookAt(new S(0,0,1)),this.add(l);var c=new ct(An,Sn,t,e);c.up.set(0,-1,0),c.lookAt(new S(0,0,-1)),this.add(c),n=n||{format:Ai,magFilter:ht,minFilter:ht},this.renderTarget=new Hn(i,i,n),this.renderTarget.texture.name="CubeCamera",this.update=function(h,u){this.parent===null&&this.updateMatrixWorld();var f=h.getRenderTarget(),d=this.renderTarget,p=d.texture.generateMipmaps;d.texture.generateMipmaps=!1,h.setRenderTarget(d,0),h.render(u,r),h.setRenderTarget(d,1),h.render(u,s),h.setRenderTarget(d,2),h.render(u,a),h.setRenderTarget(d,3),h.render(u,o),h.setRenderTarget(d,4),h.render(u,l),d.texture.generateMipmaps=p,h.setRenderTarget(d,5),h.render(u,c),h.setRenderTarget(f)},this.clear=function(h,u,f,d){for(var p=h.getRenderTarget(),m=this.renderTarget,g=0;g<6;g++)h.setRenderTarget(m,g),h.clear(u,f,d);h.setRenderTarget(p)}}la.prototype=Object.create(ce.prototype);la.prototype.constructor=la;function Lu(t){this.autoStart=t!==void 0?t:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(Lu.prototype,{start:function(){this.startTime=(typeof performance>"u"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=(typeof performance>"u"?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}});function kc(){ce.call(this),this.type="AudioListener",this.context=Au.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0}kc.prototype=Object.assign(Object.create(ce.prototype),{constructor:kc,getInput:function(){return this.gain},removeFilter:function(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(t){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this},updateMatrixWorld:function(){var t=new S,e=new tt,i=new S,n=new S,r=new Lu;return function(a){ce.prototype.updateMatrixWorld.call(this,a);var o=this.context.listener,l=this.up;if(this.timeDelta=r.getDelta(),this.matrixWorld.decompose(t,e,i),n.set(0,0,-1).applyQuaternion(e),o.positionX){var c=this.context.currentTime+this.timeDelta;o.positionX.linearRampToValueAtTime(t.x,c),o.positionY.linearRampToValueAtTime(t.y,c),o.positionZ.linearRampToValueAtTime(t.z,c),o.forwardX.linearRampToValueAtTime(n.x,c),o.forwardY.linearRampToValueAtTime(n.y,c),o.forwardZ.linearRampToValueAtTime(n.z,c),o.upX.linearRampToValueAtTime(l.x,c),o.upY.linearRampToValueAtTime(l.y,c),o.upZ.linearRampToValueAtTime(l.z,c)}else o.setPosition(t.x,t.y,t.z),o.setOrientation(n.x,n.y,n.z,l.x,l.y,l.z)}}()});function $r(t){ce.call(this),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}$r.prototype=Object.assign(Object.create(ce.prototype),{constructor:$r,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setMediaElementSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.onended=this.onEnded.bind(this),this.startTime=this.context.currentTime,t.start(this.startTime,this.offset),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()},pause:function(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this},stop:function(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),this.isPlaying===!0?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},setDetune:function(t){if(this.detune=t,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=t,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=t,this.isPlaying===!0&&(this.source.loop=this.loop),this},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}});function Nc(t){$r.call(this,t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}Nc.prototype=Object.assign(Object.create($r.prototype),{constructor:Nc,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){return this.panner.refDistance=t,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){return this.panner.rolloffFactor=t,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){return this.panner.distanceModel=t,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){return this.panner.maxDistance=t,this},setDirectionalCone:function(t,e,i){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=i,this},updateMatrixWorld:function(){var t=new S,e=new tt,i=new S,n=new S;return function(s){if(ce.prototype.updateMatrixWorld.call(this,s),!(this.hasPlaybackControl===!0&&this.isPlaying===!1)){this.matrixWorld.decompose(t,e,i),n.set(0,0,1).applyQuaternion(e);var a=this.panner;if(a.positionX){var o=this.context.currentTime+this.listener.timeDelta;a.positionX.linearRampToValueAtTime(t.x,o),a.positionY.linearRampToValueAtTime(t.y,o),a.positionZ.linearRampToValueAtTime(t.z,o),a.orientationX.linearRampToValueAtTime(n.x,o),a.orientationY.linearRampToValueAtTime(n.y,o),a.orientationZ.linearRampToValueAtTime(n.z,o)}else a.setPosition(t.x,t.y,t.z),a.setOrientation(n.x,n.y,n.z)}}}()});function Mu(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e!==void 0?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}Object.assign(Mu.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),i=0;i<e.length;i++)t+=e[i];return t/e.length}});function Ru(t,e,i){this.binding=t,this.valueSize=i;var n=Float64Array,r;switch(e){case"quaternion":r=this._slerp;break;case"string":case"bool":n=Array,r=this._select;break;default:r=this._lerp}this.buffer=new n(i*4),this._mixBufferRegion=r,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Object.assign(Ru.prototype,{accumulate:function(t,e){var i=this.buffer,n=this.valueSize,r=t*n+n,s=this.cumulativeWeight;if(s===0){for(var a=0;a!==n;++a)i[r+a]=i[a];s=e}else{s+=e;var o=e/s;this._mixBufferRegion(i,r,0,o,n)}this.cumulativeWeight=s},apply:function(t){var e=this.valueSize,i=this.buffer,n=t*e+e,r=this.cumulativeWeight,s=this.binding;if(this.cumulativeWeight=0,r<1){var a=e*3;this._mixBufferRegion(i,n,a,1-r,e)}for(var o=e,l=e+e;o!==l;++o)if(i[o]!==i[o+e]){s.setValue(i,n);break}},saveOriginalState:function(){var t=this.binding,e=this.buffer,i=this.valueSize,n=i*3;t.getValue(e,n);for(var r=i,s=n;r!==s;++r)e[r]=e[n+r%i];this.cumulativeWeight=0},restoreOriginalState:function(){var t=this.valueSize*3;this.binding.setValue(this.buffer,t)},_select:function(t,e,i,n,r){if(n>=.5)for(var s=0;s!==r;++s)t[e+s]=t[i+s]},_slerp:function(t,e,i,n){tt.slerpFlat(t,e,t,e,t,i,n)},_lerp:function(t,e,i,n,r){for(var s=1-n,a=0;a!==r;++a){var o=e+a;t[o]=t[o]*s+t[i+a]*n}}});var Wa="\\[\\]\\.:\\/";function Iu(t,e,i){var n=i||Ht.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}Object.assign(Iu.prototype,{getValue:function(t,e){this.bind();var i=this._targetGroup.nCachedObjects_,n=this._bindings[i];n!==void 0&&n.getValue(t,e)},setValue:function(t,e){for(var i=this._bindings,n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}});function Ht(t,e,i){this.path=e,this.parsedPath=i||Ht.parseTrackName(e),this.node=Ht.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}Object.assign(Ht,{Composite:Iu,create:function(t,e,i){return t&&t.isAnimationObjectGroup?new Ht.Composite(t,e,i):new Ht(t,e,i)},sanitizeNodeName:function(){var t=new RegExp("["+Wa+"]","g");return function(i){return i.replace(/\s/g,"_").replace(t,"")}}(),parseTrackName:function(){var t="[^"+Wa+"]",e="[^"+Wa.replace("\\.","")+"]",i=/((?:WC+[\/:])*)/.source.replace("WC",t),n=/(WCOD+)?/.source.replace("WCOD",e),r=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",t),s=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",t),a=new RegExp("^"+i+n+r+s+"$"),o=["material","materials","bones"];return function(c){var h=a.exec(c);if(!h)throw new Error("PropertyBinding: Cannot parse trackName: "+c);var u={nodeName:h[2],objectName:h[3],objectIndex:h[4],propertyName:h[5],propertyIndex:h[6]},f=u.nodeName&&u.nodeName.lastIndexOf(".");if(f!==void 0&&f!==-1){var d=u.nodeName.substring(f+1);o.indexOf(d)!==-1&&(u.nodeName=u.nodeName.substring(0,f),u.objectName=d)}if(u.propertyName===null||u.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+c);return u}}(),findNode:function(t,e){if(!e||e===""||e==="root"||e==="."||e===-1||e===t.name||e===t.uuid)return t;if(t.skeleton){var i=t.skeleton.getBoneByName(e);if(i!==void 0)return i}if(t.children){var n=function(s){for(var a=0;a<s.length;a++){var o=s[a];if(o.name===e||o.uuid===e)return o;var l=n(o.children);if(l)return l}return null},r=n(t.children);if(r)return r}return null}});Object.assign(Ht.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,i){e[i]=this.node[this.propertyName]},function(e,i){for(var n=this.resolvedProperty,r=0,s=n.length;r!==s;++r)e[i++]=n[r]},function(e,i){e[i]=this.resolvedProperty[this.propertyIndex]},function(e,i){this.resolvedProperty.toArray(e,i)}],SetterByBindingTypeAndVersioning:[[function(e,i){this.targetObject[this.propertyName]=e[i]},function(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.needsUpdate=!0},function(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,i){for(var n=this.resolvedProperty,r=0,s=n.length;r!==s;++r)n[r]=e[i++]},function(e,i){for(var n=this.resolvedProperty,r=0,s=n.length;r!==s;++r)n[r]=e[i++];this.targetObject.needsUpdate=!0},function(e,i){for(var n=this.resolvedProperty,r=0,s=n.length;r!==s;++r)n[r]=e[i++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,i){this.resolvedProperty[this.propertyIndex]=e[i]},function(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.needsUpdate=!0},function(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,i){this.resolvedProperty.fromArray(e,i)},function(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.needsUpdate=!0},function(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,i){this.bind(),this.getValue(e,i)},setValue:function(e,i){this.bind(),this.setValue(e,i)},bind:function(){var t=this.node,e=this.parsedPath,i=e.objectName,n=e.propertyName,r=e.propertyIndex;if(t||(t=Ht.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){var s=e.objectIndex;switch(i){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(var a=0;a<t.length;a++)if(t[a].name===s){s=a;break}break;default:if(t[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[i]}if(s!==void 0){if(t[s]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[s]}}var o=t[n];if(o===void 0){var l=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+n+" but it wasn't found.",t);return}var c=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?c=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(c=this.Versioning.MatrixWorldNeedsUpdate);var h=this.BindingType.Direct;if(r!==void 0){if(n==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}for(var a=0;a<this.node.geometry.morphAttributes.position.length;a++)if(t.geometry.morphAttributes.position[a].name===r){r=a;break}}else{if(!t.geometry.morphTargets){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);return}for(var a=0;a<this.node.geometry.morphTargets.length;a++)if(t.geometry.morphTargets[a].name===r){r=a;break}}}h=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else o.fromArray!==void 0&&o.toArray!==void 0?(h=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(h=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=n;this.getValue=this.GetterByBindingType[h],this.setValue=this.SetterByBindingTypeAndVersioning[h][c]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}});//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(Ht.prototype,{_getValue_unbound:Ht.prototype.getValue,_setValue_unbound:Ht.prototype.setValue});function y0(){this.uuid=Te.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var e=0,i=arguments.length;e!==i;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}Object.assign(y0.prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=this._objects,e=t.length,i=this.nCachedObjects_,n=this._indicesByUUID,r=this._paths,s=this._parsedPaths,a=this._bindings,o=a.length,l=void 0,c=0,h=arguments.length;c!==h;++c){var u=arguments[c],f=u.uuid,d=n[f];if(d===void 0){d=e++,n[f]=d,t.push(u);for(var p=0,m=o;p!==m;++p)a[p].push(new Ht(u,r[p],s[p]))}else if(d<i){l=t[d];var g=--i,v=t[g];n[v.uuid]=d,t[d]=v,n[f]=g,t[g]=u;for(var p=0,m=o;p!==m;++p){var x=a[p],y=x[g],b=x[d];x[d]=y,b===void 0&&(b=new Ht(u,r[p],s[p])),x[g]=b}}else t[d]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=i},remove:function(){for(var t=this._objects,e=this.nCachedObjects_,i=this._indicesByUUID,n=this._bindings,r=n.length,s=0,a=arguments.length;s!==a;++s){var o=arguments[s],l=o.uuid,c=i[l];if(c!==void 0&&c>=e){var h=e++,u=t[h];i[u.uuid]=c,t[c]=u,i[l]=h,t[h]=o;for(var f=0,d=r;f!==d;++f){var p=n[f],m=p[h],g=p[c];p[c]=m,p[h]=g}}}this.nCachedObjects_=e},uncache:function(){for(var t=this._objects,e=t.length,i=this.nCachedObjects_,n=this._indicesByUUID,r=this._bindings,s=r.length,a=0,o=arguments.length;a!==o;++a){var l=arguments[a],c=l.uuid,h=n[c];if(h!==void 0)if(delete n[c],h<i){var u=--i,f=t[u],d=--e,p=t[d];n[f.uuid]=h,t[h]=f,n[p.uuid]=u,t[u]=p,t.pop();for(var m=0,g=s;m!==g;++m){var v=r[m],x=v[u],y=v[d];v[h]=x,v[u]=y,v.pop()}}else{var d=--e,p=t[d];n[p.uuid]=h,t[h]=p,t.pop();for(var m=0,g=s;m!==g;++m){var v=r[m];v[h]=v[d],v.pop()}}}this.nCachedObjects_=i},subscribe_:function(t,e){var i=this._bindingsIndicesByPath,n=i[t],r=this._bindings;if(n!==void 0)return r[n];var s=this._paths,a=this._parsedPaths,o=this._objects,l=o.length,c=this.nCachedObjects_,h=new Array(l);n=r.length,i[t]=n,s.push(t),a.push(e),r.push(h);for(var u=c,f=o.length;u!==f;++u){var d=o[u];h[u]=new Ht(d,t,e)}return h},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,i=e[t];if(i!==void 0){var n=this._paths,r=this._parsedPaths,s=this._bindings,a=s.length-1,o=s[a],l=t[a];e[l]=i,s[i]=o,s.pop(),r[i]=r[a],r.pop(),n[i]=n[a],n.pop()}}});function Cu(t,e,i){this._mixer=t,this._clip=e,this._localRoot=i||null;for(var n=e.tracks,r=n.length,s=new Array(r),a={endingStart:Gn,endingEnd:Gn},o=0;o!==r;++o){var l=n[o].createInterpolant(null);s[o]=l,l.settings=a}this._interpolantSettings=a,this._interpolants=s,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Kd,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}Object.assign(Cu.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){var n=this._clip.duration,r=t._clip.duration,s=r/n,a=n/r;t.warp(1,s,e),this.warp(a,1,e)}return this},crossFadeTo:function(t,e,i){return t.crossFadeFrom(this,e,i)},stopFading:function(){var t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,i){var n=this._mixer,r=n.time,s=this._timeScaleInterpolant,a=this.timeScale;s===null&&(s=n._lendControlInterpolant(),this._timeScaleInterpolant=s);var o=s.parameterPositions,l=s.sampleValues;return o[0]=r,o[1]=r+i,l[0]=t/a,l[1]=e/a,this},stopWarping:function(){var t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,i,n){if(!this.enabled){this._updateWeight(t);return}var r=this._startTime;if(r!==null){var s=(t-r)*i;if(s<0||i===0)return;this._startTime=null,e=i*s}e*=this._updateTimeScale(t);var a=this._updateTime(e),o=this._updateWeight(t);if(o>0)for(var l=this._interpolants,c=this._propertyBindings,h=0,u=l.length;h!==u;++h)l[h].evaluate(a),c[h].accumulate(n,o)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var i=this._weightInterpolant;if(i!==null){var n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopFading(),n===0&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var i=this._timeScaleInterpolant;if(i!==null){var n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopWarping(),e===0?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e},_updateTime:function(t){var e=this.time+t,i=this._clip.duration,n=this.loop,r=this._loopCount,s=n===Xd;if(t===0)return r===-1?e:s&&(r&1)===1?i-e:e;if(n===Yd){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(e>=i)e=i;else if(e<0)e=0;else{this.time=e;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(r===-1&&(t>=0?(r=0,this._setEndings(!0,this.repetitions===0,s)):this._setEndings(this.repetitions===0,!0,s)),e>=i||e<0){var a=Math.floor(e/i);e-=i*a,r+=Math.abs(a);var o=this.repetitions-r;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=t>0?i:0,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(o===1){var l=t<0;this._setEndings(l,!l,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=e;if(s&&(r&1)===1)return i-e}return e},_setEndings:function(t,e,i){var n=this._interpolantSettings;i?(n.endingStart=Dn,n.endingEnd=Dn):(t?n.endingStart=this.zeroSlopeAtStart?Dn:Gn:n.endingStart=Rs,e?n.endingEnd=this.zeroSlopeAtEnd?Dn:Gn:n.endingEnd=Rs)},_scheduleFading:function(t,e,i){var n=this._mixer,r=n.time,s=this._weightInterpolant;s===null&&(s=n._lendControlInterpolant(),this._weightInterpolant=s);var a=s.parameterPositions,o=s.sampleValues;return a[0]=r,o[0]=e,a[1]=r+t,o[1]=i,this}});function Bc(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}Bc.prototype=Object.assign(Object.create(Zt.prototype),{constructor:Bc,_bindAction:function(t,e){var i=t._localRoot||this._root,n=t._clip.tracks,r=n.length,s=t._propertyBindings,a=t._interpolants,o=i.uuid,l=this._bindingsByRootAndName,c=l[o];c===void 0&&(c={},l[o]=c);for(var h=0;h!==r;++h){var u=n[h],f=u.name,d=c[f];if(d!==void 0)s[h]=d;else{if(d=s[h],d!==void 0){d._cacheIndex===null&&(++d.referenceCount,this._addInactiveBinding(d,o,f));continue}var p=e&&e._propertyBindings[h].binding.parsedPath;d=new Ru(Ht.create(i,f,p),u.ValueTypeName,u.getValueSize()),++d.referenceCount,this._addInactiveBinding(d,o,f),s[h]=d}a[h].resultBuffer=d.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){var e=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,i,e)}for(var r=t._propertyBindings,s=0,a=r.length;s!==a;++s){var o=r[s];o.useCount++===0&&(this._lendBinding(o),o.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,i=0,n=e.length;i!==n;++i){var r=e[i];--r.useCount===0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var e=t._cacheIndex;return e!==null&&e<this._nActiveActions},_addInactiveAction:function(t,e,i){var n=this._actions,r=this._actionsByClip,s=r[e];if(s===void 0)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=s;else{var a=s.knownActions;t._byClipCacheIndex=a.length,a.push(t)}t._cacheIndex=n.length,n.push(t),s.actionByRoot[i]=t},_removeInactiveAction:function(t){var e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n,e[n]=i,e.pop(),t._cacheIndex=null;var r=t._clip.uuid,s=this._actionsByClip,a=s[r],o=a.knownActions,l=o[o.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),t._byClipCacheIndex=null;var h=a.actionByRoot,u=(t._localRoot||this._root).uuid;delete h[u],o.length===0&&delete s[r],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=t._propertyBindings,i=0,n=e.length;i!==n;++i){var r=e[i];--r.referenceCount===0&&this._removeInactiveBinding(r)}},_lendAction:function(t){var e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r},_takeBackAction:function(t){var e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r},_addInactiveBinding:function(t,e,i){var n=this._bindingsByRootAndName,r=n[e],s=this._bindings;r===void 0&&(r={},n[e]=r),r[i]=t,t._cacheIndex=s.length,s.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,i=t.binding,n=i.rootNode.uuid,r=i.path,s=this._bindingsByRootAndName,a=s[n],o=e[e.length-1],l=t._cacheIndex;o._cacheIndex=l,e[l]=o,e.pop(),delete a[r];e:{for(var c in a)break e;delete s[n]}},_lendBinding:function(t){var e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r},_takeBackBinding:function(t){var e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,i=t[e];return i===void 0&&(i=new sa(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=e,t[e]=i),i},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,r=e[n];t.__cacheIndex=n,e[n]=t,r.__cacheIndex=i,e[i]=r},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e){var i=e||this._root,n=i.uuid,r=typeof t=="string"?mi.findByName(i,t):t,s=r!==null?r.uuid:t,a=this._actionsByClip[s],o=null;if(a!==void 0){var l=a.actionByRoot[n];if(l!==void 0)return l;o=a.knownActions[0],r===null&&(r=o._clip)}if(r===null)return null;var c=new Cu(this,r,e);return this._bindAction(c,o),this._addInactiveAction(c,s,n),c},existingAction:function(t,e){var i=e||this._root,n=i.uuid,r=typeof t=="string"?mi.findByName(i,t):t,s=r?r.uuid:t,a=this._actionsByClip[s];return a!==void 0&&a.actionByRoot[n]||null},stopAllAction:function(){var t=this._actions,e=this._nActiveActions,i=this._bindings,n=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var r=0;r!==e;++r)t[r].reset();for(var r=0;r!==n;++r)i[r].useCount=0;return this},update:function(t){t*=this.timeScale;for(var e=this._actions,i=this._nActiveActions,n=this.time+=t,r=Math.sign(t),s=this._accuIndex^=1,a=0;a!==i;++a){var o=e[a];o._update(n,t,r,s)}for(var l=this._bindings,c=this._nActiveBindings,a=0;a!==c;++a)l[a].apply(s);return this},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions,i=t.uuid,n=this._actionsByClip,r=n[i];if(r!==void 0){for(var s=r.knownActions,a=0,o=s.length;a!==o;++a){var l=s[a];this._deactivateAction(l);var c=l._cacheIndex,h=e[e.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,h._cacheIndex=c,e[c]=h,e.pop(),this._removeInactiveBindingsForAction(l)}delete n[i]}},uncacheRoot:function(t){var e=t.uuid,i=this._actionsByClip;for(var n in i){var r=i[n].actionByRoot,s=r[e];s!==void 0&&(this._deactivateAction(s),this._removeInactiveAction(s))}var a=this._bindingsByRootAndName,o=a[e];if(o!==void 0)for(var l in o){var c=o[l];c.restoreOriginalState(),this._removeInactiveBinding(c)}},uncacheAction:function(t,e){var i=this.existingAction(t,e);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}});function Qo(t){typeof t=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}Qo.prototype.clone=function(){return new Qo(this.value.clone===void 0?this.value:this.value.clone())};function Uc(t,e,i){Wn.call(this,t,e),this.meshPerAttribute=i||1}Uc.prototype=Object.assign(Object.create(Wn.prototype),{constructor:Uc,isInstancedInterleavedBuffer:!0,copy:function(t){return Wn.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}});function Du(t,e,i,n){this.ray=new ar(t,e),this.near=i||0,this.far=n||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Gc(t,e){return t.distance-e.distance}function el(t,e,i,n){if(t.visible!==!1&&(t.raycast(e,i),n===!0))for(var r=t.children,s=0,a=r.length;s<a;s++)el(r[s],e,i,!0)}Object.assign(Du.prototype,{linePrecision:1,set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize()):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e,i){var n=i||[];return el(t,this,n,e),n.sort(Gc),n},intersectObjects:function(t,e,i){var n=i||[];if(Array.isArray(t)===!1)return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var r=0,s=t.length;r<s;r++)el(t[r],this,n,e);return n.sort(Gc),n}});function x0(t,e,i){return this.radius=t!==void 0?t:1,this.phi=e!==void 0?e:0,this.theta=i!==void 0?i:0,this}Object.assign(x0.prototype,{set:function(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){var t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(Te.clamp(e/this.radius,-1,1))),this}});function E0(t,e,i){return this.radius=t!==void 0?t:1,this.theta=e!==void 0?e:0,this.y=i!==void 0?i:0,this}Object.assign(E0.prototype,{set:function(t,e,i){return this.radius=t,this.theta=e,this.y=i,this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,i){return this.radius=Math.sqrt(t*t+i*i),this.theta=Math.atan2(t,i),this.y=e,this}});function Pu(t,e){this.min=t!==void 0?t:new X(1/0,1/0),this.max=e!==void 0?e:new X(-1/0,-1/0)}Object.assign(Pu.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new X;return function(i,n){var r=t.copy(n).multiplyScalar(.5);return this.min.copy(i).sub(r),this.max.copy(i).add(r),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return t===void 0&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new X),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return t===void 0&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new X),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return e===void 0&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new X),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return e===void 0&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new X),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new X;return function(i){var n=t.copy(i).clamp(this.min,this.max);return n.sub(i).length()}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});function Ou(t,e){this.start=t!==void 0?t:new S,this.end=e!==void 0?e:new S}Object.assign(Ou.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return t===void 0&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new S),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return t===void 0&&(console.warn("THREE.Line3: .delta() target is now required"),t=new S),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){return e===void 0&&(console.warn("THREE.Line3: .at() target is now required"),e=new S),this.delta(e).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(){var t=new S,e=new S;return function(n,r){t.subVectors(n,this.start),e.subVectors(this.end,this.start);var s=e.dot(e),a=e.dot(t),o=a/s;return r&&(o=Te.clamp(o,0,1)),o}}(),closestPointToPoint:function(t,e,i){var n=this.closestPointToPointParameter(t,e);return i===void 0&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),i=new S),this.delta(i).multiplyScalar(n).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}});function ca(t){ce.call(this),this.material=t,this.render=function(){}}ca.prototype=Object.create(ce.prototype);ca.prototype.constructor=ca;ca.prototype.isImmediateRenderObject=!0;function ha(t,e,i,n){this.object=t,this.size=e!==void 0?e:1;var r=i!==void 0?i:16711680,s=n!==void 0?n:1,a=0,o=this.object.geometry;o&&o.isGeometry?a=o.faces.length*3:o&&o.isBufferGeometry&&(a=o.attributes.normal.count);var l=new he,c=new le(a*2*3,3);l.addAttribute("position",c),ut.call(this,l,new st({color:r,linewidth:s})),this.matrixAutoUpdate=!1,this.update()}ha.prototype=Object.create(ut.prototype);ha.prototype.constructor=ha;ha.prototype.update=function(){var t=new S,e=new S,i=new Rt;return function(){var r=["a","b","c"];this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);var s=this.object.matrixWorld,a=this.geometry.attributes.position,o=this.object.geometry;if(o&&o.isGeometry)for(var l=o.vertices,c=o.faces,h=0,u=0,f=c.length;u<f;u++)for(var d=c[u],p=0,m=d.vertexNormals.length;p<m;p++){var g=l[d[r[p]]],v=d.vertexNormals[p];t.copy(g).applyMatrix4(s),e.copy(v).applyMatrix3(i).normalize().multiplyScalar(this.size).add(t),a.setXYZ(h,t.x,t.y,t.z),h=h+1,a.setXYZ(h,e.x,e.y,e.z),h=h+1}else if(o&&o.isBufferGeometry)for(var x=o.attributes.position,y=o.attributes.normal,h=0,p=0,m=x.count;p<m;p++)t.set(x.getX(p),x.getY(p),x.getZ(p)).applyMatrix4(s),e.set(y.getX(p),y.getY(p),y.getZ(p)),e.applyMatrix3(i).normalize().multiplyScalar(this.size).add(t),a.setXYZ(h,t.x,t.y,t.z),h=h+1,a.setXYZ(h,e.x,e.y,e.z),h=h+1;a.needsUpdate=!0}}();function Yr(t,e){ce.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;for(var i=new he,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],r=0,s=1,a=32;r<a;r++,s++){var o=r/a*Math.PI*2,l=s/a*Math.PI*2;n.push(Math.cos(o),Math.sin(o),1,Math.cos(l),Math.sin(l),1)}i.addAttribute("position",new le(n,3));var c=new st({fog:!1});this.cone=new ut(i,c),this.add(this.cone),this.update()}Yr.prototype=Object.create(ce.prototype);Yr.prototype.constructor=Yr;Yr.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()};Yr.prototype.update=function(){var t=new S;return function(){this.light.updateMatrixWorld();var i=this.light.distance?this.light.distance:1e3,n=i*Math.tan(this.light.angle);this.cone.scale.set(n,n,i),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}();function Fu(t){var e=[];t&&t.isBone&&e.push(t);for(var i=0;i<t.children.length;i++)e.push.apply(e,Fu(t.children[i]));return e}function Kr(t){for(var e=Fu(t),i=new he,n=[],r=[],s=new me(0,0,1),a=new me(0,1,0),o=0;o<e.length;o++){var l=e[o];l.parent&&l.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(s.r,s.g,s.b),r.push(a.r,a.g,a.b))}i.addAttribute("position",new le(n,3)),i.addAttribute("color",new le(r,3));var c=new st({vertexColors:sr,depthTest:!1,depthWrite:!1,transparent:!0});ut.call(this,i,c),this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}Kr.prototype=Object.create(ut.prototype);Kr.prototype.constructor=Kr;Kr.prototype.updateMatrixWorld=function(){var t=new S,e=new we,i=new we;return function(r){var s=this.bones,a=this.geometry,o=a.getAttribute("position");i.getInverse(this.root.matrixWorld);for(var l=0,c=0;l<s.length;l++){var h=s[l];h.parent&&h.parent.isBone&&(e.multiplyMatrices(i,h.matrixWorld),t.setFromMatrixPosition(e),o.setXYZ(c,t.x,t.y,t.z),e.multiplyMatrices(i,h.parent.matrixWorld),t.setFromMatrixPosition(e),o.setXYZ(c+1,t.x,t.y,t.z),c+=2)}a.getAttribute("position").needsUpdate=!0,ce.prototype.updateMatrixWorld.call(this,r)}}();function Xr(t,e,i){this.light=t,this.light.updateMatrixWorld(),this.color=i;var n=new Ri(e,4,2),r=new It({wireframe:!0,fog:!1});Et.call(this,n,r),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}Xr.prototype=Object.create(Et.prototype);Xr.prototype.constructor=Xr;Xr.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()};Xr.prototype.update=function(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)};function qr(t,e){this.type="RectAreaLightHelper",this.light=t,this.color=e;var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],n=new he;n.addAttribute("position",new le(i,3)),n.computeBoundingSphere();var r=new st({fog:!1});kt.call(this,n,r);var s=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],a=new he;a.addAttribute("position",new le(s,3)),a.computeBoundingSphere(),this.add(new Et(a,new It({side:xt,fog:!1}))),this.update()}qr.prototype=Object.create(kt.prototype);qr.prototype.constructor=qr;qr.prototype.update=function(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),this.color!==void 0)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var t=this.material.color,e=Math.max(t.r,t.g,t.b);e>1&&t.multiplyScalar(1/e),this.children[0].material.color.copy(this.material.color)}};qr.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()};function Zr(t,e,i){ce.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;var n=new jn(e);n.rotateY(Math.PI*.5),this.material=new It({wireframe:!0,fog:!1}),this.color===void 0&&(this.material.vertexColors=sr);var r=n.getAttribute("position"),s=new Float32Array(r.count*3);n.addAttribute("color",new Fe(s,3)),this.add(new Et(n,this.material)),this.update()}Zr.prototype=Object.create(ce.prototype);Zr.prototype.constructor=Zr;Zr.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()};Zr.prototype.update=function(){var t=new S,e=new me,i=new me;return function(){var r=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{var s=r.geometry.getAttribute("color");e.copy(this.light.color),i.copy(this.light.groundColor);for(var a=0,o=s.count;a<o;a++){var l=a<o/2?e:i;s.setXYZ(a,l.r,l.g,l.b)}s.needsUpdate=!0}r.lookAt(t.setFromMatrixPosition(this.light.matrixWorld).negate())}}();function Jr(t,e){this.lightProbe=t,this.size=e;var i={};i.GAMMA_OUTPUT="";var n=new Vt({defines:i,uniforms:{sh:{value:this.lightProbe.sh.coefficients},intensity:{value:this.lightProbe.intensity}},vertexShader:["varying vec3 vNormal;","void main() {","	vNormal = normalize( normalMatrix * normal );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["#define RECIPROCAL_PI 0.318309886","vec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {","	// matrix is assumed to be orthogonal","	return normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );","}","vec3 linearToOutput( in vec3 a ) {","	#ifdef GAMMA_OUTPUT","		return pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );","	#else","		return a;","	#endif","}","// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf","vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {","	// normal is assumed to have unit length","	float x = normal.x, y = normal.y, z = normal.z;","	// band 0","	vec3 result = shCoefficients[ 0 ] * 0.886227;","	// band 1","	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;","	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;","	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;","	// band 2","	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;","	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;","	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );","	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;","	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );","	return result;","}","uniform vec3 sh[ 9 ]; // sh coefficients","uniform float intensity; // light probe intensity","varying vec3 vNormal;","void main() {","	vec3 normal = normalize( vNormal );","	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );","	vec3 irradiance = shGetIrradianceAt( worldNormal, sh );","	vec3 outgoingLight = RECIPROCAL_PI * irradiance * intensity;","	outgoingLight = linearToOutput( outgoingLight );","	gl_FragColor = vec4( outgoingLight, 1.0 );","}"].join(`
`)}),r=new Ri(1,32,16);Et.call(this,r,n),this.onBeforeRender()}Jr.prototype=Object.create(Et.prototype);Jr.prototype.constructor=Jr;Jr.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()};Jr.prototype.onBeforeRender=function(){return function(){this.position.copy(this.lightProbe.position),this.scale.set(1,1,1).multiplyScalar(this.size),this.material.uniforms.intensity.value=this.lightProbe.intensity}}();function tl(t,e,i,n){t=t||10,e=e||10,i=new me(i!==void 0?i:4473924),n=new me(n!==void 0?n:8947848);for(var r=e/2,s=t/e,a=t/2,o=[],l=[],c=0,h=0,u=-a;c<=e;c++,u+=s){o.push(-a,0,u,a,0,u),o.push(u,0,-a,u,0,a);var f=c===r?i:n;f.toArray(l,h),h+=3,f.toArray(l,h),h+=3,f.toArray(l,h),h+=3,f.toArray(l,h),h+=3}var d=new he;d.addAttribute("position",new le(o,3)),d.addAttribute("color",new le(l,3));var p=new st({vertexColors:sr});ut.call(this,d,p)}tl.prototype=Object.assign(Object.create(ut.prototype),{constructor:tl,copy:function(t){return ut.prototype.copy.call(this,t),this.geometry.copy(t.geometry),this.material.copy(t.material),this},clone:function(){return new this.constructor().copy(this)}});function il(t,e,i,n,r,s){t=t||10,e=e||16,i=i||8,n=n||64,r=new me(r!==void 0?r:4473924),s=new me(s!==void 0?s:8947848);var a=[],o=[],l,c,h,u,f,d,p;for(u=0;u<=e;u++)h=u/e*(Math.PI*2),l=Math.sin(h)*t,c=Math.cos(h)*t,a.push(0,0,0),a.push(l,0,c),p=u&1?r:s,o.push(p.r,p.g,p.b),o.push(p.r,p.g,p.b);for(u=0;u<=i;u++)for(p=u&1?r:s,d=t-t/i*u,f=0;f<n;f++)h=f/n*(Math.PI*2),l=Math.sin(h)*d,c=Math.cos(h)*d,a.push(l,0,c),o.push(p.r,p.g,p.b),h=(f+1)/n*(Math.PI*2),l=Math.sin(h)*d,c=Math.cos(h)*d,a.push(l,0,c),o.push(p.r,p.g,p.b);var m=new he;m.addAttribute("position",new le(a,3)),m.addAttribute("color",new le(o,3));var g=new st({vertexColors:sr});ut.call(this,m,g)}il.prototype=Object.create(ut.prototype);il.prototype.constructor=il;function Qr(t,e,i,n){this.audio=t,this.range=e||1,this.divisionsInnerAngle=i||16,this.divisionsOuterAngle=n||2;var r=new he,s=this.divisionsInnerAngle+this.divisionsOuterAngle*2,a=new Float32Array((s*3+3)*3);r.addAttribute("position",new Fe(a,3));var o=new st({color:65280}),l=new st({color:16776960});kt.call(this,r,[l,o]),this.update()}Qr.prototype=Object.create(kt.prototype);Qr.prototype.constructor=Qr;Qr.prototype.update=function(){var t=this.audio,e=this.range,i=this.divisionsInnerAngle,n=this.divisionsOuterAngle,r=Te.degToRad(t.panner.coneInnerAngle),s=Te.degToRad(t.panner.coneOuterAngle),a=r/2,o=s/2,l=0,c=0,h,u,f=this.geometry,d=f.attributes.position;f.clearGroups();function p(m,g,v,x){var y=(g-m)/v;for(d.setXYZ(l,0,0,0),c++,h=m;h<g;h+=y)u=l+c,d.setXYZ(u,Math.sin(h)*e,0,Math.cos(h)*e),d.setXYZ(u+1,Math.sin(Math.min(h+y,g))*e,0,Math.cos(Math.min(h+y,g))*e),d.setXYZ(u+2,0,0,0),c+=3;f.addGroup(l,c,x),l+=c,c=0}p(-o,-a,n,0),p(-a,a,i,1),p(a,o,n,0),d.needsUpdate=!0,r===s&&(this.material[0].visible=!1)};Qr.prototype.dispose=function(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()};function ua(t,e,i,n){this.object=t,this.size=e!==void 0?e:1;var r=i!==void 0?i:16776960,s=n!==void 0?n:1,a=0,o=this.object.geometry;o&&o.isGeometry?a=o.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var l=new he,c=new le(a*2*3,3);l.addAttribute("position",c),ut.call(this,l,new st({color:r,linewidth:s})),this.matrixAutoUpdate=!1,this.update()}ua.prototype=Object.create(ut.prototype);ua.prototype.constructor=ua;ua.prototype.update=function(){var t=new S,e=new S,i=new Rt;return function(){this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);for(var r=this.object.matrixWorld,s=this.geometry.attributes.position,a=this.object.geometry,o=a.vertices,l=a.faces,c=0,h=0,u=l.length;h<u;h++){var f=l[h],d=f.normal;t.copy(o[f.a]).add(o[f.b]).add(o[f.c]).divideScalar(3).applyMatrix4(r),e.copy(d).applyMatrix3(i).normalize().multiplyScalar(this.size).add(t),s.setXYZ(c,t.x,t.y,t.z),c=c+1,s.setXYZ(c,e.x,e.y,e.z),c=c+1}s.needsUpdate=!0}}();function es(t,e,i){ce.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,e===void 0&&(e=1);var n=new he;n.addAttribute("position",new le([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));var r=new st({fog:!1});this.lightPlane=new kt(n,r),this.add(this.lightPlane),n=new he,n.addAttribute("position",new le([0,0,0,0,0,1],3)),this.targetLine=new kt(n,r),this.add(this.targetLine),this.update()}es.prototype=Object.create(ce.prototype);es.prototype.constructor=es;es.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()};es.prototype.update=function(){var t=new S,e=new S,i=new S;return function(){t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),i.subVectors(e,t),this.lightPlane.lookAt(e),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(e),this.targetLine.scale.z=i.length()}}();function fa(t){var e=new he,i=new st({color:16777215,vertexColors:jh}),n=[],r=[],s={},a=new me(16755200),o=new me(16711680),l=new me(43775),c=new me(16777215),h=new me(3355443);u("n1","n2",a),u("n2","n4",a),u("n4","n3",a),u("n3","n1",a),u("f1","f2",a),u("f2","f4",a),u("f4","f3",a),u("f3","f1",a),u("n1","f1",a),u("n2","f2",a),u("n3","f3",a),u("n4","f4",a),u("p","n1",o),u("p","n2",o),u("p","n3",o),u("p","n4",o),u("u1","u2",l),u("u2","u3",l),u("u3","u1",l),u("c","t",c),u("p","c",h),u("cn1","cn2",h),u("cn3","cn4",h),u("cf1","cf2",h),u("cf3","cf4",h);function u(d,p,m){f(d,m),f(p,m)}function f(d,p){n.push(0,0,0),r.push(p.r,p.g,p.b),s[d]===void 0&&(s[d]=[]),s[d].push(n.length/3-1)}e.addAttribute("position",new le(n,3)),e.addAttribute("color",new le(r,3)),ut.call(this,e,i),this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}fa.prototype=Object.create(ut.prototype);fa.prototype.constructor=fa;fa.prototype.update=function(){var t,e,i=new S,n=new Gi;function r(s,a,o,l){i.set(a,o,l).unproject(n);var c=e[s];if(c!==void 0)for(var h=t.getAttribute("position"),u=0,f=c.length;u<f;u++)h.setXYZ(c[u],i.x,i.y,i.z)}return function(){t=this.geometry,e=this.pointMap;var a=1,o=1;n.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),r("c",0,0,-1),r("t",0,0,1),r("n1",-a,-o,-1),r("n2",a,-o,-1),r("n3",-a,o,-1),r("n4",a,o,-1),r("f1",-a,-o,1),r("f2",a,-o,1),r("f3",-a,o,1),r("f4",a,o,1),r("u1",a*.7,o*1.1,-1),r("u2",-a*.7,o*1.1,-1),r("u3",0,o*2,-1),r("cf1",-a,0,1),r("cf2",a,0,1),r("cf3",0,-o,1),r("cf4",0,o,1),r("cn1",-a,0,-1),r("cn2",a,0,-1),r("cn3",0,-o,-1),r("cn4",0,o,-1),t.getAttribute("position").needsUpdate=!0}}();function xn(t,e){this.object=t,e===void 0&&(e=16776960);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(8*3),r=new he;r.setIndex(new Fe(i,1)),r.addAttribute("position",new Fe(n,3)),ut.call(this,r,new st({color:e})),this.matrixAutoUpdate=!1,this.update()}xn.prototype=Object.create(ut.prototype);xn.prototype.constructor=xn;xn.prototype.update=function(){var t=new Ti;return function(i){if(i!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&t.setFromObject(this.object),!t.isEmpty()){var n=t.min,r=t.max,s=this.geometry.attributes.position,a=s.array;a[0]=r.x,a[1]=r.y,a[2]=r.z,a[3]=n.x,a[4]=r.y,a[5]=r.z,a[6]=n.x,a[7]=n.y,a[8]=r.z,a[9]=r.x,a[10]=n.y,a[11]=r.z,a[12]=r.x,a[13]=r.y,a[14]=n.z,a[15]=n.x,a[16]=r.y,a[17]=n.z,a[18]=n.x,a[19]=n.y,a[20]=n.z,a[21]=r.x,a[22]=n.y,a[23]=n.z,s.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}();xn.prototype.setFromObject=function(t){return this.object=t,this.update(),this};xn.prototype.copy=function(t){return ut.prototype.copy.call(this,t),this.object=t.object,this};xn.prototype.clone=function(){return new this.constructor().copy(this)};function da(t,e){this.type="Box3Helper",this.box=t;var i=e!==void 0?e:16776960,n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new he;s.setIndex(new Fe(n,1)),s.addAttribute("position",new le(r,3)),ut.call(this,s,new st({color:i})),this.geometry.computeBoundingSphere()}da.prototype=Object.create(ut.prototype);da.prototype.constructor=da;da.prototype.updateMatrixWorld=function(t){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),ce.prototype.updateMatrixWorld.call(this,t))};function pa(t,e,i){this.type="PlaneHelper",this.plane=t,this.size=e===void 0?1:e;var n=i!==void 0?i:16776960,r=[1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],s=new he;s.addAttribute("position",new le(r,3)),s.computeBoundingSphere(),kt.call(this,s,new st({color:n}));var a=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],o=new he;o.addAttribute("position",new le(a,3)),o.computeBoundingSphere(),this.add(new Et(o,new It({color:n,opacity:.2,transparent:!0,depthWrite:!1})))}pa.prototype=Object.create(kt.prototype);pa.prototype.constructor=pa;pa.prototype.updateMatrixWorld=function(t){var e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?xt:ss,this.lookAt(this.plane.normal),ce.prototype.updateMatrixWorld.call(this,t)};var ds,ja;function sn(t,e,i,n,r,s){ce.call(this),t===void 0&&(t=new S(0,0,1)),e===void 0&&(e=new S(0,0,0)),i===void 0&&(i=1),n===void 0&&(n=16776960),r===void 0&&(r=.2*i),s===void 0&&(s=.2*r),ds===void 0&&(ds=new he,ds.addAttribute("position",new le([0,0,0,0,1,0],3)),ja=new rn(0,.5,1,5,1),ja.translate(0,-.5,0)),this.position.copy(e),this.line=new kt(ds,new st({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Et(ja,new It({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,r,s)}sn.prototype=Object.create(ce.prototype);sn.prototype.constructor=sn;sn.prototype.setDirection=function(){var t=new S,e;return function(n){n.y>.99999?this.quaternion.set(0,0,0,1):n.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(n.z,0,-n.x).normalize(),e=Math.acos(n.y),this.quaternion.setFromAxisAngle(t,e))}}();sn.prototype.setLength=function(t,e,i){e===void 0&&(e=.2*t),i===void 0&&(i=.2*e),this.line.scale.set(1,Math.max(0,t-e),1),this.line.updateMatrix(),this.cone.scale.set(i,e,i),this.cone.position.y=t,this.cone.updateMatrix()};sn.prototype.setColor=function(t){this.line.material.color.copy(t),this.cone.material.color.copy(t)};sn.prototype.copy=function(t){return ce.prototype.copy.call(this,t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this};sn.prototype.clone=function(){return new this.constructor().copy(this)};function nl(t){t=t||1;var e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],n=new he;n.addAttribute("position",new le(e,3)),n.addAttribute("color",new le(i,3));var r=new st({vertexColors:sr});ut.call(this,n,r)}nl.prototype=Object.create(ut.prototype);nl.prototype.constructor=nl;_e.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(_e.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t};Object.assign(Zi.prototype,{createPointsGeometry:function(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var e=new Ie,i=0,n=t.length;i<n;i++){var r=t[i];e.vertices.push(new S(r.x,r.y,r.z||0))}return e}});Object.assign(bi.prototype,{fromPoints:function(t){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}});Object.create(ii.prototype);Object.create(ii.prototype);function ku(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),ii.call(this,t),this.type="catmullrom"}ku.prototype=Object.create(ii.prototype);Object.assign(ku.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}});tl.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};Kr.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};Object.assign(oa.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Eu.extractUrlBase(t)}});Object.assign(Tu.prototype,{setTexturePath:function(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}});Object.assign(Pu.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}});Object.assign(Ti.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}});Ou.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)};Object.assign(Te,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Te.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Te.ceilPowerOfTwo(t)}});Object.assign(Rt.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(t){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}});Object.assign(we.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){var t;return function(){return t===void 0&&(t=new S),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),t.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(t){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,i,n,r,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,n,i,r,s)}});Bi.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)};tt.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)};Object.assign(ar.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}});Object.assign(Ft.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}});Object.assign(Ft,{barycoordFromPoint:function(t,e,i,n,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Ft.getBarycoord(t,e,i,n,r)},normal:function(t,e,i,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Ft.getNormal(t,e,i,n)}});Object.assign(un.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Yn(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Kn(this,t)}});Object.assign(X.prototype,{fromAttribute:function(t,e,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}});Object.assign(S.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}});Object.assign(et.prototype,{fromAttribute:function(t,e,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}});Object.assign(Ie.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}});Object.assign(ce.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}});Object.defineProperties(ce.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Object.defineProperties(ks.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}});Object.defineProperty(Co.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}});Ns.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};Object.defineProperty(_e.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}});ct.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(t)};Object.defineProperties(ot.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}});Object.defineProperties(Fe.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}});Object.assign(he.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addDrawCall:function(t,e,i){i!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}});Object.defineProperties(he.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});Object.assign(Hi.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}});Object.defineProperties(Qo.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}});Object.defineProperties(Pe.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new me}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=t===zh}}});Object.defineProperties(Ii.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});Object.defineProperties(Vt.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}});Object.assign(Cl.prototype,{clearTarget:function(t,e,i,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,i,n)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")}});Object.defineProperties(Cl.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(hu.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(Hn.prototype,{activeCubeFace:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeCubeFace has been removed. It is now the second parameter of WebGLRenderer.setRenderTarget().")}},activeMipMapLevel:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeMipMapLevel has been removed. It is now the third parameter of WebGLRenderer.setRenderTarget().")}}});Object.defineProperties(Li.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}});Object.defineProperties(fu.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}},userHeight:{set:function(){console.warn("THREE.WebVRManager: .userHeight has been removed.")}}});$r.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var e=this,i=new Su;return i.load(t,function(n){e.setBuffer(n)}),this};Mu.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()};la.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)};dn.crossOrigin=void 0;dn.loadTexture=function(t,e,i,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var r=new Dl;r.setCrossOrigin(this.crossOrigin);var s=r.load(t,i,void 0,n);return e&&(s.mapping=e),s};dn.loadTextureCube=function(t,e,i,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var r=new xu;r.setCrossOrigin(this.crossOrigin);var s=r.load(t,i,void 0,n);return e&&(s.mapping=e),s};dn.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};dn.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const b0="0.12.1",T0={three:"^0.105.2"};b0.split(".")[1];const Hc=T0.three.split(".")[1],ts={ORBIT:0,DEVICEORIENTATION:1},gt={UNKNOWN:0,NORMAL:1,CARDBOARD:2,STEREO:3},wt={Info:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABAAAAAQADq8/hgAAADBklEQVR42u2bP08UQRiHnzFaSYCI/xoksdBIqGwIiYWRUBISExpCQ0ej38FWOmlIKKhoMPEbaCxsrrHiYrQgOSlQEaICrT+LHSPZzNzt3s3c3Hn7lHvLzvv82L2dm30XKioqKgYY062BJF0HpoA7wARwBbhsPz4DjoEG8AnYNcZ8Sx1Op8IXJM1KWpdUV3nq9m9nJV1I7VNGfEzSM0mNNqR9NOwxx1L7NRMflbQm6SSgeJ4TO8Zoat+8/LKkg4jieQ4kLaf2RtKwpJ0uiufZkTScSn5S0l5C+b/sSZrstvyMpKPU5uc4kjTTjkvpeYCkaeA1/+7hvcIZMGuMqUULQNIU8Aa4ltrWwyHwyBizGzwASSPAe+B2assW7AH3jTE/i+xcZoa12Qfy2Bo3i+5cKABl99zF1GYlWFTBeULLS0DZrOsDcDNggTXgc27bLWA64BhfgHvGmB8dHUXZ1DM0S45xliKMs9bKr+klIOkqsBrwv9JtVq1DewEAT4Ch1BYdMGQdygeg7Df4SmqDAKyoyXpCszPgITCeuvoAjFuX0gE8jljUdv7bCtiOOJ7XpdUZ8L/gdXHOA5QtYH5NXXVgbrgWWn1nwFTqaiPgdPIFcDd1tRFwOl307DwRuZgXwLvctgfA04hjOp18AcReZ6sZY16e3yDpUuQxnU6+S2AkcjEpcDr1zxOXSPgCKLSa0mc4nXwB/EpdbQScTr4AGqmrjYDTyRfAx9TVRsDp5Aug8LJyH+F0cgZg58z11BUHpO5ruGh2G3ybuuqAeF2aBfAqddUB8bq0OgP2U1cegH3aOQOMMb+BrdTVB2DLupQLwLIOnKY26IBT6+ClaQDGmO/ARmqLDtiwDn7HVkcY+EdjNoTlCI+tYhO2iUppm6HKslPUq2qQKHpUe8AFsjaUXuUQWCgqXyoAG8IuME/WkNRrnAHzZfqDSgdgQ6gBc2Td3b3CMTBXtkOsIzTIjZLnQhjcVtlcEIPZLJ0LoVvt8s/Va+3yuSAG84UJRxB98cpM9dJURUVFxSDzBxKde4Lk3/h2AAAAAElFTkSuQmCC",Arrow:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABAAAAAQADq8/hgAAADPklEQVR42u2bMUscQRiG30/SRaJEI1ZKUiRErNIELRUbQYSAnX8hpVUgkDYp0wgWVjYW+QcJaQzYpLojJIXhtDDEKBpj65ti58ixmdmb2ZvZ7+T2AUHudmfmeXf2bnb3O6CmpqZmgJGqOiI5AWAWwEMA0wDuArht3r4CcAagBeAbgIaI/NQOp1fhIZKLJN+SbDKcptl3keSQtk+I+BjJVyRbJaRdtEybY9p+ReKjJN+QvIwonufS9DGq7ZuXXyd5nFA8zzHJdW1vkLxDcrdC8Ty7JO9oyc+QPFCUb3NAcqZq+TmSp9rmHZySnCvjErwOIPkUwHv8+w7vF64ALIrIfrIASM4C+ADgnratgxMACyLSiB4AyREAnwE80LbswgGAJyJy4bNxyApr6wbIw4xxy3djrwCYfeeuaZsFsEbPdULXU4DZqusLgMkEA21P05EEbf8A8FhEzos28pkBLxLKL5s/r/M1kEkz9vKQHGeatf05yfmOfubNa7G5JDle5NhtBjwHMBz5yFwAWBaRT+0XzP8pZsKwcQiH2fX8Ycojb+kzxUw4ZJn7CSQXqpRPHMKCq7+iZJ71Mvdy/DftXSQ6HcJdSDaqPPKW/mPOBO+lcbvzCU35RCFM2PpwnQKzZQfdgfe0dxH5dLA6uQJ4pC2fIASrkyuA6X6QjxyC1ckVQNn7bNHlI4ZgdXIFUObiJJl8pBCsTjGfuIwA2Cv4FN7xbYjkjqsRAHuIePXoCiDF1Zk2VidXAL+1R5sAq5MrgJb2aBNgdXIF8FV7tAmwOrkCCFs73wysTtYATHFCU3vEEWm6Ci6KvgY/ao86Ik6XogDeaY86Ik6XbjPgSHvkEThCwQy45XpDRK5JbgN4GWkgUyR9H65MRQxgW0SunZ5FezK7pfwd8e8MV8UfAPdF5Jdrg8JrAbPjprZFD2wWyQP6j8ZSEufRmGlgQ9umBBvd5IOgbjFUKLu+XnWBhG+rpsFVZGUo/coJgFVf+aAATAgNACvICpL6jSsAKyH1QcEBmBD2ASwhq+7uF84ALIVWiPUEB7lQsiOEwS2VzQUxmMXSuRCqKpd/zX4rl88FMZg/mLAEcSN+MlP/aKqmpqZmkPkL0hSjwOpNKxwAAAAASUVORK5CYII=",FullscreenEnter:"data:image/svg+xml;base64,PHN2ZyBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz4KICAgIDxwYXRoIGQ9Ik03IDE0SDV2NWg1di0ySDd2LTN6bS0yLTRoMlY3aDNWNUg1djV6bTEyIDdoLTN2Mmg1di01aC0ydjN6TTE0IDV2MmgzdjNoMlY1aC01eiIvPgo8L3N2Zz4=",FullscreenLeave:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggc3R5bGU9ImZpbGw6I2ZmZiIgZD0iTTE0LDE0SDE5VjE2SDE2VjE5SDE0VjE0TTUsMTRIMTBWMTlIOFYxNkg1VjE0TTgsNUgxMFYxMEg1VjhIOFY1TTE5LDhWMTBIMTRWNUgxNlY4SDE5WiIgLz48L3N2Zz4=",VideoPlay:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggc3R5bGU9ImZpbGw6I2ZmZiIgZD0iTTgsNS4xNFYxOS4xNEwxOSwxMi4xNEw4LDUuMTRaIiAvPjwvc3ZnPg==",VideoPause:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggc3R5bGU9ImZpbGw6I2ZmZiIgZD0iTTE0LDE5LjE0SDE4VjUuMTRIMTRNNiwxOS4xNEgxMFY1LjE0SDZWMTkuMTRaIiAvPjwvc3ZnPg==",WhiteTile:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIABAMAAAAGVsnJAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAB1WlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOkNvbXByZXNzaW9uPjE8L3RpZmY6Q29tcHJlc3Npb24+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDx0aWZmOlBob3RvbWV0cmljSW50ZXJwcmV0YXRpb24+MjwvdGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KAtiABQAAACRQTFRFAAAAAAAABgYGBwcHHh4eKysrx8fHy8vLzMzM7OzsAAAABgYG+q7SZgAAAAp0Uk5TAP7+/v7+/v7+/iJx/a8AAAOwSURBVHja7d0hbsNAEAVQo6SFI6XEcALDcgNLvUBvEBQVhpkWVYWlhSsVFS7t5QIshRt695lEASZP+8c7a1kzDL1fz+/zyuvzp6FbvoddrL6uDd1yGZ5eXldeb18N3fIx7A+58prmhm65DfvDcd0952lu6JabFbD/zVprZj1lzcys+fj9z8xTZtbT8rv8yWlu6BYAIgAAAAAAAAAAAABAM6QXEAEAAAAAAAAAgJ2gnaAIiIA3Q2qAGgAAAAAAAAAAAAAAAAAAAAAAAAAAQJsADkVFAAAAAAA8Bj0GRUAEREAEREAEREAEREAEAAAAAAAAAAB2gnaCIiACPplRA9QANUAERAAAAEVQERQBERCBVlfAcZ3aeZobusUKMGBhV6KUElHGKBERJR6/fxExRkQZl9/lT8S1oVsuhqyYMmPKjCkzvfcCpsxohrwY0Q06EAEAAAAAAAAAAACgGdILiAAAAAAAAAAAwE7QTlAERMCbITVADQAAAAAAAAAAAAAAAAAAAAAAAAAAwKmwQ1ERAAAAAACPQY9BERABERABERABERABERABAAAAAAAAAICdoJ2gCIiAT2bUADVADRABEQAAQBFUBEVABERgEyvAlJm+V4ApM6bMmDJjyowpM6bMdN0LmDKjGfJiRDfoQAQAAAAAAAAAAACAZkgvIAIAAAAAAAAAADtBO0EREAFvhtQANQAAAAAAAAAAAAAAAAAAAAAAAAAAAKfCDkVFAAAAAAA8Bj0GRUAEREAEREAEREAEREAEAAAAAAAAAAB2gnaCIiACPplRA9QANUAERAAAAEVQERQBERCBTawAU2b6XgGmzJgyY8qMKTOmzJgy03UvYMqMZsiLEd2gAxEAAAAAAAAAAAAAmiG9gAgAAAAAAAAAAOwE7QRFQAS8GVID1AAAAAAAAAAAAAAAAAAAAAAAAAAAAJwKOxQVAQAAAADwGPQYFAEREAEREAEREAEREAERAAAAAAAAAADYCdoJioAI+GRGDVAD1AAREAEAABRBRVAEREAENrECTJnpewWYMmPKjCkzpsyYMmPKTNe9gCkzmiEvRnSDDkQAAAAAAAAAAAAAaIb0AiIAAAAAAAAAALATtBMUARHwZkgNUAMAAAAAAAAAAAAAAAAAAAAAAAAAAHAq7FBUBAAAAADAY9BjUAREQAREQAREQAREQAREAAAAAAAAAABgJ2gnKAIi4JMZNUANUANEQAQAAFAEFUEREAER2MQKMGWm7xVgyowpM50PWen9ugNGXz1XaocAFgAAAABJRU5ErkJggg==",Setting:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABAAAAAQADq8/hgAAADn0lEQVR42u2bzUsVURjGnyO6CPzAMnTjppAo3LTwH1CqTfaxbeOiRS37A0wXtROFVi1aRBs3LWohSIGbQAQXViBGRhG0UIRKUCpK7q/FnOB2uc6cOXNmRnGe3eW+H8/7zLln3vNxpQoVKlQ4wjBFJAFOSRqX1O7osivpvjHmU1nChBZglvSYLYJbS0EanCvIJzWK+gnsyH34/8OuMaYjb265jwCgz6N4SWq3vodbAEmnS/KtBDgoAgyU5BteAOAkMAPcBroc7PskDWfgN+wyDwBdltMMcDI3tYBnde/pHeARMNTErgd4APzweP834oeN1dMkz5DlsFNn/yyv4kdiSK4At4AO4CqwGaDwRmza2B0210qM7YhrXU59ANAq6bWkwQTTn5KO5fIE0uVYlXTeGLOXFMx1DrjlULwKKN41x6DlnIjEEQCckPRe0okCiguJr5LOGGO+xhm5jICJQ1i8LOeJJKPYEQAMKvrtt5ZdjSf2FM0Fq/sZJI2A6UNcvCz36TiDfUcAcE1SPu/U6Mm8k/TFfu6XdFb5iX3dGPM8lQfwNod3+TowBnQ3yddtv1vPIe+b1JIBiwEJ1IAJ208k5W21trWA+V/5CHAcmAtU/A2P/DcCiTAHHE8tgCVhgLvAXgYCk17Jo/yTGfLuWe7Zd72AC8CWB4n3OAz7mLytNkZabAEXMhfeQKYfWEpJZCxA3rGUOZeA/qDF15FpAz47EvlNk9neI2e3jeWCz0BbmvipNkSMMX8kuSZYM8Z8zyqAjbHmaN5mOeYjgIXrU93MWrxHrNQjrqiDkQMLHwG+OdqF3NN3jeXKzU8AoF1SzdH8XKhJUO7HZDXLMbwAwICkJUULFxe0SbqSVQAbw3Xi7Ze0ZLmGAzAKbHs0JGU1QtvAaIjCW4B7ZOvJy2qFa5a730RPtBiaz0CgnkiZi6F5fBZDVMvho7EhcuS3xJJ2hV9IupgTqaLw0hhzab8vq23xOG/r+LDsKjLgYVzxUnU0ltwK2wDezUyJmEwqXgp/PL4rvxthaeCSI+zxuA10J8ZkWdJNSb2SLkvayKHwDRu71+ZajrG941J8agALDQ3GU/a/IvMkYCPzmCbtLNEVmacNtgs5iP9fYVNEV1Q6Hez7yNZSL+J2SarTcpqiyV2iUkG0IvPFvbz5FbEn+KEk3wMjwMeSfCsBXFBdly9CAPk9ydyffpECuB5tZfVJjaKWueOSfinln6YK4lahQoUKRxd/AcRPGTcQCAUQAAAAAElFTkSuQmCC",ChevronRight:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTguNTksMTYuNThMMTMuMTcsMTJMOC41OSw3LjQxTDEwLDZMMTYsMTJMMTAsMThMOC41OSwxNi41OFoiIC8+PC9zdmc+",Check:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTIxLDdMOSwxOUwzLjUsMTMuNUw0LjkxLDEyLjA5TDksMTYuMTdMMTkuNTksNS41OUwyMSw3WiIgLz48L3N2Zz4=",ViewIndicator:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBpZD0idmlldy1pbmRpY2F0b3IiIGhlaWdodD0iMzAiIHdpZHRoPSIzMCIgdmlld0JveD0iLTIuNSAtMSAzMCAzMCI+Cgk8c3R5bGUgdHlwZT0idGV4dC9jc3MiPi5zdDB7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLW1pdGVybGltaXQ6MTA7ZmlsbDpub25lO30uc3Qxe3N0cm9rZS13aWR0aDo2O3N0cm9rZS1taXRlcmxpbWl0OjEwO30KCTwvc3R5bGU+Cgk8Zz4KCQk8cGF0aCBjbGFzcz0ic3QwIiBkPSJNIDEyLjUgMCBBIDEyLjUgMTIuNSAwIDAgMCAtMTIuNSAwIEEgMTIuNSAxMi41IDAgMCAwIDEyLjUgMCIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxMywxNS41KSI+PC9wYXRoPgoJCTxwYXRoIGNsYXNzPSJzdDIiIGQ9Ik0gMTMgMCBMIDEwIDIgTCAxNiAyIFoiPjwvcGF0aD4KCQk8cGF0aCBjbGFzcz0ic3QyIiBkPSJNIDIgMCBBIDIgMiAwIDAgMCAtMiAwIEEgMiAyIDAgMCAwIDIgMCIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxMywxNS41KSI+PC9wYXRoPgoJCTxwYXRoIGNsYXNzPSJzdDEiIGlkPSJpbmRpY2F0b3IiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMTMsMTUuNSkiPjwvcGF0aD4KCTwvZz4KPC9zdmc+"},Nu={load:function(t,e=()=>{},i=()=>{},n=()=>{}){Gt.enabled=!0;let r,s,a,o,l,c,h;for(let f in wt)wt.hasOwnProperty(f)&&t===wt[f]&&(h=f);if(r=Gt.get(h||t),r!==void 0)return e&&setTimeout(function(){i({loaded:1,total:1}),e(r)},0),r;l=window.URL||window.webkitURL,c=document.createElementNS("http://www.w3.org/1999/xhtml","img"),Gt.add(h||t,c);const u=()=>{l.revokeObjectURL(c.src),e(c)};if(t.indexOf("data:")===0)return c.addEventListener("load",u,!1),c.src=t,c;c.crossOrigin=this.crossOrigin!==void 0?this.crossOrigin:"",s=new window.XMLHttpRequest,s.open("GET",t,!0),{}.npm_lifecycle_event!=="test"&&(s.onreadystatechange=function(){this.readyState===4&&this.status>=400&&n()}),s.responseType="arraybuffer",s.addEventListener("error",n),s.addEventListener("progress",f=>{if(!f)return;const{loaded:d,total:p,lengthComputable:m}=f;m&&i({loaded:d,total:p})}),s.addEventListener("loadend",f=>{if(!f)return;const{currentTarget:{response:d}}=f;a=new Uint8Array(d),o=new window.Blob([a]),c.addEventListener("load",u,!1),c.src=l.createObjectURL(o)}),s.send(null)}},Nl={load:function(t,e=()=>{},i,n){var r=new Ye;return Nu.load(t,function(s){r.image=s;const a=t.search(/\.(jpg|jpeg)$/)>0||t.search(/^data\:image\/jpeg/)===0;r.format=a?Ai:Si,r.needsUpdate=!0,e(r)},i,n),r}},_0={load:function(t,e=()=>{},i=()=>{},n){var r,s,a,o,l;return r=new Mi([]),s=0,a={},o={},t.map(function(c,h){Nu.load(c,function(u){r.images[h]=u,s++,s===6&&(r.needsUpdate=!0,e(r))},function(u){a[h]={loaded:u.loaded,total:u.total},o.loaded=0,o.total=0,l=0;for(var f in a)l++,o.loaded+=a[f].loaded,o.total+=a[f].total;l<6&&(o.total=o.total/l*6),i(o)},n)}),r}};function Bu(t){const e={video:{width:{ideal:1920},height:{ideal:1080},facingMode:{exact:"environment"}},audio:!1};this.constraints=Object.assign(e,t),this.container=null,this.scene=null,this.element=null,this.devices=[],this.stream=null,this.ratioScalar=1,this.videoDeviceIndex=0}Bu.prototype=Object.assign(Object.create(Zt.prototype),{setContainer:function(t){this.container=t},setScene:function(t){this.scene=t},enumerateDevices:function(){const t=this.devices,e=new Promise(i=>{i(t)});return t.length>0?e:window.navigator.mediaDevices.enumerateDevices()},switchNextVideoDevice:function(){const t=this.stop.bind(this),e=this.start.bind(this),i=this.setVideDeviceIndex.bind(this);let n=this.videoDeviceIndex;this.getDevices("video").then(r=>{t(),n++,n>=r.length?(i(0),n--):i(n),e(r[n])})},getDevices:function(t="video"){const e=this.devices,i=r=>r.map(s=>(e.includes(s)||e.push(s),s)),n=r=>{const s=new RegExp(t,"i");return r.filter(a=>s.test(a.kind))};return this.enumerateDevices().then(i).then(n)},getUserMedia:function(t){const e=this.setMediaStream.bind(this),i=this.playVideo.bind(this),n=r=>{console.warn(`PANOLENS.Media: ${r}`)};return window.navigator.mediaDevices.getUserMedia(t).then(e).then(i).catch(n)},setVideDeviceIndex:function(t){this.videoDeviceIndex=t},start:function(t){const e=this.constraints,i=this.getUserMedia.bind(this),n=r=>{if(!r||r.length===0)throw Error("no video device found");const s=t||r[0];return e.video.deviceId=s.deviceId,i(e)};return this.element=this.createVideoElement(),this.getDevices().then(n)},stop:function(){const t=this.stream;t&&t.active&&(t.getTracks()[0].stop(),window.removeEventListener("resize",this.onWindowResize.bind(this)),this.element=null,this.stream=null)},setMediaStream:function(t){this.stream=t,this.element.srcObject=t,this.scene&&(this.scene.background=this.createVideoTexture()),window.addEventListener("resize",this.onWindowResize.bind(this))},playVideo:function(){const{element:t}=this;t&&(t.play(),this.dispatchEvent({type:"play"}))},pauseVideo:function(){const{element:t}=this;t&&(t.pause(),this.dispatchEvent({type:"pause"}))},createVideoTexture:function(){const t=this.element,e=new Bs(t);return e.generateMipmaps=!1,e.minFilter=ht,e.magFilter=ht,e.format=Ai,e.center.set(.5,.5),t.addEventListener("canplay",this.onWindowResize.bind(this)),e},createVideoElement:function(){const t=this.dispatchEvent.bind(this),e=document.createElement("video"),i=()=>t({type:"canplay"});return e.setAttribute("autoplay",""),e.setAttribute("muted",""),e.setAttribute("playsinline",""),e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.objectPosition="center",e.style.objectFit="cover",e.style.display=this.scene?"none":"",e.addEventListener("canplay",i),e},onWindowResize:function(){if(this.element&&this.element.videoWidth&&this.element.videoHeight&&this.scene){const{clientWidth:t,clientHeight:e}=this.container,i=this.scene.background,{videoWidth:n,videoHeight:r}=this.element,s=r/n,a=this.container?t/e:1,o=s*a*this.ratioScalar;t>e?i.repeat.set(o,1):i.repeat.set(1,1/o)}}});function rl(t=16777215,e=!0,i=1500){this.dpr=window.devicePixelRatio;const{canvas:n,context:r}=this.createCanvas(),s=new nn({color:t,map:this.createCanvasTexture(n)});vn.call(this,s),this.canvasWidth=n.width,this.canvasHeight=n.height,this.context=r,this.color=t instanceof me?t:new me(t),this.autoSelect=e,this.dwellTime=i,this.rippleDuration=500,this.position.z=-10,this.center.set(.5,.5),this.scale.set(.5,.5,1),this.startTimestamp=null,this.timerId=null,this.callback=null,this.frustumCulled=!1,this.updateCanvasArcByProgress(0)}rl.prototype=Object.assign(Object.create(vn.prototype),{constructor:rl,setColor:function(t){this.material.color.copy(t instanceof me?t:new me(t))},createCanvasTexture:function(t){const e=new Lr(t);return e.minFilter=ht,e.magFilter=ht,e.generateMipmaps=!1,e},createCanvas:function(){const i=document.createElement("canvas"),n=i.getContext("2d"),r=this.dpr;return i.width=32*r,i.height=32*r,n.scale(r,r),n.shadowBlur=5,n.shadowColor="rgba(200,200,200,0.9)",{canvas:i,context:n}},updateCanvasArcByProgress:function(t){const e=this.context,{canvasWidth:i,canvasHeight:n,material:r}=this,s=this.dpr,a=t*Math.PI*2,o=this.color.getStyle(),l=i*.5/s,c=n*.5/s,h=3;e.clearRect(0,0,i,n),e.beginPath(),t===0?(e.arc(l,c,i/16,0,2*Math.PI),e.fillStyle=o,e.fill()):(e.arc(l,c,i/4-h,-Math.PI/2,-Math.PI/2+a),e.strokeStyle=o,e.lineWidth=h,e.stroke()),e.closePath(),r.map.needsUpdate=!0},ripple:function(){const t=this.context,{canvasWidth:e,canvasHeight:i,material:n}=this,r=this.rippleDuration,s=performance.now(),a=this.color,o=this.dpr,l=e*.5/o,c=i*.5/o,h=()=>{const u=window.requestAnimationFrame(h),d=(performance.now()-s)/r,p=1-d>0?1-d:0,m=d*e*.5/o;t.clearRect(0,0,e,i),t.beginPath(),t.arc(l,c,m,0,Math.PI*2),t.fillStyle=`rgba(${a.r*255}, ${a.g*255}, ${a.b*255}, ${p})`,t.fill(),t.closePath(),d>=1&&(window.cancelAnimationFrame(u),this.updateCanvasArcByProgress(0),this.dispatchEvent({type:"reticle-ripple-end"})),n.map.needsUpdate=!0};this.dispatchEvent({type:"reticle-ripple-start"}),h()},show:function(){this.visible=!0},hide:function(){this.visible=!1},start:function(t){this.autoSelect&&(this.dispatchEvent({type:"reticle-start"}),this.startTimestamp=performance.now(),this.callback=t,this.update())},end:function(){this.startTimestamp&&(window.cancelAnimationFrame(this.timerId),this.updateCanvasArcByProgress(0),this.callback=null,this.timerId=null,this.startTimestamp=null,this.dispatchEvent({type:"reticle-end"}))},update:function(){this.timerId=window.requestAnimationFrame(this.update.bind(this));const e=(performance.now()-this.startTimestamp)/this.dwellTime;this.updateCanvasArcByProgress(e),this.dispatchEvent({type:"reticle-update",progress:e}),e>=1&&(window.cancelAnimationFrame(this.timerId),this.callback&&this.callback(),this.end(),this.ripple())}});function w0(t,e){return e={exports:{}},t(e,e.exports),e.exports}var rt=w0(function(t,e){var i=function(){this._tweens={},this._tweensAddedDuringUpdate={}};i.prototype={getAll:function(){return Object.keys(this._tweens).map(function(r){return this._tweens[r]}.bind(this))},removeAll:function(){this._tweens={}},add:function(r){this._tweens[r.getId()]=r,this._tweensAddedDuringUpdate[r.getId()]=r},remove:function(r){delete this._tweens[r.getId()],delete this._tweensAddedDuringUpdate[r.getId()]},update:function(r,s){var a=Object.keys(this._tweens);if(a.length===0)return!1;for(r=r!==void 0?r:n.now();a.length>0;){this._tweensAddedDuringUpdate={};for(var o=0;o<a.length;o++){var l=this._tweens[a[o]];l&&l.update(r)===!1&&(l._isPlaying=!1,s||delete this._tweens[a[o]])}a=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var n=new i;n.Group=i,n._nextId=0,n.nextId=function(){return n._nextId++},typeof self>"u"&&typeof process<"u"&&process.hrtime?n.now=function(){var r=process.hrtime();return r[0]*1e3+r[1]/1e6}:typeof self<"u"&&self.performance!==void 0&&self.performance.now!==void 0?n.now=self.performance.now.bind(self.performance):Date.now!==void 0?n.now=Date.now:n.now=function(){return new Date().getTime()},n.Tween=function(r,s){this._object=r,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=n.Easing.Linear.None,this._interpolationFunction=n.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onRepeatCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=s||n,this._id=n.nextId()},n.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(r,s){return this._valuesEnd=Object.create(r),s!==void 0&&(this._duration=s),this},duration:function(s){return this._duration=s,this},start:function(r){this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=r!==void 0?typeof r=="string"?n.now()+parseFloat(r):r:n.now(),this._startTime+=this._delayTime;for(var s in this._valuesEnd){if(this._valuesEnd[s]instanceof Array){if(this._valuesEnd[s].length===0)continue;this._valuesEnd[s]=[this._object[s]].concat(this._valuesEnd[s])}this._object[s]!==void 0&&(this._valuesStart[s]=this._object[s],this._valuesStart[s]instanceof Array||(this._valuesStart[s]*=1),this._valuesStartRepeat[s]=this._valuesStart[s]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,this._onStopCallback!==null&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(1/0),this},stopChainedTweens:function(){for(var r=0,s=this._chainedTweens.length;r<s;r++)this._chainedTweens[r].stop()},group:function(r){return this._group=r,this},delay:function(r){return this._delayTime=r,this},repeat:function(r){return this._repeat=r,this},repeatDelay:function(r){return this._repeatDelayTime=r,this},yoyo:function(r){return this._yoyo=r,this},easing:function(r){return this._easingFunction=r,this},interpolation:function(r){return this._interpolationFunction=r,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(r){return this._onStartCallback=r,this},onUpdate:function(r){return this._onUpdateCallback=r,this},onRepeat:function(s){return this._onRepeatCallback=s,this},onComplete:function(r){return this._onCompleteCallback=r,this},onStop:function(r){return this._onStopCallback=r,this},update:function(r){var s,a,o;if(r<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback!==null&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),a=(r-this._startTime)/this._duration,a=this._duration===0||a>1?1:a,o=this._easingFunction(a);for(s in this._valuesEnd)if(this._valuesStart[s]!==void 0){var l=this._valuesStart[s]||0,c=this._valuesEnd[s];c instanceof Array?this._object[s]=this._interpolationFunction(c,o):(typeof c=="string"&&(c.charAt(0)==="+"||c.charAt(0)==="-"?c=l+parseFloat(c):c=parseFloat(c)),typeof c=="number"&&(this._object[s]=l+(c-l)*o))}if(this._onUpdateCallback!==null&&this._onUpdateCallback(this._object,a),a===1)if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(s in this._valuesStartRepeat){if(typeof this._valuesEnd[s]=="string"&&(this._valuesStartRepeat[s]=this._valuesStartRepeat[s]+parseFloat(this._valuesEnd[s])),this._yoyo){var h=this._valuesStartRepeat[s];this._valuesStartRepeat[s]=this._valuesEnd[s],this._valuesEnd[s]=h}this._valuesStart[s]=this._valuesStartRepeat[s]}return this._yoyo&&(this._reversed=!this._reversed),this._repeatDelayTime!==void 0?this._startTime=r+this._repeatDelayTime:this._startTime=r+this._delayTime,this._onRepeatCallback!==null&&this._onRepeatCallback(this._object),!0}else{this._onCompleteCallback!==null&&this._onCompleteCallback(this._object);for(var u=0,f=this._chainedTweens.length;u<f;u++)this._chainedTweens[u].start(this._startTime+this._duration);return!1}return!0}},n.Easing={Linear:{None:function(r){return r}},Quadratic:{In:function(r){return r*r},Out:function(r){return r*(2-r)},InOut:function(r){return(r*=2)<1?.5*r*r:-.5*(--r*(r-2)-1)}},Cubic:{In:function(r){return r*r*r},Out:function(r){return--r*r*r+1},InOut:function(r){return(r*=2)<1?.5*r*r*r:.5*((r-=2)*r*r+2)}},Quartic:{In:function(r){return r*r*r*r},Out:function(r){return 1- --r*r*r*r},InOut:function(r){return(r*=2)<1?.5*r*r*r*r:-.5*((r-=2)*r*r*r-2)}},Quintic:{In:function(r){return r*r*r*r*r},Out:function(r){return--r*r*r*r*r+1},InOut:function(r){return(r*=2)<1?.5*r*r*r*r*r:.5*((r-=2)*r*r*r*r+2)}},Sinusoidal:{In:function(r){return 1-Math.cos(r*Math.PI/2)},Out:function(r){return Math.sin(r*Math.PI/2)},InOut:function(r){return .5*(1-Math.cos(Math.PI*r))}},Exponential:{In:function(r){return r===0?0:Math.pow(1024,r-1)},Out:function(r){return r===1?1:1-Math.pow(2,-10*r)},InOut:function(r){return r===0?0:r===1?1:(r*=2)<1?.5*Math.pow(1024,r-1):.5*(-Math.pow(2,-10*(r-1))+2)}},Circular:{In:function(r){return 1-Math.sqrt(1-r*r)},Out:function(r){return Math.sqrt(1- --r*r)},InOut:function(r){return(r*=2)<1?-.5*(Math.sqrt(1-r*r)-1):.5*(Math.sqrt(1-(r-=2)*r)+1)}},Elastic:{In:function(r){return r===0?0:r===1?1:-Math.pow(2,10*(r-1))*Math.sin((r-1.1)*5*Math.PI)},Out:function(r){return r===0?0:r===1?1:Math.pow(2,-10*r)*Math.sin((r-.1)*5*Math.PI)+1},InOut:function(r){return r===0?0:r===1?1:(r*=2,r<1?-.5*Math.pow(2,10*(r-1))*Math.sin((r-1.1)*5*Math.PI):.5*Math.pow(2,-10*(r-1))*Math.sin((r-1.1)*5*Math.PI)+1)}},Back:{In:function(r){var s=1.70158;return r*r*((s+1)*r-s)},Out:function(r){var s=1.70158;return--r*r*((s+1)*r+s)+1},InOut:function(r){var s=2.5949095;return(r*=2)<1?.5*(r*r*((s+1)*r-s)):.5*((r-=2)*r*((s+1)*r+s)+2)}},Bounce:{In:function(r){return 1-n.Easing.Bounce.Out(1-r)},Out:function(r){return r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375},InOut:function(r){return r<.5?n.Easing.Bounce.In(r*2)*.5:n.Easing.Bounce.Out(r*2-1)*.5+.5}}},n.Interpolation={Linear:function(r,s){var a=r.length-1,o=a*s,l=Math.floor(o),c=n.Interpolation.Utils.Linear;return s<0?c(r[0],r[1],o):s>1?c(r[a],r[a-1],a-o):c(r[l],r[l+1>a?a:l+1],o-l)},Bezier:function(r,s){for(var a=0,o=r.length-1,l=Math.pow,c=n.Interpolation.Utils.Bernstein,h=0;h<=o;h++)a+=l(1-s,o-h)*l(s,h)*r[h]*c(o,h);return a},CatmullRom:function(r,s){var a=r.length-1,o=a*s,l=Math.floor(o),c=n.Interpolation.Utils.CatmullRom;return r[0]===r[a]?(s<0&&(l=Math.floor(o=a*(1+s))),c(r[(l-1+a)%a],r[l],r[(l+1)%a],r[(l+2)%a],o-l)):s<0?r[0]-(c(r[0],r[0],r[1],r[1],-o)-r[0]):s>1?r[a]-(c(r[a],r[a],r[a-1],r[a-1],o-a)-r[a]):c(r[l?l-1:0],r[l],r[a<l+1?a:l+1],r[a<l+2?a:l+2],o-l)},Utils:{Linear:function(r,s,a){return(s-r)*a+r},Bernstein:function(r,s){var a=n.Interpolation.Utils.Factorial;return a(r)/a(s)/a(r-s)},Factorial:function(){var r=[1];return function(s){var a=1;if(r[s])return r[s];for(var o=s;o>1;o--)a*=o;return r[s]=a,a}}(),CatmullRom:function(r,s,a,o,l){var c=(a-r)*.5,h=(o-s)*.5,u=l*l,f=l*u;return(2*s-2*a+c+h)*f+(-3*s+3*a-2*c-h)*u+c*l+s}}},function(r){t.exports=n}()});function gi(t=300,e,i){e=e||wt.Info,vn.call(this),this.type="infospot",this.animated=i!==void 0?i:!0,this.isHovering=!1,this.frustumCulled=!1,this.element=null,this.toPanorama=null,this.cursorStyle=null,this.mode=gt.NORMAL,this.scale.set(t,t,1),this.rotation.y=Math.PI,this.container=null,this.originalRaycast=this.raycast,this.HANDLER_FOCUS=null,this.material.side=rr,this.material.depthTest=!1,this.material.transparent=!0,this.material.opacity=0,this.scaleUpAnimation=new rt.Tween,this.scaleDownAnimation=new rt.Tween;const s=function(a){if(!this.material)return;const o=a.image.width/a.image.height,l=new S;a.image.width=a.image.naturalWidth||64,a.image.height=a.image.naturalHeight||64,this.scale.set(o*t,t,1),l.copy(this.scale),this.scaleUpAnimation=new rt.Tween(this.scale).to({x:l.x*1.3,y:l.y*1.3},500).easing(rt.Easing.Elastic.Out),this.scaleDownAnimation=new rt.Tween(this.scale).to({x:l.x,y:l.y},500).easing(rt.Easing.Elastic.Out),this.material.map=a,this.material.needsUpdate=!0}.bind(this);this.showAnimation=new rt.Tween(this.material).to({opacity:1},500).onStart(this.enableRaycast.bind(this,!0)).easing(rt.Easing.Quartic.Out),this.hideAnimation=new rt.Tween(this.material).to({opacity:0},500).onStart(this.enableRaycast.bind(this,!1)).easing(rt.Easing.Quartic.Out),this.addEventListener("click",this.onClick),this.addEventListener("hover",this.onHover),this.addEventListener("hoverenter",this.onHoverStart),this.addEventListener("hoverleave",this.onHoverEnd),this.addEventListener("panolens-dual-eye-effect",this.onDualEyeEffect),this.addEventListener("panolens-container",this.setContainer.bind(this)),this.addEventListener("dismiss",this.onDismiss),this.addEventListener("panolens-infospot-focus",this.setFocusMethod),Nl.load(e,s)}gi.prototype=Object.assign(Object.create(vn.prototype),{constructor:gi,setContainer:function(t){let e;t instanceof HTMLElement?e=t:t&&t.container&&(e=t.container),e&&this.element&&e.appendChild(this.element),this.container=e},getContainer:function(){return this.container},onClick:function(t){this.element&&this.getContainer()&&(this.onHoverStart(t),this.lockHoverElement())},onDismiss:function(){this.element&&(this.unlockHoverElement(),this.onHoverEnd())},onHover:function(){},onHoverStart:function(t){if(!this.getContainer())return;const e=this.cursorStyle||(this.mode===gt.NORMAL?"pointer":"default"),{scaleDownAnimation:i,scaleUpAnimation:n,element:r}=this;if(this.isHovering=!0,this.container.style.cursor=e,this.animated&&(i.stop(),n.start()),r&&t.mouseEvent.clientX>=0&&t.mouseEvent.clientY>=0){const{left:s,right:a,style:o}=r;this.mode===gt.CARDBOARD||this.mode===gt.STEREO?(o.display="none",s.style.display="block",a.style.display="block",r._width=s.clientWidth,r._height=s.clientHeight):(o.display="block",s&&(s.style.display="none"),a&&(a.style.display="none"),r._width=r.clientWidth,r._height=r.clientHeight)}},onHoverEnd:function(){if(!this.getContainer())return;const{scaleDownAnimation:t,scaleUpAnimation:e,element:i}=this;if(this.isHovering=!1,this.container.style.cursor="default",this.animated&&(e.stop(),t.start()),i&&!this.element.locked){const{left:n,right:r,style:s}=i;s.display="none",n&&(n.style.display="none"),r&&(r.style.display="none"),this.unlockHoverElement()}},onDualEyeEffect:function(t){if(!this.getContainer())return;let e,i,n;this.mode=t.mode,e=this.element,i=this.container.clientWidth/2,n=this.container.clientHeight/2,e&&(!e.left&&!e.right&&(e.left=e.cloneNode(!0),e.right=e.cloneNode(!0)),this.mode===gt.CARDBOARD||this.mode===gt.STEREO?(e.left.style.display=e.style.display,e.right.style.display=e.style.display,e.style.display="none"):(e.style.display=e.left.style.display,e.left.style.display="none",e.right.style.display="none"),this.translateElement(i,n),this.container.appendChild(e.left),this.container.appendChild(e.right))},translateElement:function(t,e){if(!this.element._width||!this.element._height||!this.getContainer())return;let i,n,r,s,a,o,l;l=this.container,r=this.element,s=r._width/2,a=r._height/2,o=r.verticalDelta!==void 0?r.verticalDelta:40,i=t-s,n=e-a-o,(this.mode===gt.CARDBOARD||this.mode===gt.STEREO)&&r.left&&r.right&&!(t===l.clientWidth/2&&e===l.clientHeight/2)?(i=l.clientWidth/4-s+(t-l.clientWidth/2),n=l.clientHeight/2-a-o+(e-l.clientHeight/2),this.setElementStyle("transform",r.left,"translate("+i+"px, "+n+"px)"),i+=l.clientWidth/2,this.setElementStyle("transform",r.right,"translate("+i+"px, "+n+"px)")):this.setElementStyle("transform",r,"translate("+i+"px, "+n+"px)")},setElementStyle:function(t,e,i){const n=e.style;t==="transform"&&(n.webkitTransform=n.msTransform=n.transform=i)},setText:function(t){this.element&&(this.element.textContent=t)},setCursorHoverStyle:function(t){this.cursorStyle=t},addHoverText:function(t,e=40){this.element||(this.element=document.createElement("div"),this.element.style.display="none",this.element.style.color="#fff",this.element.style.top=0,this.element.style.maxWidth="50%",this.element.style.maxHeight="50%",this.element.style.textShadow="0 0 3px #000000",this.element.style.fontFamily='"Trebuchet MS", Helvetica, sans-serif',this.element.style.position="absolute",this.element.classList.add("panolens-infospot"),this.element.verticalDelta=e),this.setText(t)},addHoverElement:function(t,e=40){this.element||(this.element=t.cloneNode(!0),this.element.style.display="none",this.element.style.top=0,this.element.style.position="absolute",this.element.classList.add("panolens-infospot"),this.element.verticalDelta=e)},removeHoverElement:function(){this.element&&(this.element.left&&(this.container.removeChild(this.element.left),this.element.left=null),this.element.right&&(this.container.removeChild(this.element.right),this.element.right=null),this.container.removeChild(this.element),this.element=null)},lockHoverElement:function(){this.element&&(this.element.locked=!0)},unlockHoverElement:function(){this.element&&(this.element.locked=!1)},enableRaycast:function(t=!0){t?this.raycast=this.originalRaycast:this.raycast=()=>{}},show:function(t=0){const{animated:e,hideAnimation:i,showAnimation:n,material:r}=this;e?(i.stop(),n.delay(t).start()):(this.enableRaycast(!0),r.opacity=1)},hide:function(t=0){const{animated:e,hideAnimation:i,showAnimation:n,material:r,element:s}=this;if(s){const{style:a}=s;a.display="none"}e?(n.stop(),i.delay(t).start()):(this.enableRaycast(!1),r.opacity=0)},setFocusMethod:function(t){t&&(this.HANDLER_FOCUS=t.method)},focus:function(t,e){this.HANDLER_FOCUS&&(this.HANDLER_FOCUS(this.position,t,e),this.onDismiss())},dispose:function(){const{geometry:t,material:e}=this,{map:i}=e;this.removeHoverElement(),this.parent&&this.parent.remove(this),i&&(i.dispose(),e.map=null),t&&(t.dispose(),this.geometry=null),e&&(e.dispose(),this.material=null)}});function sl(t){t||console.warn("PANOLENS.Widget: No container specified"),Zt.call(this),this.DEFAULT_TRANSITION="all 0.27s ease",this.TOUCH_ENABLED=!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch),this.PREVENT_EVENT_HANDLER=function(e){e.preventDefault(),e.stopPropagation()},this.container=t,this.barElement=null,this.fullscreenElement=null,this.videoElement=null,this.settingElement=null,this.mainMenu=null,this.activeMainItem=null,this.activeSubMenu=null,this.mask=null}sl.prototype=Object.assign(Object.create(Zt.prototype),{constructor:sl,addControlBar:function(){if(!this.container){console.warn("Widget container not set");return}var t=this,e,i,n,r;r="linear-gradient(bottom, rgba(0,0,0,0.2), rgba(0,0,0,0))",e=document.createElement("div"),e.style.width="100%",e.style.height="44px",e.style.float="left",e.style.transform=e.style.webkitTransform=e.style.msTransform="translateY(-100%)",e.style.background="-webkit-"+r,e.style.background="-moz-"+r,e.style.background="-o-"+r,e.style.background="-ms-"+r,e.style.background=r,e.style.transition=this.DEFAULT_TRANSITION,e.style.pointerEvents="none",e.isHidden=!1,e.toggle=function(){e.isHidden=!e.isHidden,i=e.isHidden?"translateY(0)":"translateY(-100%)",n=e.isHidden?0:1,e.style.transform=e.style.webkitTransform=e.style.msTransform=i,e.style.opacity=n};var s=this.createDefaultMenu();this.mainMenu=this.createMainMenu(s),e.appendChild(this.mainMenu);var a=this.createMask();this.mask=a,this.container.appendChild(a),e.dispose=function(){t.fullscreenElement&&(e.removeChild(t.fullscreenElement),t.fullscreenElement.dispose(),t.fullscreenElement=null),t.settingElement&&(e.removeChild(t.settingElement),t.settingElement.dispose(),t.settingElement=null),t.videoElement&&(e.removeChild(t.videoElement),t.videoElement.dispose(),t.videoElement=null)},this.container.appendChild(e),this.mask.addEventListener("mousemove",this.PREVENT_EVENT_HANDLER,!0),this.mask.addEventListener("mouseup",this.PREVENT_EVENT_HANDLER,!0),this.mask.addEventListener("mousedown",this.PREVENT_EVENT_HANDLER,!0),this.mask.addEventListener(t.TOUCH_ENABLED?"touchend":"click",function(o){o.preventDefault(),o.stopPropagation(),t.mask.hide(),t.settingElement.deactivate()},!1),this.addEventListener("control-bar-toggle",e.toggle),this.barElement=e},createDefaultMenu:function(){var t=this,e;return e=function(i,n){return function(){t.dispatchEvent({type:"panolens-viewer-handler",method:i,data:n})}},[{title:"Control",subMenu:[{title:this.TOUCH_ENABLED?"Touch":"Mouse",handler:e("enableControl",ts.ORBIT)},{title:"Sensor",handler:e("enableControl",ts.DEVICEORIENTATION)}]},{title:"Mode",subMenu:[{title:"Normal",handler:e("disableEffect")},{title:"Cardboard",handler:e("enableEffect",gt.CARDBOARD)},{title:"Stereoscopic",handler:e("enableEffect",gt.STEREO)}]}]},addControlButton:function(t){let e;switch(t){case"fullscreen":e=this.createFullscreenButton(),this.fullscreenElement=e;break;case"setting":e=this.createSettingButton(),this.settingElement=e;break;case"video":e=this.createVideoControl(),this.videoElement=e;break;default:return}e&&this.barElement.appendChild(e)},createMask:function(){const t=document.createElement("div");return t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.width="100%",t.style.height="100%",t.style.background="transparent",t.style.display="none",t.show=function(){this.style.display="block"},t.hide=function(){this.style.display="none"},t},createSettingButton:function(){let t=this,e;function i(n){n.preventDefault(),n.stopPropagation(),t.mainMenu.toggle(),this.activated?this.deactivate():this.activate()}return e=this.createCustomItem({style:{backgroundImage:'url("'+wt.Setting+'")',webkitTransition:this.DEFAULT_TRANSITION,transition:this.DEFAULT_TRANSITION},onTap:i}),e.activate=function(){this.style.transform="rotate3d(0,0,1,90deg)",this.activated=!0,t.mask.show()},e.deactivate=function(){this.style.transform="rotate3d(0,0,0,0)",this.activated=!1,t.mask.hide(),t.mainMenu&&t.mainMenu.visible&&t.mainMenu.hide(),t.activeSubMenu&&t.activeSubMenu.visible&&t.activeSubMenu.hide(),t.mainMenu&&t.mainMenu._width&&(t.mainMenu.changeSize(t.mainMenu._width),t.mainMenu.unslideAll())},e.activated=!1,e},createFullscreenButton:function(){let t=this,e,i=!1,n=!0,r;const{container:s}=this;if(r="panolens-style-addon",!document.fullscreenEnabled&&!document.webkitFullscreenEnabled&&!document.mozFullScreenEnabled&&!document.msFullscreenEnabled)return;function a(l){l.preventDefault(),l.stopPropagation(),n=!1,i?(document.exitFullscreen&&document.exitFullscreen(),document.msExitFullscreen&&document.msExitFullscreen(),document.mozCancelFullScreen&&document.mozCancelFullScreen(),document.webkitExitFullscreen&&document.webkitExitFullscreen(),i=!1):(s.requestFullscreen&&s.requestFullscreen(),s.msRequestFullscreen&&s.msRequestFullscreen(),s.mozRequestFullScreen&&s.mozRequestFullScreen(),s.webkitRequestFullscreen&&s.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),i=!0),this.style.backgroundImage=i?'url("'+wt.FullscreenLeave+'")':'url("'+wt.FullscreenEnter+'")'}function o(){n&&(i=!i,e.style.backgroundImage=i?'url("'+wt.FullscreenLeave+'")':'url("'+wt.FullscreenEnter+'")'),t.dispatchEvent({type:"panolens-viewer-handler",method:"onWindowResize"}),n=!0}if(document.addEventListener("fullscreenchange",o,!1),document.addEventListener("webkitfullscreenchange",o,!1),document.addEventListener("mozfullscreenchange",o,!1),document.addEventListener("MSFullscreenChange",o,!1),e=this.createCustomItem({style:{backgroundImage:'url("'+wt.FullscreenEnter+'")'},onTap:a}),!document.querySelector(r)){const l=document.createElement("style");l.id=r,l.innerHTML=":-webkit-full-screen { width: 100% !important; height: 100% !important }",document.body.appendChild(l)}return e},createVideoControl:function(){const t=document.createElement("span");return t.style.display="none",t.show=function(){t.style.display=""},t.hide=function(){t.style.display="none",t.controlButton.paused=!0,t.controlButton.update()},t.controlButton=this.createVideoControlButton(),t.seekBar=this.createVideoControlSeekbar(),t.appendChild(t.controlButton),t.appendChild(t.seekBar),t.dispose=function(){t.removeChild(t.controlButton),t.removeChild(t.seekBar),t.controlButton.dispose(),t.controlButton=null,t.seekBar.dispose(),t.seekBar=null},this.addEventListener("video-control-show",t.show),this.addEventListener("video-control-hide",t.hide),t},createVideoControlButton:function(){const t=this;function e(n){n.preventDefault(),n.stopPropagation(),t.dispatchEvent({type:"panolens-viewer-handler",method:"toggleVideoPlay",data:!this.paused}),this.paused=!this.paused,i.update()}const i=this.createCustomItem({style:{float:"left",backgroundImage:'url("'+wt.VideoPlay+'")'},onTap:e});return i.paused=!0,i.update=function(n){this.paused=n!==void 0?n:this.paused,this.style.backgroundImage='url("'+(this.paused?wt.VideoPlay:wt.VideoPause)+'")'},i},createVideoControlSeekbar:function(){let t=this,e,i,n,r=!1,s,a,o;i=document.createElement("div"),i.style.width="0%",i.style.height="100%",i.style.backgroundColor="#fff",n=document.createElement("div"),n.style.float="right",n.style.width="14px",n.style.height="14px",n.style.transform="translate(7px, -5px)",n.style.borderRadius="50%",n.style.backgroundColor="#ddd",n.addEventListener("mousedown",l,{passive:!0}),n.addEventListener("touchstart",l,{passive:!0});function l(m){m.stopPropagation(),r=!0,s=m.clientX||m.changedTouches&&m.changedTouches[0].clientX,a=parseInt(i.style.width)/100,u()}function c(m){r&&(o=((m.clientX||m.changedTouches&&m.changedTouches[0].clientX)-s)/e.clientWidth,o=a+o,o=o>1?1:o<0?0:o,e.setProgress(o),t.dispatchEvent({type:"panolens-viewer-handler",method:"setVideoCurrentTime",data:o}))}function h(m){m.stopPropagation(),r=!1,f()}function u(){t.container.addEventListener("mousemove",c,{passive:!0}),t.container.addEventListener("mouseup",h,{passive:!0}),t.container.addEventListener("touchmove",c,{passive:!0}),t.container.addEventListener("touchend",h,{passive:!0})}function f(){t.container.removeEventListener("mousemove",c,!1),t.container.removeEventListener("mouseup",h,!1),t.container.removeEventListener("touchmove",c,!1),t.container.removeEventListener("touchend",h,!1)}function d(m){if(m.preventDefault(),m.stopPropagation(),m.target===n)return;const g=m.changedTouches&&m.changedTouches.length>0?(m.changedTouches[0].pageX-m.target.getBoundingClientRect().left)/this.clientWidth:m.offsetX/this.clientWidth;t.dispatchEvent({type:"panolens-viewer-handler",method:"setVideoCurrentTime",data:g}),e.setProgress(m.offsetX/this.clientWidth)}function p(){f(),i=null,n=null}return i.appendChild(n),e=this.createCustomItem({style:{float:"left",width:"30%",height:"4px",marginTop:"20px",backgroundColor:"rgba(188,188,188,0.8)"},onTap:d,onDispose:p}),e.appendChild(i),e.setProgress=function(m){i.style.width=m*100+"%"},this.addEventListener("video-update",function(m){e.setProgress(m.percentage)}),e.progressElement=i,e.progressElementControl=n,e},createMenuItem:function(t){const e=this,i=document.createElement("a");return i.textContent=t,i.style.display="block",i.style.padding="10px",i.style.textDecoration="none",i.style.cursor="pointer",i.style.pointerEvents="auto",i.style.transition=this.DEFAULT_TRANSITION,i.slide=function(n){this.style.transform="translateX("+(n?"":"-")+"100%)"},i.unslide=function(){this.style.transform="translateX(0)"},i.setIcon=function(n){this.icon&&(this.icon.style.backgroundImage="url("+n+")")},i.setSelectionTitle=function(n){this.selection&&(this.selection.textContent=n)},i.addSelection=function(n){const r=document.createElement("span");return r.style.fontSize="13px",r.style.fontWeight="300",r.style.float="right",this.selection=r,this.setSelectionTitle(n),this.appendChild(r),this},i.addIcon=function(n=wt.ChevronRight,r=!1,s=!1){const a=document.createElement("span");return a.style.float=r?"left":"right",a.style.width="17px",a.style.height="17px",a.style["margin"+(r?"Right":"Left")]="12px",a.style.backgroundSize="cover",s&&(a.style.transform="rotateZ(180deg)"),this.icon=a,this.setIcon(n),this.appendChild(a),this},i.addSubMenu=function(n,r){return this.subMenu=e.createSubMenu(n,r),this},i.addEventListener("mouseenter",function(){this.style.backgroundColor="#e0e0e0"},!1),i.addEventListener("mouseleave",function(){this.style.backgroundColor="#fafafa"},!1),i},createMenuItemHeader:function(t){const e=this.createMenuItem(t);return e.style.borderBottom="1px solid #333",e.style.paddingBottom="15px",e},createMainMenu:function(t){let e=this,i=this.createMenu();i._width=200,i.changeSize(i._width);function n(o){o.preventDefault(),o.stopPropagation();let l=e.mainMenu,c=this.subMenu;function h(){l.changeSize(c.clientWidth),c.show(),c.unslideAll()}l.hide(),l.slideAll(),l.parentElement.appendChild(c),e.activeMainItem=this,e.activeSubMenu=c,window.requestAnimationFrame(h)}for(var r=0;r<t.length;r++){var s=i.addItem(t[r].title);if(s.style.paddingLeft="20px",s.addIcon().addEventListener(e.TOUCH_ENABLED?"touchend":"click",n,!1),t[r].subMenu&&t[r].subMenu.length>0){var a=t[r].subMenu[0].title;s.addSelection(a).addSubMenu(t[r].title,t[r].subMenu)}}return i},createSubMenu:function(t,e){let i=this,n,r=this.createMenu();r.items=e,r.activeItem=null;function s(a){a.preventDefault(),a.stopPropagation(),n=i.mainMenu,n.changeSize(n._width),n.unslideAll(),n.show(),r.slideAll(!0),r.hide(),this.type!=="header"&&(r.setActiveItem(this),i.activeMainItem.setSelectionTitle(this.textContent),this.handler&&this.handler())}r.addHeader(t).addIcon(void 0,!0,!0).addEventListener(i.TOUCH_ENABLED?"touchend":"click",s,!1);for(let a=0;a<e.length;a++){const o=r.addItem(e[a].title);o.style.fontWeight=300,o.handler=e[a].handler,o.addIcon(" ",!0),o.addEventListener(i.TOUCH_ENABLED?"touchend":"click",s,!1),r.activeItem||r.setActiveItem(o)}return r.slideAll(!0),r},createMenu:function(){const t=this,e=document.createElement("span"),i=e.style;return i.padding="5px 0",i.position="fixed",i.bottom="100%",i.right="14px",i.backgroundColor="#fafafa",i.fontFamily="Helvetica Neue",i.fontSize="14px",i.visibility="hidden",i.opacity=0,i.boxShadow="0 0 12pt rgba(0,0,0,0.25)",i.borderRadius="2px",i.overflow="hidden",i.willChange="width, height, opacity",i.pointerEvents="auto",i.transition=this.DEFAULT_TRANSITION,e.visible=!1,e.changeSize=function(n,r){n&&(this.style.width=n+"px"),r&&(this.style.height=r+"px")},e.show=function(){this.style.opacity=1,this.style.visibility="visible",this.visible=!0},e.hide=function(){this.style.opacity=0,this.style.visibility="hidden",this.visible=!1},e.toggle=function(){this.visible?this.hide():this.show()},e.slideAll=function(n){for(let r=0;r<e.children.length;r++)e.children[r].slide&&e.children[r].slide(n)},e.unslideAll=function(){for(let n=0;n<e.children.length;n++)e.children[n].unslide&&e.children[n].unslide()},e.addHeader=function(n){const r=t.createMenuItemHeader(n);return r.type="header",this.appendChild(r),r},e.addItem=function(n){const r=t.createMenuItem(n);return r.type="item",this.appendChild(r),r},e.setActiveItem=function(n){this.activeItem&&this.activeItem.setIcon(" "),n.setIcon(wt.Check),this.activeItem=n},e.addEventListener("mousemove",this.PREVENT_EVENT_HANDLER,!0),e.addEventListener("mouseup",this.PREVENT_EVENT_HANDLER,!0),e.addEventListener("mousedown",this.PREVENT_EVENT_HANDLER,!0),e},createCustomItem:function(t={}){const e=this,i=t.element||document.createElement("span"),{onDispose:n}=t;return i.style.cursor="pointer",i.style.float="right",i.style.width="44px",i.style.height="100%",i.style.backgroundSize="60%",i.style.backgroundRepeat="no-repeat",i.style.backgroundPosition="center",i.style.webkitUserSelect=i.style.MozUserSelect=i.style.userSelect="none",i.style.position="relative",i.style.pointerEvents="auto",i.addEventListener(e.TOUCH_ENABLED?"touchstart":"mouseenter",function(){i.style.filter=i.style.webkitFilter="drop-shadow(0 0 5px rgba(255,255,255,1))"},{passive:!0}),i.addEventListener(e.TOUCH_ENABLED?"touchend":"mouseleave",function(){i.style.filter=i.style.webkitFilter=""},{passive:!0}),this.mergeStyleOptions(i,t.style),t.onTap&&i.addEventListener(e.TOUCH_ENABLED?"touchend":"click",t.onTap,!1),i.dispose=function(){i.removeEventListener(e.TOUCH_ENABLED?"touchend":"click",t.onTap,!1),n&&t.onDispose()},i},mergeStyleOptions:function(t,e={}){for(let i in e)e.hasOwnProperty(i)&&(t.style[i]=e[i]);return t},dispose:function(){this.barElement&&(this.container.removeChild(this.barElement),this.barElement.dispose(),this.barElement=null)}});function mt(t,e){Et.call(this,t,e),this.type="panorama",this.ImageQualityLow=1,this.ImageQualityFair=2,this.ImageQualityMedium=3,this.ImageQualityHigh=4,this.ImageQualitySuperHigh=5,this.animationDuration=1e3,this.defaultInfospotSize=350,this.container=void 0,this.loaded=!1,this.linkedSpots=[],this.isInfospotVisible=!1,this.linkingImageURL=void 0,this.linkingImageScale=void 0,this.material.side=xt,this.material.opacity=0,this.scale.x*=-1,this.renderOrder=-1,this.active=!1,this.infospotAnimation=new rt.Tween(this).to({},this.animationDuration/2),this.addEventListener("load",this.fadeIn.bind(this)),this.addEventListener("panolens-container",this.setContainer.bind(this)),this.addEventListener("click",this.onClick.bind(this)),this.setupTransitions()}mt.prototype=Object.assign(Object.create(Et.prototype),{constructor:mt,add:function(t){let e;if(arguments.length>1){for(var i=0;i<arguments.length;i++)this.add(arguments[i]);return this}if(t instanceof gi){if(e=t,t.dispatchEvent){const{container:n}=this;n&&t.dispatchEvent({type:"panolens-container",container:n}),t.dispatchEvent({type:"panolens-infospot-focus",method:function(r,s,a){this.dispatchEvent({type:"panolens-viewer-handler",method:"tweenControlCenter",data:[r,s,a]})}.bind(this)})}}else e=new ce,e.scale.x=-1,e.scalePlaceHolder=!0,e.add(t);ce.prototype.add.call(this,e)},load:function(){this.onLoad()},onClick:function(t){t.intersects&&t.intersects.length===0&&this.traverse(function(e){e.dispatchEvent({type:"dismiss"})})},setContainer:function(t){let e;t instanceof HTMLElement?e=t:t&&t.container&&(e=t.container),e&&(this.children.forEach(function(i){i instanceof gi&&i.dispatchEvent&&i.dispatchEvent({type:"panolens-container",container:e})}),this.container=e)},onLoad:function(){this.loaded=!0,this.dispatchEvent({type:"load"})},onProgress:function(t){this.dispatchEvent({type:"progress",progress:t})},onError:function(){this.dispatchEvent({type:"error"})},getZoomLevel:function(){let t;return window.innerWidth<=800?t=this.ImageQualityFair:window.innerWidth>800&&window.innerWidth<=1280?t=this.ImageQualityMedium:window.innerWidth>1280&&window.innerWidth<=1920?t=this.ImageQualityHigh:window.innerWidth>1920?t=this.ImageQualitySuperHigh:t=this.ImageQualityLow,t},updateTexture:function(t){this.material.map=t,this.material.needsUpdate=!0},toggleInfospotVisibility:function(t,e){e=e!==void 0?e:0;const i=t!==void 0?t:!this.isInfospotVisible;this.traverse(function(n){n instanceof gi&&(i?n.show(e):n.hide(e))}),this.isInfospotVisible=i,this.infospotAnimation.onComplete(function(){this.dispatchEvent({type:"infospot-animation-complete",visible:i})}.bind(this)).delay(e).start()},setLinkingImage:function(t,e){this.linkingImageURL=t,this.linkingImageScale=e},link:function(t,e,i,n){let r,s;if(this.visible=!0,!e){console.warn("Please specify infospot position for linking");return}i!==void 0?r=i:t.linkingImageScale!==void 0?r=t.linkingImageScale:r=300,n?s=n:t.linkingImageURL?s=t.linkingImageURL:s=wt.Arrow;const a=new gi(r,s);a.position.copy(e),a.toPanorama=t,a.addEventListener("click",function(){this.dispatchEvent({type:"panolens-viewer-handler",method:"setPanorama",data:t})}.bind(this)),this.linkedSpots.push(a),this.add(a),this.visible=!1},reset:function(){this.children.length=0},setupTransitions:function(){this.fadeInAnimation=new rt.Tween(this.material).easing(rt.Easing.Quartic.Out).onStart(function(){this.visible=!0,this.dispatchEvent({type:"enter-fade-start"})}.bind(this)),this.fadeOutAnimation=new rt.Tween(this.material).easing(rt.Easing.Quartic.Out).onComplete(function(){this.visible=!1,this.dispatchEvent({type:"leave-complete"})}.bind(this)),this.enterTransition=new rt.Tween(this).easing(rt.Easing.Quartic.Out).onComplete(function(){this.dispatchEvent({type:"enter-complete"})}.bind(this)).start(),this.leaveTransition=new rt.Tween(this).easing(rt.Easing.Quartic.Out)},onFadeAnimationUpdate:function(){const t=this.material.opacity,{uniforms:e}=this.material;e&&e.opacity&&(e.opacity.value=t)},fadeIn:function(t){t=t>=0?t:this.animationDuration,this.fadeOutAnimation.stop(),this.fadeInAnimation.to({opacity:1},t).onUpdate(this.onFadeAnimationUpdate.bind(this)).onComplete(function(){this.toggleInfospotVisibility(!0,t/2),this.dispatchEvent({type:"enter-fade-complete"})}.bind(this)).start()},fadeOut:function(t){t=t>=0?t:this.animationDuration,this.fadeInAnimation.stop(),this.fadeOutAnimation.to({opacity:0},t).onUpdate(this.onFadeAnimationUpdate.bind(this)).start()},onEnter:function(){const t=this.animationDuration;this.leaveTransition.stop(),this.enterTransition.to({},t).onStart(function(){this.dispatchEvent({type:"enter-start"}),this.loaded?this.fadeIn(t):this.load()}.bind(this)).start(),this.dispatchEvent({type:"enter"}),this.children.forEach(e=>{e.dispatchEvent({type:"panorama-enter"})}),this.active=!0},onLeave:function(){const t=this.animationDuration;this.enterTransition.stop(),this.leaveTransition.to({},t).onStart(function(){this.dispatchEvent({type:"leave-start"}),this.fadeOut(t),this.toggleInfospotVisibility(!1)}.bind(this)).start(),this.dispatchEvent({type:"leave"}),this.children.forEach(e=>{e.dispatchEvent({type:"panorama-leave"})}),this.active=!1},dispose:function(){this.infospotAnimation.stop(),this.fadeInAnimation.stop(),this.fadeOutAnimation.stop(),this.enterTransition.stop(),this.leaveTransition.stop(),this.dispatchEvent({type:"panolens-viewer-handler",method:"onPanoramaDispose",data:this});function t(e){const{geometry:i,material:n}=e;for(var r=e.children.length-1;r>=0;r--)t(e.children[r]),e.remove(e.children[r]);e instanceof gi&&e.dispose(),i&&(i.dispose(),e.geometry=null),n&&(n.dispose(),e.material=null)}t(this),this.parent&&this.parent.remove(this)}});function Qt(t,e,i){const r=e||new Ri(5e3,60,40),s=i||new It({opacity:0,transparent:!0});mt.call(this,r,s),this.src=t,this.radius=5e3}Qt.prototype=Object.assign(Object.create(mt.prototype),{constructor:Qt,load:function(t){if(t=t||this.src,t)typeof t=="string"?Nl.load(t,this.onLoad.bind(this),this.onProgress.bind(this),this.onError.bind(this)):t instanceof HTMLImageElement&&this.onLoad(new Ye(t));else{console.warn("Image source undefined");return}},onLoad:function(t){t.minFilter=t.magFilter=ht,t.needsUpdate=!0,this.updateTexture(t),window.requestAnimationFrame(mt.prototype.onLoad.bind(this))},reset:function(){mt.prototype.reset.call(this)},dispose:function(){const{material:{map:t}}=this;Gt.remove(this.src),t&&t.dispose(),mt.prototype.dispose.call(this)}});function Vc(){const t=new he,e=new It({color:0,opacity:0,transparent:!0});t.addAttribute("position",new Fe(new Float32Array,1)),mt.call(this,t,e)}Vc.prototype=Object.assign(Object.create(mt.prototype),{constructor:Vc});function ma(t=[]){const i=Object.assign({},xi.cube),n=new pn(1e4,1e4,1e4),r=new Vt({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:i.uniforms,side:xt,transparent:!0});mt.call(this,n,r),this.images=t,this.edgeLength=1e4,this.material.uniforms.opacity.value=0}ma.prototype=Object.assign(Object.create(mt.prototype),{constructor:ma,load:function(){_0.load(this.images,this.onLoad.bind(this),this.onProgress.bind(this),this.onError.bind(this))},onLoad:function(t){this.material.uniforms.tCube.value=t,mt.prototype.onLoad.call(this)},dispose:function(){const{value:t}=this.material.uniforms.tCube;this.images.forEach(e=>{Gt.remove(e)}),t instanceof Mi&&t.dispose(),mt.prototype.dispose.call(this)}});function zc(){const t=[];for(let e=0;e<6;e++)t.push(wt.WhiteTile);ma.call(this,t)}zc.prototype=Object.assign(Object.create(ma.prototype),{constructor:zc});function cn(t,e={}){const n=new Ri(5e3,60,40),r=new It({opacity:0,transparent:!0});mt.call(this,n,r),this.src=t,this.options={videoElement:document.createElement("video"),loop:!0,muted:!0,autoplay:!1,playsinline:!0,crossOrigin:"anonymous"},Object.assign(this.options,e),this.videoElement=this.options.videoElement,this.videoProgress=0,this.radius=5e3,this.addEventListener("leave",this.pauseVideo.bind(this)),this.addEventListener("enter-fade-start",this.resumeVideoProgress.bind(this)),this.addEventListener("video-toggle",this.toggleVideo.bind(this)),this.addEventListener("video-time",this.setVideoCurrentTime.bind(this))}cn.prototype=Object.assign(Object.create(mt.prototype),{constructor:cn,isMobile:function(){let t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(window.navigator.userAgent||window.navigator.vendor||window.opera),t},load:function(){const{muted:t,loop:e,autoplay:i,playsinline:n,crossOrigin:r}=this.options,s=this.videoElement,a=this.material,o=this.onProgress.bind(this),l=this.onLoad.bind(this);s.loop=e,s.autoplay=i,s.playsinline=n,s.crossOrigin=r,s.muted=t,n&&(s.setAttribute("playsinline",""),s.setAttribute("webkit-playsinline",""));const c=function(){this.setVideoTexture(s),i&&this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!1}),this.isMobile()&&(s.pause(),i&&t?this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!1}):this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!0}));const h=()=>{a.map.needsUpdate=!0,o({loaded:1,total:1}),l()};window.requestAnimationFrame(h)};if(s.readyState>2)c.call(this);else{if(s.querySelectorAll("source").length===0){const h=document.createElement("source");h.src=this.src,s.appendChild(h)}s.load()}s.addEventListener("loadeddata",c.bind(this)),s.addEventListener("timeupdate",function(){this.videoProgress=s.duration>=0?s.currentTime/s.duration:0,this.dispatchEvent({type:"panolens-viewer-handler",method:"onVideoUpdate",data:this.videoProgress})}.bind(this)),s.addEventListener("ended",function(){e||(this.resetVideo(),this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!0}))}.bind(this),!1)},setVideoTexture:function(t){if(!t)return;const e=new Bs(t);e.minFilter=ht,e.magFilter=ht,e.format=Ai,this.updateTexture(e)},reset:function(){this.videoElement=void 0,mt.prototype.reset.call(this)},isVideoPaused:function(){return this.videoElement.paused},toggleVideo:function(){const t=this.videoElement;t&&t[t.paused?"play":"pause"]()},setVideoCurrentTime:function({percentage:t}){const e=this.videoElement;e&&!Number.isNaN(t)&&t!==1&&(e.currentTime=e.duration*t,this.dispatchEvent({type:"panolens-viewer-handler",method:"onVideoUpdate",data:t}))},playVideo:function(){const t=this.videoElement,e=this.playVideo.bind(this),i=this.dispatchEvent.bind(this),n=()=>{i({type:"play"})},r=s=>{window.requestAnimationFrame(e),i({type:"play-error",error:s})};t&&t.paused&&t.play().then(n).catch(r)},pauseVideo:function(){const t=this.videoElement;t&&!t.paused&&t.pause(),this.dispatchEvent({type:"pause"})},resumeVideoProgress:function(){const t=this.videoElement;t.readyState>=4&&t.autoplay&&!this.isMobile()?(this.playVideo(),this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!1})):(this.pauseVideo(),this.dispatchEvent({type:"panolens-viewer-handler",method:"updateVideoPlayButton",data:!0})),this.setVideoCurrentTime({percentage:this.videoProgress})},resetVideo:function(){this.videoElement&&this.setVideoCurrentTime({percentage:0})},isVideoMuted:function(){return this.videoElement.muted},muteVideo:function(){const t=this.videoElement;t&&!t.muted&&(t.muted=!0),this.dispatchEvent({type:"volumechange"})},unmuteVideo:function(){const t=this.videoElement;t&&this.isVideoMuted()&&(t.muted=!1),this.dispatchEvent({type:"volumechange"})},getVideoElement:function(){return this.videoElement},dispose:function(){const{material:{map:t}}=this;this.pauseVideo(),this.removeEventListener("leave",this.pauseVideo.bind(this)),this.removeEventListener("enter-fade-start",this.resumeVideoProgress.bind(this)),this.removeEventListener("video-toggle",this.toggleVideo.bind(this)),this.removeEventListener("video-time",this.setVideoCurrentTime.bind(this)),t&&t.dispose(),mt.prototype.dispose.call(this)}});function al(t={}){this._parameters=t,this._zoom=null,this._panoId=null,this._panoClient=new google.maps.StreetViewService,this._count=0,this._total=0,this._canvas=[],this._ctx=[],this._wc=0,this._hc=0,this.result=null,this.rotation=0,this.copyright="",this.onSizeChange=null,this.onPanoramaLoad=null,this.levelsW=[1,2,4,7,13,26],this.levelsH=[1,1,2,4,7,13],this.widths=[416,832,1664,3328,6656,13312],this.heights=[416,416,832,1664,3328,6656],this.maxW=6656,this.maxH=6656;let e;try{const i=document.createElement("canvas");e=i.getContext("experimental-webgl"),e||(e=i.getContext("webgl"))}catch{}this.maxW=Math.max(e.getParameter(e.MAX_TEXTURE_SIZE),this.maxW),this.maxH=Math.max(e.getParameter(e.MAX_TEXTURE_SIZE),this.maxH)}Object.assign(al.prototype,{constructor:al,setProgress:function(t,e){this.onProgress&&this.onProgress({loaded:t,total:e})},adaptTextureToZoom:function(){const t=this.widths[this._zoom],e=this.heights[this._zoom],i=this.maxW,n=this.maxH;this._wc=Math.ceil(t/i),this._hc=Math.ceil(e/n);for(let r=0;r<this._hc;r++)for(let s=0;s<this._wc;s++){const a=document.createElement("canvas");s<this._wc-1?a.width=i:a.width=t-i*s,r<this._hc-1?a.height=n:a.height=e-n*r,this._canvas.push(a),this._ctx.push(a.getContext("2d"))}},composeFromTile:function(t,e,i){const n=this.maxW,r=this.maxH;t*=512,e*=512;const s=Math.floor(t/n),a=Math.floor(e/r);t-=s*n,e-=a*r,this._ctx[a*this._wc+s].drawImage(i,0,0,i.width,i.height,t,e,512,512),this.progress()},progress:function(){this._count++,this.setProgress(this._count,this._total),this._count===this._total&&(this.canvas=this._canvas,this.panoId=this._panoId,this.zoom=this._zoom,this.onPanoramaLoad&&this.onPanoramaLoad(this._canvas[0]))},composePanorama:function(){this.setProgress(0,1);const t=this.levelsW[this._zoom],e=this.levelsH[this._zoom],i=this;this._count=0,this._total=t*e;const{useWebGL:n}=this._parameters;for(let r=0;r<e;r++)for(let s=0;s<t;s++){const a="https://geo0.ggpht.com/cbk?cb_client=maps_sv.tactile&authuser=0&hl=en&output=tile&zoom="+this._zoom+"&x="+s+"&y="+r+"&panoid="+this._panoId+"&nbt&fover=2";(function(o,l){if(n){const c=Nl.load(a,null,function(){i.composeFromTile(o,l,c)})}else{const c=new Image;c.addEventListener("load",function(){i.composeFromTile(o,l,this)}),c.crossOrigin="",c.src=a}})(s,r)}},load:function(t){this.loadPano(t)},loadPano:function(t){const e=this;this._panoClient.getPanoramaById(t,function(i,n){n===google.maps.StreetViewStatus.OK&&(e.result=i,e.copyright=i.copyright,e._panoId=i.location.pano,e.composePanorama())})},setZoom:function(t){this._zoom=t,this.adaptTextureToZoom()}});function Wc(t,e){Qt.call(this),this.panoId=t,this.gsvLoader=null,this.loadRequested=!1,this.setupGoogleMapAPI(e)}Wc.prototype=Object.assign(Object.create(Qt.prototype),{constructor:Wc,load:function(t){this.loadRequested=!0,t=t||this.panoId||{},t&&this.gsvLoader&&this.loadGSVLoader(t)},setupGoogleMapAPI:function(t){const e=document.createElement("script");e.src="https://maps.googleapis.com/maps/api/js?",e.src+=t?"key="+t:"",e.onreadystatechange=this.setGSVLoader.bind(this),e.onload=this.setGSVLoader.bind(this),document.querySelector("head").appendChild(e)},setGSVLoader:function(){this.gsvLoader=new al,this.loadRequested&&this.load()},getGSVLoader:function(){return this.gsvLoader},loadGSVLoader:function(t){this.loadRequested=!1,this.gsvLoader.onProgress=this.onProgress.bind(this),this.gsvLoader.onPanoramaLoad=this.onLoad.bind(this),this.gsvLoader.setZoom(this.getZoomLevel()),this.gsvLoader.load(t),this.gsvLoader.loaded=!0},onLoad:function(t){Qt.prototype.onLoad.call(this,new Ye(t))},reset:function(){this.gsvLoader=void 0,Qt.prototype.reset.call(this)}});const A0={uniforms:{tDiffuse:{value:new Ye},resolution:{value:1},transform:{value:new we},zoom:{value:1},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D tDiffuse;","uniform float resolution;","uniform mat4 transform;","uniform float zoom;","uniform float opacity;","varying vec2 vUv;","const float PI = 3.141592653589793;","void main(){","vec2 position = -1.0 +  2.0 * vUv;","position *= vec2( zoom * resolution, zoom * 0.5 );","float x2y2 = position.x * position.x + position.y * position.y;","vec3 sphere_pnt = vec3( 2. * position, x2y2 - 1. ) / ( x2y2 + 1. );","sphere_pnt = vec3( transform * vec4( sphere_pnt, 1.0 ) );","vec2 sampleUV = vec2(","(atan(sphere_pnt.y, sphere_pnt.x) / PI + 1.0) * 0.5,","(asin(sphere_pnt.z) / PI + 0.5)",");","gl_FragColor = texture2D( tDiffuse, sampleUV );","gl_FragColor.a *= opacity;","}"].join(`
`)};function Nn(t="image",e,i=1e4,n=.5){t==="image"&&Qt.call(this,e,this.createGeometry(i,n),this.createMaterial(i)),this.size=i,this.ratio=n,this.EPS=1e-6,this.frameId=null,this.dragging=!1,this.userMouse=new X,this.quatA=new tt,this.quatB=new tt,this.quatCur=new tt,this.quatSlerp=new tt,this.vectorX=new S(1,0,0),this.vectorY=new S(0,1,0),this.addEventListener("window-resize",this.onWindowResize)}Nn.prototype=Object.assign(Object.create(Qt.prototype),{constructor:Nn,add:function(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}t instanceof gi&&(t.material.depthTest=!1),Qt.prototype.add.call(this,t)},createGeometry:function(t,e){return new tn(t,t*e)},createMaterial:function(t){const e=Object.assign({},A0),i=e.uniforms;return i.zoom.value=t,i.opacity.value=0,new Vt({uniforms:i,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,side:xt,transparent:!0})},registerMouseEvents:function(){this.container.addEventListener("mousedown",this.onMouseDown.bind(this),{passive:!0}),this.container.addEventListener("mousemove",this.onMouseMove.bind(this),{passive:!0}),this.container.addEventListener("mouseup",this.onMouseUp.bind(this),{passive:!0}),this.container.addEventListener("touchstart",this.onMouseDown.bind(this),{passive:!0}),this.container.addEventListener("touchmove",this.onMouseMove.bind(this),{passive:!0}),this.container.addEventListener("touchend",this.onMouseUp.bind(this),{passive:!0}),this.container.addEventListener("mousewheel",this.onMouseWheel.bind(this),{passive:!1}),this.container.addEventListener("DOMMouseScroll",this.onMouseWheel.bind(this),{passive:!1}),this.container.addEventListener("contextmenu",this.onContextMenu.bind(this),{passive:!0})},unregisterMouseEvents:function(){this.container.removeEventListener("mousedown",this.onMouseDown.bind(this),!1),this.container.removeEventListener("mousemove",this.onMouseMove.bind(this),!1),this.container.removeEventListener("mouseup",this.onMouseUp.bind(this),!1),this.container.removeEventListener("touchstart",this.onMouseDown.bind(this),!1),this.container.removeEventListener("touchmove",this.onMouseMove.bind(this),!1),this.container.removeEventListener("touchend",this.onMouseUp.bind(this),!1),this.container.removeEventListener("mousewheel",this.onMouseWheel.bind(this),!1),this.container.removeEventListener("DOMMouseScroll",this.onMouseWheel.bind(this),!1),this.container.removeEventListener("contextmenu",this.onContextMenu.bind(this),!1)},onMouseDown:function(t){switch(t.touches&&t.touches.length||1){case 1:const i=t.clientX>=0?t.clientX:t.touches[0].clientX,n=t.clientY>=0?t.clientY:t.touches[0].clientY;this.dragging=!0,this.userMouse.set(i,n);break;case 2:const r=t.touches[0].pageX-t.touches[1].pageX,s=t.touches[0].pageY-t.touches[1].pageY,a=Math.sqrt(r*r+s*s);this.userMouse.pinchDistance=a;break}this.onUpdateCallback()},onMouseMove:function(t){switch(t.touches&&t.touches.length||1){case 1:const i=t.clientX>=0?t.clientX:t.touches[0].clientX,n=t.clientY>=0?t.clientY:t.touches[0].clientY,r=Te.degToRad(i-this.userMouse.x)*.4,s=Te.degToRad(n-this.userMouse.y)*.4;this.dragging&&(this.quatA.setFromAxisAngle(this.vectorY,r),this.quatB.setFromAxisAngle(this.vectorX,s),this.quatCur.multiply(this.quatA).multiply(this.quatB),this.userMouse.set(i,n));break;case 2:const a=t.touches[0].pageX-t.touches[1].pageX,o=t.touches[0].pageY-t.touches[1].pageY,l=Math.sqrt(a*a+o*o);this.addZoomDelta(this.userMouse.pinchDistance-l);break}},onMouseUp:function(){this.dragging=!1},onMouseWheel:function(t){t.preventDefault(),t.stopPropagation();let e=0;t.wheelDelta!==void 0?e=t.wheelDelta:t.detail!==void 0&&(e=-t.detail),this.addZoomDelta(e),this.onUpdateCallback()},addZoomDelta:function(t){const e=this.material.uniforms,i=this.size*.1,n=this.size*10;e.zoom.value+=t,e.zoom.value<=i?e.zoom.value=i:e.zoom.value>=n&&(e.zoom.value=n)},onUpdateCallback:function(){this.frameId=window.requestAnimationFrame(this.onUpdateCallback.bind(this)),this.quatSlerp.slerp(this.quatCur,.1),this.material&&this.material.uniforms.transform.value.makeRotationFromQuaternion(this.quatSlerp),!this.dragging&&1-this.quatSlerp.clone().dot(this.quatCur)<this.EPS&&window.cancelAnimationFrame(this.frameId)},reset:function(){this.quatCur.set(0,0,0,1),this.quatSlerp.set(0,0,0,1),this.onUpdateCallback()},onLoad:function(t){this.material.uniforms.resolution.value=this.container.clientWidth/this.container.clientHeight,this.registerMouseEvents(),this.onUpdateCallback(),this.dispatchEvent({type:"panolens-viewer-handler",method:"disableControl"}),Qt.prototype.onLoad.call(this,t)},onLeave:function(){this.unregisterMouseEvents(),this.dispatchEvent({type:"panolens-viewer-handler",method:"enableControl",data:ts.ORBIT}),window.cancelAnimationFrame(this.frameId),Qt.prototype.onLeave.call(this)},onWindowResize:function(){this.material.uniforms.resolution.value=this.container.clientWidth/this.container.clientHeight},onContextMenu:function(){this.dragging=!1},dispose:function(){this.unregisterMouseEvents(),Qt.prototype.dispose.call(this)}});function jc(t,e,i){Nn.call(this,"image",t,e,i)}jc.prototype=Object.assign(Object.create(Nn.prototype),{constructor:jc,onLoad:function(t){this.updateTexture(t),Nn.prototype.onLoad.call(this,t)},updateTexture:function(t){t.minFilter=t.magFilter=ht,this.material.uniforms.tDiffuse.value=t},dispose:function(){const t=this.material.uniforms.tDiffuse;t&&t.value&&t.value.dispose(),Nn.prototype.dispose.call(this)}});function ol(t){const i=new Ri(5e3,60,40),n=new It({visible:!1});mt.call(this,i,n),this.media=new Bu(t),this.radius=5e3,this.addEventListener("enter",this.start.bind(this)),this.addEventListener("leave",this.stop.bind(this)),this.addEventListener("panolens-container",this.onPanolensContainer.bind(this)),this.addEventListener("panolens-scene",this.onPanolensScene.bind(this))}ol.prototype=Object.assign(Object.create(mt.prototype),{constructor:ol,onPanolensContainer:function({container:t}){this.media.setContainer(t)},onPanolensScene:function({scene:t}){this.media.setScene(t)},start:function(){return this.media.start()},stop:function(){this.media.stop()}});function ll(t,e){this.object=t,this.domElement=e!==void 0?e:document,this.frameId=null,this.enabled=!0,this.target=new S,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.noRotate=!1,this.rotateSpeed=-.15,this.noPan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.momentumDampingFactor=.9,this.momentumScalingFactor=-.005,this.momentumKeydownFactor=20,this.minFov=30,this.maxFov=120,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:Oa.LEFT,ZOOM:Oa.MIDDLE,PAN:Oa.RIGHT};var i=this,n=1e-7,r=1e-4,s=new X,a=new X,o=new X,l=new X,c=new X,h=new X,u=new S,f=new S,d=new X,p=new X,m=new X,g=0,v=0,x=0,y=0,b=1,E=new S,w=new S,A=new tt,D=0,O=0,P,L=!1,C,U,j,K,z={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},$=z.NONE;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom;var k=new tt().setFromUnitVectors(t.up,new S(0,1,0)),G=k.clone().inverse(),q={type:"change"},ee={type:"start"},Q={type:"end"};this.setLastQuaternion=function(W){A.copy(W),i.object.quaternion.copy(W)},this.getLastPosition=function(){return w},this.rotateLeft=function(W){W===void 0&&(W=ae()),y-=W},this.rotateUp=function(W){W===void 0&&(W=ae()),x-=W},this.panLeft=function(W){var te=this.object.matrix.elements;u.set(te[0],te[1],te[2]),u.multiplyScalar(-W),E.add(u)},this.panUp=function(W){var te=this.object.matrix.elements;u.set(te[4],te[5],te[6]),u.multiplyScalar(W),E.add(u)},this.pan=function(W,te){var se=i.domElement===document?i.domElement.body:i.domElement;if(i.object instanceof ct){var Le=i.object.position,Re=Le.clone().sub(i.target),ke=Re.length();ke*=Math.tan(i.object.fov/2*Math.PI/180),i.panLeft(2*W*ke/se.clientHeight),i.panUp(2*te*ke/se.clientHeight)}else i.object instanceof en?(i.panLeft(W*(i.object.right-i.object.left)/se.clientWidth),i.panUp(te*(i.object.top-i.object.bottom)/se.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.momentum=function(){if(L){if(Math.abs(D)<r&&Math.abs(O)<r){L=!1;return}O*=this.momentumDampingFactor,D*=this.momentumDampingFactor,y-=this.momentumScalingFactor*D,x-=this.momentumScalingFactor*O}},this.dollyIn=function(W){W===void 0&&(W=V()),i.object instanceof ct?b/=W:i.object instanceof en?(i.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*W)),i.object.updateProjectionMatrix(),i.dispatchEvent(q)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.dollyOut=function(W){W===void 0&&(W=V()),i.object instanceof ct?b*=W:i.object instanceof en?(i.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/W)),i.object.updateProjectionMatrix(),i.dispatchEvent(q)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.update=function(W){var te=this.object.position;f.copy(te).sub(this.target),f.applyQuaternion(k),g=Math.atan2(f.x,f.z),v=Math.atan2(Math.sqrt(f.x*f.x+f.z*f.z),f.y),this.autoRotate&&$===z.NONE&&this.rotateLeft(ae()),this.momentum(),g+=y,v+=x,g=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,g)),v=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,v)),v=Math.max(n,Math.min(Math.PI-n,v));var se=f.length()*b;se=Math.max(this.minDistance,Math.min(this.maxDistance,se)),this.target.add(E),f.x=se*Math.sin(v)*Math.sin(g),f.y=se*Math.cos(v),f.z=se*Math.sin(v)*Math.cos(g),f.applyQuaternion(G),te.copy(this.target).add(f),this.object.lookAt(this.target),y=0,x=0,b=1,E.set(0,0,0),(w.distanceToSquared(this.object.position)>n||8*(1-A.dot(this.object.quaternion))>n)&&(W!==!0&&this.dispatchEvent(q),w.copy(this.object.position),A.copy(this.object.quaternion))},this.reset=function(){$=z.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(q),this.update()},this.getPolarAngle=function(){return v},this.getAzimuthalAngle=function(){return g};function ae(){return 2*Math.PI/60/60*i.autoRotateSpeed}function V(){return Math.pow(.95,i.zoomSpeed)}function oe(W){if(L=!1,D=O=0,i.enabled!==!1){if(W.preventDefault(),W.button===i.mouseButtons.ORBIT){if(i.noRotate===!0)return;$=z.ROTATE,s.set(W.clientX,W.clientY)}else if(W.button===i.mouseButtons.ZOOM){if(i.noZoom===!0)return;$=z.DOLLY,d.set(W.clientX,W.clientY)}else if(W.button===i.mouseButtons.PAN){if(i.noPan===!0)return;$=z.PAN,l.set(W.clientX,W.clientY)}$!==z.NONE&&(document.addEventListener("mousemove",ne,!1),document.addEventListener("mouseup",ve,!1),i.dispatchEvent(ee)),i.update()}}function ne(W){if(i.enabled!==!1){W.preventDefault();var te=i.domElement===document?i.domElement.body:i.domElement;if($===z.ROTATE){if(i.noRotate===!0)return;a.set(W.clientX,W.clientY),o.subVectors(a,s),i.rotateLeft(2*Math.PI*o.x/te.clientWidth*i.rotateSpeed),i.rotateUp(2*Math.PI*o.y/te.clientHeight*i.rotateSpeed),s.copy(a),P&&(D=W.clientX-P.clientX,O=W.clientY-P.clientY),P=W}else if($===z.DOLLY){if(i.noZoom===!0)return;p.set(W.clientX,W.clientY),m.subVectors(p,d),m.y>0?i.dollyIn():m.y<0&&i.dollyOut(),d.copy(p)}else if($===z.PAN){if(i.noPan===!0)return;c.set(W.clientX,W.clientY),h.subVectors(c,l),i.pan(h.x,h.y),l.copy(c)}$!==z.NONE&&i.update()}}function ve(){L=!0,P=void 0,i.enabled!==!1&&(document.removeEventListener("mousemove",ne,!1),document.removeEventListener("mouseup",ve,!1),i.dispatchEvent(Q),$=z.NONE)}function Ee(W){if(!(i.enabled===!1||i.noZoom===!0||$!==z.NONE)){W.preventDefault(),W.stopPropagation();var te=0;W.wheelDelta!==void 0?te=W.wheelDelta:W.detail!==void 0&&(te=-W.detail),te>0?(i.object.fov=i.object.fov<i.maxFov?i.object.fov+1:i.maxFov,i.object.updateProjectionMatrix()):te<0&&(i.object.fov=i.object.fov>i.minFov?i.object.fov-1:i.minFov,i.object.updateProjectionMatrix()),i.update(),i.dispatchEvent(q),i.dispatchEvent(ee),i.dispatchEvent(Q)}}function Ge(W){switch(W.keyCode){case i.keys.UP:C=!1;break;case i.keys.BOTTOM:U=!1;break;case i.keys.LEFT:j=!1;break;case i.keys.RIGHT:K=!1;break}}function I(W){if(!(i.enabled===!1||i.noKeys===!0||i.noRotate===!0)){switch(W.keyCode){case i.keys.UP:C=!0;break;case i.keys.BOTTOM:U=!0;break;case i.keys.LEFT:j=!0;break;case i.keys.RIGHT:K=!0;break}(C||U||j||K)&&(L=!0,C&&(O=-i.rotateSpeed*i.momentumKeydownFactor),U&&(O=i.rotateSpeed*i.momentumKeydownFactor),j&&(D=-i.rotateSpeed*i.momentumKeydownFactor),K&&(D=i.rotateSpeed*i.momentumKeydownFactor))}}function M(W){if(L=!1,D=O=0,i.enabled!==!1){switch(W.touches.length){case 1:if(i.noRotate===!0)return;$=z.TOUCH_ROTATE,s.set(W.touches[0].pageX,W.touches[0].pageY);break;case 2:if(i.noZoom===!0)return;$=z.TOUCH_DOLLY;var te=W.touches[0].pageX-W.touches[1].pageX,se=W.touches[0].pageY-W.touches[1].pageY,Le=Math.sqrt(te*te+se*se);d.set(0,Le);break;case 3:if(i.noPan===!0)return;$=z.TOUCH_PAN,l.set(W.touches[0].pageX,W.touches[0].pageY);break;default:$=z.NONE}$!==z.NONE&&i.dispatchEvent(ee)}}function J(W){if(i.enabled!==!1){W.preventDefault(),W.stopPropagation();var te=i.domElement===document?i.domElement.body:i.domElement;switch(W.touches.length){case 1:if(i.noRotate===!0||$!==z.TOUCH_ROTATE)return;a.set(W.touches[0].pageX,W.touches[0].pageY),o.subVectors(a,s),i.rotateLeft(2*Math.PI*o.x/te.clientWidth*i.rotateSpeed),i.rotateUp(2*Math.PI*o.y/te.clientHeight*i.rotateSpeed),s.copy(a),P&&(D=W.touches[0].pageX-P.pageX,O=W.touches[0].pageY-P.pageY),P={pageX:W.touches[0].pageX,pageY:W.touches[0].pageY},i.update();break;case 2:if(i.noZoom===!0||$!==z.TOUCH_DOLLY)return;var se=W.touches[0].pageX-W.touches[1].pageX,Le=W.touches[0].pageY-W.touches[1].pageY,Re=Math.sqrt(se*se+Le*Le);p.set(0,Re),m.subVectors(p,d),m.y<0?(i.object.fov=i.object.fov<i.maxFov?i.object.fov+1:i.maxFov,i.object.updateProjectionMatrix()):m.y>0&&(i.object.fov=i.object.fov>i.minFov?i.object.fov-1:i.minFov,i.object.updateProjectionMatrix()),d.copy(p),i.update(),i.dispatchEvent(q);break;case 3:if(i.noPan===!0||$!==z.TOUCH_PAN)return;c.set(W.touches[0].pageX,W.touches[0].pageY),h.subVectors(c,l),i.pan(h.x,h.y),l.copy(c),i.update();break;default:$=z.NONE}}}function re(){L=!0,P=void 0,i.enabled!==!1&&(i.dispatchEvent(Q),$=z.NONE)}this.dispose=function(){this.domElement.removeEventListener("mousedown",oe),this.domElement.removeEventListener("mousewheel",Ee),this.domElement.removeEventListener("DOMMouseScroll",Ee),this.domElement.removeEventListener("touchstart",M),this.domElement.removeEventListener("touchend",re),this.domElement.removeEventListener("touchmove",J),window.removeEventListener("keyup",Ge),window.removeEventListener("keydown",I)},this.domElement.addEventListener("mousedown",oe,{passive:!1}),this.domElement.addEventListener("mousewheel",Ee,{passive:!1}),this.domElement.addEventListener("DOMMouseScroll",Ee,{passive:!1}),this.domElement.addEventListener("touchstart",M,{passive:!1}),this.domElement.addEventListener("touchend",re,{passive:!1}),this.domElement.addEventListener("touchmove",J,{passive:!1}),window.addEventListener("keyup",Ge,{passive:!1}),window.addEventListener("keydown",I,{passive:!1}),this.update()}ll.prototype=Object.assign(Object.create(Zt.prototype),{constructor:ll});function cl(t,e){var i=this,n={type:"change"},r=0,s=0,a=0,o=0;this.camera=t,this.camera.rotation.reorder("YXZ"),this.domElement=e!==void 0?e:document,this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alpha=0,this.alphaOffsetAngle=0;var l=function(d){i.deviceOrientation=d},c=function(){i.screenOrientation=window.orientation||0},h=function(d){d.preventDefault(),d.stopPropagation(),a=d.touches[0].pageX,o=d.touches[0].pageY},u=function(d){d.preventDefault(),d.stopPropagation(),r+=Te.degToRad((d.touches[0].pageX-a)/4),s+=Te.degToRad((o-d.touches[0].pageY)/4),i.updateAlphaOffsetAngle(r),a=d.touches[0].pageX,o=d.touches[0].pageY},f=function(d,p,m,g,v){var x=new S(0,0,1),y=new bn,b=new tt,E=new tt(-Math.sqrt(.5),0,0,Math.sqrt(.5)),w,A=new tt,D=new tt;i.screenOrientation==0?(w=new S(1,0,0),A.setFromAxisAngle(w,-s)):i.screenOrientation==180?(w=new S(1,0,0),A.setFromAxisAngle(w,s)):i.screenOrientation==90?(w=new S(0,1,0),A.setFromAxisAngle(w,s)):i.screenOrientation==-90&&(w=new S(0,1,0),A.setFromAxisAngle(w,-s)),E.multiply(A),E.multiply(D),y.set(m,p,-g,"YXZ"),d.setFromEuler(y),d.multiply(E),d.multiply(b.setFromAxisAngle(x,-v))};this.connect=function(){c(),window.addEventListener("orientationchange",c,{passive:!0}),window.addEventListener("deviceorientation",l,{passive:!0}),window.addEventListener("deviceorientation",this.update.bind(this),{passive:!0}),i.domElement.addEventListener("touchstart",h,{passive:!1}),i.domElement.addEventListener("touchmove",u,{passive:!1}),i.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",c,!1),window.removeEventListener("deviceorientation",l,!1),window.removeEventListener("deviceorientation",this.update.bind(this),!1),i.domElement.removeEventListener("touchstart",h,!1),i.domElement.removeEventListener("touchmove",u,!1),i.enabled=!1},this.update=function(d){if(i.enabled!==!1){var p=i.deviceOrientation.alpha?Te.degToRad(i.deviceOrientation.alpha)+i.alphaOffsetAngle:0,m=i.deviceOrientation.beta?Te.degToRad(i.deviceOrientation.beta):0,g=i.deviceOrientation.gamma?Te.degToRad(i.deviceOrientation.gamma):0,v=i.screenOrientation?Te.degToRad(i.screenOrientation):0;f(i.camera.quaternion,p,m,g,v),i.alpha=p,d!==!0&&i.dispatchEvent(n)}},this.updateAlphaOffsetAngle=function(d){this.alphaOffsetAngle=d,this.update()},this.dispose=function(){this.disconnect()},this.connect()}cl.prototype=Object.assign(Object.create(Zt.prototype),{constructor:cl});function S0(t){var e=new en(-1,1,1,-1,0,1),i=new zn,n=new kl;n.aspect=.5;var r={minFilter:ht,magFilter:Mt,format:Si},s=new Li(512,512,r);s.scissorTest=!0,s.texture.generateMipmaps=!1;var a=new X(.441,.156),o=new tn(1,1,10,20).removeAttribute("normal").toNonIndexed(),l=o.attributes.position.array,c=o.attributes.uv.array;o.attributes.position.count*=2,o.attributes.uv.count*=2;var h=new Float32Array(l.length*2);h.set(l),h.set(l,l.length);var u=new Float32Array(c.length*2);u.set(c),u.set(c,c.length);for(var f=new X,d=l.length/3,p=0,m=h.length/3;p<m;p++){f.x=h[p*3+0],f.y=h[p*3+1];var g=f.dot(f),v=1.5+(a.x+a.y*g)*g,x=p<d?0:1;h[p*3+0]=f.x/v*1.5-.5+x,h[p*3+1]=f.y/v*3,u[p*2]=(u[p*2]+x)*.5}o.attributes.position.array=h,o.attributes.uv.array=u;var y=new It({map:s.texture}),b=new Et(o,y);i.add(b),this.setSize=function(E,w){t.setSize(E,w);var A=t.getPixelRatio();s.setSize(E*A,w*A)},this.render=function(E,w){E.updateMatrixWorld(),w.parent===null&&w.updateMatrixWorld(),n.update(w);var A=s.width/2,D=s.height;t.autoClear&&t.clear(),s.scissor.set(0,0,A,D),s.viewport.set(0,0,A,D),t.setRenderTarget(s),t.render(E,n.cameraL),t.clearDepth(),s.scissor.set(A,0,A,D),s.viewport.set(A,0,A,D),t.setRenderTarget(s),t.render(E,n.cameraR),t.clearDepth(),t.setRenderTarget(null),t.render(i,e)}}const L0=function(t){var e=new kl;e.aspect=.5;var i=new X;this.setEyeSeparation=function(n){e.eyeSep=n},this.setSize=function(n,r){t.setSize(n,r)},this.render=function(n,r){n.updateMatrixWorld(),r.parent===null&&r.updateMatrixWorld(),e.update(r),t.getSize(i),t.autoClear&&t.clear(),t.setScissorTest(!0),t.setScissor(0,0,i.width/2,i.height),t.setViewport(0,0,i.width/2,i.height),t.render(n,e.cameraL),t.setScissor(i.width/2,0,i.width/2,i.height),t.setViewport(i.width/2,0,i.width/2,i.height),t.render(n,e.cameraR),t.setScissorTest(!1)}};function hl(t){let e;t=t||{},t.controlBar=t.controlBar!==void 0?t.controlBar:!0,t.controlButtons=t.controlButtons||["fullscreen","setting","video"],t.autoHideControlBar=t.autoHideControlBar!==void 0?t.autoHideControlBar:!1,t.autoHideInfospot=t.autoHideInfospot!==void 0?t.autoHideInfospot:!0,t.horizontalView=t.horizontalView!==void 0?t.horizontalView:!1,t.clickTolerance=t.clickTolerance||10,t.cameraFov=t.cameraFov||60,t.reverseDragging=t.reverseDragging||!1,t.enableReticle=t.enableReticle||!1,t.dwellTime=t.dwellTime||1500,t.autoReticleSelect=t.autoReticleSelect!==void 0?t.autoReticleSelect:!0,t.viewIndicator=t.viewIndicator!==void 0?t.viewIndicator:!1,t.indicatorSize=t.indicatorSize||30,t.output=t.output?t.output:"none",t.autoRotate=t.autoRotate||!1,t.autoRotateSpeed=t.autoRotateSpeed||2,t.autoRotateActivationDuration=t.autoRotateActivationDuration||5e3,this.options=t,t.container?(e=t.container,e._width=e.clientWidth,e._height=e.clientHeight):(e=document.createElement("div"),e.classList.add("panolens-container"),e.style.width="100%",e.style.height="100%",e._width=window.innerWidth,e._height=window.innerHeight,document.body.appendChild(e)),this.container=e,this.camera=t.camera||new ct(this.options.cameraFov,this.container.clientWidth/this.container.clientHeight,1,1e4),this.scene=t.scene||new zn,this.renderer=t.renderer||new Cl({alpha:!0,antialias:!1}),this.sceneReticle=new zn,this.viewIndicatorSize=this.options.indicatorSize,this.reticle={},this.tempEnableReticle=this.options.enableReticle,this.mode=gt.NORMAL,this.panorama=null,this.widget=null,this.hoverObject=null,this.infospot=null,this.pressEntityObject=null,this.pressObject=null,this.raycaster=new Du,this.raycasterPoint=new X,this.userMouse=new X,this.updateCallbacks=[],this.requestAnimationId=null,this.cameraFrustum=new Aa,this.cameraViewProjectionMatrix=new we,this.autoRotateRequestId=null,this.outputDivElement=null,this.touchSupported="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,this.HANDLER_MOUSE_DOWN=this.onMouseDown.bind(this),this.HANDLER_MOUSE_UP=this.onMouseUp.bind(this),this.HANDLER_MOUSE_MOVE=this.onMouseMove.bind(this),this.HANDLER_WINDOW_RESIZE=this.onWindowResize.bind(this),this.HANDLER_KEY_DOWN=this.onKeyDown.bind(this),this.HANDLER_KEY_UP=this.onKeyUp.bind(this),this.HANDLER_TAP=this.onTap.bind(this,{clientX:this.container.clientWidth/2,clientY:this.container.clientHeight/2}),this.OUTPUT_INFOSPOT=!1,this.tweenLeftAnimation=new rt.Tween,this.tweenUpAnimation=new rt.Tween,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.renderer.setClearColor(0,0),this.renderer.autoClear=!1,this.renderer.domElement.classList.add("panolens-canvas"),this.renderer.domElement.style.display="block",this.container.style.backgroundColor="#000",this.container.appendChild(this.renderer.domElement),this.OrbitControls=new ll(this.camera,this.container),this.OrbitControls.id="orbit",this.OrbitControls.minDistance=1,this.OrbitControls.noPan=!0,this.OrbitControls.autoRotate=this.options.autoRotate,this.OrbitControls.autoRotateSpeed=this.options.autoRotateSpeed,this.DeviceOrientationControls=new cl(this.camera,this.container),this.DeviceOrientationControls.id="device-orientation",this.DeviceOrientationControls.enabled=!1,this.camera.position.z=1,this.options.passiveRendering&&console.warn("passiveRendering is now deprecated"),this.controls=[this.OrbitControls,this.DeviceOrientationControls],this.control=this.OrbitControls,this.CardboardEffect=new S0(this.renderer),this.CardboardEffect.setSize(this.container.clientWidth,this.container.clientHeight),this.StereoEffect=new L0(this.renderer),this.StereoEffect.setSize(this.container.clientWidth,this.container.clientHeight),this.effect=this.CardboardEffect,this.addReticle(),this.options.horizontalView&&(this.OrbitControls.minPolarAngle=Math.PI/2,this.OrbitControls.maxPolarAngle=Math.PI/2),this.options.controlBar!==!1&&this.addDefaultControlBar(this.options.controlButtons),this.options.viewIndicator&&this.addViewIndicator(),this.options.reverseDragging&&this.reverseDraggingDirection(),this.options.enableReticle?this.enableReticleControl():this.registerMouseAndTouchEvents(),this.options.output==="overlay"&&this.addOutputElement(),this.registerEventListeners(),this.animate.call(this)}hl.prototype=Object.assign(Object.create(Zt.prototype),{constructor:hl,add:function(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}this.scene.add(t),t.addEventListener&&t.addEventListener("panolens-viewer-handler",this.eventHandler.bind(this)),t instanceof mt&&t.dispatchEvent&&t.dispatchEvent({type:"panolens-container",container:this.container}),t instanceof ol&&t.dispatchEvent({type:"panolens-scene",scene:this.scene}),t.type==="panorama"&&(this.addPanoramaEventListener(t),this.panorama||this.setPanorama(t))},remove:function(t){t.removeEventListener&&t.removeEventListener("panolens-viewer-handler",this.eventHandler.bind(this)),this.scene.remove(t)},addDefaultControlBar:function(t){if(this.widget){console.warn("Default control bar exists");return}const e=new sl(this.container);e.addEventListener("panolens-viewer-handler",this.eventHandler.bind(this)),e.addControlBar(),t.forEach(i=>{e.addControlButton(i)}),this.widget=e},setPanorama:function(t){const e=this.panorama;if(t.type==="panorama"&&e!==t){this.hideInfospot();const i=function(){e&&e.onLeave(),t.removeEventListener("enter-fade-start",i)};t.addEventListener("enter-fade-start",i),(this.panorama=t).onEnter()}},eventHandler:function(t){t.method&&this[t.method]&&this[t.method](t.data)},dispatchEventToChildren:function(t){this.scene.traverse(function(e){e.dispatchEvent&&e.dispatchEvent(t)})},activateWidgetItem:function(t,e){const i=this.widget.mainMenu,n=i.children[0],r=i.children[1];let s;if(t!==void 0){switch(t){case 0:s=n.subMenu.children[1];break;case 1:s=n.subMenu.children[2];break;default:s=n.subMenu.children[1];break}n.subMenu.setActiveItem(s),n.setSelectionTitle(s.textContent)}if(e!==void 0){switch(e){case gt.CARDBOARD:s=r.subMenu.children[2];break;case gt.STEREO:s=r.subMenu.children[3];break;default:s=r.subMenu.children[1];break}r.subMenu.setActiveItem(s),r.setSelectionTitle(s.textContent)}},enableEffect:function(t){if(this.mode===t)return;if(t===gt.NORMAL){this.disableEffect();return}else this.mode=t;const e=this.camera.fov;switch(t){case gt.CARDBOARD:this.effect=this.CardboardEffect,this.enableReticleControl();break;case gt.STEREO:this.effect=this.StereoEffect,this.enableReticleControl();break;default:this.effect=null,this.disableReticleControl();break}this.activateWidgetItem(void 0,this.mode),this.dispatchEventToChildren({type:"panolens-dual-eye-effect",mode:this.mode}),this.camera.fov=e+.01,this.effect.setSize(this.container.clientWidth,this.container.clientHeight),this.render(),this.camera.fov=e,this.dispatchEvent({type:"mode-change",mode:this.mode})},disableEffect:function(){this.mode!==gt.NORMAL&&(this.mode=gt.NORMAL,this.disableReticleControl(),this.activateWidgetItem(void 0,this.mode),this.dispatchEventToChildren({type:"panolens-dual-eye-effect",mode:this.mode}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.render(),this.dispatchEvent({type:"mode-change",mode:this.mode}))},enableReticleControl:function(){this.reticle.visible||(this.tempEnableReticle=!0,this.unregisterMouseAndTouchEvents(),this.reticle.show(),this.registerReticleEvent(),this.updateReticleEvent())},disableReticleControl:function(){this.tempEnableReticle=!1,this.options.enableReticle?this.updateReticleEvent():(this.reticle.hide(),this.unregisterReticleEvent(),this.registerMouseAndTouchEvents())},enableAutoRate:function(){this.options.autoRotate=!0,this.OrbitControls.autoRotate=!0},disableAutoRate:function(){clearTimeout(this.autoRotateRequestId),this.options.autoRotate=!1,this.OrbitControls.autoRotate=!1},toggleVideoPlay:function(t){this.panorama instanceof cn&&this.panorama.dispatchEvent({type:"video-toggle",pause:t})},setVideoCurrentTime:function(t){this.panorama instanceof cn&&this.panorama.dispatchEvent({type:"video-time",percentage:t})},onVideoUpdate:function(t){const{widget:e}=this;e&&e.dispatchEvent({type:"video-update",percentage:t})},addUpdateCallback:function(t){t&&this.updateCallbacks.push(t)},removeUpdateCallback:function(t){const e=this.updateCallbacks.indexOf(t);t&&e>=0&&this.updateCallbacks.splice(e,1)},showVideoWidget:function(){const{widget:t}=this;t&&t.dispatchEvent({type:"video-control-show"})},hideVideoWidget:function(){const{widget:t}=this;t&&t.dispatchEvent({type:"video-control-hide"})},updateVideoPlayButton:function(t){const{widget:e}=this;e&&e.videoElement&&e.videoElement.controlButton&&e.videoElement.controlButton.update(t)},addPanoramaEventListener:function(t){t.addEventListener("enter-fade-start",this.setCameraControl.bind(this)),t instanceof cn&&(t.addEventListener("enter-fade-start",this.showVideoWidget.bind(this)),t.addEventListener("leave",function(){this.panorama instanceof cn||this.hideVideoWidget.call(this)}.bind(this)))},setCameraControl:function(){this.OrbitControls.target.copy(this.panorama.position)},getControl:function(){return this.control},getScene:function(){return this.scene},getCamera:function(){return this.camera},getRenderer:function(){return this.renderer},getContainer:function(){return this.container},getControlId:function(){return this.control.id},getNextControlId:function(){return this.controls[this.getNextControlIndex()].id},getNextControlIndex:function(){const t=this.controls,e=this.control,i=t.indexOf(e)+1;return i>=t.length?0:i},setCameraFov:function(t){this.camera.fov=t,this.camera.updateProjectionMatrix()},enableControl:function(t){switch(t=t>=0&&t<this.controls.length?t:0,this.control.enabled=!1,this.control=this.controls[t],this.control.enabled=!0,t){case ts.ORBIT:this.camera.position.copy(this.panorama.position),this.camera.position.z+=1;break;case ts.DEVICEORIENTATION:this.camera.position.copy(this.panorama.position);break}this.control.update(),this.activateWidgetItem(t,void 0)},disableControl:function(){this.control.enabled=!1},toggleNextControl:function(){this.enableControl(this.getNextControlIndex())},getScreenVector:function(t){const e=t.clone(),i=this.container.clientWidth/2,n=this.container.clientHeight/2;return e.project(this.camera),e.x=e.x*i+i,e.y=-(e.y*n)+n,e.z=0,e},checkSpriteInViewport:function(t){return this.camera.matrixWorldInverse.getInverse(this.camera.matrixWorld),this.cameraViewProjectionMatrix.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),this.cameraFrustum.setFromMatrix(this.cameraViewProjectionMatrix),t.visible&&this.cameraFrustum.intersectsSprite(t)},reverseDraggingDirection:function(){this.OrbitControls.rotateSpeed*=-1,this.OrbitControls.momentumScalingFactor*=-1},addReticle:function(){this.reticle=new rl(16777215,!0,this.options.dwellTime),this.reticle.hide(),this.camera.add(this.reticle),this.sceneReticle.add(this.camera)},tweenControlCenter:function(t,e,i){if(this.control!==this.OrbitControls)return;t instanceof Array&&(e=t[1],i=t[2],t=t[0]),e=e!==void 0?e:1e3,i=i||rt.Easing.Exponential.Out;let n,r,s,a,o,l,c,h,u,f;n=this,a=this.camera.getWorldDirection(new S),o=a.clone(),h=this.panorama.getWorldPosition(new S).sub(this.camera.getWorldPosition(new S)),l=t.clone(),l.x*=-1,l.add(h).normalize(),c=l.clone(),a.y=0,l.y=0,r=Math.atan2(l.z,l.x)-Math.atan2(a.z,a.x),r=r>Math.PI?r-2*Math.PI:r,r=r<-Math.PI?r+2*Math.PI:r,s=Math.abs(o.angleTo(a)+(o.y*c.y<=0?c.angleTo(l):-c.angleTo(l))),s*=c.y<o.y?1:-1,u={left:0,up:0},f={left:0,up:0},this.tweenLeftAnimation.stop(),this.tweenUpAnimation.stop(),this.tweenLeftAnimation=new rt.Tween(u).to({left:r},e).easing(i).onUpdate(function(d){n.control.rotateLeft(d.left-f.left),f.left=d.left}).start(),this.tweenUpAnimation=new rt.Tween(u).to({up:s},e).easing(i).onUpdate(function(d){n.control.rotateUp(d.up-f.up),f.up=d.up}).start()},tweenControlCenterByObject:function(t,e,i){let n=!1;if(t.traverseAncestors(function(r){r.scalePlaceHolder&&(n=!0)}),n){const r=new S(-1,1,1);this.tweenControlCenter(t.getWorldPosition(new S).multiply(r),e,i)}else this.tweenControlCenter(t.getWorldPosition(new S),e,i)},onWindowResize:function(t,e){let i,n;const r=this.container.classList.contains("panolens-container")||this.container.isFullscreen;if(t!==void 0&&e!==void 0)i=t,n=e,this.container._width=t,this.container._height=e;else{const s=/(android)/i.test(window.navigator.userAgent),a=s?Math.min(document.documentElement.clientWidth,window.innerWidth||0):Math.max(document.documentElement.clientWidth,window.innerWidth||0),o=s?Math.min(document.documentElement.clientHeight,window.innerHeight||0):Math.max(document.documentElement.clientHeight,window.innerHeight||0);i=r?a:this.container.clientWidth,n=r?o:this.container.clientHeight,this.container._width=i,this.container._height=n}this.camera.aspect=i/n,this.camera.updateProjectionMatrix(),this.renderer.setSize(i,n),(this.options.enableReticle||this.tempEnableReticle)&&this.updateReticleEvent(),this.dispatchEvent({type:"window-resize",width:i,height:n}),this.scene.traverse(function(s){s.dispatchEvent&&s.dispatchEvent({type:"window-resize",width:i,height:n})})},addOutputElement:function(){const t=document.createElement("div");t.style.position="absolute",t.style.right="10px",t.style.top="10px",t.style.color="#fff",this.container.appendChild(t),this.outputDivElement=t},outputPosition:function(){const t=this.raycaster.intersectObject(this.panorama,!0);if(t.length>0){const e=t[0].point.clone(),i=new S(-1,1,1),n=this.panorama.getWorldPosition(new S);e.sub(n).multiply(i);const r={x:e.x.toFixed(2),y:e.y.toFixed(2),z:e.z.toFixed(2)},s=`${r.x}, ${r.y}, ${r.z}`;if(e.length()===0)return;switch(this.options.output){case"event":this.dispatchEvent({type:"position-output",position:r});break;case"console":console.info(s);break;case"overlay":this.outputDivElement.textContent=s;break}}},onMouseDown:function(t){t.preventDefault(),this.userMouse.x=t.clientX>=0?t.clientX:t.touches[0].clientX,this.userMouse.y=t.clientY>=0?t.clientY:t.touches[0].clientY,this.userMouse.type="mousedown",this.onTap(t)},onMouseMove:function(t){t.preventDefault(),this.userMouse.type="mousemove",this.onTap(t)},onMouseUp:function(t){let e=!1;this.userMouse.type="mouseup";const i=this.userMouse.x>=t.clientX-this.options.clickTolerance&&this.userMouse.x<=t.clientX+this.options.clickTolerance&&this.userMouse.y>=t.clientY-this.options.clickTolerance&&this.userMouse.y<=t.clientY+this.options.clickTolerance||t.changedTouches&&this.userMouse.x>=t.changedTouches[0].clientX-this.options.clickTolerance&&this.userMouse.x<=t.changedTouches[0].clientX+this.options.clickTolerance&&this.userMouse.y>=t.changedTouches[0].clientY-this.options.clickTolerance&&this.userMouse.y<=t.changedTouches[0].clientY+this.options.clickTolerance?"click":void 0;if(!(t&&t.target&&!t.target.classList.contains("panolens-canvas"))&&(t.preventDefault(),t.changedTouches&&t.changedTouches.length===1?e=this.onTap({clientX:t.changedTouches[0].clientX,clientY:t.changedTouches[0].clientY},i):e=this.onTap(t,i),this.userMouse.type="none",!e&&i==="click")){const{options:{autoHideInfospot:n,autoHideControlBar:r},panorama:s,toggleControlBar:a}=this;n&&s&&s.toggleInfospotVisibility(),r&&a()}},onTap:function(t,e){const{left:i,top:n}=this.container.getBoundingClientRect(),{clientWidth:r,clientHeight:s}=this.container;if(this.raycasterPoint.x=(t.clientX-i)/r*2-1,this.raycasterPoint.y=-((t.clientY-n)/s)*2+1,this.raycaster.setFromCamera(this.raycasterPoint,this.camera),!this.panorama)return;(t.type!=="mousedown"&&this.touchSupported||this.OUTPUT_INFOSPOT)&&this.outputPosition();const a=this.raycaster.intersectObjects(this.panorama.children,!0),o=this.getConvertedIntersect(a),l=a.length>0?a[0].object:void 0;if(this.userMouse.type==="mouseup"&&(o&&this.pressEntityObject===o&&this.pressEntityObject.dispatchEvent&&this.pressEntityObject.dispatchEvent({type:"pressstop-entity",mouseEvent:t}),this.pressEntityObject=void 0),this.userMouse.type==="mouseup"&&(l&&this.pressObject===l&&this.pressObject.dispatchEvent&&this.pressObject.dispatchEvent({type:"pressstop",mouseEvent:t}),this.pressObject=void 0),e==="click"?(this.panorama.dispatchEvent({type:"click",intersects:a,mouseEvent:t}),o&&o.dispatchEvent&&o.dispatchEvent({type:"click-entity",mouseEvent:t}),l&&l.dispatchEvent&&l.dispatchEvent({type:"click",mouseEvent:t})):(this.panorama.dispatchEvent({type:"hover",intersects:a,mouseEvent:t}),(this.hoverObject&&a.length>0&&this.hoverObject!==o||this.hoverObject&&a.length===0)&&(this.hoverObject.dispatchEvent&&(this.hoverObject.dispatchEvent({type:"hoverleave",mouseEvent:t}),this.reticle.end()),this.hoverObject=void 0),o&&a.length>0&&(this.hoverObject!==o&&(this.hoverObject=o,this.hoverObject.dispatchEvent&&(this.hoverObject.dispatchEvent({type:"hoverenter",mouseEvent:t}),(this.options.autoReticleSelect&&this.options.enableReticle||this.tempEnableReticle)&&this.reticle.start(this.onTap.bind(this,t,"click")))),this.userMouse.type==="mousedown"&&this.pressEntityObject!=o&&(this.pressEntityObject=o,this.pressEntityObject.dispatchEvent&&this.pressEntityObject.dispatchEvent({type:"pressstart-entity",mouseEvent:t})),this.userMouse.type==="mousedown"&&this.pressObject!=l&&(this.pressObject=l,this.pressObject.dispatchEvent&&this.pressObject.dispatchEvent({type:"pressstart",mouseEvent:t})),(this.userMouse.type==="mousemove"||this.options.enableReticle)&&(l&&l.dispatchEvent&&l.dispatchEvent({type:"hover",mouseEvent:t}),this.pressEntityObject&&this.pressEntityObject.dispatchEvent&&this.pressEntityObject.dispatchEvent({type:"pressmove-entity",mouseEvent:t}),this.pressObject&&this.pressObject.dispatchEvent&&this.pressObject.dispatchEvent({type:"pressmove",mouseEvent:t}))),!o&&this.pressEntityObject&&this.pressEntityObject.dispatchEvent&&(this.pressEntityObject.dispatchEvent({type:"pressstop-entity",mouseEvent:t}),this.pressEntityObject=void 0),!l&&this.pressObject&&this.pressObject.dispatchEvent&&(this.pressObject.dispatchEvent({type:"pressstop",mouseEvent:t}),this.pressObject=void 0)),l&&l instanceof gi){if(this.infospot=l,e==="click")return!0}else this.infospot&&this.hideInfospot();this.options.autoRotate&&this.userMouse.type!=="mousemove"&&(clearTimeout(this.autoRotateRequestId),this.control===this.OrbitControls&&(this.OrbitControls.autoRotate=!1,this.autoRotateRequestId=window.setTimeout(this.enableAutoRate.bind(this),this.options.autoRotateActivationDuration)))},getConvertedIntersect:function(t){let e;for(let i=0;i<t.length;i++)if(t[i].distance>=0&&t[i].object&&!t[i].object.passThrough){if(t[i].object.entity&&t[i].object.entity.passThrough)continue;if(t[i].object.entity&&!t[i].object.entity.passThrough){e=t[i].object.entity;break}else{e=t[i].object;break}}return e},hideInfospot:function(){this.infospot&&(this.infospot.onHoverEnd(),this.infospot=void 0)},toggleControlBar:function(){const{widget:t}=this;t&&t.dispatchEvent({type:"control-bar-toggle"})},onKeyDown:function(t){this.options.output&&this.options.output!=="none"&&t.key==="Control"&&(this.OUTPUT_INFOSPOT=!0)},onKeyUp:function(){this.OUTPUT_INFOSPOT=!1},update:function(){rt.update(),this.updateCallbacks.forEach(function(t){t()}),this.control.update(),this.scene.traverse(function(t){if(t instanceof gi&&t.element&&(this.hoverObject===t||t.element.style.display!=="none"||t.element.left&&t.element.left.style.display!=="none"||t.element.right&&t.element.right.style.display!=="none"))if(this.checkSpriteInViewport(t)){const{x:e,y:i}=this.getScreenVector(t.getWorldPosition(new S));t.translateElement(e,i)}else t.onDismiss()}.bind(this))},render:function(){this.mode===gt.CARDBOARD||this.mode===gt.STEREO?(this.renderer.clear(),this.effect.render(this.scene,this.camera),this.effect.render(this.sceneReticle,this.camera)):(this.renderer.clear(),this.renderer.render(this.scene,this.camera),this.renderer.clearDepth(),this.renderer.render(this.sceneReticle,this.camera))},animate:function(){this.requestAnimationId=window.requestAnimationFrame(this.animate.bind(this)),this.onChange()},onChange:function(){this.update(),this.render()},registerMouseAndTouchEvents:function(){const t={passive:!1};this.container.addEventListener("mousedown",this.HANDLER_MOUSE_DOWN,t),this.container.addEventListener("mousemove",this.HANDLER_MOUSE_MOVE,t),this.container.addEventListener("mouseup",this.HANDLER_MOUSE_UP,t),this.container.addEventListener("touchstart",this.HANDLER_MOUSE_DOWN,t),this.container.addEventListener("touchend",this.HANDLER_MOUSE_UP,t)},unregisterMouseAndTouchEvents:function(){this.container.removeEventListener("mousedown",this.HANDLER_MOUSE_DOWN,!1),this.container.removeEventListener("mousemove",this.HANDLER_MOUSE_MOVE,!1),this.container.removeEventListener("mouseup",this.HANDLER_MOUSE_UP,!1),this.container.removeEventListener("touchstart",this.HANDLER_MOUSE_DOWN,!1),this.container.removeEventListener("touchend",this.HANDLER_MOUSE_UP,!1)},registerReticleEvent:function(){this.addUpdateCallback(this.HANDLER_TAP)},unregisterReticleEvent:function(){this.removeUpdateCallback(this.HANDLER_TAP)},updateReticleEvent:function(){const t=this.container.clientWidth/2+this.container.offsetLeft,e=this.container.clientHeight/2;this.removeUpdateCallback(this.HANDLER_TAP),this.HANDLER_TAP=this.onTap.bind(this,{clientX:t,clientY:e}),this.addUpdateCallback(this.HANDLER_TAP)},registerEventListeners:function(){window.addEventListener("resize",this.HANDLER_WINDOW_RESIZE,!0),window.addEventListener("keydown",this.HANDLER_KEY_DOWN,!0),window.addEventListener("keyup",this.HANDLER_KEY_UP,!0)},unregisterEventListeners:function(){window.removeEventListener("resize",this.HANDLER_WINDOW_RESIZE,!0),window.removeEventListener("keydown",this.HANDLER_KEY_DOWN,!0),window.removeEventListener("keyup",this.HANDLER_KEY_UP,!0)},dispose:function(){this.tweenLeftAnimation.stop(),this.tweenUpAnimation.stop(),this.unregisterEventListeners();function t(e){for(let i=e.children.length-1;i>=0;i--)t(e.children[i]),e.remove(e.children[i]);e instanceof mt||e instanceof gi?(e.dispose(),e=null):e.dispatchEvent&&e.dispatchEvent("dispose")}t(this.scene),this.widget&&(this.widget.dispose(),this.widget=null),Gt&&Gt.enabled&&Gt.clear()},destroy:function(){this.dispose(),this.render(),window.cancelAnimationFrame(this.requestAnimationId)},onPanoramaDispose:function(t){t instanceof cn&&this.hideVideoWidget(),t===this.panorama&&(this.panorama=null)},loadAsyncRequest:function(t,e=()=>{}){const i=new window.XMLHttpRequest;i.onloadend=function(n){e(n)},i.open("GET",t,!0),i.send(null)},addViewIndicator:function(){const t=this;function e(i){if(i.loaded===0)return;const n=i.target.responseXML.documentElement;n.style.width=t.viewIndicatorSize+"px",n.style.height=t.viewIndicatorSize+"px",n.style.position="absolute",n.style.top="10px",n.style.left="10px",n.style.opacity="0.5",n.style.cursor="pointer",n.id="panolens-view-indicator-container",t.container.appendChild(n);const r=n.querySelector("#indicator"),s=function(){t.radius=t.viewIndicatorSize*.225,t.currentPanoAngle=t.camera.rotation.y-Te.degToRad(90),t.fovAngle=Te.degToRad(t.camera.fov),t.leftAngle=-t.currentPanoAngle-t.fovAngle/2,t.rightAngle=-t.currentPanoAngle+t.fovAngle/2,t.leftX=t.radius*Math.cos(t.leftAngle),t.leftY=t.radius*Math.sin(t.leftAngle),t.rightX=t.radius*Math.cos(t.rightAngle),t.rightY=t.radius*Math.sin(t.rightAngle),t.indicatorD="M "+t.leftX+" "+t.leftY+" A "+t.radius+" "+t.radius+" 0 0 1 "+t.rightX+" "+t.rightY,t.leftX&&t.leftY&&t.rightX&&t.rightY&&t.radius&&r.setAttribute("d",t.indicatorD)};t.addUpdateCallback(s);const a=function(){this.style.opacity="1"},o=function(){this.style.opacity="0.5"};n.addEventListener("mouseenter",a),n.addEventListener("mouseleave",o)}this.loadAsyncRequest(wt.ViewIndicator,e)},appendControlItem:function(t){const e=this.widget.createCustomItem(t);return t.group==="video"?this.widget.videoElement.appendChild(e):this.widget.barElement.appendChild(e),e},clearAllCache:function(){Gt.clear()}});Hh!=Hc&&console.warn(`three.js version is not matched. Please consider use the target revision ${Hc}`);window.TWEEN=rt;function M0(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Uu={exports:{}};(function(t,e){(function(i){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(l,c,h){if(h=h||{},l=l.trim(),c=c.trim(),!c){if(!h.alwaysNormalize)return l;var u=o.parseURL(l);if(!u)throw new Error("Error trying to parse base URL.");return u.path=o.normalizePath(u.path),o.buildURLFromParts(u)}var f=o.parseURL(c);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return h.alwaysNormalize?(f.path=o.normalizePath(f.path),o.buildURLFromParts(f)):c;var d=o.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");if(!d.netLoc&&d.path&&d.path[0]!=="/"){var p=r.exec(d.path);d.netLoc=p[1],d.path=p[2]}d.netLoc&&!d.path&&(d.path="/");var m={scheme:d.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(m.netLoc=d.netLoc,f.path[0]!=="/"))if(!f.path)m.path=d.path,f.params||(m.params=d.params,f.query||(m.query=d.query));else{var g=d.path,v=g.substring(0,g.lastIndexOf("/")+1)+f.path;m.path=o.normalizePath(v)}return m.path===null&&(m.path=h.alwaysNormalize?o.normalizePath(f.path):f.path),o.buildURLFromParts(m)},parseURL:function(l){var c=n.exec(l);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(s,"");l.length!==(l=l.replace(a,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};t.exports=o})()})(Uu);var Bl=Uu.exports;function $c(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),i.push.apply(i,n)}return i}function zt(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?$c(Object(i),!0).forEach(function(n){R0(t,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):$c(Object(i)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(i,n))})}return t}function R0(t,e,i){return e=C0(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function bt(){return bt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},bt.apply(this,arguments)}function I0(t,e){if(typeof t!="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var n=i.call(t,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function C0(t){var e=I0(t,"string");return typeof e=="symbol"?e:String(e)}const be=Number.isFinite||function(t){return typeof t=="number"&&isFinite(t)},D0=Number.isSafeInteger||function(t){return typeof t=="number"&&Math.abs(t)<=P0},P0=Number.MAX_SAFE_INTEGER||9007199254740991;let T=function(t){return t.MEDIA_ATTACHING="hlsMediaAttaching",t.MEDIA_ATTACHED="hlsMediaAttached",t.MEDIA_DETACHING="hlsMediaDetaching",t.MEDIA_DETACHED="hlsMediaDetached",t.BUFFER_RESET="hlsBufferReset",t.BUFFER_CODECS="hlsBufferCodecs",t.BUFFER_CREATED="hlsBufferCreated",t.BUFFER_APPENDING="hlsBufferAppending",t.BUFFER_APPENDED="hlsBufferAppended",t.BUFFER_EOS="hlsBufferEos",t.BUFFER_FLUSHING="hlsBufferFlushing",t.BUFFER_FLUSHED="hlsBufferFlushed",t.MANIFEST_LOADING="hlsManifestLoading",t.MANIFEST_LOADED="hlsManifestLoaded",t.MANIFEST_PARSED="hlsManifestParsed",t.LEVEL_SWITCHING="hlsLevelSwitching",t.LEVEL_SWITCHED="hlsLevelSwitched",t.LEVEL_LOADING="hlsLevelLoading",t.LEVEL_LOADED="hlsLevelLoaded",t.LEVEL_UPDATED="hlsLevelUpdated",t.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",t.LEVELS_UPDATED="hlsLevelsUpdated",t.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",t.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",t.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",t.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",t.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",t.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",t.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",t.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",t.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",t.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",t.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",t.CUES_PARSED="hlsCuesParsed",t.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",t.INIT_PTS_FOUND="hlsInitPtsFound",t.FRAG_LOADING="hlsFragLoading",t.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",t.FRAG_LOADED="hlsFragLoaded",t.FRAG_DECRYPTED="hlsFragDecrypted",t.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",t.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",t.FRAG_PARSING_METADATA="hlsFragParsingMetadata",t.FRAG_PARSED="hlsFragParsed",t.FRAG_BUFFERED="hlsFragBuffered",t.FRAG_CHANGED="hlsFragChanged",t.FPS_DROP="hlsFpsDrop",t.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",t.ERROR="hlsError",t.DESTROYING="hlsDestroying",t.KEY_LOADING="hlsKeyLoading",t.KEY_LOADED="hlsKeyLoaded",t.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",t.BACK_BUFFER_REACHED="hlsBackBufferReached",t}({}),Se=function(t){return t.NETWORK_ERROR="networkError",t.MEDIA_ERROR="mediaError",t.KEY_SYSTEM_ERROR="keySystemError",t.MUX_ERROR="muxError",t.OTHER_ERROR="otherError",t}({}),Y=function(t){return t.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",t.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",t.KEY_SYSTEM_NO_SESSION="keySystemNoSession",t.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",t.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",t.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",t.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",t.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",t.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",t.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",t.MANIFEST_LOAD_ERROR="manifestLoadError",t.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",t.MANIFEST_PARSING_ERROR="manifestParsingError",t.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",t.LEVEL_EMPTY_ERROR="levelEmptyError",t.LEVEL_LOAD_ERROR="levelLoadError",t.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",t.LEVEL_PARSING_ERROR="levelParsingError",t.LEVEL_SWITCH_ERROR="levelSwitchError",t.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",t.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",t.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",t.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",t.FRAG_LOAD_ERROR="fragLoadError",t.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",t.FRAG_DECRYPT_ERROR="fragDecryptError",t.FRAG_PARSING_ERROR="fragParsingError",t.FRAG_GAP="fragGap",t.REMUX_ALLOC_ERROR="remuxAllocError",t.KEY_LOAD_ERROR="keyLoadError",t.KEY_LOAD_TIMEOUT="keyLoadTimeOut",t.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",t.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",t.BUFFER_APPEND_ERROR="bufferAppendError",t.BUFFER_APPENDING_ERROR="bufferAppendingError",t.BUFFER_STALLED_ERROR="bufferStalledError",t.BUFFER_FULL_ERROR="bufferFullError",t.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",t.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",t.INTERNAL_EXCEPTION="internalException",t.INTERNAL_ABORTED="aborted",t.UNKNOWN="unknown",t}({});const ln=function(){},ul={trace:ln,debug:ln,log:ln,warn:ln,info:ln,error:ln};let gr=ul;function O0(t){const e=self.console[t];return e?e.bind(self.console,`[${t}] >`):ln}function F0(t,...e){e.forEach(function(i){gr[i]=t[i]?t[i].bind(t):O0(i)})}function k0(t,e){if(self.console&&t===!0||typeof t=="object"){F0(t,"debug","log","info","warn","error");try{gr.log(`Debug logs enabled for "${e}" in hls.js version 1.4.14`)}catch{gr=ul}}else gr=ul}const N=gr,N0=/^(\d+)x(\d+)$/,Yc=/(.+?)=(".*?"|.*?)(?:,|$)/g;class ft{constructor(e){typeof e=="string"&&(e=ft.parseAttrList(e));for(const i in e)e.hasOwnProperty(i)&&(i.substring(0,2)==="X-"&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(i)),this[i]=e[i])}decimalInteger(e){const i=parseInt(this[e],10);return i>Number.MAX_SAFE_INTEGER?1/0:i}hexadecimalInteger(e){if(this[e]){let i=(this[e]||"0x").slice(2);i=(i.length&1?"0":"")+i;const n=new Uint8Array(i.length/2);for(let r=0;r<i.length/2;r++)n[r]=parseInt(i.slice(r*2,r*2+2),16);return n}else return null}hexadecimalIntegerAsNumber(e){const i=parseInt(this[e],16);return i>Number.MAX_SAFE_INTEGER?1/0:i}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,i){const n=this[e];return n?parseFloat(n):i}enumeratedString(e){return this[e]}bool(e){return this[e]==="YES"}decimalResolution(e){const i=N0.exec(this[e]);if(i!==null)return{width:parseInt(i[1],10),height:parseInt(i[2],10)}}static parseAttrList(e){let i;const n={},r='"';for(Yc.lastIndex=0;(i=Yc.exec(e))!==null;){let s=i[2];s.indexOf(r)===0&&s.lastIndexOf(r)===s.length-1&&(s=s.slice(1,-1));const a=i[1].trim();n[a]=s}return n}}function B0(t){return t!=="ID"&&t!=="CLASS"&&t!=="START-DATE"&&t!=="DURATION"&&t!=="END-DATE"&&t!=="END-ON-NEXT"}function U0(t){return t==="SCTE35-OUT"||t==="SCTE35-IN"}class Gu{constructor(e,i){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,i){const n=i.attr;for(const r in n)if(Object.prototype.hasOwnProperty.call(e,r)&&e[r]!==n[r]){N.warn(`DATERANGE tag attribute: "${r}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=r;break}e=bt(new ft({}),n,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const n=new Date(this.attr["END-DATE"]);be(n.getTime())&&(this._endDate=n)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const e=this.duration;return e!==null?new Date(this._startDate.getTime()+e*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(be(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&be(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class La{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Qe={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class Hu{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[Qe.AUDIO]:null,[Qe.VIDEO]:null,[Qe.AUDIOVIDEO]:null},this.baseurl=e}setByteRange(e,i){const n=e.split("@",2),r=[];n.length===1?r[0]=i?i.byteRangeEndOffset:0:r[0]=parseInt(n[1]),r[1]=parseInt(n[0])+r[0],this._byteRange=r}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Bl.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class $a extends Hu{constructor(e,i){super(i),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new La,this.urlId=0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.type=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const i=this.levelkeys.identity;if(i)this._decryptdata=i.getDecryptData(this.sn);else{const n=Object.keys(this.levelkeys);if(n.length===1)return this._decryptdata=this.levelkeys[n[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!be(this.programDateTime))return null;const e=be(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const i=Object.keys(this.levelkeys),n=i.length;if(n>1||n===1&&this.levelkeys[i[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){const i=this.levelkeys[e];i&&!this._decryptdata&&(this._decryptdata=i.getDecryptData(this.sn))}}abortRequests(){var e,i;(e=this.loader)==null||e.abort(),(i=this.keyLoader)==null||i.abort()}setElementaryStreamInfo(e,i,n,r,s,a=!1){const{elementaryStreams:o}=this,l=o[e];if(!l){o[e]={startPTS:i,endPTS:n,startDTS:r,endDTS:s,partial:a};return}l.startPTS=Math.min(l.startPTS,i),l.endPTS=Math.max(l.endPTS,n),l.startDTS=Math.min(l.startDTS,r),l.endDTS=Math.max(l.endDTS,s)}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Qe.AUDIO]=null,e[Qe.VIDEO]=null,e[Qe.AUDIOVIDEO]=null}}class G0 extends Hu{constructor(e,i,n,r,s){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new La,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=i,this.index=r;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}const H0=10;class V0{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const i=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!i||!this.live,this.advanced=this.endSN>e.endSN||i>0||i===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?be(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||H0}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function Ul(t){return Uint8Array.from(atob(t),e=>e.charCodeAt(0))}function z0(t){const e=Vu(t).subarray(0,16),i=new Uint8Array(16);return i.set(e,16-e.length),i}function W0(t){const e=function(n,r,s){const a=n[r];n[r]=n[s],n[s]=a};e(t,0,3),e(t,1,2),e(t,4,5),e(t,6,7)}function j0(t){const e=t.split(":");let i=null;if(e[0]==="data"&&e.length===2){const n=e[1].split(";"),r=n[n.length-1].split(",");if(r.length===2){const s=r[0]==="base64",a=r[1];s?(n.splice(-1,1),i=Ul(a)):i=z0(a)}}return i}function Vu(t){return Uint8Array.from(unescape(encodeURIComponent(t)),e=>e.charCodeAt(0))}var dt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Xt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Kc(t){switch(t){case Xt.FAIRPLAY:return dt.FAIRPLAY;case Xt.PLAYREADY:return dt.PLAYREADY;case Xt.WIDEVINE:return dt.WIDEVINE;case Xt.CLEARKEY:return dt.CLEARKEY}}var zu={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function $0(t){if(t===zu.WIDEVINE)return dt.WIDEVINE}function Xc(t){switch(t){case dt.FAIRPLAY:return Xt.FAIRPLAY;case dt.PLAYREADY:return Xt.PLAYREADY;case dt.WIDEVINE:return Xt.WIDEVINE;case dt.CLEARKEY:return Xt.CLEARKEY}}function Ya(t){const{drmSystems:e,widevineLicenseUrl:i}=t,n=e?[dt.FAIRPLAY,dt.WIDEVINE,dt.PLAYREADY,dt.CLEARKEY].filter(r=>!!e[r]):[];return!n[dt.WIDEVINE]&&i&&n.push(dt.WIDEVINE),n}const Wu=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function Y0(t,e,i,n){let r;switch(t){case dt.FAIRPLAY:r=["cenc","sinf"];break;case dt.WIDEVINE:case dt.PLAYREADY:r=["cenc"];break;case dt.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${t}`)}return K0(r,e,i,n)}function K0(t,e,i,n){return[{initDataTypes:t,persistentState:n.persistentState||"not-allowed",distinctiveIdentifier:n.distinctiveIdentifier||"not-allowed",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs="${s}"`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:i.map(s=>({contentType:`video/mp4; codecs="${s}"`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}function fn(t,e,i){return Uint8Array.prototype.slice?t.slice(e,i):new Uint8Array(Array.prototype.slice.call(t,e,i))}const Gl=(t,e)=>e+10<=t.length&&t[e]===73&&t[e+1]===68&&t[e+2]===51&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128,ju=(t,e)=>e+10<=t.length&&t[e]===51&&t[e+1]===68&&t[e+2]===73&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128,ga=(t,e)=>{const i=e;let n=0;for(;Gl(t,e);){n+=10;const r=Ma(t,e+6);n+=r,ju(t,e+10)&&(n+=10),e+=n}if(n>0)return t.subarray(i,i+n)},Ma=(t,e)=>{let i=0;return i=(t[e]&127)<<21,i|=(t[e+1]&127)<<14,i|=(t[e+2]&127)<<7,i|=t[e+3]&127,i},X0=(t,e)=>Gl(t,e)&&Ma(t,e+6)+10<=t.length-e,q0=t=>{const e=Yu(t);for(let i=0;i<e.length;i++){const n=e[i];if($u(n))return iy(n)}},$u=t=>t&&t.key==="PRIV"&&t.info==="com.apple.streaming.transportStreamTimestamp",Z0=t=>{const e=String.fromCharCode(t[0],t[1],t[2],t[3]),i=Ma(t,4),n=10;return{type:e,size:i,data:t.subarray(n,n+i)}},Yu=t=>{let e=0;const i=[];for(;Gl(t,e);){const n=Ma(t,e+6);e+=10;const r=e+n;for(;e+8<r;){const s=Z0(t.subarray(e)),a=J0(s);a&&i.push(a),e+=s.size+10}ju(t,e)&&(e+=10)}return i},J0=t=>t.type==="PRIV"?Q0(t):t.type[0]==="W"?ty(t):ey(t),Q0=t=>{if(t.size<2)return;const e=wi(t.data,!0),i=new Uint8Array(t.data.subarray(e.length+1));return{key:t.type,info:e,data:i.buffer}},ey=t=>{if(t.size<2)return;if(t.type==="TXXX"){let i=1;const n=wi(t.data.subarray(i),!0);i+=n.length+1;const r=wi(t.data.subarray(i));return{key:t.type,info:n,data:r}}const e=wi(t.data.subarray(1));return{key:t.type,data:e}},ty=t=>{if(t.type==="WXXX"){if(t.size<2)return;let i=1;const n=wi(t.data.subarray(i),!0);i+=n.length+1;const r=wi(t.data.subarray(i));return{key:t.type,info:n,data:r}}const e=wi(t.data);return{key:t.type,data:e}},iy=t=>{if(t.data.byteLength===8){const e=new Uint8Array(t.data),i=e[3]&1;let n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,i&&(n+=4772185884e-2),Math.round(n)}},wi=(t,e=!1)=>{const i=ny();if(i){const c=i.decode(t);if(e){const h=c.indexOf("\0");return h!==-1?c.substring(0,h):c}return c.replace(/\0/g,"")}const n=t.length;let r,s,a,o="",l=0;for(;l<n;){if(r=t[l++],r===0&&e)return o;if(r===0||r===3)continue;switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(r);break;case 12:case 13:s=t[l++],o+=String.fromCharCode((r&31)<<6|s&63);break;case 14:s=t[l++],a=t[l++],o+=String.fromCharCode((r&15)<<12|(s&63)<<6|(a&63)<<0);break}}return o};let Ka;function ny(){if(!navigator.userAgent.includes("PlayStation 4"))return!Ka&&typeof self.TextDecoder<"u"&&(Ka=new self.TextDecoder("utf-8")),Ka}const yi={hexDump:function(t){let e="";for(let i=0;i<t.length;i++){let n=t[i].toString(16);n.length<2&&(n="0"+n),e+=n}return e}},va=Math.pow(2,32)-1,ry=[].push,Ku={video:1,audio:2,id3:3,text:4};function St(t){return String.fromCharCode.apply(null,t)}function Xu(t,e){const i=t[e]<<8|t[e+1];return i<0?65536+i:i}function De(t,e){const i=qu(t,e);return i<0?4294967296+i:i}function qu(t,e){return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}function Xa(t,e,i){t[e]=i>>24,t[e+1]=i>>16&255,t[e+2]=i>>8&255,t[e+3]=i&255}function We(t,e){const i=[];if(!e.length)return i;const n=t.byteLength;for(let r=0;r<n;){const s=De(t,r),a=St(t.subarray(r+4,r+8)),o=s>1?r+s:n;if(a===e[0])if(e.length===1)i.push(t.subarray(r+8,o));else{const l=We(t.subarray(r+8,o),e.slice(1));l.length&&ry.apply(i,l)}r=o}return i}function sy(t){const e=[],i=t[0];let n=8;const r=De(t,n);n+=4;const s=0,a=0;i===0?n+=8:n+=16,n+=2;let o=t.length+a;const l=Xu(t,n);n+=2;for(let c=0;c<l;c++){let h=n;const u=De(t,h);h+=4;const f=u&2147483647;if((u&2147483648)>>>31===1)return N.warn("SIDX has hierarchical references (not supported)"),null;const p=De(t,h);h+=4,e.push({referenceSize:f,subsegmentDuration:p,info:{duration:p/r,start:o,end:o+f-1}}),o+=f,h+=4,n=h}return{earliestPresentationTime:s,timescale:r,version:i,referencesCount:l,references:e}}function Zu(t){const e=[],i=We(t,["moov","trak"]);for(let r=0;r<i.length;r++){const s=i[r],a=We(s,["tkhd"])[0];if(a){let o=a[0],l=o===0?12:20;const c=De(a,l),h=We(s,["mdia","mdhd"])[0];if(h){o=h[0],l=o===0?12:20;const u=De(h,l),f=We(s,["mdia","hdlr"])[0];if(f){const d=St(f.subarray(8,12)),p={soun:Qe.AUDIO,vide:Qe.VIDEO}[d];if(p){const m=We(s,["mdia","minf","stbl","stsd"])[0];let g;m&&(g=St(m.subarray(12,16))),e[c]={timescale:u,type:p},e[p]={timescale:u,id:c,codec:g}}}}}}return We(t,["moov","mvex","trex"]).forEach(r=>{const s=De(r,4),a=e[s];a&&(a.default={duration:De(r,12),flags:De(r,20)})}),e}function ay(t,e){if(!t||!e)return t;const i=e.keyId;return i&&e.isCommonEncryption&&We(t,["moov","trak"]).forEach(r=>{const a=We(r,["mdia","minf","stbl","stsd"])[0].subarray(8);let o=We(a,["enca"]);const l=o.length>0;l||(o=We(a,["encv"])),o.forEach(c=>{const h=l?c.subarray(28):c.subarray(78);We(h,["sinf"]).forEach(f=>{const d=Ju(f);if(d){const p=d.subarray(8,24);p.some(m=>m!==0)||(N.log(`[eme] Patching keyId in 'enc${l?"a":"v"}>sinf>>tenc' box: ${yi.hexDump(p)} -> ${yi.hexDump(i)}`),d.set(i,8))}})})}),t}function Ju(t){const e=We(t,["schm"])[0];if(e){const i=St(e.subarray(4,8));if(i==="cbcs"||i==="cenc")return We(t,["schi","tenc"])[0]}return N.error("[eme] missing 'schm' box"),null}function oy(t,e){return We(e,["moof","traf"]).reduce((i,n)=>{const r=We(n,["tfdt"])[0],s=r[0],a=We(n,["tfhd"]).reduce((o,l)=>{const c=De(l,4),h=t[c];if(h){let u=De(r,4);if(s===1){if(u===va)return N.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),o;u*=va+1,u+=De(r,8)}const f=h.timescale||9e4,d=u/f;if(be(d)&&(o===null||d<o))return d}return o},null);return a!==null&&be(a)&&(i===null||a<i)?a:i},null)}function ly(t,e){let i=0,n=0,r=0;const s=We(t,["moof","traf"]);for(let a=0;a<s.length;a++){const o=s[a],l=We(o,["tfhd"])[0],c=De(l,4),h=e[c];if(!h)continue;const u=h.default,f=De(l,0)|(u==null?void 0:u.flags);let d=u==null?void 0:u.duration;f&8&&(f&2?d=De(l,12):d=De(l,8));const p=h.timescale||9e4,m=We(o,["trun"]);for(let g=0;g<m.length;g++){if(i=cy(m[g]),!i&&d){const v=De(m[g],4);i=d*v}h.type===Qe.VIDEO?n+=i/p:h.type===Qe.AUDIO&&(r+=i/p)}}if(n===0&&r===0){let a=0;const o=We(t,["sidx"]);for(let l=0;l<o.length;l++){const c=sy(o[l]);c!=null&&c.references&&(a+=c.references.reduce((h,u)=>h+u.info.duration||0,0))}return a}return n||r}function cy(t){const e=De(t,0);let i=8;e&1&&(i+=4),e&4&&(i+=4);let n=0;const r=De(t,4);for(let s=0;s<r;s++){if(e&256){const a=De(t,i);n+=a,i+=4}e&512&&(i+=4),e&1024&&(i+=4),e&2048&&(i+=4)}return n}function hy(t,e,i){We(e,["moof","traf"]).forEach(n=>{We(n,["tfhd"]).forEach(r=>{const s=De(r,4),a=t[s];if(!a)return;const o=a.timescale||9e4;We(n,["tfdt"]).forEach(l=>{const c=l[0];let h=De(l,4);if(c===0)h-=i*o,h=Math.max(h,0),Xa(l,4,h);else{h*=Math.pow(2,32),h+=De(l,8),h-=i*o,h=Math.max(h,0);const u=Math.floor(h/(va+1)),f=Math.floor(h%(va+1));Xa(l,4,u),Xa(l,8,f)}})})})}function uy(t){const e={valid:null,remainder:null},i=We(t,["moof"]);if(i){if(i.length<2)return e.remainder=t,e}else return e;const n=i[i.length-1];return e.valid=fn(t,0,n.byteOffset-8),e.remainder=fn(t,n.byteOffset-8),e}function En(t,e){const i=new Uint8Array(t.length+e.length);return i.set(t),i.set(e,t.length),i}function qc(t,e){const i=[],n=e.samples,r=e.timescale,s=e.id;let a=!1;return We(n,["moof"]).map(l=>{const c=l.byteOffset-8;We(l,["traf"]).map(u=>{const f=We(u,["tfdt"]).map(d=>{const p=d[0];let m=De(d,4);return p===1&&(m*=Math.pow(2,32),m+=De(d,8)),m/r})[0];return f!==void 0&&(t=f),We(u,["tfhd"]).map(d=>{const p=De(d,4),m=De(d,0)&16777215,g=(m&1)!==0,v=(m&2)!==0,x=(m&8)!==0;let y=0;const b=(m&16)!==0;let E=0;const w=(m&32)!==0;let A=8;p===s&&(g&&(A+=8),v&&(A+=4),x&&(y=De(d,A),A+=4),b&&(E=De(d,A),A+=4),w&&(A+=4),e.type==="video"&&(a=fy(e.codec)),We(u,["trun"]).map(D=>{const O=D[0],P=De(D,0)&16777215,L=(P&1)!==0;let C=0;const U=(P&4)!==0,j=(P&256)!==0;let K=0;const z=(P&512)!==0;let $=0;const k=(P&1024)!==0,G=(P&2048)!==0;let q=0;const ee=De(D,4);let Q=8;L&&(C=De(D,Q),Q+=4),U&&(Q+=4);let ae=C+c;for(let V=0;V<ee;V++){if(j?(K=De(D,Q),Q+=4):K=y,z?($=De(D,Q),Q+=4):$=E,k&&(Q+=4),G&&(O===0?q=De(D,Q):q=qu(D,Q),Q+=4),e.type===Qe.VIDEO){let oe=0;for(;oe<$;){const ne=De(n,ae);if(ae+=4,dy(a,n[ae])){const ve=n.subarray(ae,ae+ne);Qu(ve,a?2:1,t+q/r,i)}ae+=ne,oe+=ne+4}}t+=K/r}}))})})}),i}function fy(t){if(!t)return!1;const e=t.indexOf("."),i=e<0?t:t.substring(0,e);return i==="hvc1"||i==="hev1"||i==="dvh1"||i==="dvhe"}function dy(t,e){if(t){const i=e>>1&63;return i===39||i===40}else return(e&31)===6}function Qu(t,e,i,n){const r=ef(t);let s=0;s+=e;let a=0,o=0,l=!1,c=0;for(;s<r.length;){a=0;do{if(s>=r.length)break;c=r[s++],a+=c}while(c===255);o=0;do{if(s>=r.length)break;c=r[s++],o+=c}while(c===255);const h=r.length-s;if(!l&&a===4&&s<r.length){if(l=!0,r[s++]===181){const f=Xu(r,s);if(s+=2,f===49){const d=De(r,s);if(s+=4,d===1195456820){const p=r[s++];if(p===3){const m=r[s++],g=31&m,v=64&m,x=v?2+g*3:0,y=new Uint8Array(x);if(v){y[0]=m;for(let b=1;b<x;b++)y[b]=r[s++]}n.push({type:p,payloadType:a,pts:i,bytes:y})}}}}}else if(a===5&&o<h){if(l=!0,o>16){const u=[];for(let p=0;p<16;p++){const m=r[s++].toString(16);u.push(m.length==1?"0"+m:m),(p===3||p===5||p===7||p===9)&&u.push("-")}const f=o-16,d=new Uint8Array(f);for(let p=0;p<f;p++)d[p]=r[s++];n.push({payloadType:a,pts:i,uuid:u.join(""),userData:wi(d),userDataBytes:d})}}else if(o<h)s+=o;else if(o>h)break}}function ef(t){const e=t.byteLength,i=[];let n=1;for(;n<e-2;)t[n]===0&&t[n+1]===0&&t[n+2]===3?(i.push(n+2),n+=2):n++;if(i.length===0)return t;const r=e-i.length,s=new Uint8Array(r);let a=0;for(n=0;n<r;a++,n++)a===i[0]&&(a++,i.shift()),s[n]=t[a];return s}function py(t){const e=t[0];let i="",n="",r=0,s=0,a=0,o=0,l=0,c=0;if(e===0){for(;St(t.subarray(c,c+1))!=="\0";)i+=St(t.subarray(c,c+1)),c+=1;for(i+=St(t.subarray(c,c+1)),c+=1;St(t.subarray(c,c+1))!=="\0";)n+=St(t.subarray(c,c+1)),c+=1;n+=St(t.subarray(c,c+1)),c+=1,r=De(t,12),s=De(t,16),o=De(t,20),l=De(t,24),c=28}else if(e===1){c+=4,r=De(t,c),c+=4;const u=De(t,c);c+=4;const f=De(t,c);for(c+=4,a=2**32*u+f,D0(a)||(a=Number.MAX_SAFE_INTEGER,N.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=De(t,c),c+=4,l=De(t,c),c+=4;St(t.subarray(c,c+1))!=="\0";)i+=St(t.subarray(c,c+1)),c+=1;for(i+=St(t.subarray(c,c+1)),c+=1;St(t.subarray(c,c+1))!=="\0";)n+=St(t.subarray(c,c+1)),c+=1;n+=St(t.subarray(c,c+1)),c+=1}const h=t.subarray(c,t.byteLength);return{schemeIdUri:i,value:n,timeScale:r,presentationTime:a,presentationTimeDelta:s,eventDuration:o,id:l,payload:h}}function my(t,...e){const i=e.length;let n=8,r=i;for(;r--;)n+=e[r].byteLength;const s=new Uint8Array(n);for(s[0]=n>>24&255,s[1]=n>>16&255,s[2]=n>>8&255,s[3]=n&255,s.set(t,4),r=0,n=8;r<i;r++)s.set(e[r],n),n+=e[r].byteLength;return s}function gy(t,e,i){if(t.byteLength!==16)throw new RangeError("Invalid system id");let n,r;if(e){n=1,r=new Uint8Array(e.length*16);for(let o=0;o<e.length;o++){const l=e[o];if(l.byteLength!==16)throw new RangeError("Invalid key");r.set(l,o*16)}}else n=0,r=new Uint8Array;let s;n>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const a=new Uint8Array(4);return i&&i.byteLength>0&&new DataView(a.buffer).setUint32(0,i.byteLength,!1),my([112,115,115,104],new Uint8Array([n,0,0,0]),t,s,r,a,i||new Uint8Array)}function vy(t){if(!(t instanceof ArrayBuffer)||t.byteLength<32)return null;const e={version:0,systemId:"",kids:null,data:null},i=new DataView(t),n=i.getUint32(0);if(t.byteLength!==n&&n>44||i.getUint32(4)!==1886614376||(e.version=i.getUint32(8)>>>24,e.version>1))return null;e.systemId=yi.hexDump(new Uint8Array(t,12,16));const s=i.getUint32(28);if(e.version===0){if(n-32<s)return null;e.data=new Uint8Array(t,32,s)}else if(e.version===1){e.kids=[];for(let a=0;a<s;a++)e.kids.push(new Uint8Array(t,32+a*16,16))}return e}let ps={};class is{static clearKeyUriToKeyIdMap(){ps={}}constructor(e,i,n,r=[1],s=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=i,this.keyFormat=n,this.keyFormatVersions=r,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&e!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Xt.FAIRPLAY:case Xt.WIDEVINE:case Xt.PLAYREADY:case Xt.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof e!="number"&&(this.method==="AES-128"&&!this.iv&&N.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const n=yy(e);return new is(this.method,this.uri,"identity",this.keyFormatVersions,n)}const i=j0(this.uri);if(i)switch(this.keyFormat){case Xt.WIDEVINE:this.pssh=i,i.length>=22&&(this.keyId=i.subarray(i.length-22,i.length-6));break;case Xt.PLAYREADY:{const n=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=gy(n,null,i);const r=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2),s=String.fromCharCode.apply(null,Array.from(r)),a=s.substring(s.indexOf("<"),s.length),c=new DOMParser().parseFromString(a,"text/xml").getElementsByTagName("KID")[0];if(c){const h=c.childNodes[0]?c.childNodes[0].nodeValue:c.getAttribute("VALUE");if(h){const u=Ul(h).subarray(0,16);W0(u),this.keyId=u}}break}default:{let n=i.subarray(0,16);if(n.length!==16){const r=new Uint8Array(16);r.set(n,16-n.length),n=r}this.keyId=n;break}}if(!this.keyId||this.keyId.byteLength!==16){let n=ps[this.uri];if(!n){const r=Object.keys(ps).length%Number.MAX_SAFE_INTEGER;n=new Uint8Array(16),new DataView(n.buffer,12,4).setUint32(0,r),ps[this.uri]=n}this.keyId=n}return this}}function yy(t){const e=new Uint8Array(16);for(let i=12;i<16;i++)e[i]=t>>8*(15-i)&255;return e}const tf=/\{\$([a-zA-Z0-9-_]+)\}/g;function Zc(t){return tf.test(t)}function Kt(t,e,i){if(t.variableList!==null||t.hasVariableRefs)for(let n=i.length;n--;){const r=i[n],s=e[r];s&&(e[r]=fl(t,s))}}function fl(t,e){if(t.variableList!==null||t.hasVariableRefs){const i=t.variableList;return e.replace(tf,n=>{const r=n.substring(2,n.length-1),s=i==null?void 0:i[r];return s===void 0?(t.playlistParsingError||(t.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),n):s})}return e}function Jc(t,e,i){let n=t.variableList;n||(t.variableList=n={});let r,s;if("QUERYPARAM"in e){r=e.QUERYPARAM;try{const a=new self.URL(i).searchParams;if(a.has(r))s=a.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${i}"`)}catch(a){t.playlistParsingError||(t.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else r=e.NAME,s=e.VALUE;r in n?t.playlistParsingError||(t.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):n[r]=s||""}function xy(t,e,i){const n=e.IMPORT;if(i&&n in i){let r=t.variableList;r||(t.variableList=r={}),r[n]=i[n]}else t.playlistParsingError||(t.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}function Ra(){if(!(typeof self>"u"))return self.MediaSource||self.WebKitMediaSource}const Ey={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},Qc=Ra();function by(t,e){const i=Ey[e];return!!i&&i[t.slice(0,4)]===!0}function qa(t,e){var i;return(i=Qc==null?void 0:Qc.isTypeSupported(`${e||"video"}/mp4;codecs="${t}"`))!=null?i:!1}const eh=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,th=/#EXT-X-MEDIA:(.*)/g,Ty=/^#EXT(?:INF|-X-TARGETDURATION):/m,ih=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),_y=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class vi{static findGroup(e,i){for(let n=0;n<e.length;n++){const r=e[n];if(r.id===i)return r}}static convertAVC1ToAVCOTI(e){const i=e.split(".");if(i.length>2){let n=i.shift()+".";return n+=parseInt(i.shift()).toString(16),n+=("000"+parseInt(i.shift()).toString(16)).slice(-4),n}return e}static resolve(e,i){return Bl.buildAbsoluteURL(i,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return Ty.test(e)}static parseMasterPlaylist(e,i){const n=Zc(e),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},s=[];eh.lastIndex=0;let a;for(;(a=eh.exec(e))!=null;)if(a[1]){var o;const c=new ft(a[1]);Kt(r,c,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const h=fl(r,a[2]),u={attrs:c,bitrate:c.decimalInteger("AVERAGE-BANDWIDTH")||c.decimalInteger("BANDWIDTH"),name:c.NAME,url:vi.resolve(h,i)},f=c.decimalResolution("RESOLUTION");f&&(u.width=f.width,u.height=f.height),wy((c.CODECS||"").split(/[ ,]+/).filter(d=>d),u),u.videoCodec&&u.videoCodec.indexOf("avc1")!==-1&&(u.videoCodec=vi.convertAVC1ToAVCOTI(u.videoCodec)),(o=u.unknownCodecs)!=null&&o.length||s.push(u),r.levels.push(u)}else if(a[3]){const c=a[3],h=a[4];switch(c){case"SESSION-DATA":{const u=new ft(h);Kt(r,u,["DATA-ID","LANGUAGE","VALUE","URI"]);const f=u["DATA-ID"];f&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[f]=u);break}case"SESSION-KEY":{const u=nh(h,i,r);u.encrypted&&u.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(u)):N.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${h}"`);break}case"DEFINE":{{const u=new ft(h);Kt(r,u,["NAME","VALUE","QUERYPARAM"]),Jc(r,u,i)}break}case"CONTENT-STEERING":{const u=new ft(h);Kt(r,u,["SERVER-URI","PATHWAY-ID"]),r.contentSteering={uri:vi.resolve(u["SERVER-URI"],i),pathwayId:u["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=rh(h);break}}}const l=s.length>0&&s.length<r.levels.length;return r.levels=l?s:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,i,n){let r;const s={},a=n.levels,o={AUDIO:a.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:a.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(th.lastIndex=0;(r=th.exec(e))!==null;){const c=new ft(r[1]),h=c.TYPE;if(h){const u=o[h],f=s[h]||[];s[h]=f,Kt(n,c,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const d={attrs:c,bitrate:0,id:l++,groupId:c["GROUP-ID"]||"",instreamId:c["INSTREAM-ID"],name:c.NAME||c.LANGUAGE||"",type:h,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:c.LANGUAGE,url:c.URI?vi.resolve(c.URI,i):""};if(u!=null&&u.length){const p=vi.findGroup(u,d.groupId)||u[0];sh(d,p,"audioCodec"),sh(d,p,"textCodec")}f.push(d)}}return s}static parseLevelPlaylist(e,i,n,r,s,a){const o=new V0(i),l=o.fragments;let c=null,h=0,u=0,f=0,d=0,p=null,m=new $a(r,i),g,v,x,y=-1,b=!1;for(ih.lastIndex=0,o.m3u8=e,o.hasVariableRefs=Zc(e);(g=ih.exec(e))!==null;){b&&(b=!1,m=new $a(r,i),m.start=f,m.sn=h,m.cc=d,m.level=n,c&&(m.initSegment=c,m.rawProgramDateTime=c.rawProgramDateTime,c.rawProgramDateTime=null));const D=g[1];if(D){m.duration=parseFloat(D);const O=(" "+g[2]).slice(1);m.title=O||null,m.tagList.push(O?["INF",D,O]:["INF",D])}else if(g[3]){if(be(m.duration)){m.start=f,x&&lh(m,x,o),m.sn=h,m.level=n,m.cc=d,m.urlId=s,l.push(m);const O=(" "+g[3]).slice(1);m.relurl=fl(o,O),ah(m,p),p=m,f+=m.duration,h++,u=0,b=!0}}else if(g[4]){const O=(" "+g[4]).slice(1);p?m.setByteRange(O,p):m.setByteRange(O)}else if(g[5])m.rawProgramDateTime=(" "+g[5]).slice(1),m.tagList.push(["PROGRAM-DATE-TIME",m.rawProgramDateTime]),y===-1&&(y=l.length);else{if(g=g[0].match(_y),!g){N.warn("No matches on slow regex match for level playlist!");continue}for(v=1;v<g.length&&!(typeof g[v]<"u");v++);const O=(" "+g[v]).slice(1),P=(" "+g[v+1]).slice(1),L=g[v+2]?(" "+g[v+2]).slice(1):"";switch(O){case"PLAYLIST-TYPE":o.type=P.toUpperCase();break;case"MEDIA-SEQUENCE":h=o.startSN=parseInt(P);break;case"SKIP":{const C=new ft(P);Kt(o,C,["RECENTLY-REMOVED-DATERANGES"]);const U=C.decimalInteger("SKIPPED-SEGMENTS");if(be(U)){o.skippedSegments=U;for(let K=U;K--;)l.unshift(null);h+=U}const j=C.enumeratedString("RECENTLY-REMOVED-DATERANGES");j&&(o.recentlyRemovedDateranges=j.split("	"));break}case"TARGETDURATION":o.targetduration=Math.max(parseInt(P),1);break;case"VERSION":o.version=parseInt(P);break;case"EXTM3U":break;case"ENDLIST":o.live=!1;break;case"#":(P||L)&&m.tagList.push(L?[P,L]:[P]);break;case"DISCONTINUITY":d++,m.tagList.push(["DIS"]);break;case"GAP":m.gap=!0,m.tagList.push([O]);break;case"BITRATE":m.tagList.push([O,P]);break;case"DATERANGE":{const C=new ft(P);Kt(o,C,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),Kt(o,C,C.clientAttrs);const U=new Gu(C,o.dateRanges[C.ID]);U.isValid||o.skippedSegments?o.dateRanges[U.id]=U:N.warn(`Ignoring invalid DATERANGE tag: "${P}"`),m.tagList.push(["EXT-X-DATERANGE",P]);break}case"DEFINE":{{const C=new ft(P);Kt(o,C,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in C?xy(o,C,a):Jc(o,C,i)}break}case"DISCONTINUITY-SEQUENCE":d=parseInt(P);break;case"KEY":{const C=nh(P,i,o);if(C.isSupported()){if(C.method==="NONE"){x=void 0;break}x||(x={}),x[C.keyFormat]&&(x=bt({},x)),x[C.keyFormat]=C}else N.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${P}"`);break}case"START":o.startTimeOffset=rh(P);break;case"MAP":{const C=new ft(P);if(Kt(o,C,["BYTERANGE","URI"]),m.duration){const U=new $a(r,i);oh(U,C,n,x),c=U,m.initSegment=c,c.rawProgramDateTime&&!m.rawProgramDateTime&&(m.rawProgramDateTime=c.rawProgramDateTime)}else oh(m,C,n,x),c=m,b=!0;break}case"SERVER-CONTROL":{const C=new ft(P);o.canBlockReload=C.bool("CAN-BLOCK-RELOAD"),o.canSkipUntil=C.optionalFloat("CAN-SKIP-UNTIL",0),o.canSkipDateRanges=o.canSkipUntil>0&&C.bool("CAN-SKIP-DATERANGES"),o.partHoldBack=C.optionalFloat("PART-HOLD-BACK",0),o.holdBack=C.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const C=new ft(P);o.partTarget=C.decimalFloatingPoint("PART-TARGET");break}case"PART":{let C=o.partList;C||(C=o.partList=[]);const U=u>0?C[C.length-1]:void 0,j=u++,K=new ft(P);Kt(o,K,["BYTERANGE","URI"]);const z=new G0(K,m,i,j,U);C.push(z),m.duration+=z.duration;break}case"PRELOAD-HINT":{const C=new ft(P);Kt(o,C,["URI"]),o.preloadHint=C;break}case"RENDITION-REPORT":{const C=new ft(P);Kt(o,C,["URI"]),o.renditionReports=o.renditionReports||[],o.renditionReports.push(C);break}default:N.warn(`line parsed but not handled: ${g}`);break}}}p&&!p.relurl?(l.pop(),f-=p.duration,o.partList&&(o.fragmentHint=p)):o.partList&&(ah(m,p),m.cc=d,o.fragmentHint=m,x&&lh(m,x,o));const E=l.length,w=l[0],A=l[E-1];if(f+=o.skippedSegments*o.targetduration,f>0&&E&&A){o.averagetargetduration=f/E;const D=A.sn;o.endSN=D!=="initSegment"?D:0,o.live||(A.endList=!0),w&&(o.startCC=w.cc)}else o.endSN=0,o.startCC=0;return o.fragmentHint&&(f+=o.fragmentHint.duration),o.totalduration=f,o.endCC=d,y>0&&Ay(l,y),o}}function nh(t,e,i){var n,r;const s=new ft(t);Kt(i,s,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const a=(n=s.METHOD)!=null?n:"",o=s.URI,l=s.hexadecimalInteger("IV"),c=s.KEYFORMATVERSIONS,h=(r=s.KEYFORMAT)!=null?r:"identity";o&&s.IV&&!l&&N.error(`Invalid IV: ${s.IV}`);const u=o?vi.resolve(o,e):"",f=(c||"1").split("/").map(Number).filter(Number.isFinite);return new is(a,u,h,f,l)}function rh(t){const i=new ft(t).decimalFloatingPoint("TIME-OFFSET");return be(i)?i:null}function wy(t,e){["video","audio","text"].forEach(i=>{const n=t.filter(r=>by(r,i));if(n.length){const r=n.filter(s=>s.lastIndexOf("avc1",0)===0||s.lastIndexOf("mp4a",0)===0);e[`${i}Codec`]=r.length>0?r[0]:n[0],t=t.filter(s=>n.indexOf(s)===-1)}}),e.unknownCodecs=t}function sh(t,e,i){const n=e[i];n&&(t[i]=n)}function Ay(t,e){let i=t[e];for(let n=e;n--;){const r=t[n];if(!r)return;r.programDateTime=i.programDateTime-r.duration*1e3,i=r}}function ah(t,e){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):e!=null&&e.programDateTime&&(t.programDateTime=e.endProgramDateTime),be(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}function oh(t,e,i,n){t.relurl=e.URI,e.BYTERANGE&&t.setByteRange(e.BYTERANGE),t.level=i,t.sn="initSegment",n&&(t.levelkeys=n),t.initSegment=null}function lh(t,e,i){t.levelkeys=e;const{encryptedFragments:n}=i;(!n.length||n[n.length-1].levelkeys!==e)&&Object.keys(e).some(r=>e[r].isCommonEncryption)&&n.push(t)}var je={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Me={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function ch(t){const{type:e}=t;switch(e){case je.AUDIO_TRACK:return Me.AUDIO;case je.SUBTITLE_TRACK:return Me.SUBTITLE;default:return Me.MAIN}}function Za(t,e){let i=t.url;return(i===void 0||i.indexOf("data:")===0)&&(i=e.url),i}class Sy{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.LEVEL_LOADING,this.onLevelLoading,this),e.on(T.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(T.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:e}=this;e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.LEVEL_LOADING,this.onLevelLoading,this),e.off(T.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(T.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){const i=this.hls.config,n=i.pLoader,r=i.loader,s=n||r,a=new s(i);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const i=this.loaders[e];i&&i.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,i){const{url:n}=i;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:je.MANIFEST,url:n,deliveryDirectives:null})}onLevelLoading(e,i){const{id:n,level:r,url:s,deliveryDirectives:a}=i;this.load({id:n,level:r,responseType:"text",type:je.LEVEL,url:s,deliveryDirectives:a})}onAudioTrackLoading(e,i){const{id:n,groupId:r,url:s,deliveryDirectives:a}=i;this.load({id:n,groupId:r,level:null,responseType:"text",type:je.AUDIO_TRACK,url:s,deliveryDirectives:a})}onSubtitleTrackLoading(e,i){const{id:n,groupId:r,url:s,deliveryDirectives:a}=i;this.load({id:n,groupId:r,level:null,responseType:"text",type:je.SUBTITLE_TRACK,url:s,deliveryDirectives:a})}load(e){var i;const n=this.hls.config;let r=this.getInternalLoader(e);if(r){const c=r.context;if(c&&c.url===e.url){N.trace("[playlist-loader]: playlist request ongoing");return}N.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}let s;if(e.type===je.MANIFEST?s=n.manifestLoadPolicy.default:s=bt({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),(i=e.deliveryDirectives)!=null&&i.part){let c;if(e.type===je.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===je.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===je.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const h=c.partTarget,u=c.targetduration;if(h&&u){const f=Math.max(h*3,u*.8)*1e3;s=bt({},s,{maxTimeToFirstByteMs:Math.min(f,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,s.maxTimeToFirstByteMs)})}}}const a=s.errorRetry||s.timeoutRetry||{},o={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(c,h,u,f)=>{const d=this.getInternalLoader(u);this.resetInternalLoader(u.type);const p=c.data;if(p.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(c,u,new Error("no EXTM3U delimiter"),f||null,h);return}h.parsing.start=performance.now(),vi.isMediaPlaylist(p)?this.handleTrackOrLevelPlaylist(c,h,u,f||null,d):this.handleMasterPlaylist(c,h,u,f)},onError:(c,h,u,f)=>{this.handleNetworkError(h,u,!1,c,f)},onTimeout:(c,h,u)=>{this.handleNetworkError(h,u,!0,void 0,c)}};r.load(e,o,l)}handleMasterPlaylist(e,i,n,r){const s=this.hls,a=e.data,o=Za(e,n),l=vi.parseMasterPlaylist(a,o);if(l.playlistParsingError){this.handleManifestParsingError(e,n,l.playlistParsingError,r,i);return}const{contentSteering:c,levels:h,sessionData:u,sessionKeys:f,startTimeOffset:d,variableList:p}=l;this.variableList=p;const{AUDIO:m=[],SUBTITLES:g,"CLOSED-CAPTIONS":v}=vi.parseMasterPlaylistMedia(a,o,l);m.length&&!m.some(y=>!y.url)&&h[0].audioCodec&&!h[0].attrs.AUDIO&&(N.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new ft({}),bitrate:0,url:""})),s.trigger(T.MANIFEST_LOADED,{levels:h,audioTracks:m,subtitles:g,captions:v,contentSteering:c,url:o,stats:i,networkDetails:r,sessionData:u,sessionKeys:f,startTimeOffset:d,variableList:p})}handleTrackOrLevelPlaylist(e,i,n,r,s){const a=this.hls,{id:o,level:l,type:c}=n,h=Za(e,n),u=be(o)?o:0,f=be(l)?l:u,d=ch(n),p=vi.parseLevelPlaylist(e.data,h,f,d,u,this.variableList);if(c===je.MANIFEST){const m={attrs:new ft({}),bitrate:0,details:p,name:"",url:h};a.trigger(T.MANIFEST_LOADED,{levels:[m],audioTracks:[],url:h,stats:i,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}i.parsing.end=performance.now(),n.levelDetails=p,this.handlePlaylistLoaded(p,e,i,n,r,s)}handleManifestParsingError(e,i,n,r,s){this.hls.trigger(T.ERROR,{type:Se.NETWORK_ERROR,details:Y.MANIFEST_PARSING_ERROR,fatal:i.type===je.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:i,networkDetails:r,stats:s})}handleNetworkError(e,i,n=!1,r,s){let a=`A network ${n?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===je.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===je.AUDIO_TRACK||e.type===je.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const o=new Error(a);N.warn(`[playlist-loader]: ${a}`);let l=Y.UNKNOWN,c=!1;const h=this.getInternalLoader(e);switch(e.type){case je.MANIFEST:l=n?Y.MANIFEST_LOAD_TIMEOUT:Y.MANIFEST_LOAD_ERROR,c=!0;break;case je.LEVEL:l=n?Y.LEVEL_LOAD_TIMEOUT:Y.LEVEL_LOAD_ERROR,c=!1;break;case je.AUDIO_TRACK:l=n?Y.AUDIO_TRACK_LOAD_TIMEOUT:Y.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case je.SUBTITLE_TRACK:l=n?Y.SUBTITLE_TRACK_LOAD_TIMEOUT:Y.SUBTITLE_LOAD_ERROR,c=!1;break}h&&this.resetInternalLoader(e.type);const u={type:Se.NETWORK_ERROR,details:l,fatal:c,url:e.url,loader:h,context:e,error:o,networkDetails:i,stats:s};if(r){const f=(i==null?void 0:i.url)||e.url;u.response=zt({url:f,data:void 0},r)}this.hls.trigger(T.ERROR,u)}handlePlaylistLoaded(e,i,n,r,s,a){const o=this.hls,{type:l,level:c,id:h,groupId:u,deliveryDirectives:f}=r,d=Za(i,r),p=ch(r),m=typeof r.level=="number"&&p===Me.MAIN?c:void 0;if(!e.fragments.length){const v=new Error("No Segments found in Playlist");o.trigger(T.ERROR,{type:Se.NETWORK_ERROR,details:Y.LEVEL_EMPTY_ERROR,fatal:!1,url:d,error:v,reason:v.message,response:i,context:r,level:m,parent:p,networkDetails:s,stats:n});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const g=e.playlistParsingError;if(g){o.trigger(T.ERROR,{type:Se.NETWORK_ERROR,details:Y.LEVEL_PARSING_ERROR,fatal:!1,url:d,error:g,reason:g.message,response:i,context:r,level:m,parent:p,networkDetails:s,stats:n});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case je.MANIFEST:case je.LEVEL:o.trigger(T.LEVEL_LOADED,{details:e,level:m||0,id:h||0,stats:n,networkDetails:s,deliveryDirectives:f});break;case je.AUDIO_TRACK:o.trigger(T.AUDIO_TRACK_LOADED,{details:e,id:h||0,groupId:u||"",stats:n,networkDetails:s,deliveryDirectives:f});break;case je.SUBTITLE_TRACK:o.trigger(T.SUBTITLE_TRACK_LOADED,{details:e,id:h||0,groupId:u||"",stats:n,networkDetails:s,deliveryDirectives:f});break}}}function nf(t,e){let i;try{i=new Event("addtrack")}catch{i=document.createEvent("Event"),i.initEvent("addtrack",!1,!1)}i.track=t,e.dispatchEvent(i)}function rf(t,e){const i=t.mode;if(i==="disabled"&&(t.mode="hidden"),t.cues&&!t.cues.getCueById(e.id))try{if(t.addCue(e),!t.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){N.debug(`[texttrack-utils]: ${n}`);try{const r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,t.addCue(r)}catch(r){N.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}i==="disabled"&&(t.mode=i)}function Pn(t){const e=t.mode;if(e==="disabled"&&(t.mode="hidden"),t.cues)for(let i=t.cues.length;i--;)t.removeCue(t.cues[i]);e==="disabled"&&(t.mode=e)}function dl(t,e,i,n){const r=t.mode;if(r==="disabled"&&(t.mode="hidden"),t.cues&&t.cues.length>0){const s=My(t.cues,e,i);for(let a=0;a<s.length;a++)(!n||n(s[a]))&&t.removeCue(s[a])}r==="disabled"&&(t.mode=r)}function Ly(t,e){if(e<t[0].startTime)return 0;const i=t.length-1;if(e>t[i].endTime)return-1;let n=0,r=i;for(;n<=r;){const s=Math.floor((r+n)/2);if(e<t[s].startTime)r=s-1;else if(e>t[s].startTime&&n<i)n=s+1;else return s}return t[n].startTime-e<e-t[r].startTime?n:r}function My(t,e,i){const n=[],r=Ly(t,e);if(r>-1)for(let s=r,a=t.length;s<a;s++){const o=t[s];if(o.startTime>=e&&o.endTime<=i)n.push(o);else if(o.startTime>i)return n}return n}var pi={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const Ry=.25;function pl(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function hh(t,e,i,n,r){let s=new t(e,i,"");try{s.value=n,r&&(s.type=r)}catch{s=new t(e,i,JSON.stringify(r?zt({type:r},n):n))}return s}const ms=(()=>{const t=pl();try{t&&new t(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function Ja(t,e){return t.getTime()/1e3-e}function Iy(t){return Uint8Array.from(t.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class Cy{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:e}=this;e.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(T.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(T.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(T.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(T.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,i){this.media=i.media}onMediaDetaching(){this.id3Track&&(Pn(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const i=this.getID3Track(e.textTracks);return i.mode="hidden",i}getID3Track(e){if(this.media){for(let i=0;i<e.length;i++){const n=e[i];if(n.kind==="metadata"&&n.label==="id3")return nf(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,i){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:n,enableID3MetadataCues:r}}}=this;if(!n&&!r)return;const{samples:s}=i;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=pl();if(a)for(let o=0;o<s.length;o++){const l=s[o].type;if(l===pi.emsg&&!n||!r)continue;const c=Yu(s[o].data);if(c){const h=s[o].pts;let u=h+s[o].duration;u>ms&&(u=ms),u-h<=0&&(u=h+Ry);for(let d=0;d<c.length;d++){const p=c[d];if(!$u(p)){this.updateId3CueEnds(h,l);const m=hh(a,h,u,p,l);m&&this.id3Track.addCue(m)}}}}}updateId3CueEnds(e,i){var n;const r=(n=this.id3Track)==null?void 0:n.cues;if(r)for(let s=r.length;s--;){const a=r[s];a.type===i&&a.startTime<e&&a.endTime===ms&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:i,endOffset:n,type:r}){const{id3Track:s,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=a;if(s&&(o||l)){let c;r==="audio"?c=h=>h.type===pi.audioId3&&l:r==="video"?c=h=>h.type===pi.emsg&&o:c=h=>h.type===pi.audioId3&&l||h.type===pi.emsg&&o,dl(s,i,n,c)}}onLevelUpdated(e,{details:i}){if(!this.media||!i.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:n,id3Track:r}=this,{dateRanges:s}=i,a=Object.keys(s);if(r){const h=Object.keys(n).filter(u=>!a.includes(u));for(let u=h.length;u--;){const f=h[u];Object.keys(n[f].cues).forEach(d=>{r.removeCue(n[f].cues[d])}),delete n[f]}}const o=i.fragments[i.fragments.length-1];if(a.length===0||!be(o==null?void 0:o.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=o.programDateTime/1e3-o.start,c=pl();for(let h=0;h<a.length;h++){const u=a[h],f=s[u],d=n[u],p=(d==null?void 0:d.cues)||{};let m=(d==null?void 0:d.durationKnown)||!1;const g=Ja(f.startDate,l);let v=ms;const x=f.endDate;if(x)v=Ja(x,l),m=!0;else if(f.endOnNext&&!m){const b=a.reduce((E,w)=>{const A=s[w];return A.class===f.class&&A.id!==w&&A.startDate>f.startDate&&E.push(A),E},[]).sort((E,w)=>E.startDate.getTime()-w.startDate.getTime())[0];b&&(v=Ja(b.startDate,l),m=!0)}const y=Object.keys(f.attr);for(let b=0;b<y.length;b++){const E=y[b];if(!B0(E))continue;const w=p[E];if(w)m&&!d.durationKnown&&(w.endTime=v);else if(c){let A=f.attr[E];U0(E)&&(A=Iy(A));const D=hh(c,g,v,{key:E,data:A},pi.dateRange);D&&(D.id=u,this.id3Track.addCue(D),p[E]=D)}}n[u]={cues:p,dateRange:f,durationKnown:m}}}}class Dy{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:e,levelDetails:i}=this;return e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:i?e.liveMaxLatencyDurationCount*i.targetduration:0}get targetLatency(){const{levelDetails:e}=this;if(e===null)return null;const{holdBack:i,partHoldBack:n,targetduration:r}=e,{liveSyncDuration:s,liveSyncDurationCount:a,lowLatencyMode:o}=this.config,l=this.hls.userConfig;let c=o&&n||i;(l.liveSyncDuration||l.liveSyncDurationCount||c===0)&&(c=s!==void 0?s:a*r);const h=r,u=1;return c+Math.min(this.stallCount*u,h)}get liveSyncPosition(){const e=this.estimateLiveEdge(),i=this.targetLatency,n=this.levelDetails;if(e===null||i===null||n===null)return null;const r=n.edge,s=e-i-this.edgeStalled,a=r-n.totalduration,o=r-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(a,s),o)}get drift(){const{levelDetails:e}=this;return e===null?1:e.drift}get edgeStalled(){const{levelDetails:e}=this;if(e===null)return 0;const i=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-i,0)}get forwardBufferLength(){const{media:e,levelDetails:i}=this;if(!e||!i)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):i.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(T.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(T.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(T.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(T.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(T.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(T.ERROR,this.onError,this)}onMediaAttached(e,i){this.media=i.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:i}){this.levelDetails=i,i.advanced&&this.timeupdate(),!i.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,i){var n;i.details===Y.BUFFER_STALLED_ERROR&&(this.stallCount++,(n=this.levelDetails)!=null&&n.live&&N.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:e,levelDetails:i}=this;if(!e||!i)return;this.currentTime=e.currentTime;const n=this.computeLatency();if(n===null)return;this._latency=n;const{lowLatencyMode:r,maxLiveSyncPlaybackRate:s}=this.config;if(!r||s===1)return;const a=this.targetLatency;if(a===null)return;const o=n-a,l=Math.min(this.maxLatency,a+i.targetduration),c=o<l;if(i.live&&c&&o>.05&&this.forwardBufferLength>1){const h=Math.min(2,Math.max(1,s)),u=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20;e.playbackRate=Math.min(h,Math.max(1,u))}else e.playbackRate!==1&&e.playbackRate!==0&&(e.playbackRate=1)}estimateLiveEdge(){const{levelDetails:e}=this;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}const ml=["NONE","TYPE-0","TYPE-1",null];var vr={No:"",Yes:"YES",v2:"v2"};function Py(t,e){const{canSkipUntil:i,canSkipDateRanges:n,endSN:r}=t,s=e!==void 0?e-r:0;return i&&s<i?n?vr.v2:vr.Yes:vr.No}class uh{constructor(e,i,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=i,this.skip=n}addDirectives(e){const i=new self.URL(e);return this.msn!==void 0&&i.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&i.searchParams.set("_HLS_part",this.part.toString()),this.skip&&i.searchParams.set("_HLS_skip",this.skip),i.href}}class ns{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs,this.codecSet=[e.videoCodec,e.audioCodec].filter(i=>i).join(",").replace(/\.[^.,]+/g,"")}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get attrs(){return this._attrs[this._urlId]}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get uri(){return this.url[this._urlId]||""}get urlId(){return this._urlId}set urlId(e){const i=e%this.url.length;this._urlId!==i&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=i)}get audioGroupId(){var e;return(e=this.audioGroupIds)==null?void 0:e[this.urlId]}get textGroupId(){var e;return(e=this.textGroupIds)==null?void 0:e[this.urlId]}addFallback(e){this.url.push(e.url),this._attrs.push(e.attrs)}}function Qa(t,e){const i=e.startPTS;if(be(i)){let n=0,r;e.sn>t.sn?(n=i-t.start,r=t):(n=t.start-i,r=e),r.duration!==n&&(r.duration=n)}else e.sn>t.sn?t.cc===e.cc&&t.minEndPTS?e.start=t.start+(t.minEndPTS-t.start):e.start=t.start+t.duration:e.start=Math.max(t.start-e.duration,0)}function sf(t,e,i,n,r,s){n-i<=0&&(N.warn("Fragment should have a positive duration",e),n=i+e.duration,s=r+e.duration);let o=i,l=n;const c=e.startPTS,h=e.endPTS;if(be(c)){const g=Math.abs(c-i);be(e.deltaPTS)?e.deltaPTS=Math.max(g,e.deltaPTS):e.deltaPTS=g,o=Math.max(i,c),i=Math.min(i,c),r=Math.min(r,e.startDTS),l=Math.min(n,h),n=Math.max(n,h),s=Math.max(s,e.endDTS)}const u=i-e.start;e.start!==0&&(e.start=i),e.duration=n-e.start,e.startPTS=i,e.maxStartPTS=o,e.startDTS=r,e.endPTS=n,e.minEndPTS=l,e.endDTS=s;const f=e.sn;if(!t||f<t.startSN||f>t.endSN)return 0;let d;const p=f-t.startSN,m=t.fragments;for(m[p]=e,d=p;d>0;d--)Qa(m[d],m[d-1]);for(d=p;d<m.length-1;d++)Qa(m[d],m[d+1]);return t.fragmentHint&&Qa(m[m.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,u}function Oy(t,e){let i=null;const n=t.fragments;for(let l=n.length-1;l>=0;l--){const c=n[l].initSegment;if(c){i=c;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;let r=0,s;if(Ny(t,e,(l,c)=>{l.relurl&&(r=l.cc-c.cc),be(l.startPTS)&&be(l.endPTS)&&(c.start=c.startPTS=l.startPTS,c.startDTS=l.startDTS,c.maxStartPTS=l.maxStartPTS,c.endPTS=l.endPTS,c.endDTS=l.endDTS,c.minEndPTS=l.minEndPTS,c.duration=l.endPTS-l.startPTS,c.duration&&(s=c),e.PTSKnown=e.alignedSliding=!0),c.elementaryStreams=l.elementaryStreams,c.loader=l.loader,c.stats=l.stats,c.urlId=l.urlId,l.initSegment&&(c.initSegment=l.initSegment,i=l.initSegment)}),i&&(e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments).forEach(c=>{var h;(!c.initSegment||c.initSegment.relurl===((h=i)==null?void 0:h.relurl))&&(c.initSegment=i)}),e.skippedSegments)if(e.deltaUpdateFailed=e.fragments.some(l=>!l),e.deltaUpdateFailed){N.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let l=e.skippedSegments;l--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}else e.canSkipDateRanges&&(e.dateRanges=Fy(t.dateRanges,e.dateRanges,e.recentlyRemovedDateranges));const a=e.fragments;if(r){N.warn("discontinuity sliding from playlist, take drift into account");for(let l=0;l<a.length;l++)a[l].cc+=r}e.skippedSegments&&(e.startCC=e.fragments[0].cc),ky(t.partList,e.partList,(l,c)=>{c.elementaryStreams=l.elementaryStreams,c.stats=l.stats}),s?sf(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):af(t,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=t.driftStartTime,e.driftStart=t.driftStart;const o=e.advancedDateTime;if(e.advanced&&o){const l=e.edge;e.driftStart||(e.driftStartTime=o,e.driftStart=l),e.driftEndTime=o,e.driftEnd=l}else e.driftEndTime=t.driftEndTime,e.driftEnd=t.driftEnd,e.advancedDateTime=t.advancedDateTime}function Fy(t,e,i){const n=bt({},t);return i&&i.forEach(r=>{delete n[r]}),Object.keys(e).forEach(r=>{const s=new Gu(e[r].attr,n[r]);s.isValid?n[r]=s:N.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(e[r].attr)}"`)}),n}function ky(t,e,i){if(t&&e){let n=0;for(let r=0,s=t.length;r<=s;r++){const a=t[r],o=e[r+n];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?i(a,o):n--}}}function Ny(t,e,i){const n=e.skippedSegments,r=Math.max(t.startSN,e.startSN)-e.startSN,s=(t.fragmentHint?1:0)+(n?e.endSN:Math.min(t.endSN,e.endSN))-e.startSN,a=e.startSN-t.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments;for(let c=r;c<=s;c++){const h=l[a+c];let u=o[c];n&&!u&&c<n&&(u=e.fragments[c]=h),h&&u&&i(h,u)}}function af(t,e){const i=e.startSN+e.skippedSegments-t.startSN,n=t.fragments;i<0||i>=n.length||gl(e,n[i].start)}function gl(t,e){if(e){const i=t.fragments;for(let n=t.skippedSegments;n<i.length;n++)i[n].start+=e;t.fragmentHint&&(t.fragmentHint.start+=e)}}function By(t,e=1/0){let i=1e3*t.targetduration;if(t.updated){const n=t.fragments,r=4;if(n.length&&i*r>e){const s=n[n.length-1].duration*1e3;s<i&&(i=s)}}else i/=2;return Math.round(i)}function Uy(t,e,i){if(!(t!=null&&t.details))return null;const n=t.details;let r=n.fragments[e-n.startSN];return r||(r=n.fragmentHint,r&&r.sn===e)?r:e<n.startSN&&i&&i.sn===e?i:null}function fh(t,e,i){var n;return t!=null&&t.details?of((n=t.details)==null?void 0:n.partList,e,i):null}function of(t,e,i){if(t)for(let n=t.length;n--;){const r=t[n];if(r.index===i&&r.fragment.sn===e)return r}return null}function ya(t){switch(t.details){case Y.FRAG_LOAD_TIMEOUT:case Y.KEY_LOAD_TIMEOUT:case Y.LEVEL_LOAD_TIMEOUT:case Y.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function dh(t,e){const i=ya(e);return t.default[`${i?"timeout":"error"}Retry`]}function Hl(t,e){const i=t.backoff==="linear"?1:Math.pow(2,e);return Math.min(i*t.retryDelayMs,t.maxRetryDelayMs)}function ph(t){return zt(zt({},t),{errorRetry:null,timeoutRetry:null})}function xa(t,e,i,n){return!!t&&e<t.maxNumRetry&&(Gy(n)||!!i)}function Gy(t){return t===0&&navigator.onLine===!1||!!t&&(t<400||t>499)}const lf={search:function(t,e){let i=0,n=t.length-1,r=null,s=null;for(;i<=n;){r=(i+n)/2|0,s=t[r];const a=e(s);if(a>0)i=r+1;else if(a<0)n=r-1;else return s}return null}};function Hy(t,e,i){if(e===null||!Array.isArray(t)||!t.length||!be(e))return null;const n=t[0].programDateTime;if(e<(n||0))return null;const r=t[t.length-1].endProgramDateTime;if(e>=(r||0))return null;i=i||0;for(let s=0;s<t.length;++s){const a=t[s];if(Vy(e,i,a))return a}return null}function rs(t,e,i=0,n=0){let r=null;if(t?r=e[t.sn-e[0].sn+1]||null:i===0&&e[0].start===0&&(r=e[0]),r&&vl(i,n,r)===0)return r;const s=lf.search(e,vl.bind(null,i,n));return s&&(s!==t||!r)?s:r}function vl(t=0,e=0,i){if(i.start<=t&&i.start+i.duration>t)return 0;const n=Math.min(e,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.start+i.duration-n<=t?1:i.start-n>t&&i.start?-1:0}function Vy(t,e,i){const n=Math.min(e,i.duration+(i.deltaPTS?i.deltaPTS:0))*1e3;return(i.endProgramDateTime||0)-n>t}function zy(t,e){return lf.search(t,i=>i.cc<e?1:i.cc>e?-1:0)}const Wy=3e5;var Ot={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},ai={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class jy{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=N.log.bind(N,"[info]:"),this.warn=N.warn.bind(N,"[warning]:"),this.error=N.error.bind(N,"[error]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(T.ERROR,this.onError,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(T.ERROR,this.onError,this),e.off(T.ERROR,this.onErrorOut,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){this.playlistError=0}stopLoad(){}getVariantLevelIndex(e){return(e==null?void 0:e.type)===Me.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,i){var n,r;if(i.fatal)return;const s=this.hls,a=i.context;switch(i.details){case Y.FRAG_LOAD_ERROR:case Y.FRAG_LOAD_TIMEOUT:case Y.KEY_LOAD_ERROR:case Y.KEY_LOAD_TIMEOUT:i.errorAction=this.getFragRetryOrSwitchAction(i);return;case Y.FRAG_PARSING_ERROR:if((n=i.frag)!=null&&n.gap){i.errorAction={action:Ot.DoNothing,flags:ai.None};return}case Y.FRAG_GAP:case Y.FRAG_DECRYPT_ERROR:{i.errorAction=this.getFragRetryOrSwitchAction(i),i.errorAction.action=Ot.SendAlternateToPenaltyBox;return}case Y.LEVEL_EMPTY_ERROR:case Y.LEVEL_PARSING_ERROR:{var o,l;const c=i.parent===Me.MAIN?i.level:s.loadLevel;i.details===Y.LEVEL_EMPTY_ERROR&&((o=i.context)!=null&&(l=o.levelDetails)!=null&&l.live)?i.errorAction=this.getPlaylistRetryOrSwitchAction(i,c):(i.levelRetry=!1,i.errorAction=this.getLevelSwitchAction(i,c))}return;case Y.LEVEL_LOAD_ERROR:case Y.LEVEL_LOAD_TIMEOUT:typeof(a==null?void 0:a.level)=="number"&&(i.errorAction=this.getPlaylistRetryOrSwitchAction(i,a.level));return;case Y.AUDIO_TRACK_LOAD_ERROR:case Y.AUDIO_TRACK_LOAD_TIMEOUT:case Y.SUBTITLE_LOAD_ERROR:case Y.SUBTITLE_TRACK_LOAD_TIMEOUT:if(a){const c=s.levels[s.loadLevel];if(c&&(a.type===je.AUDIO_TRACK&&a.groupId===c.audioGroupId||a.type===je.SUBTITLE_TRACK&&a.groupId===c.textGroupId)){i.errorAction=this.getPlaylistRetryOrSwitchAction(i,s.loadLevel),i.errorAction.action=Ot.SendAlternateToPenaltyBox,i.errorAction.flags=ai.MoveAllAlternatesMatchingHost;return}}return;case Y.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const c=s.levels[s.loadLevel],h=c==null?void 0:c.attrs["HDCP-LEVEL"];h&&(i.errorAction={action:Ot.SendAlternateToPenaltyBox,flags:ai.MoveAllAlternatesMatchingHDCP,hdcpLevel:h})}return;case Y.BUFFER_ADD_CODEC_ERROR:case Y.REMUX_ALLOC_ERROR:i.errorAction=this.getLevelSwitchAction(i,(r=i.level)!=null?r:s.loadLevel);return;case Y.INTERNAL_EXCEPTION:case Y.BUFFER_APPENDING_ERROR:case Y.BUFFER_APPEND_ERROR:case Y.BUFFER_FULL_ERROR:case Y.LEVEL_SWITCH_ERROR:case Y.BUFFER_STALLED_ERROR:case Y.BUFFER_SEEK_OVER_HOLE:case Y.BUFFER_NUDGE_ON_STALL:i.errorAction={action:Ot.DoNothing,flags:ai.None};return}if(i.type===Se.KEY_SYSTEM_ERROR){const c=this.getVariantLevelIndex(i.frag);i.levelRetry=!1,i.errorAction=this.getLevelSwitchAction(i,c);return}}getPlaylistRetryOrSwitchAction(e,i){var n;const r=this.hls,s=dh(r.config.playlistLoadPolicy,e),a=this.playlistError++,o=(n=e.response)==null?void 0:n.code;if(xa(s,a,ya(e),o))return{action:Ot.RetryRequest,flags:ai.None,retryConfig:s,retryCount:a};const c=this.getLevelSwitchAction(e,i);return s&&(c.retryConfig=s,c.retryCount=a),c}getFragRetryOrSwitchAction(e){const i=this.hls,n=this.getVariantLevelIndex(e.frag),r=i.levels[n],{fragLoadPolicy:s,keyLoadPolicy:a}=i.config,o=dh(e.details.startsWith("key")?a:s,e),l=i.levels.reduce((u,f)=>u+f.fragmentError,0);if(r){var c;e.details!==Y.FRAG_GAP&&r.fragmentError++;const u=(c=e.response)==null?void 0:c.code;if(xa(o,l,ya(e),u))return{action:Ot.RetryRequest,flags:ai.None,retryConfig:o,retryCount:l}}const h=this.getLevelSwitchAction(e,n);return o&&(h.retryConfig=o,h.retryCount=l),h}getLevelSwitchAction(e,i){const n=this.hls;i==null&&(i=n.loadLevel);const r=this.hls.levels[i];if(r&&(r.loadError++,n.autoLevelEnabled)){var s,a;let o=-1;const{levels:l,loadLevel:c,minAutoLevel:h,maxAutoLevel:u}=n,f=(s=e.frag)==null?void 0:s.type,{type:d,groupId:p}=(a=e.context)!=null?a:{};for(let m=l.length;m--;){const g=(m+c)%l.length;if(g!==c&&g>=h&&g<=u&&l[g].loadError===0){const v=l[g];if(e.details===Y.FRAG_GAP&&e.frag){const x=l[g].details;if(x){const y=rs(e.frag,x.fragments,e.frag.start);if(y!=null&&y.gap)continue}}else{if(d===je.AUDIO_TRACK&&p===v.audioGroupId||d===je.SUBTITLE_TRACK&&p===v.textGroupId)continue;if(f===Me.AUDIO&&r.audioGroupId===v.audioGroupId||f===Me.SUBTITLE&&r.textGroupId===v.textGroupId)continue}o=g;break}}if(o>-1&&n.loadLevel!==o)return e.levelRetry=!0,this.playlistError=0,{action:Ot.SendAlternateToPenaltyBox,flags:ai.None,nextAutoLevel:o}}return{action:Ot.SendAlternateToPenaltyBox,flags:ai.MoveAllAlternatesMatchingHost}}onErrorOut(e,i){var n;switch((n=i.errorAction)==null?void 0:n.action){case Ot.DoNothing:break;case Ot.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(i),!i.errorAction.resolved&&i.details!==Y.FRAG_GAP&&(i.fatal=!0);break}if(i.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const i=this.hls,n=e.errorAction;if(!n)return;const{flags:r,hdcpLevel:s,nextAutoLevel:a}=n;switch(r){case ai.None:this.switchLevel(e,a);break;case ai.MoveAllAlternatesMatchingHost:n.resolved||(n.resolved=this.redundantFailover(e));break;case ai.MoveAllAlternatesMatchingHDCP:s&&(i.maxHdcpLevel=ml[ml.indexOf(s)-1],n.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${i.maxHdcpLevel}" or lower`);break}n.resolved||this.switchLevel(e,a)}switchLevel(e,i){i!==void 0&&e.errorAction&&(this.warn(`switching to level ${i} after ${e.details}`),this.hls.nextAutoLevel=i,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}redundantFailover(e){const{hls:i,penalizedRenditions:n}=this,r=e.parent===Me.MAIN?e.level:i.loadLevel,s=i.levels[r],a=s.url.length,o=e.frag?e.frag.urlId:s.urlId;s.urlId===o&&(!e.frag||s.details)&&this.penalizeRendition(s,e);for(let l=1;l<a;l++){const c=(o+l)%a,h=n[c];if(!h||$y(h,e,n[o]))return this.warn(`Switching to Redundant Stream ${c+1}/${a}: "${s.url[c]}" after ${e.details}`),this.playlistError=0,i.levels.forEach(u=>{u.urlId=c}),i.nextLoadLevel=r,!0}return!1}penalizeRendition(e,i){const{penalizedRenditions:n}=this,r=n[e.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};r.lastErrorPerfMs=performance.now(),r.errors.push(i),r.details=e.details,n[e.urlId]=r}}function $y(t,e,i){if(performance.now()-t.lastErrorPerfMs>Wy)return!0;const n=t.details;if(e.details===Y.FRAG_GAP&&n&&e.frag){const r=e.frag.start,s=rs(null,n.fragments,r);if(s&&!s.gap)return!0}if(i&&t.errors.length<i.errors.length){const r=t.errors[t.errors.length-1];if(n&&r.frag&&e.frag&&Math.abs(r.frag.start-e.frag.start)>n.targetduration*3)return!0}return!1}class Vl{constructor(e,i){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=N.log.bind(N,`${i}:`),this.warn=N.warn.bind(N,`${i}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){clearTimeout(this.timer),this.timer=-1}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,i){const n=i==null?void 0:i.renditionReports;if(n){let r=-1;for(let s=0;s<n.length;s++){const a=n[s];let o;try{o=new self.URL(a.URI,i.url).href}catch(l){N.warn(`Could not construct new URL for Rendition Report: ${l}`),o=a.URI||""}if(o===e){r=s;break}else o===e.substring(0,o.length)&&(r=s)}if(r!==-1){const s=n[r],a=parseInt(s["LAST-MSN"])||(i==null?void 0:i.lastPartSn);let o=parseInt(s["LAST-PART"])||(i==null?void 0:i.lastPartIndex);if(this.hls.config.lowLatencyMode){const l=Math.min(i.age-i.partTarget,i.targetduration);o>=0&&l>i.partTarget&&(o+=1)}return new uh(a,o>=0?o:void 0,vr.No)}}}loadPlaylist(e){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(e)}playlistLoaded(e,i,n){const{details:r,stats:s}=i,a=self.performance.now(),o=s.loading.first?Math.max(0,a-s.loading.first):0;if(r.advancedDateTime=Date.now()-o,r.live||n!=null&&n.live){if(r.reloaded(n),n&&this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),n&&r.fragments.length>0&&Oy(n,r),!this.canLoad||!r.live)return;let l,c,h;if(r.canBlockReload&&r.endSN&&r.advanced){const g=this.hls.config.lowLatencyMode,v=r.lastPartSn,x=r.endSN,y=r.lastPartIndex,b=y!==-1,E=v===x,w=g?0:y;b?(c=E?x+1:v,h=E?w:y+1):c=x+1;const A=r.age,D=A+r.ageHeader;let O=Math.min(D-r.partTarget,r.targetduration*1.5);if(O>0){if(n&&O>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${O} with playlist age: ${r.age}`),O=0;else{const P=Math.floor(O/r.targetduration);if(c+=P,h!==void 0){const L=Math.round(O%r.targetduration/r.partTarget);h+=L}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${A.toFixed(2)}s goal: ${O} skip sn ${P} to part ${h}`)}r.tuneInGoal=O}if(l=this.getDeliveryDirectives(r,i.deliveryDirectives,c,h),g||!E){this.loadPlaylist(l);return}}else(r.canBlockReload||r.canSkipUntil)&&(l=this.getDeliveryDirectives(r,i.deliveryDirectives,c,h));const u=this.hls.mainForwardBufferInfo,f=u?u.end-u.len:0,d=(r.edge-f)*1e3,p=By(r,d);r.updated&&a>this.requestScheduled+p&&(this.requestScheduled=s.loading.start),c!==void 0&&r.canBlockReload?this.requestScheduled=s.loading.first+p-(r.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+p<a?this.requestScheduled=a:this.requestScheduled-a<=0&&(this.requestScheduled+=p);let m=this.requestScheduled-a;m=Math.max(0,m),this.log(`reload live playlist ${e} in ${Math.round(m)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(l),m)}else this.clearTimer()}getDeliveryDirectives(e,i,n,r){let s=Py(e,n);return i!=null&&i.skip&&e.deltaUpdateFailed&&(n=i.msn,r=i.part,s=vr.No),new uh(n,r,s)}checkRetry(e){const i=e.details,n=ya(e),r=e.errorAction,{action:s,retryCount:a=0,retryConfig:o}=r||{},l=!!r&&!!o&&(s===Ot.RetryRequest||!r.resolved&&s===Ot.SendAlternateToPenaltyBox);if(l){var c;if(this.requestScheduled=-1,a>=o.maxNumRetry)return!1;if(n&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${i}" without delivery-directives`),this.loadPlaylist();else{const h=Hl(o,a);this.timer=self.setTimeout(()=>this.loadPlaylist(),h),this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${i}" in ${h}ms`)}e.levelRetry=!0,r.resolved=!0}return l}}let eo;class Yy extends Vl{constructor(e,i){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=i,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(T.LEVEL_LOADED,this.onLevelLoaded,this),e.on(T.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(T.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(T.FRAG_LOADED,this.onFragLoaded,this),e.on(T.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(T.LEVEL_LOADED,this.onLevelLoaded,this),e.off(T.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(T.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(T.FRAG_LOADED,this.onFragLoaded,this),e.off(T.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}startLoad(){this._levels.forEach(i=>{i.loadError=0,i.fragmentError=0}),super.startLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]}onManifestLoading(e,i){this.resetLevels()}onManifestLoaded(e,i){const n=[],r={};let s;i.levels.forEach(a=>{var o;const l=a.attrs;((o=a.audioCodec)==null?void 0:o.indexOf("mp4a.40.34"))!==-1&&(eo||(eo=/chrome|firefox/i.test(navigator.userAgent)),eo&&(a.audioCodec=void 0));const{AUDIO:c,CODECS:h,"FRAME-RATE":u,"PATHWAY-ID":f,RESOLUTION:d,SUBTITLES:p}=l,g=`${`${f||"."}-`}${a.bitrate}-${d}-${u}-${h}`;s=r[g],s?s.addFallback(a):(s=new ns(a),r[g]=s,n.push(s)),Ea(s,"audio",c),Ea(s,"text",p)}),this.filterAndSortMediaOptions(n,i)}filterAndSortMediaOptions(e,i){let n=[],r=[],s=!1,a=!1,o=!1,l=e.filter(({audioCodec:d,videoCodec:p,width:m,height:g,unknownCodecs:v})=>(s||(s=!!(m&&g)),a||(a=!!p),o||(o=!!d),!(v!=null&&v.length)&&(!d||qa(d,"audio"))&&(!p||qa(p,"video"))));if((s||a)&&o&&(l=l.filter(({videoCodec:d,width:p,height:m})=>!!d||!!(p&&m))),l.length===0){Promise.resolve().then(()=>{if(this.hls){const d=new Error("no level with compatible codecs found in manifest");this.hls.trigger(T.ERROR,{type:Se.MEDIA_ERROR,details:Y.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:i.url,error:d,reason:d.message})}});return}i.audioTracks&&(n=i.audioTracks.filter(d=>!d.audioCodec||qa(d.audioCodec,"audio")),mh(n)),i.subtitles&&(r=i.subtitles,mh(r));const c=l.slice(0);l.sort((d,p)=>d.attrs["HDCP-LEVEL"]!==p.attrs["HDCP-LEVEL"]?(d.attrs["HDCP-LEVEL"]||"")>(p.attrs["HDCP-LEVEL"]||"")?1:-1:d.bitrate!==p.bitrate?d.bitrate-p.bitrate:d.attrs["FRAME-RATE"]!==p.attrs["FRAME-RATE"]?d.attrs.decimalFloatingPoint("FRAME-RATE")-p.attrs.decimalFloatingPoint("FRAME-RATE"):d.attrs.SCORE!==p.attrs.SCORE?d.attrs.decimalFloatingPoint("SCORE")-p.attrs.decimalFloatingPoint("SCORE"):s&&d.height!==p.height?d.height-p.height:0);let h=c[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==c.length)){for(let d=0;d<c.length;d++)if(c[d].pathwayId===l[0].pathwayId){h=c[d];break}}this._levels=l;for(let d=0;d<l.length;d++)if(l[d]===h){this._firstLevel=d,this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${h.bitrate}`);break}const u=o&&!a,f={levels:l,audioTracks:n,subtitleTracks:r,sessionData:i.sessionData,sessionKeys:i.sessionKeys,firstLevel:this._firstLevel,stats:i.stats,audio:o,video:a,altAudio:!u&&n.some(d=>!!d.url)};this.hls.trigger(T.MANIFEST_PARSED,f),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(e){const i=this._levels;if(i.length===0)return;if(e<0||e>=i.length){const h=new Error("invalid level idx"),u=e<0;if(this.hls.trigger(T.ERROR,{type:Se.OTHER_ERROR,details:Y.LEVEL_SWITCH_ERROR,level:e,fatal:u,error:h,reason:h.message}),u)return;e=Math.min(e,i.length-1)}const n=this.currentLevelIndex,r=this.currentLevel,s=r?r.attrs["PATHWAY-ID"]:void 0,a=i[e],o=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,n===e&&a.details&&r&&s===o)return;this.log(`Switching to level ${e}${o?" with Pathway "+o:""} from level ${n}${s?" with Pathway "+s:""}`);const l=bt({},a,{level:e,maxBitrate:a.maxBitrate,attrs:a.attrs,uri:a.uri,urlId:a.urlId});delete l._attrs,delete l._urlId,this.hls.trigger(T.LEVEL_SWITCHING,l);const c=a.details;if(!c||c.live){const h=this.switchParams(a.uri,r==null?void 0:r.details);this.loadPlaylist(h)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this._firstLevel}else return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,i){i.fatal||!i.context||i.context.type===je.LEVEL&&i.context.level===this.level&&this.checkRetry(i)}onFragLoaded(e,{frag:i}){if(i!==void 0&&i.type===Me.MAIN){const n=this._levels[i.level];n!==void 0&&(n.loadError=0)}}onLevelLoaded(e,i){var n;const{level:r,details:s}=i,a=this._levels[r];if(!a){var o;this.warn(`Invalid level index ${r}`),(o=i.deliveryDirectives)!=null&&o.skip&&(s.deltaUpdateFailed=!0);return}r===this.currentLevelIndex?(a.fragmentError===0&&(a.loadError=0),this.playlistLoaded(r,i,a.details)):(n=i.deliveryDirectives)!=null&&n.skip&&(s.deltaUpdateFailed=!0)}onAudioTrackSwitched(e,i){const n=this.currentLevel;if(!n)return;const r=this.hls.audioTracks[i.id].groupId;if(n.audioGroupIds&&n.audioGroupId!==r){let s=-1;for(let a=0;a<n.audioGroupIds.length;a++)if(n.audioGroupIds[a]===r){s=a;break}s!==-1&&s!==n.urlId&&(n.urlId=s,this.canLoad&&this.startLoad())}}loadPlaylist(e){super.loadPlaylist();const i=this.currentLevelIndex,n=this.currentLevel;if(n&&this.shouldLoadPlaylist(n)){const r=n.urlId;let s=n.uri;if(e)try{s=e.addDirectives(s)}catch(o){this.warn(`Could not construct new URL with HLS Delivery Directives: ${o}`)}const a=n.attrs["PATHWAY-ID"];this.log(`Loading level index ${i}${(e==null?void 0:e.msn)!==void 0?" at sn "+e.msn+" part "+e.part:""} with${a?" Pathway "+a:""} URI ${r+1}/${n.url.length} ${s}`),this.clearTimer(),this.hls.trigger(T.LEVEL_LOADING,{url:s,level:i,id:r,deliveryDirectives:e||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e,i){const n=(s,a)=>a!==i,r=this._levels.filter((s,a)=>a!==e?!0:s.url.length>1&&i!==void 0?(s.url=s.url.filter(n),s.audioGroupIds&&(s.audioGroupIds=s.audioGroupIds.filter(n)),s.textGroupIds&&(s.textGroupIds=s.textGroupIds.filter(n)),s.urlId=0,!0):(this.steering&&this.steering.removeLevel(s),!1));this.hls.trigger(T.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:i}){i.forEach((n,r)=>{const{details:s}=n;s!=null&&s.fragments&&s.fragments.forEach(a=>{a.level=r})}),this._levels=i}}function Ea(t,e,i){i&&(e==="audio"?(t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds[t.url.length-1]=i):e==="text"&&(t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds[t.url.length-1]=i))}function mh(t){const e={};t.forEach(i=>{const n=i.groupId||"";i.id=e[n]=e[n]||0,e[n]++})}var At={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class Ky{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(T.BUFFER_APPENDED,this.onBufferAppended,this),e.on(T.FRAG_BUFFERED,this.onFragBuffered,this),e.on(T.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(T.BUFFER_APPENDED,this.onBufferAppended,this),e.off(T.FRAG_BUFFERED,this.onFragBuffered,this),e.off(T.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,i){const n=this.activePartLists[i];if(n)for(let r=n.length;r--;){const s=n[r];if(!s)break;const a=s.end;if(s.start<=e&&a!==null&&e<=a)return s}return this.getBufferedFrag(e,i)}getBufferedFrag(e,i){const{fragments:n}=this,r=Object.keys(n);for(let s=r.length;s--;){const a=n[r[s]];if((a==null?void 0:a.body.type)===i&&a.buffered){const o=a.body;if(o.start<=e&&e<=o.end)return o}}return null}detectEvictedFragments(e,i,n,r){this.timeRanges&&(this.timeRanges[e]=i);const s=(r==null?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(a=>{const o=this.fragments[a];if(!o||s>=o.body.sn)return;if(!o.buffered&&!o.loaded){o.body.type===n&&this.removeFragment(o.body);return}const l=o.range[e];l&&l.time.some(c=>{const h=!this.isTimeBuffered(c.startPTS,c.endPTS,i);return h&&this.removeFragment(o.body),h})})}detectPartialFragments(e){const i=this.timeRanges,{frag:n,part:r}=e;if(!i||n.sn==="initSegment")return;const s=Ln(n),a=this.fragments[s];if(!a||a.buffered&&n.gap)return;const o=!n.relurl;Object.keys(i).forEach(l=>{const c=n.elementaryStreams[l];if(!c)return;const h=i[l],u=o||c.partial===!0;a.range[l]=this.getBufferedTimes(n,r,u,h)}),a.loaded=null,Object.keys(a.range).length?(a.buffered=!0,(a.body.endList=n.endList||a.body.endList)&&(this.endListFragments[a.body.type]=a),gs(a)||this.removeParts(n.sn-1,n.type)):this.removeFragment(a.body)}removeParts(e,i){const n=this.activePartLists[i];n&&(this.activePartLists[i]=n.filter(r=>r.fragment.sn>=e))}fragBuffered(e,i){const n=Ln(e);let r=this.fragments[n];!r&&i&&(r=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,r.buffered=!0)}getBufferedTimes(e,i,n,r){const s={time:[],partial:n},a=e.start,o=e.end,l=e.minEndPTS||o,c=e.maxStartPTS||a;for(let h=0;h<r.length;h++){const u=r.start(h)-this.bufferPadding,f=r.end(h)+this.bufferPadding;if(c>=u&&l<=f){s.time.push({startPTS:Math.max(a,r.start(h)),endPTS:Math.min(o,r.end(h))});break}else if(a<f&&o>u)s.partial=!0,s.time.push({startPTS:Math.max(a,r.start(h)),endPTS:Math.min(o,r.end(h))});else if(o<=u)break}return s}getPartialFragment(e){let i=null,n,r,s,a=0;const{bufferPadding:o,fragments:l}=this;return Object.keys(l).forEach(c=>{const h=l[c];h&&gs(h)&&(r=h.body.start-o,s=h.body.end+o,e>=r&&e<=s&&(n=Math.min(e-r,s-e),a<=n&&(i=h.body,a=n)))}),i}isEndListAppended(e){const i=this.endListFragments[e];return i!==void 0&&(i.buffered||gs(i))}getState(e){const i=Ln(e),n=this.fragments[i];return n?n.buffered?gs(n)?At.PARTIAL:At.OK:At.APPENDING:At.NOT_LOADED}isTimeBuffered(e,i,n){let r,s;for(let a=0;a<n.length;a++){if(r=n.start(a)-this.bufferPadding,s=n.end(a)+this.bufferPadding,e>=r&&i<=s)return!0;if(i<=r)return!1}return!1}onFragLoaded(e,i){const{frag:n,part:r}=i;if(n.sn==="initSegment"||n.bitrateTest)return;const s=r?null:i,a=Ln(n);this.fragments[a]={body:n,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,i){const{frag:n,part:r,timeRanges:s}=i;if(n.sn==="initSegment")return;const a=n.type;if(r){let o=this.activePartLists[a];o||(this.activePartLists[a]=o=[]),o.push(r)}this.timeRanges=s,Object.keys(s).forEach(o=>{const l=s[o];this.detectEvictedFragments(o,l,a,r)})}onFragBuffered(e,i){this.detectPartialFragments(i)}hasFragment(e){const i=Ln(e);return!!this.fragments[i]}hasParts(e){var i;return!!((i=this.activePartLists[e])!=null&&i.length)}removeFragmentsInRange(e,i,n,r,s){r&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const o=this.fragments[a];if(!o)return;const l=o.body;l.type!==n||r&&!l.gap||l.start<i&&l.end>e&&(o.buffered||s)&&this.removeFragment(l)})}removeFragment(e){const i=Ln(e);e.stats.loaded=0,e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const r=e.sn;this.activePartLists[e.type]=n.filter(s=>s.fragment.sn!==r)}delete this.fragments[i],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function gs(t){var e,i,n;return t.buffered&&(t.body.gap||((e=t.range.video)==null?void 0:e.partial)||((i=t.range.audio)==null?void 0:i.partial)||((n=t.range.audiovideo)==null?void 0:n.partial))}function Ln(t){return`${t.type}_${t.level}_${t.urlId}_${t.sn}`}const gh=Math.pow(2,17);class Xy{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,i){const n=e.url;if(!n)return Promise.reject(new ki({type:Se.NETWORK_ERROR,details:Y.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const r=this.config,s=r.fLoader,a=r.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(d=>d[0]==="GAP")){l(yh(e));return}else e.gap=!1;const c=this.loader=e.loader=s?new s(r):new a(r),h=vh(e),u=ph(r.fragLoadPolicy.default),f={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:gh};e.stats=c.stats,c.load(h,f,{onSuccess:(d,p,m,g)=>{this.resetLoader(e,c);let v=d.data;m.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(v.slice(0,16)),v=v.slice(16)),o({frag:e,part:null,payload:v,networkDetails:g})},onError:(d,p,m,g)=>{this.resetLoader(e,c),l(new ki({type:Se.NETWORK_ERROR,details:Y.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:zt({url:n,data:void 0},d),error:new Error(`HTTP Error ${d.code} ${d.text}`),networkDetails:m,stats:g}))},onAbort:(d,p,m)=>{this.resetLoader(e,c),l(new ki({type:Se.NETWORK_ERROR,details:Y.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:m,stats:d}))},onTimeout:(d,p,m)=>{this.resetLoader(e,c),l(new ki({type:Se.NETWORK_ERROR,details:Y.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:m,stats:d}))},onProgress:(d,p,m,g)=>{i&&i({frag:e,part:null,payload:m,networkDetails:g})}})})}loadPart(e,i,n){this.abort();const r=this.config,s=r.fLoader,a=r.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap||i.gap){l(yh(e,i));return}const c=this.loader=e.loader=s?new s(r):new a(r),h=vh(e,i),u=ph(r.fragLoadPolicy.default),f={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:gh};i.stats=c.stats,c.load(h,f,{onSuccess:(d,p,m,g)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,i);const v={frag:e,part:i,payload:d.data,networkDetails:g};n(v),o(v)},onError:(d,p,m,g)=>{this.resetLoader(e,c),l(new ki({type:Se.NETWORK_ERROR,details:Y.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:i,response:zt({url:h.url,data:void 0},d),error:new Error(`HTTP Error ${d.code} ${d.text}`),networkDetails:m,stats:g}))},onAbort:(d,p,m)=>{e.stats.aborted=i.stats.aborted,this.resetLoader(e,c),l(new ki({type:Se.NETWORK_ERROR,details:Y.INTERNAL_ABORTED,fatal:!1,frag:e,part:i,error:new Error("Aborted"),networkDetails:m,stats:d}))},onTimeout:(d,p,m)=>{this.resetLoader(e,c),l(new ki({type:Se.NETWORK_ERROR,details:Y.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:i,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:m,stats:d}))}})})}updateStatsFromPart(e,i){const n=e.stats,r=i.stats,s=r.total;if(n.loaded+=r.loaded,s){const l=Math.round(e.duration/i.duration),c=Math.min(Math.round(n.loaded/s),l),u=(l-c)*Math.round(n.loaded/c);n.total=n.loaded+u}else n.total=Math.max(n.loaded,n.total);const a=n.loading,o=r.loading;a.start?a.first+=o.first-o.start:(a.start=o.start,a.first=o.first),a.end=o.end}resetLoader(e,i){e.loader=null,this.loader===i&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),i.destroy()}}function vh(t,e=null){const i=e||t,n={frag:t,part:e,responseType:"arraybuffer",url:i.url,headers:{},rangeStart:0,rangeEnd:0},r=i.byteRangeStartOffset,s=i.byteRangeEndOffset;if(be(r)&&be(s)){var a;let o=r,l=s;if(t.sn==="initSegment"&&((a=t.decryptdata)==null?void 0:a.method)==="AES-128"){const c=s-r;c%16&&(l=s+(16-c%16)),r!==0&&(n.resetIV=!0,o=r-16)}n.rangeStart=o,n.rangeEnd=l}return n}function yh(t,e){const i=new Error(`GAP ${t.gap?"tag":"attribute"} found`),n={type:Se.MEDIA_ERROR,details:Y.FRAG_GAP,fatal:!1,frag:t,error:i,networkDetails:null};return e&&(n.part=e),(e||t).stats.aborted=!0,new ki(n)}class ki extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class qy{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const i in this.keyUriToKeyInfo){const n=this.keyUriToKeyInfo[i].loader;if(n){if(e&&e!==n.context.frag.type)return;n.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[e];(i.mediaKeySessionContext||i.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[e].loader;i&&i.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,i=Y.KEY_LOAD_ERROR,n,r,s){return new ki({type:Se.NETWORK_ERROR,details:i,fatal:!1,frag:e,response:s,error:n,networkDetails:r})}loadClear(e,i){if(this.emeController&&this.config.emeEnabled){const{sn:n,cc:r}=e;for(let s=0;s<i.length;s++){const a=i[s];if(r<=a.cc&&(n==="initSegment"||a.sn==="initSegment"||n<a.sn)){this.emeController.selectKeySystemFormat(a).then(o=>{a.setKeyFormat(o)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(i=>this.loadInternal(e,i)):this.loadInternal(e)}loadInternal(e,i){var n,r;i&&e.setKeyFormat(i);const s=e.decryptdata;if(!s){const c=new Error(i?`Expected frag.decryptdata to be defined after setting format ${i}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,Y.KEY_LOAD_ERROR,c))}const a=s.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,Y.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));let o=this.keyUriToKeyInfo[a];if((n=o)!=null&&n.decryptdata.key)return s.key=o.decryptdata.key,Promise.resolve({frag:e,keyInfo:o});if((r=o)!=null&&r.keyLoadPromise){var l;switch((l=o.mediaKeySessionContext)==null?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return o.keyLoadPromise.then(c=>(s.key=c.keyInfo.decryptdata.key,{frag:e,keyInfo:o}))}}switch(o=this.keyUriToKeyInfo[a]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(o,e):this.loadKeyEME(o,e);case"AES-128":return this.loadKeyHTTP(o,e);default:return Promise.reject(this.createKeyLoadError(e,Y.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,i){const n={frag:i,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const r=this.emeController.loadKey(n);if(r)return(e.keyLoadPromise=r.then(s=>(e.mediaKeySessionContext=s,n))).catch(s=>{throw e.keyLoadPromise=null,s})}return Promise.resolve(n)}loadKeyHTTP(e,i){const n=this.config,r=n.loader,s=new r(n);return i.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((a,o)=>{const l={keyInfo:e,frag:i,responseType:"arraybuffer",url:e.decryptdata.uri},c=n.keyLoadPolicy.default,h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(f,d,p,m)=>{const{frag:g,keyInfo:v,url:x}=p;if(!g.decryptdata||v!==this.keyUriToKeyInfo[x])return o(this.createKeyLoadError(g,Y.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),m));v.decryptdata.key=g.decryptdata.key=new Uint8Array(f.data),g.keyLoader=null,v.loader=null,a({frag:g,keyInfo:v})},onError:(f,d,p,m)=>{this.resetLoader(d),o(this.createKeyLoadError(i,Y.KEY_LOAD_ERROR,new Error(`HTTP Error ${f.code} loading key ${f.text}`),p,zt({url:l.url,data:void 0},f)))},onTimeout:(f,d,p)=>{this.resetLoader(d),o(this.createKeyLoadError(i,Y.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),p))},onAbort:(f,d,p)=>{this.resetLoader(d),o(this.createKeyLoadError(i,Y.INTERNAL_ABORTED,new Error("key loading aborted"),p))}};s.load(l,h,u)})}resetLoader(e){const{frag:i,keyInfo:n,url:r}=e,s=n.loader;i.keyLoader===s&&(i.keyLoader=null,n.loader=null),delete this.keyUriToKeyInfo[r],s&&s.destroy()}}class Zy{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}const Jy={length:0,start:()=>0,end:()=>0};class at{static isBuffered(e,i){try{if(e){const n=at.getBuffered(e);for(let r=0;r<n.length;r++)if(i>=n.start(r)&&i<=n.end(r))return!0}}catch{}return!1}static bufferInfo(e,i,n){try{if(e){const r=at.getBuffered(e),s=[];let a;for(a=0;a<r.length;a++)s.push({start:r.start(a),end:r.end(a)});return this.bufferedInfo(s,i,n)}}catch{}return{len:0,start:i,end:i,nextStart:void 0}}static bufferedInfo(e,i,n){i=Math.max(0,i),e.sort(function(c,h){const u=c.start-h.start;return u||h.end-c.end});let r=[];if(n)for(let c=0;c<e.length;c++){const h=r.length;if(h){const u=r[h-1].end;e[c].start-u<n?e[c].end>u&&(r[h-1].end=e[c].end):r.push(e[c])}else r.push(e[c])}else r=e;let s=0,a,o=i,l=i;for(let c=0;c<r.length;c++){const h=r[c].start,u=r[c].end;if(i+n>=h&&i<u)o=h,l=u,s=l-i;else if(i+n<h){a=h;break}}return{len:s,start:o||0,end:l||0,nextStart:a}}static getBuffered(e){try{return e.buffered}catch(i){return N.log("failed to get media.buffered",i),Jy}}}class zl{constructor(e,i,n,r=0,s=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=vs(),this.buffering={audio:vs(),video:vs(),audiovideo:vs()},this.level=e,this.sn=i,this.id=n,this.size=r,this.part=s,this.partial=a}}function vs(){return{start:0,executeStart:0,executeEnd:0,end:0}}function cf(t,e){let i=null;for(let n=0,r=t.length;n<r;n++){const s=t[n];if(s&&s.cc===e){i=s;break}}return i}function Qy(t,e,i){return!!(e.details&&(i.endCC>i.startCC||t&&t.cc<i.startCC))}function ex(t,e,i=0){const n=t.fragments,r=e.fragments;if(!r.length||!n.length){N.log("No fragments to align");return}const s=cf(n,r[0].cc);if(!s||s&&!s.startPTS){N.log("No frag in previous level to align on");return}return s}function xh(t,e){if(t){const i=t.start+e;t.start=t.startPTS=i,t.endPTS=i+t.duration}}function Wl(t,e){const i=e.fragments;for(let n=0,r=i.length;n<r;n++)xh(i[n],t);e.fragmentHint&&xh(e.fragmentHint,t),e.alignedSliding=!0}function tx(t,e,i){e&&(ix(t,i,e),!i.alignedSliding&&e.details&&nx(i,e.details),!i.alignedSliding&&e.details&&!i.skippedSegments&&af(e.details,i))}function ix(t,e,i){if(Qy(t,i,e)){const n=ex(i.details,e);n&&be(n.start)&&(N.log(`Adjusting PTS using last level due to CC increase within current level ${e.url}`),Wl(n.start,e))}}function nx(t,e){if(!e.fragments.length||!t.hasProgramDateTime||!e.hasProgramDateTime)return;const i=e.fragments[0].programDateTime,n=t.fragments[0].programDateTime,r=(n-i)/1e3+e.fragments[0].start;r&&be(r)&&(N.log(`Adjusting PTS using programDateTime delta ${n-i}ms, sliding:${r.toFixed(3)} ${t.url} `),Wl(r,t))}function hf(t,e){if(!t.hasProgramDateTime||!e.hasProgramDateTime)return;const i=t.fragments,n=e.fragments;if(!i.length||!n.length)return;const r=Math.round(n.length/2)-1,s=n[r],a=cf(i,s.cc)||i[Math.round(i.length/2)-1],o=s.programDateTime,l=a.programDateTime;if(o===null||l===null)return;const c=(l-o)/1e3-(a.start-s.start);Wl(c,t)}class rx{constructor(e,i){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=i}decrypt(e,i){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},i,e)}}class sx{constructor(e,i){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=i}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function ax(t){const e=t.byteLength,i=e&&new DataView(t.buffer).getUint8(e-1);return i?fn(t,0,e-i):t}class ox{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const i=new DataView(e),n=new Uint32Array(4);for(let r=0;r<4;r++)n[r]=i.getUint32(r*4);return n}initTable(){const e=this.sBox,i=this.invSBox,n=this.subMix,r=n[0],s=n[1],a=n[2],o=n[3],l=this.invSubMix,c=l[0],h=l[1],u=l[2],f=l[3],d=new Uint32Array(256);let p=0,m=0,g=0;for(g=0;g<256;g++)g<128?d[g]=g<<1:d[g]=g<<1^283;for(g=0;g<256;g++){let v=m^m<<1^m<<2^m<<3^m<<4;v=v>>>8^v&255^99,e[p]=v,i[v]=p;const x=d[p],y=d[x],b=d[y];let E=d[v]*257^v*16843008;r[p]=E<<24|E>>>8,s[p]=E<<16|E>>>16,a[p]=E<<8|E>>>24,o[p]=E,E=b*16843009^y*65537^x*257^p*16843008,c[v]=E<<24|E>>>8,h[v]=E<<16|E>>>16,u[v]=E<<8|E>>>24,f[v]=E,p?(p=x^d[d[d[b^x]]],m^=d[d[m]]):p=m=1}}expandKey(e){const i=this.uint8ArrayToUint32Array_(e);let n=!0,r=0;for(;r<i.length&&n;)n=i[r]===this.key[r],r++;if(n)return;this.key=i;const s=this.keySize=i.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const a=this.ksRows=(s+6+1)*4;let o,l;const c=this.keySchedule=new Uint32Array(a),h=this.invKeySchedule=new Uint32Array(a),u=this.sBox,f=this.rcon,d=this.invSubMix,p=d[0],m=d[1],g=d[2],v=d[3];let x,y;for(o=0;o<a;o++){if(o<s){x=c[o]=i[o];continue}y=x,o%s===0?(y=y<<8|y>>>24,y=u[y>>>24]<<24|u[y>>>16&255]<<16|u[y>>>8&255]<<8|u[y&255],y^=f[o/s|0]<<24):s>6&&o%s===4&&(y=u[y>>>24]<<24|u[y>>>16&255]<<16|u[y>>>8&255]<<8|u[y&255]),c[o]=x=(c[o-s]^y)>>>0}for(l=0;l<a;l++)o=a-l,l&3?y=c[o]:y=c[o-4],l<4||o<=4?h[l]=y:h[l]=p[u[y>>>24]]^m[u[y>>>16&255]]^g[u[y>>>8&255]]^v[u[y&255]],h[l]=h[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,i,n){const r=this.keySize+6,s=this.invKeySchedule,a=this.invSBox,o=this.invSubMix,l=o[0],c=o[1],h=o[2],u=o[3],f=this.uint8ArrayToUint32Array_(n);let d=f[0],p=f[1],m=f[2],g=f[3];const v=new Int32Array(e),x=new Int32Array(v.length);let y,b,E,w,A,D,O,P,L,C,U,j,K,z;const $=this.networkToHostOrderSwap;for(;i<v.length;){for(L=$(v[i]),C=$(v[i+1]),U=$(v[i+2]),j=$(v[i+3]),A=L^s[0],D=j^s[1],O=U^s[2],P=C^s[3],K=4,z=1;z<r;z++)y=l[A>>>24]^c[D>>16&255]^h[O>>8&255]^u[P&255]^s[K],b=l[D>>>24]^c[O>>16&255]^h[P>>8&255]^u[A&255]^s[K+1],E=l[O>>>24]^c[P>>16&255]^h[A>>8&255]^u[D&255]^s[K+2],w=l[P>>>24]^c[A>>16&255]^h[D>>8&255]^u[O&255]^s[K+3],A=y,D=b,O=E,P=w,K=K+4;y=a[A>>>24]<<24^a[D>>16&255]<<16^a[O>>8&255]<<8^a[P&255]^s[K],b=a[D>>>24]<<24^a[O>>16&255]<<16^a[P>>8&255]<<8^a[A&255]^s[K+1],E=a[O>>>24]<<24^a[P>>16&255]<<16^a[A>>8&255]<<8^a[D&255]^s[K+2],w=a[P>>>24]<<24^a[A>>16&255]<<16^a[D>>8&255]<<8^a[O&255]^s[K+3],x[i]=$(y^d),x[i+1]=$(w^p),x[i+2]=$(E^m),x[i+3]=$(b^g),d=L,p=C,m=U,g=j,i=i+4}return x.buffer}}const lx=16;class jl{constructor(e,{removePKCS7Padding:i=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=i,i)try{const n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:i}=this;if(!e||i)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?ax(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,i,n){return this.useSoftware?new Promise((r,s)=>{this.softwareDecrypt(new Uint8Array(e),i,n);const a=this.flush();a?r(a.buffer):s(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),i,n)}softwareDecrypt(e,i,n){const{currentIV:r,currentResult:s,remainderData:a}=this;this.logOnce("JS AES decrypt"),a&&(e=En(a,e),this.remainderData=null);const o=this.getValidChunk(e);if(!o.length)return null;r&&(n=r);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new ox),l.expandKey(i);const c=s;return this.currentResult=l.decrypt(o.buffer,0,n),this.currentIV=fn(o,-16).buffer,c||null}webCryptoDecrypt(e,i,n){const r=this.subtle;return(this.key!==i||!this.fastAesKey)&&(this.key=i,this.fastAesKey=new sx(r,i)),this.fastAesKey.expandKey().then(s=>r?(this.logOnce("WebCrypto AES decrypt"),new rx(r,new Uint8Array(n)).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(N.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,i,n)))}onWebCryptoError(e,i,n){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,i,n);const r=this.flush();if(r)return r.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let i=e;const n=e.length-e.length%lx;return n!==e.length&&(i=fn(e,0,n),this.remainderData=fn(e,n)),i}logOnce(e){this.logEnabled&&(N.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const cx={toString:function(t){let e="";const i=t.length;for(let n=0;n<i;n++)e+=`[${t.start(n).toFixed(3)}-${t.end(n).toFixed(3)}]`;return e}},Z={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class $l extends Zy{constructor(e,i,n,r,s){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=Z.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=s,this.logPrefix=r,this.log=N.log.bind(N,`${r}:`),this.warn=N.warn.bind(N,`${r}:`),this.hls=e,this.fragmentLoader=new Xy(e.config),this.keyLoader=n,this.fragmentTracker=i,this.config=e.config,this.decrypter=new jl(e.config),e.on(T.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Z.STOPPED}_streamEnded(e,i){if(i.live||e.nextStart||!e.end||!this.media)return!1;const n=i.partList;if(n!=null&&n.length){const s=n[n.length-1];return at.isBuffered(this.media,s.start+s.duration/2)}const r=i.fragments[i.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(r)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levels[this.levelLastLoaded])==null?void 0:e.details}}onMediaAttached(e,i){const n=this.media=this.mediaBuffer=i.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),n.addEventListener("seeking",this.onvseeking),n.addEventListener("ended",this.onvended);const r=this.config;this.levels&&r.autoStartLoad&&this.state===Z.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(){const e=this.media;e!=null&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:e,fragCurrent:i,media:n,mediaBuffer:r,state:s}=this,a=n?n.currentTime:0,o=at.bufferInfo(r||n,a,e.maxBufferHole);if(this.log(`media seeking to ${be(a)?a.toFixed(3):a}, state: ${s}`),this.state===Z.ENDED)this.resetLoadingState();else if(i){const l=e.maxFragLookUpTolerance,c=i.start-l,h=i.start+i.duration+l;if(!o.len||h<o.start||c>o.end){const u=a>h;(a<c||u)&&(u&&i.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),i.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}n&&(this.fragmentTracker.removeFragmentsInRange(a,1/0,this.playlistType,!0),this.lastCurrentTime=a),!this.loadedmetadata&&!o.len&&(this.nextLoadPosition=this.startPosition=a),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,i){this.startTimeOffset=i.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.stopLoad(),super.onHandlerDestroying()}onHandlerDestroyed(){this.state=Z.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,i,n){this._loadFragForPlayback(e,i,n)}_loadFragForPlayback(e,i,n){const r=s=>{if(this.fragContextChanged(e)){this.warn(`Fragment ${e.sn}${s.part?" p: "+s.part.index:""} of level ${e.level} was dropped during download.`),this.fragmentTracker.removeFragment(e);return}e.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,i,n,r).then(s=>{if(!s)return;const a=this.state;if(this.fragContextChanged(e)){(a===Z.FRAG_LOADING||!this.fragCurrent&&a===Z.PARSING)&&(this.fragmentTracker.removeFragment(e),this.state=Z.IDLE);return}"payload"in s&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(T.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===Z.STOPPED||this.state===Z.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var i;const{fragmentTracker:n}=this;if(n.getState(e)===At.APPENDING){const s=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,s),o=Math.max(e.duration,a?a.len:this.config.maxBufferLength);this.reduceMaxBufferLength(o)&&n.removeFragment(e)}else((i=this.mediaBuffer)==null?void 0:i.buffered.length)===0?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===At.PARTIAL&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const i=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:i,part:null,stats:i.stats,id:i.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}flushMainBuffer(e,i,n=null){if(!(e-i))return;const r={startOffset:e,endOffset:i,type:n};this.hls.trigger(T.BUFFER_FLUSHING,r)}_loadInitSegment(e,i){this._doFragLoad(e,i).then(n=>{if(!n||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return n}).then(n=>{const{hls:r}=this,{payload:s}=n,a=e.decryptdata;if(s&&s.byteLength>0&&a&&a.key&&a.iv&&a.method==="AES-128"){const o=self.performance.now();return this.decrypter.decrypt(new Uint8Array(s),a.key.buffer,a.iv.buffer).catch(l=>{throw r.trigger(T.ERROR,{type:Se.MEDIA_ERROR,details:Y.FRAG_DECRYPT_ERROR,fatal:!1,error:l,reason:l.message,frag:e}),l}).then(l=>{const c=self.performance.now();return r.trigger(T.FRAG_DECRYPTED,{frag:e,payload:l,stats:{tstart:o,tdecrypt:c}}),n.payload=l,n})}return n}).then(n=>{const{fragCurrent:r,hls:s,levels:a}=this;if(!a)throw new Error("init load aborted, missing levels");const o=e.stats;this.state=Z.IDLE,i.fragmentError=0,e.data=new Uint8Array(n.payload),o.parsing.start=o.buffering.start=self.performance.now(),o.parsing.end=o.buffering.end=self.performance.now(),n.frag===r&&s.trigger(T.FRAG_BUFFERED,{stats:o,frag:r,part:null,id:e.type}),this.tick()}).catch(n=>{this.state===Z.STOPPED||this.state===Z.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}fragContextChanged(e){const{fragCurrent:i}=this;return!e||!i||e.level!==i.level||e.sn!==i.sn||e.urlId!==i.urlId}fragBufferedComplete(e,i){var n,r,s,a;const o=this.mediaBuffer?this.mediaBuffer:this.media;this.log(`Buffered ${e.type} sn: ${e.sn}${i?" part: "+i.index:""} of ${this.playlistType===Me.MAIN?"level":"track"} ${e.level} (frag:[${((n=e.startPTS)!=null?n:NaN).toFixed(3)}-${((r=e.endPTS)!=null?r:NaN).toFixed(3)}] > buffer:${o?cx.toString(at.getBuffered(o)):"(detached)"})`),this.state=Z.IDLE,o&&(!this.loadedmetadata&&e.type==Me.MAIN&&o.buffered.length&&((s=this.fragCurrent)==null?void 0:s.sn)===((a=this.fragPrevious)==null?void 0:a.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){const{transmuxer:i}=this;if(!i)return;const{frag:n,part:r,partsLoaded:s}=e,a=!s||s.length===0||s.some(l=>!l),o=new zl(n.level,n.sn,n.stats.chunkCount+1,0,r?r.index:-1,!a);i.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,i,n=null,r){var s;const a=i==null?void 0:i.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let o=null;if(e.encrypted&&!((s=e.decryptdata)!=null&&s.key)?(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${e.level}`),this.state=Z.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then(h=>{if(!this.fragContextChanged(h.frag))return this.hls.trigger(T.KEY_LOADED,h),this.state===Z.KEY_LOADING&&(this.state=Z.IDLE),h}),this.hls.trigger(T.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(o=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&a.encryptedFragments.length&&this.keyLoader.loadClear(e,a.encryptedFragments),n=Math.max(e.start,n||0),this.config.lowLatencyMode&&e.sn!=="initSegment"){const h=a.partList;if(h&&r){n>e.end&&a.fragmentHint&&(e=a.fragmentHint);const u=this.getNextPart(h,e,n);if(u>-1){const f=h[u];this.log(`Loading part sn: ${e.sn} p: ${f.index} cc: ${e.cc} of playlist [${a.startSN}-${a.endSN}] parts [0-${u}-${h.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=f.start+f.duration,this.state=Z.FRAG_LOADING;let d;return o?d=o.then(p=>!p||this.fragContextChanged(p.frag)?null:this.doFragPartsLoad(e,f,i,r)).catch(p=>this.handleFragLoadError(p)):d=this.doFragPartsLoad(e,f,i,r).catch(p=>this.handleFragLoadError(p)),this.hls.trigger(T.FRAG_LOADING,{frag:e,part:f,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):d}else if(!e.url||this.loadedEndOfParts(h,n))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${a?"of ["+a.startSN+"-"+a.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(n.toFixed(3))}`),be(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=Z.FRAG_LOADING;const l=this.config.progressive;let c;return l&&o?c=o.then(h=>!h||this.fragContextChanged(h==null?void 0:h.frag)?null:this.fragmentLoader.load(e,r)).catch(h=>this.handleFragLoadError(h)):c=Promise.all([this.fragmentLoader.load(e,l?r:void 0),o]).then(([h])=>(!l&&h&&r&&r(h),h)).catch(h=>this.handleFragLoadError(h)),this.hls.trigger(T.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):c}doFragPartsLoad(e,i,n,r){return new Promise((s,a)=>{var o;const l=[],c=(o=n.details)==null?void 0:o.partList,h=u=>{this.fragmentLoader.loadPart(e,u,r).then(f=>{l[u.index]=f;const d=f.part;this.hls.trigger(T.FRAG_LOADED,f);const p=fh(n,e.sn,u.index+1)||of(c,e.sn,u.index+1);if(p)h(p);else return s({frag:e,part:d,partsLoaded:l})}).catch(a)};h(i)})}handleFragLoadError(e){if("data"in e){const i=e.data;e.data&&i.details===Y.INTERNAL_ABORTED?this.handleFragLoadAborted(i.frag,i.part):this.hls.trigger(T.ERROR,i)}else this.hls.trigger(T.ERROR,{type:Se.OTHER_ERROR,details:Y.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const i=this.getCurrentContext(e);if(!i||this.state!==Z.PARSING){!this.fragCurrent&&this.state!==Z.STOPPED&&this.state!==Z.ERROR&&(this.state=Z.IDLE);return}const{frag:n,part:r,level:s}=i,a=self.performance.now();n.stats.parsing.end=a,r&&(r.stats.parsing.end=a),this.updateLevelTiming(n,r,s,e.partial)}getCurrentContext(e){const{levels:i,fragCurrent:n}=this,{level:r,sn:s,part:a}=e;if(!(i!=null&&i[r]))return this.warn(`Levels object was unset while buffering fragment ${s} of level ${r}. The current chunk will not be buffered.`),null;const o=i[r],l=a>-1?fh(o,s,a):null,c=l?l.fragment:Uy(o,s,n);return c?(n&&n!==c&&(c.stats=n.stats),{frag:c,part:l,level:o}):null}bufferFragmentData(e,i,n,r,s){var a;if(!e||this.state!==Z.PARSING)return;const{data1:o,data2:l}=e;let c=o;if(o&&l&&(c=En(o,l)),!((a=c)!=null&&a.length))return;const h={type:e.type,frag:i,part:n,chunkMeta:r,parent:i.type,data:c};if(this.hls.trigger(T.BUFFER_APPENDING,h),e.dropped&&e.independent&&!n){if(s)return;this.flushBufferGap(i)}}flushBufferGap(e){const i=this.media;if(!i)return;if(!at.isBuffered(i,i.currentTime)){this.flushMainBuffer(0,e.start);return}const n=i.currentTime,r=at.bufferInfo(i,n,0),s=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),o=Math.max(Math.min(e.start-a,r.end-a),n+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,i){const n=this.getLoadPosition();return be(n)?this.getFwdBufferInfoAtPos(e,n,i):null}getFwdBufferInfoAtPos(e,i,n){const{config:{maxBufferHole:r}}=this,s=at.bufferInfo(e,i,r);if(s.len===0&&s.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(i,n);if(a&&s.nextStart<a.end)return at.bufferInfo(e,i,Math.max(s.nextStart,r))}return s}getMaxBufferLength(e){const{config:i}=this;let n;return e?n=Math.max(8*i.maxBufferSize/e,i.maxBufferLength):n=i.maxBufferLength,Math.min(n,i.maxMaxBufferLength)}reduceMaxBufferLength(e){const i=this.config,n=e||i.maxBufferLength;return i.maxMaxBufferLength>=n?(i.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${i.maxMaxBufferLength}s`),!0):!1}getAppendedFrag(e,i=Me.MAIN){const n=this.fragmentTracker.getAppendedFrag(e,Me.MAIN);return n&&"fragment"in n?n.fragment:n}getNextFragment(e,i){const n=i.fragments,r=n.length;if(!r)return null;const{config:s}=this,a=n[0].start;let o;if(i.live){const l=s.initialLiveManifestSize;if(r<l)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${l})`),null;!i.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(o=this.getInitialLiveFragment(i,n),this.startPosition=o?this.hls.liveSyncPosition||o.start:e)}else e<=a&&(o=n[0]);if(!o){const l=s.lowLatencyMode?i.partEnd:i.fragmentEnd;o=this.getFragmentAtPosition(e,l,i)}return this.mapToInitFragWhenRequired(o)}isLoopLoading(e,i){const n=this.fragmentTracker.getState(e);return(n===At.OK||n===At.PARTIAL&&!!e.gap)&&this.nextLoadPosition>i}getNextFragmentLoopLoading(e,i,n,r,s){const a=e.gap,o=this.getNextFragment(this.nextLoadPosition,i);if(o===null)return o;if(e=o,a&&e&&!e.gap&&n.nextStart){const l=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,r);if(l!==null&&n.len+l.len>=s)return this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,i,n){let r=-1,s=!1,a=!0;for(let o=0,l=e.length;o<l;o++){const c=e[o];if(a=a&&!c.independent,r>-1&&n<c.start)break;const h=c.loaded;h?r=-1:(s||c.independent||a)&&c.fragment===i&&(r=o),s=h}return r}loadedEndOfParts(e,i){const n=e[e.length-1];return n&&i>n.start&&n.loaded}getInitialLiveFragment(e,i){const n=this.fragPrevious;let r=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),r=Hy(i,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const s=n.sn+1;if(s>=e.startSN&&s<=e.endSN){const a=i[s-e.startSN];n.cc===a.cc&&(r=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=zy(i,n.cc),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(r=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,i,n){const{config:r}=this;let{fragPrevious:s}=this,{fragments:a,endSN:o}=n;const{fragmentHint:l}=n,c=r.maxFragLookUpTolerance,h=n.partList,u=!!(r.lowLatencyMode&&h!=null&&h.length&&l);u&&l&&!this.bitrateTest&&(a=a.concat(l),o=l.sn);let f;if(e<i){const d=e>i-c?0:c;f=rs(s,a,e,d)}else f=a[a.length-1];if(f){const d=f.sn-n.startSN,p=this.fragmentTracker.getState(f);if((p===At.OK||p===At.PARTIAL&&f.gap)&&(s=f),s&&f.sn===s.sn&&(!u||h[0].fragment.sn>f.sn)&&s&&f.level===s.level){const g=a[d+1];f.sn<o&&this.fragmentTracker.getState(g)!==At.OK?f=g:f=null}}return f}synchronizeToLiveEdge(e){const{config:i,media:n}=this;if(!n)return;const r=this.hls.liveSyncPosition,s=n.currentTime,a=e.fragments[0].start,o=e.edge,l=s>=a-i.maxFragLookUpTolerance&&s<=o;if(r!==null&&n.duration>r&&(s<r||!l)){const c=i.liveMaxLatencyDuration!==void 0?i.liveMaxLatencyDuration:i.liveMaxLatencyDurationCount*e.targetduration;(!l&&n.readyState<4||s<o-c)&&(this.loadedmetadata||(this.nextLoadPosition=r),n.readyState&&(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${r.toFixed(3)}`),n.currentTime=r))}}alignPlaylists(e,i){const{levels:n,levelLastLoaded:r,fragPrevious:s}=this,a=r!==null?n[r]:null,o=e.fragments.length;if(!o)return this.warn("No fragments in live playlist"),0;const l=e.fragments[0].start,c=!i,h=e.alignedSliding&&be(l);if(c||!h&&!l){tx(s,a,e);const u=e.fragments[0].start;return this.log(`Live playlist sliding: ${u.toFixed(2)} start-sn: ${i?i.startSN:"na"}->${e.startSN} prev-sn: ${s?s.sn:"na"} fragments: ${o}`),u}return l}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,i){let n=this.startPosition;if(n<i&&(n=-1),n===-1||this.lastCurrentTime===-1){const r=this.startTimeOffset!==null,s=r?this.startTimeOffset:e.startTimeOffset;s!==null&&be(s)?(n=i+s,s<0&&(n+=e.totalduration),n=Math.min(Math.max(i,n),i+e.totalduration),this.log(`Start time offset ${s} found in ${r?"multivariant":"media"} playlist, adjust startPosition to ${n}`),this.startPosition=n):e.live?n=this.hls.liveSyncPosition||i:this.startPosition=n=0,this.lastCurrentTime=n}this.nextLoadPosition=n}getLoadPosition(){const{media:e}=this;let i=0;return this.loadedmetadata&&e?i=e.currentTime:this.nextLoadPosition&&(i=this.nextLoadPosition),i}handleFragLoadAborted(e,i){this.transmuxer&&e.sn!=="initSegment"&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${i?" part "+i.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==Z.FRAG_LOADING_WAITING_RETRY)&&(this.state=Z.IDLE)}onFragmentOrKeyLoadError(e,i){if(i.chunkMeta&&!i.frag){const u=this.getCurrentContext(i.chunkMeta);u&&(i.frag=u.frag)}const n=i.frag;if(!n||n.type!==e||!this.levels)return;if(this.fragContextChanged(n)){var r;this.warn(`Frag load error must match current frag to retry ${n.url} > ${(r=this.fragCurrent)==null?void 0:r.url}`);return}const s=i.details===Y.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(n,!0);const a=i.errorAction,{action:o,retryCount:l=0,retryConfig:c}=a||{};if(a&&o===Ot.RetryRequest&&c){var h;this.resetStartWhenNotLoaded((h=this.levelLastLoaded)!=null?h:n.level);const u=Hl(c,l);this.warn(`Fragment ${n.sn} of ${e} ${n.level} errored with ${i.details}, retrying loading ${l+1}/${c.maxNumRetry} in ${u}ms`),a.resolved=!0,this.retryDate=self.performance.now()+u,this.state=Z.FRAG_LOADING_WAITING_RETRY}else c&&a?(this.resetFragmentErrors(e),l<c.maxNumRetry?s||(a.resolved=!0):N.warn(`${i.details} reached or exceeded max retry (${l})`)):(a==null?void 0:a.action)===Ot.SendAlternateToPenaltyBox?this.state=Z.WAITING_LEVEL:this.state=Z.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===Z.PARSING||this.state===Z.PARSED){const i=e.parent,n=this.getFwdBufferInfo(this.mediaBuffer,i),r=n&&n.len>.5;r&&this.reduceMaxBufferLength(n.len);const s=!r;return s&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${i} buffer`),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),s}return!1}resetFragmentErrors(e){e===Me.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==Z.STOPPED&&(this.state=Z.IDLE)}afterBufferFlushed(e,i,n){if(!e)return;const r=at.getBuffered(e);this.fragmentTracker.detectEvictedFragments(i,r,n),this.state===Z.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=Z.IDLE}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;const i=this.levels?this.levels[e].details:null;i!=null&&i.live?(this.startPosition=-1,this.setStartPosition(i,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){var i;this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded((i=this.levelLastLoaded)!=null?i:e.level),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,i,n,r){var s;const a=n.details;if(!a){this.warn("level.details undefined");return}if(Object.keys(e.elementaryStreams).reduce((l,c)=>{const h=e.elementaryStreams[c];if(h){const u=h.endPTS-h.startPTS;if(u<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${u})`),l||!1;const f=r?0:sf(a,e,h.startPTS,h.endPTS,h.startDTS,h.endDTS);return this.hls.trigger(T.LEVEL_PTS_UPDATED,{details:a,level:n,drift:f,type:c,frag:e,start:h.startPTS,end:h.endPTS}),!0}return l},!1))n.fragmentError=0;else if(((s=this.transmuxer)==null?void 0:s.error)===null){const l=new Error(`Found no media in fragment ${e.sn} of level ${e.level} resetting transmuxer to fallback to playlist timing`);if(n.fragmentError===0&&(n.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(l.message),this.hls.trigger(T.ERROR,{type:Se.MEDIA_ERROR,details:Y.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:`Found no media in msn ${e.sn} of level "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=Z.PARSED,this.hls.trigger(T.FRAG_PARSED,{frag:e,part:i})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){if(e.event==="demuxerWorker"){var i,n,r;this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded((i=(n=this.levelLastLoaded)!=null?n:(r=this.fragCurrent)==null?void 0:r.level)!=null?i:0),this.resetLoadingState()}}set state(e){const i=this._state;i!==e&&(this._state=e,this.log(`${i}->${e}`))}get state(){return this._state}}function uf(){return self.SourceBuffer||self.WebKitSourceBuffer}function hx(){const t=Ra();if(!t)return!1;const e=uf(),i=t&&typeof t.isTypeSupported=="function"&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),n=!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function";return!!i&&!!n}function ux(){var t;const e=uf();return typeof(e==null||(t=e.prototype)==null?void 0:t.changeType)=="function"}function fx(){return typeof __HLS_WORKER_BUNDLE__=="function"}function dx(){const t=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),e=self.URL.createObjectURL(t);return{worker:new self.Worker(e),objectURL:e}}function px(t){const e=new self.URL(t,self.location.href).href;return{worker:new self.Worker(e),scriptURL:e}}function Ei(t="",e=9e4){return{type:t,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class ff{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,i,n,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,i){return!1}appendFrame(e,i,n){}demux(e,i){this.cachedData&&(e=En(this.cachedData,e),this.cachedData=null);let n=ga(e,0),r=n?n.length:0,s;const a=this._audioTrack,o=this._id3Track,l=n?q0(n):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&be(l))&&(this.basePTS=mx(l,i,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:pi.audioId3,duration:Number.POSITIVE_INFINITY});r<c;){if(this.canParse(e,r)){const h=this.appendFrame(a,e,r);h?(this.frameIndex++,this.lastPTS=h.sample.pts,r+=h.length,s=r):r=c}else X0(e,r)?(n=ga(e,r),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:pi.audioId3,duration:Number.POSITIVE_INFINITY}),r+=n.length,s=r):r++;if(r===c&&s!==c){const h=fn(e,s);this.cachedData?this.cachedData=En(this.cachedData,h):this.cachedData=h}}return{audioTrack:a,videoTrack:Ei(),id3Track:o,textTrack:Ei()}}demuxSampleAes(e,i,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const i=this.cachedData;return i&&(this.cachedData=null,this.demux(i,0)),{audioTrack:this._audioTrack,videoTrack:Ei(),id3Track:this._id3Track,textTrack:Ei()}}destroy(){}}const mx=(t,e,i)=>{if(be(t))return t*90;const n=i?i.baseTime*9e4/i.timescale:0;return e*9e4+n};function gx(t,e,i,n){let r,s,a,o;const l=navigator.userAgent.toLowerCase(),c=n,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];r=((e[i+2]&192)>>>6)+1;const u=(e[i+2]&60)>>>2;if(u>h.length-1){t.trigger(T.ERROR,{type:Se.MEDIA_ERROR,details:Y.FRAG_PARSING_ERROR,fatal:!0,reason:`invalid ADTS sampling index:${u}`});return}return a=(e[i+2]&1)<<2,a|=(e[i+3]&192)>>>6,N.log(`manifest codec:${n}, ADTS type:${r}, samplingIndex:${u}`),/firefox/i.test(l)?u>=6?(r=5,o=new Array(4),s=u-3):(r=2,o=new Array(2),s=u):l.indexOf("android")!==-1?(r=2,o=new Array(2),s=u):(r=5,o=new Array(4),n&&(n.indexOf("mp4a.40.29")!==-1||n.indexOf("mp4a.40.5")!==-1)||!n&&u>=6?s=u-3:((n&&n.indexOf("mp4a.40.2")!==-1&&(u>=6&&a===1||/vivaldi/i.test(l))||!n&&a===1)&&(r=2,o=new Array(2)),s=u)),o[0]=r<<3,o[0]|=(u&14)>>1,o[1]|=(u&1)<<7,o[1]|=a<<3,r===5&&(o[1]|=(s&14)>>1,o[2]=(s&1)<<7,o[2]|=8,o[3]=0),{config:o,samplerate:h[u],channelCount:a,codec:"mp4a.40."+r,manifestCodec:c}}function df(t,e){return t[e]===255&&(t[e+1]&246)===240}function pf(t,e){return t[e+1]&1?7:9}function Yl(t,e){return(t[e+3]&3)<<11|t[e+4]<<3|(t[e+5]&224)>>>5}function vx(t,e){return e+5<t.length}function ba(t,e){return e+1<t.length&&df(t,e)}function yx(t,e){return vx(t,e)&&df(t,e)&&Yl(t,e)<=t.length-e}function xx(t,e){if(ba(t,e)){const i=pf(t,e);if(e+i>=t.length)return!1;const n=Yl(t,e);if(n<=i)return!1;const r=e+n;return r===t.length||ba(t,r)}return!1}function mf(t,e,i,n,r){if(!t.samplerate){const s=gx(e,i,n,r);if(!s)return;t.config=s.config,t.samplerate=s.samplerate,t.channelCount=s.channelCount,t.codec=s.codec,t.manifestCodec=s.manifestCodec,N.log(`parsed codec:${t.codec}, rate:${s.samplerate}, channels:${s.channelCount}`)}}function gf(t){return 1024*9e4/t}function Ex(t,e){const i=pf(t,e);if(e+i<=t.length){const n=Yl(t,e)-i;if(n>0)return{headerLength:i,frameLength:n}}}function vf(t,e,i,n,r){const s=gf(t.samplerate),a=n+r*s,o=Ex(e,i);let l;if(o){const{frameLength:u,headerLength:f}=o,d=f+u,p=Math.max(0,i+d-e.length);p?(l=new Uint8Array(d-f),l.set(e.subarray(i+f,e.length),0)):l=e.subarray(i+f,i+d);const m={unit:l,pts:a};return p||t.samples.push(m),{sample:m,length:d,missing:p}}const c=e.length-i;return l=new Uint8Array(c),l.set(e.subarray(i,e.length),0),{sample:{unit:l,pts:a},length:c,missing:-1}}class bx extends ff{constructor(e,i){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=i}resetInitSegment(e,i,n,r){super.resetInitSegment(e,i,n,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:i,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let n=(ga(e,0)||[]).length;for(let r=e.length;n<r;n++)if(xx(e,n))return N.log("ADTS sync word found !"),!0;return!1}canParse(e,i){return yx(e,i)}appendFrame(e,i,n){mf(e,this.observer,i,n,e.manifestCodec);const r=vf(e,i,n,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}}const Tx=/\/emsg[-/]ID3/i;class _x{constructor(e,i){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=i}resetTimeStamp(){}resetInitSegment(e,i,n,r){const s=this.videoTrack=Ei("video",1),a=this.audioTrack=Ei("audio",1),o=this.txtTrack=Ei("text",1);if(this.id3Track=Ei("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=Zu(e);if(l.video){const{id:c,timescale:h,codec:u}=l.video;s.id=c,s.timescale=o.timescale=h,s.codec=u}if(l.audio){const{id:c,timescale:h,codec:u}=l.audio;a.id=c,a.timescale=h,a.codec=u}o.id=Ku.text,s.sampleDuration=0,s.duration=a.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return e=e.length>16384?e.subarray(0,16384):e,We(e,["moof"]).length>0}demux(e,i){this.timeOffset=i;let n=e;const r=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=En(this.remainderData,e));const o=uy(n);this.remainderData=o.remainder,r.samples=o.valid||new Uint8Array}else r.samples=n;const a=this.extractID3Track(r,i);return s.samples=qc(i,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,i=this.videoTrack,n=this.txtTrack;i.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(i,this.timeOffset);return n.samples=qc(e,i),{videoTrack:i,audioTrack:Ei(),id3Track:r,textTrack:Ei()}}extractID3Track(e,i){const n=this.id3Track;if(e.samples.length){const r=We(e.samples,["emsg"]);r&&r.forEach(s=>{const a=py(s);if(Tx.test(a.schemeIdUri)){const o=be(a.presentationTime)?a.presentationTime/a.timeScale:i+a.presentationTimeDelta/a.timeScale;let l=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const c=a.payload;n.samples.push({data:c,len:c.byteLength,dts:o,pts:o,type:pi.emsg,duration:l})}})}return n}demuxSampleAes(e,i,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}let ys=null;const wx=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Ax=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Sx=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Lx=[0,1,1,4];function yf(t,e,i,n,r){if(i+24>e.length)return;const s=xf(e,i);if(s&&i+s.frameLength<=e.length){const a=s.samplesPerFrame*9e4/s.sampleRate,o=n+r*a,l={unit:e.subarray(i,i+s.frameLength),pts:o,dts:o};return t.config=[],t.channelCount=s.channelCount,t.samplerate=s.sampleRate,t.samples.push(l),{sample:l,length:s.frameLength,missing:0}}}function xf(t,e){const i=t[e+1]>>3&3,n=t[e+1]>>1&3,r=t[e+2]>>4&15,s=t[e+2]>>2&3;if(i!==1&&r!==0&&r!==15&&s!==3){const a=t[e+2]>>1&1,o=t[e+3]>>6,l=i===3?3-n:n===3?3:4,c=wx[l*14+r-1]*1e3,u=Ax[(i===3?0:i===2?1:2)*3+s],f=o===3?1:2,d=Sx[i][n],p=Lx[n],m=d*8*p,g=Math.floor(d*c/u+a)*p;if(ys===null){const y=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ys=y?parseInt(y[1]):0}return!!ys&&ys<=87&&n===2&&c>=224e3&&o===0&&(t[e+3]=t[e+3]|128),{sampleRate:u,channelCount:f,frameLength:g,samplesPerFrame:m}}}function Kl(t,e){return t[e]===255&&(t[e+1]&224)===224&&(t[e+1]&6)!==0}function Ef(t,e){return e+1<t.length&&Kl(t,e)}function Mx(t,e){return Kl(t,e)&&4<=t.length-e}function Rx(t,e){if(e+1<t.length&&Kl(t,e)){const n=xf(t,e);let r=4;n!=null&&n.frameLength&&(r=n.frameLength);const s=e+r;return s===t.length||Ef(t,s)}return!1}class Eh{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,i=this.bytesAvailable,n=e.byteLength-i,r=new Uint8Array(4),s=Math.min(4,i);if(s===0)throw new Error("no bytes available");r.set(e.subarray(n,n+s)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let i;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,i=e>>3,e-=i<<3,this.bytesAvailable-=i,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let i=Math.min(this.bitsAvailable,e);const n=this.word>>>32-i;if(e>32&&N.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=i,this.bitsAvailable>0)this.word<<=i;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return i=e-i,i>0&&this.bitsAvailable?n<<i|this.readBits(i):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let i=8,n=8,r;for(let s=0;s<e;s++)n!==0&&(r=this.readEG(),n=(i+r+256)%256),i=n===0?i:n}readSPS(){let e=0,i=0,n=0,r=0,s,a,o;const l=this.readUByte.bind(this),c=this.readBits.bind(this),h=this.readUEG.bind(this),u=this.readBoolean.bind(this),f=this.skipBits.bind(this),d=this.skipEG.bind(this),p=this.skipUEG.bind(this),m=this.skipScalingList.bind(this);l();const g=l();if(c(5),f(3),l(),p(),g===100||g===110||g===122||g===244||g===44||g===83||g===86||g===118||g===128){const w=h();if(w===3&&f(1),p(),p(),f(1),u())for(a=w!==3?8:12,o=0;o<a;o++)u()&&(o<6?m(16):m(64))}p();const v=h();if(v===0)h();else if(v===1)for(f(1),d(),d(),s=h(),o=0;o<s;o++)d();p(),f(1);const x=h(),y=h(),b=c(1);b===0&&f(1),f(1),u()&&(e=h(),i=h(),n=h(),r=h());let E=[1,1];if(u()&&u())switch(l()){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:{E=[l()<<8|l(),l()<<8|l()];break}}return{width:Math.ceil((x+1)*16-e*2-i*2),height:(2-b)*(y+1)*16-(b?2:4)*(n+r),pixelRatio:E}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class Ix{constructor(e,i,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new jl(i,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,i,n){const r=e[i].unit;if(r.length<=16)return;const s=r.subarray(16,r.length-r.length%16),a=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(a).then(o=>{const l=new Uint8Array(o);r.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,i+1,n)})}decryptAacSamples(e,i,n){for(;;i++){if(i>=e.length){n();return}if(!(e[i].unit.length<32)&&(this.decryptAacSample(e,i,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const i=Math.floor((e.length-48)/160)*16+16,n=new Int8Array(i);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)n.set(e.subarray(s,s+16),r);return n}getAvcDecryptedUnit(e,i){const n=new Uint8Array(i);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)e.set(n.subarray(r,r+16),s);return e}decryptAvcSample(e,i,n,r,s){const a=ef(s.data),o=this.getAvcEncryptedData(a);this.decryptBuffer(o.buffer).then(l=>{s.data=this.getAvcDecryptedUnit(a,l),this.decrypter.isSync()||this.decryptAvcSamples(e,i,n+1,r)})}decryptAvcSamples(e,i,n,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;i++,n=0){if(i>=e.length){r();return}const s=e[i].units;for(;!(n>=s.length);n++){const a=s[n];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,i,n,r,a),!this.decrypter.isSync()))return}}}}const Pt=188;class Ki{constructor(e,i,n){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=i,this.typeSupported=n}static probe(e){const i=Ki.syncOffset(e);return i>0&&N.warn(`MPEG2-TS detected but first sync word found @ offset ${i}`),i!==-1}static syncOffset(e){const i=e.length;let n=Math.min(Pt*5,e.length-Pt)+1,r=0;for(;r<n;){let s=!1,a=-1,o=0;for(let l=r;l<i;l+=Pt)if(e[l]===71){if(o++,a===-1&&(a=l,a!==0&&(n=Math.min(a+Pt*99,e.length-Pt)+1)),s||(s=yl(e,l)===0),s&&o>1&&(a===0&&o>2||l+Pt>n))return a}else{if(o)return-1;break}r++}return-1}static createTrack(e,i){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:Ku[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?i:void 0}}resetInitSegment(e,i,n,r){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=Ki.createTrack("video"),this._audioTrack=Ki.createTrack("audio",r),this._id3Track=Ki.createTrack("id3"),this._txtTrack=Ki.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=i,this.videoCodec=n,this._duration=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_avcTrack:i,_id3Track:n}=this;e&&(e.pesData=null),i&&(i.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null}demux(e,i,n=!1,r=!1){n||(this.sampleAes=null);let s;const a=this._avcTrack,o=this._audioTrack,l=this._id3Track,c=this._txtTrack;let h=a.pid,u=a.pesData,f=o.pid,d=l.pid,p=o.pesData,m=l.pesData,g=null,v=this.pmtParsed,x=this._pmtId,y=e.length;if(this.remainderData&&(e=En(this.remainderData,e),y=e.length,this.remainderData=null),y<Pt&&!r)return this.remainderData=e,{audioTrack:o,videoTrack:a,id3Track:l,textTrack:c};const b=Math.max(0,Ki.syncOffset(e));y-=(y-b)%Pt,y<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,y,e.buffer.byteLength-y));let E=0;for(let A=b;A<y;A+=Pt)if(e[A]===71){const D=!!(e[A+1]&64),O=yl(e,A),P=(e[A+3]&48)>>4;let L;if(P>1){if(L=A+5+e[A+4],L===A+Pt)continue}else L=A+4;switch(O){case h:D&&(u&&(s=Mn(u))&&this.parseAVCPES(a,c,s,!1),u={data:[],size:0}),u&&(u.data.push(e.subarray(L,A+Pt)),u.size+=A+Pt-L);break;case f:if(D){if(p&&(s=Mn(p)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,s);break;case"mp3":this.parseMPEGPES(o,s);break}p={data:[],size:0}}p&&(p.data.push(e.subarray(L,A+Pt)),p.size+=A+Pt-L);break;case d:D&&(m&&(s=Mn(m))&&this.parseID3PES(l,s),m={data:[],size:0}),m&&(m.data.push(e.subarray(L,A+Pt)),m.size+=A+Pt-L);break;case 0:D&&(L+=e[L]+1),x=this._pmtId=Cx(e,L);break;case x:{D&&(L+=e[L]+1);const C=Dx(e,L,this.typeSupported,n);h=C.avc,h>0&&(a.pid=h),f=C.audio,f>0&&(o.pid=f,o.segmentCodec=C.segmentCodec),d=C.id3,d>0&&(l.pid=d),g!==null&&!v&&(N.warn(`MPEG-TS PMT found at ${A} after unknown PID '${g}'. Backtracking to sync byte @${b} to parse all TS packets.`),g=null,A=b-188),v=this.pmtParsed=!0;break}case 17:case 8191:break;default:g=O;break}}else E++;if(E>0){const A=new Error(`Found ${E} TS packet/s that do not start with 0x47`);this.observer.emit(T.ERROR,T.ERROR,{type:Se.MEDIA_ERROR,details:Y.FRAG_PARSING_ERROR,fatal:!1,error:A,reason:A.message})}a.pesData=u,o.pesData=p,l.pesData=m;const w={audioTrack:o,videoTrack:a,id3Track:l,textTrack:c};return r&&this.extractRemainingSamples(w),w}flush(){const{remainderData:e}=this;this.remainderData=null;let i;return e?i=this.demux(e,-1,!1,!0):i={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(i),this.sampleAes?this.decrypt(i,this.sampleAes):i}extractRemainingSamples(e){const{audioTrack:i,videoTrack:n,id3Track:r,textTrack:s}=e,a=n.pesData,o=i.pesData,l=r.pesData;let c;if(a&&(c=Mn(a))?(this.parseAVCPES(n,s,c,!0),n.pesData=null):n.pesData=a,o&&(c=Mn(o))){switch(i.segmentCodec){case"aac":this.parseAACPES(i,c);break;case"mp3":this.parseMPEGPES(i,c);break}i.pesData=null}else o!=null&&o.size&&N.log("last AAC PES packet truncated,might overlap between fragments"),i.pesData=o;l&&(c=Mn(l))?(this.parseID3PES(r,c),r.pesData=null):r.pesData=l}demuxSampleAes(e,i,n){const r=this.demux(e,n,!0,!this.config.progressive),s=this.sampleAes=new Ix(this.observer,this.config,i);return this.decrypt(r,s)}decrypt(e,i){return new Promise(n=>{const{audioTrack:r,videoTrack:s}=e;r.samples&&r.segmentCodec==="aac"?i.decryptAacSamples(r.samples,0,()=>{s.samples?i.decryptAvcSamples(s.samples,0,0,()=>{n(e)}):n(e)}):s.samples&&i.decryptAvcSamples(s.samples,0,0,()=>{n(e)})})}destroy(){this._duration=0}parseAVCPES(e,i,n,r){const s=this.parseAVCNALu(e,n.data);let a=this.avcSample,o,l=!1;n.data=null,a&&s.length&&!e.audFound&&(hr(a,e),a=this.avcSample=xs(!1,n.pts,n.dts,"")),s.forEach(c=>{var h;switch(c.type){case 1:{let f=!1;o=!0;const d=c.data;if(l&&d.length>4){const p=new Eh(d).readSliceType();(p===2||p===4||p===7||p===9)&&(f=!0)}if(f){var u;(u=a)!=null&&u.frame&&!a.key&&(hr(a,e),a=this.avcSample=null)}a||(a=this.avcSample=xs(!0,n.pts,n.dts,"")),a.frame=!0,a.key=f;break}case 5:o=!0,(h=a)!=null&&h.frame&&!a.key&&(hr(a,e),a=this.avcSample=null),a||(a=this.avcSample=xs(!0,n.pts,n.dts,"")),a.key=!0,a.frame=!0;break;case 6:{o=!0,Qu(c.data,1,n.pts,i.samples);break}case 7:if(o=!0,l=!0,!e.sps){const f=c.data,p=new Eh(f).readSPS();e.width=p.width,e.height=p.height,e.pixelRatio=p.pixelRatio,e.sps=[f],e.duration=this._duration;const m=f.subarray(1,4);let g="avc1.";for(let v=0;v<3;v++){let x=m[v].toString(16);x.length<2&&(x="0"+x),g+=x}e.codec=g}break;case 8:o=!0,e.pps||(e.pps=[c.data]);break;case 9:o=!1,e.audFound=!0,a&&hr(a,e),a=this.avcSample=xs(!1,n.pts,n.dts,"");break;case 12:o=!0;break;default:o=!1,a&&(a.debug+="unknown NAL "+c.type+" ");break}a&&o&&a.units.push(c)}),r&&a&&(hr(a,e),this.avcSample=null)}getLastNalUnit(e){var i;let n=this.avcSample,r;if((!n||n.units.length===0)&&(n=e[e.length-1]),(i=n)!=null&&i.units){const s=n.units;r=s[s.length-1]}return r}parseAVCNALu(e,i){const n=i.byteLength;let r=e.naluState||0;const s=r,a=[];let o=0,l,c,h,u=-1,f=0;for(r===-1&&(u=0,f=i[0]&31,r=0,o=1);o<n;){if(l=i[o++],!r){r=l?0:1;continue}if(r===1){r=l?0:2;continue}if(!l)r=3;else if(l===1){if(u>=0){const d={data:i.subarray(u,o-r-1),type:f};a.push(d)}else{const d=this.getLastNalUnit(e.samples);if(d&&(s&&o<=4-s&&d.state&&(d.data=d.data.subarray(0,d.data.byteLength-s)),c=o-r-1,c>0)){const p=new Uint8Array(d.data.byteLength+c);p.set(d.data,0),p.set(i.subarray(0,c),d.data.byteLength),d.data=p,d.state=0}}o<n?(h=i[o]&31,u=o,f=h,r=0):r=-1}else r=0}if(u>=0&&r>=0){const d={data:i.subarray(u,n),type:f,state:r};a.push(d)}if(a.length===0){const d=this.getLastNalUnit(e.samples);if(d){const p=new Uint8Array(d.data.byteLength+i.byteLength);p.set(d.data,0),p.set(i,d.data.byteLength),d.data=p}}return e.naluState=r,a}parseAACPES(e,i){let n=0;const r=this.aacOverFlow;let s=i.data;if(r){this.aacOverFlow=null;const u=r.missing,f=r.sample.unit.byteLength;if(u===-1){const d=new Uint8Array(f+s.byteLength);d.set(r.sample.unit,0),d.set(s,f),s=d}else{const d=f-u;r.sample.unit.set(s.subarray(0,u),d),e.samples.push(r.sample),n=r.missing}}let a,o;for(a=n,o=s.length;a<o-1&&!ba(s,a);a++);if(a!==n){let u;const f=a<o-1;f?u=`AAC PES did not start with ADTS header,offset:${a}`:u="No ADTS header found in AAC PES";const d=new Error(u);if(N.warn(`parsing error: ${u}`),this.observer.emit(T.ERROR,T.ERROR,{type:Se.MEDIA_ERROR,details:Y.FRAG_PARSING_ERROR,fatal:!1,levelRetry:f,error:d,reason:u}),!f)return}mf(e,this.observer,s,a,this.audioCodec);let l;if(i.pts!==void 0)l=i.pts;else if(r){const u=gf(e.samplerate);l=r.sample.pts+u}else{N.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,h;for(;a<o;)if(h=vf(e,s,a,l,c),a+=h.length,h.missing){this.aacOverFlow=h;break}else for(c++;a<o-1&&!ba(s,a);a++);}parseMPEGPES(e,i){const n=i.data,r=n.length;let s=0,a=0;const o=i.pts;if(o===void 0){N.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<r;)if(Ef(n,a)){const l=yf(e,n,a,o,s);if(l)a+=l.length,s++;else break}else a++}parseID3PES(e,i){if(i.pts===void 0){N.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const n=bt({},i,{type:this._avcTrack?pi.emsg:pi.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function xs(t,e,i,n){return{key:t,frame:!1,pts:e,dts:i,units:[],debug:n,length:0}}function yl(t,e){return((t[e+1]&31)<<8)+t[e+2]}function Cx(t,e){return(t[e+10]&31)<<8|t[e+11]}function Dx(t,e,i,n){const r={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},s=(t[e+1]&15)<<8|t[e+2],a=e+3+s-4,o=(t[e+10]&15)<<8|t[e+11];for(e+=12+o;e<a;){const l=yl(t,e);switch(t[e]){case 207:if(!n){N.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:r.audio===-1&&(r.audio=l);break;case 21:r.id3===-1&&(r.id3=l);break;case 219:if(!n){N.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:r.avc===-1&&(r.avc=l);break;case 3:case 4:i.mpeg!==!0&&i.mp3!==!0?N.log("MPEG audio found, not supported in this browser"):r.audio===-1&&(r.audio=l,r.segmentCodec="mp3");break;case 36:N.warn("Unsupported HEVC stream type found");break}e+=((t[e+3]&15)<<8|t[e+4])+5}return r}function Mn(t){let e=0,i,n,r,s,a;const o=t.data;if(!t||t.size===0)return null;for(;o[0].length<19&&o.length>1;){const c=new Uint8Array(o[0].length+o[1].length);c.set(o[0]),c.set(o[1],o[0].length),o[0]=c,o.splice(1,1)}if(i=o[0],(i[0]<<16)+(i[1]<<8)+i[2]===1){if(n=(i[4]<<8)+i[5],n&&n>t.size-6)return null;const c=i[7];c&192&&(s=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,c&64?(a=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,s-a>60*9e4&&(N.warn(`${Math.round((s-a)/9e4)}s delta between PTS and DTS, align them`),s=a)):a=s),r=i[8];let h=r+9;if(t.size<=h)return null;t.size-=h;const u=new Uint8Array(t.size);for(let f=0,d=o.length;f<d;f++){i=o[f];let p=i.byteLength;if(h)if(h>p){h-=p;continue}else i=i.subarray(h),p-=h,h=0;u.set(i,e),e+=p}return n&&(n-=r+3),{data:u,pts:s,dts:a,len:n}}return null}function hr(t,e){if(t.units.length&&t.frame){if(t.pts===void 0){const i=e.samples,n=i.length;if(n){const r=i[n-1];t.pts=r.pts,t.dts=r.dts}else{e.dropped++;return}}e.samples.push(t)}t.debug.length&&N.log(t.pts+"/"+t.dts+":"+t.debug)}class Px extends ff{resetInitSegment(e,i,n,r){super.resetInitSegment(e,i,n,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:i,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let n=(ga(e,0)||[]).length;for(let r=e.length;n<r;n++)if(Rx(e,n))return N.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,i){return Mx(e,i)}appendFrame(e,i,n){if(this.basePTS!==null)return yf(e,i,n,this.basePTS,this.frameIndex)}}class bh{static getSilentFrame(e,i){switch(e){case"mp4a.40.2":if(i===1)return new Uint8Array([0,200,0,128,35,128]);if(i===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(i===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(i===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(i===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(i===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(i===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(i===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(i===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Yi=Math.pow(2,32)-1;class H{static init(){H.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in H.types)H.types.hasOwnProperty(e)&&(H.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);H.HDLR_TYPES={video:i,audio:n};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);H.STTS=H.STSC=H.STCO=s,H.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),H.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),H.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),H.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);H.FTYP=H.box(H.types.ftyp,a,l,a,o),H.DINF=H.box(H.types.dinf,H.box(H.types.dref,r))}static box(e,...i){let n=8,r=i.length;const s=r;for(;r--;)n+=i[r].byteLength;const a=new Uint8Array(n);for(a[0]=n>>24&255,a[1]=n>>16&255,a[2]=n>>8&255,a[3]=n&255,a.set(e,4),r=0,n=8;r<s;r++)a.set(i[r],n),n+=i[r].byteLength;return a}static hdlr(e){return H.box(H.types.hdlr,H.HDLR_TYPES[e])}static mdat(e){return H.box(H.types.mdat,e)}static mdhd(e,i){i*=e;const n=Math.floor(i/(Yi+1)),r=Math.floor(i%(Yi+1));return H.box(H.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))}static mdia(e){return H.box(H.types.mdia,H.mdhd(e.timescale,e.duration),H.hdlr(e.type),H.minf(e))}static mfhd(e){return H.box(H.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?H.box(H.types.minf,H.box(H.types.smhd,H.SMHD),H.DINF,H.stbl(e)):H.box(H.types.minf,H.box(H.types.vmhd,H.VMHD),H.DINF,H.stbl(e))}static moof(e,i,n){return H.box(H.types.moof,H.mfhd(e),H.traf(n,i))}static moov(e){let i=e.length;const n=[];for(;i--;)n[i]=H.trak(e[i]);return H.box.apply(null,[H.types.moov,H.mvhd(e[0].timescale,e[0].duration)].concat(n).concat(H.mvex(e)))}static mvex(e){let i=e.length;const n=[];for(;i--;)n[i]=H.trex(e[i]);return H.box.apply(null,[H.types.mvex,...n])}static mvhd(e,i){i*=e;const n=Math.floor(i/(Yi+1)),r=Math.floor(i%(Yi+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return H.box(H.types.mvhd,s)}static sdtp(e){const i=e.samples||[],n=new Uint8Array(4+i.length);let r,s;for(r=0;r<i.length;r++)s=i[r].flags,n[r+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return H.box(H.types.sdtp,n)}static stbl(e){return H.box(H.types.stbl,H.stsd(e),H.box(H.types.stts,H.STTS),H.box(H.types.stsc,H.STSC),H.box(H.types.stsz,H.STSZ),H.box(H.types.stco,H.STCO))}static avc1(e){let i=[],n=[],r,s,a;for(r=0;r<e.sps.length;r++)s=e.sps[r],a=s.byteLength,i.push(a>>>8&255),i.push(a&255),i=i.concat(Array.prototype.slice.call(s));for(r=0;r<e.pps.length;r++)s=e.pps[r],a=s.byteLength,n.push(a>>>8&255),n.push(a&255),n=n.concat(Array.prototype.slice.call(s));const o=H.box(H.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|e.sps.length].concat(i).concat([e.pps.length]).concat(n))),l=e.width,c=e.height,h=e.pixelRatio[0],u=e.pixelRatio[1];return H.box(H.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,H.box(H.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),H.box(H.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,h&255,u>>24,u>>16&255,u>>8&255,u&255])))}static esds(e){const i=e.config.length;return new Uint8Array([0,0,0,0,3,23+i,0,1,0,4,15+i,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([i]).concat(e.config).concat([6,1,2]))}static mp4a(e){const i=e.samplerate;return H.box(H.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,i>>8&255,i&255,0,0]),H.box(H.types.esds,H.esds(e)))}static mp3(e){const i=e.samplerate;return H.box(H.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,i>>8&255,i&255,0,0]))}static stsd(e){return e.type==="audio"?e.segmentCodec==="mp3"&&e.codec==="mp3"?H.box(H.types.stsd,H.STSD,H.mp3(e)):H.box(H.types.stsd,H.STSD,H.mp4a(e)):H.box(H.types.stsd,H.STSD,H.avc1(e))}static tkhd(e){const i=e.id,n=e.duration*e.timescale,r=e.width,s=e.height,a=Math.floor(n/(Yi+1)),o=Math.floor(n%(Yi+1));return H.box(H.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,i&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,i){const n=H.sdtp(e),r=e.id,s=Math.floor(i/(Yi+1)),a=Math.floor(i%(Yi+1));return H.box(H.types.traf,H.box(H.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),H.box(H.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,a>>24,a>>16&255,a>>8&255,a&255])),H.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,H.box(H.types.trak,H.tkhd(e),H.mdia(e))}static trex(e){const i=e.id;return H.box(H.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,i){const n=e.samples||[],r=n.length,s=12+16*r,a=new Uint8Array(s);let o,l,c,h,u,f;for(i+=8+s,a.set([e.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255],0),o=0;o<r;o++)l=n[o],c=l.duration,h=l.size,u=l.flags,f=l.cts,a.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,h>>>24&255,h>>>16&255,h>>>8&255,h&255,u.isLeading<<2|u.dependsOn,u.isDependedOn<<6|u.hasRedundancy<<4|u.paddingValue<<1|u.isNonSync,u.degradPrio&61440,u.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*o);return H.box(H.types.trun,a)}static initSegment(e){H.types||H.init();const i=H.moov(e),n=new Uint8Array(H.FTYP.byteLength+i.byteLength);return n.set(H.FTYP),n.set(i,H.FTYP.byteLength),n}}H.types=void 0;H.HDLR_TYPES=void 0;H.STTS=void 0;H.STSC=void 0;H.STCO=void 0;H.STSZ=void 0;H.VMHD=void 0;H.SMHD=void 0;H.STSD=void 0;H.FTYP=void 0;H.DINF=void 0;const bf=9e4;function Xl(t,e,i=1,n=!1){const r=t*e*i;return n?Math.round(r):r}function Ox(t,e,i=1,n=!1){return Xl(t,e,1/i,n)}function ur(t,e=!1){return Xl(t,1e3,1/bf,e)}function Fx(t,e=1){return Xl(t,bf,1/e)}const kx=10*1e3,Th=1024,Nx=1152;let Es=null,to=null;class io{constructor(e,i,n,r=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=i,this.typeSupported=n,this.ISGenerated=!1,Es===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Es=a?parseInt(a[1]):0}if(to===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);to=s?parseInt(s[1]):0}}destroy(){}resetTimeStamp(e){N.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){N.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){N.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1}getVideoStartPts(e){let i=!1;const n=e.reduce((r,s)=>{const a=s.pts-r;return a<-4294967296?(i=!0,oi(r,s.pts)):a>0?r:s.pts},e[0].pts);return i&&N.debug("PTS rollover detected"),n}remux(e,i,n,r,s,a,o,l){let c,h,u,f,d,p,m=s,g=s;const v=e.pid>-1,x=i.pid>-1,y=i.samples.length,b=e.samples.length>0,E=o&&y>0||y>1;if((!v||b)&&(!x||E)||this.ISGenerated||o){this.ISGenerated||(u=this.generateIS(e,i,s,a));const A=this.isVideoContiguous;let D=-1,O;if(E&&(D=Bx(i.samples),!A&&this.config.forceKeyFrameOnDiscontinuity))if(p=!0,D>0){N.warn(`[mp4-remuxer]: Dropped ${D} out of ${y} video samples due to a missing keyframe`);const P=this.getVideoStartPts(i.samples);i.samples=i.samples.slice(D),i.dropped+=D,g+=(i.samples[0].pts-P)/i.inputTimeScale,O=g}else D===-1&&(N.warn(`[mp4-remuxer]: No keyframe found out of ${y} video samples`),p=!1);if(this.ISGenerated){if(b&&E){const P=this.getVideoStartPts(i.samples),C=(oi(e.samples[0].pts,P)-P)/i.inputTimeScale;m+=Math.max(0,C),g+=Math.max(0,-C)}if(b){if(e.samplerate||(N.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),u=this.generateIS(e,i,s,a)),h=this.remuxAudio(e,m,this.isAudioContiguous,a,x||E||l===Me.AUDIO?g:void 0),E){const P=h?h.endPTS-h.startPTS:0;i.inputTimeScale||(N.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),u=this.generateIS(e,i,s,a)),c=this.remuxVideo(i,g,A,P)}}else E&&(c=this.remuxVideo(i,g,A,0));c&&(c.firstKeyFrame=D,c.independent=D!==-1,c.firstKeyFramePTS=O)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(d=Tf(n,s,this._initPTS,this._initDTS)),r.samples.length&&(f=_f(r,s,this._initPTS))),{audio:h,video:c,initSegment:u,independent:p,text:f,id3:d}}generateIS(e,i,n,r){const s=e.samples,a=i.samples,o=this.typeSupported,l={},c=this._initPTS;let h=!c||r,u="audio/mp4",f,d,p;if(h&&(f=d=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":o.mpeg?(u="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3");break}l.audio={id:"audio",container:u,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&o.mpeg?new Uint8Array(0):H.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(p=e.inputTimeScale,!c||p!==c.timescale?f=d=s[0].pts-Math.round(p*n):h=!1)}if(i.sps&&i.pps&&a.length&&(i.timescale=i.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:i.codec,initSegment:H.initSegment([i]),metadata:{width:i.width,height:i.height}},h))if(p=i.inputTimeScale,!c||p!==c.timescale){const m=this.getVideoStartPts(a),g=Math.round(p*n);d=Math.min(d,oi(a[0].dts,m)-g),f=Math.min(f,m-g)}else h=!1;if(Object.keys(l).length)return this.ISGenerated=!0,h?(this._initPTS={baseTime:f,timescale:p},this._initDTS={baseTime:d,timescale:p}):f=p=void 0,{tracks:l,initPTS:f,timescale:p}}remuxVideo(e,i,n,r){const s=e.inputTimeScale,a=e.samples,o=[],l=a.length,c=this._initPTS;let h=this.nextAvcDts,u=8,f=this.videoSampleDuration,d,p,m=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,v=!1;if(!n||h===null){const k=i*s,G=a[0].pts-oi(a[0].dts,a[0].pts);h=k-G}const x=c.baseTime*s/c.timescale;for(let k=0;k<l;k++){const G=a[k];G.pts=oi(G.pts-x,h),G.dts=oi(G.dts-x,h),G.dts<a[k>0?k-1:k].dts&&(v=!0)}v&&a.sort(function(k,G){const q=k.dts-G.dts,ee=k.pts-G.pts;return q||ee}),d=a[0].dts,p=a[a.length-1].dts;const y=p-d,b=y?Math.round(y/(l-1)):f||e.inputTimeScale/30;if(n){const k=d-h,G=k>b,q=k<-1;if((G||q)&&(G?N.warn(`AVC: ${ur(k,!0)} ms (${k}dts) hole between fragments detected, filling it`):N.warn(`AVC: ${ur(-k,!0)} ms (${k}dts) overlapping between fragments detected`),!q||h>=a[0].pts)){d=h;const ee=a[0].pts-k;a[0].dts=d,a[0].pts=ee,N.log(`Video: First PTS/DTS adjusted: ${ur(ee,!0)}/${ur(d,!0)}, delta: ${ur(k,!0)} ms`)}}d=Math.max(0,d);let E=0,w=0;for(let k=0;k<l;k++){const G=a[k],q=G.units,ee=q.length;let Q=0;for(let ae=0;ae<ee;ae++)Q+=q[ae].data.length;w+=Q,E+=ee,G.length=Q,G.dts=Math.max(G.dts,d),m=Math.min(G.pts,m),g=Math.max(G.pts,g)}p=a[l-1].dts;const A=w+4*E+8;let D;try{D=new Uint8Array(A)}catch(k){this.observer.emit(T.ERROR,T.ERROR,{type:Se.MUX_ERROR,details:Y.REMUX_ALLOC_ERROR,fatal:!1,error:k,bytes:A,reason:`fail allocating video mdat ${A}`});return}const O=new DataView(D.buffer);O.setUint32(0,A),D.set(H.types.mdat,4);let P=!1,L=Number.POSITIVE_INFINITY,C=Number.POSITIVE_INFINITY,U=Number.NEGATIVE_INFINITY,j=Number.NEGATIVE_INFINITY;for(let k=0;k<l;k++){const G=a[k],q=G.units;let ee=0;for(let V=0,oe=q.length;V<oe;V++){const ne=q[V],ve=ne.data,Ee=ne.data.byteLength;O.setUint32(u,Ee),u+=4,D.set(ve,u),u+=Ee,ee+=4+Ee}let Q;if(k<l-1)f=a[k+1].dts-G.dts,Q=a[k+1].pts-G.pts;else{const V=this.config,oe=k>0?G.dts-a[k-1].dts:b;if(Q=k>0?G.pts-a[k-1].pts:b,V.stretchShortVideoTrack&&this.nextAudioPts!==null){const ne=Math.floor(V.maxBufferHole*s),ve=(r?m+r*s:this.nextAudioPts)-G.pts;ve>ne?(f=ve-oe,f<0?f=oe:P=!0,N.log(`[mp4-remuxer]: It is approximately ${ve/90} ms to the next segment; using duration ${f/90} ms for the last video frame.`)):f=oe}else f=oe}const ae=Math.round(G.pts-G.dts);L=Math.min(L,f),U=Math.max(U,f),C=Math.min(C,Q),j=Math.max(j,Q),o.push(new _h(G.key,f,ee,ae))}if(o.length){if(Es){if(Es<70){const k=o[0].flags;k.dependsOn=2,k.isNonSync=0}}else if(to&&j-C<U-L&&b/U<.025&&o[0].cts===0){N.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let k=d;for(let G=0,q=o.length;G<q;G++){const ee=k+o[G].duration,Q=k+o[G].cts;if(G<q-1){const ae=ee+o[G+1].cts;o[G].duration=ae-Q}else o[G].duration=G?o[G-1].duration:b;o[G].cts=0,k=ee}}}f=P||!f?b:f,this.nextAvcDts=h=p+f,this.videoSampleDuration=f,this.isVideoContiguous=!0;const K=H.moof(e.sequenceNumber++,d,bt({},e,{samples:o})),z="video",$={data1:K,data2:D,startPTS:m/s,endPTS:(g+f)/s,startDTS:d/s,endDTS:h/s,type:z,hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,$}remuxAudio(e,i,n,r,s){const a=e.inputTimeScale,o=e.samplerate?e.samplerate:a,l=a/o,c=e.segmentCodec==="aac"?Th:Nx,h=c*l,u=this._initPTS,f=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,d=[],p=s!==void 0;let m=e.samples,g=f?0:8,v=this.nextAudioPts||-1;const x=i*a,y=u.baseTime*a/u.timescale;if(this.isAudioContiguous=n=n||m.length&&v>0&&(r&&Math.abs(x-v)<9e3||Math.abs(oi(m[0].pts-y,x)-v)<20*h),m.forEach(function(z){z.pts=oi(z.pts-y,x)}),!n||v<0){if(m=m.filter(z=>z.pts>=0),!m.length)return;s===0?v=0:r&&!p?v=Math.max(0,x):v=m[0].pts}if(e.segmentCodec==="aac"){const z=this.config.maxAudioFramesDrift;for(let $=0,k=v;$<m.length;$++){const G=m[$],q=G.pts,ee=q-k,Q=Math.abs(1e3*ee/a);if(ee<=-z*h&&p)$===0&&(N.warn(`Audio frame @ ${(q/a).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*ee/a)} ms.`),this.nextAudioPts=v=k=q);else if(ee>=z*h&&Q<kx&&p){let ae=Math.round(ee/h);k=q-ae*h,k<0&&(ae--,k+=h),$===0&&(this.nextAudioPts=v=k),N.warn(`[mp4-remuxer]: Injecting ${ae} audio frame @ ${(k/a).toFixed(3)}s due to ${Math.round(1e3*ee/a)} ms gap.`);for(let V=0;V<ae;V++){const oe=Math.max(k,0);let ne=bh.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);ne||(N.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ne=G.unit.subarray()),m.splice($,0,{unit:ne,pts:oe}),k+=h,$++}}G.pts=k,k+=h}}let b=null,E=null,w,A=0,D=m.length;for(;D--;)A+=m[D].unit.byteLength;for(let z=0,$=m.length;z<$;z++){const k=m[z],G=k.unit;let q=k.pts;if(E!==null){const Q=d[z-1];Q.duration=Math.round((q-E)/l)}else if(n&&e.segmentCodec==="aac"&&(q=v),b=q,A>0){A+=g;try{w=new Uint8Array(A)}catch(Q){this.observer.emit(T.ERROR,T.ERROR,{type:Se.MUX_ERROR,details:Y.REMUX_ALLOC_ERROR,fatal:!1,error:Q,bytes:A,reason:`fail allocating audio mdat ${A}`});return}f||(new DataView(w.buffer).setUint32(0,A),w.set(H.types.mdat,4))}else return;w.set(G,g);const ee=G.byteLength;g+=ee,d.push(new _h(!0,c,ee,0)),E=q}const O=d.length;if(!O)return;const P=d[d.length-1];this.nextAudioPts=v=E+l*P.duration;const L=f?new Uint8Array(0):H.moof(e.sequenceNumber++,b/l,bt({},e,{samples:d}));e.samples=[];const C=b/a,U=v/a,K={data1:L,data2:w,startPTS:C,endPTS:U,startDTS:C,endDTS:U,type:"audio",hasAudio:!0,hasVideo:!1,nb:O};return this.isAudioContiguous=!0,K}remuxEmptyAudio(e,i,n,r){const s=e.inputTimeScale,a=e.samplerate?e.samplerate:s,o=s/a,l=this.nextAudioPts,c=this._initDTS,h=c.baseTime*9e4/c.timescale,u=(l!==null?l:r.startDTS*s)+h,f=r.endDTS*s+h,d=o*Th,p=Math.ceil((f-u)/d),m=bh.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(N.warn("[mp4-remuxer]: remux empty Audio"),!m){N.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const g=[];for(let v=0;v<p;v++){const x=u+v*d;g.push({unit:m,pts:x,dts:x})}return e.samples=g,this.remuxAudio(e,i,n,!1)}}function oi(t,e){let i;if(e===null)return t;for(e<t?i=-8589934592:i=8589934592;Math.abs(t-e)>4294967296;)t+=i;return t}function Bx(t){for(let e=0;e<t.length;e++)if(t[e].key)return e;return-1}function Tf(t,e,i,n){const r=t.samples.length;if(!r)return;const s=t.inputTimeScale;for(let o=0;o<r;o++){const l=t.samples[o];l.pts=oi(l.pts-i.baseTime*s/i.timescale,e*s)/s,l.dts=oi(l.dts-n.baseTime*s/n.timescale,e*s)/s}const a=t.samples;return t.samples=[],{samples:a}}function _f(t,e,i){const n=t.samples.length;if(!n)return;const r=t.inputTimeScale;for(let a=0;a<n;a++){const o=t.samples[a];o.pts=oi(o.pts-i.baseTime*r/i.timescale,e*r)/r}t.samples.sort((a,o)=>a.pts-o.pts);const s=t.samples;return t.samples=[],{samples:s}}class _h{constructor(e,i,n,r){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=i,this.size=n,this.cts=r,this.flags=new Ux(e)}}class Ux{constructor(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1}}class Gx{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,i,n,r){this.audioCodec=i,this.videoCodec=n,this.generateInitSegment(ay(e,r)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:i,videoCodec:n}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const r=this.initData=Zu(e);i||(i=wh(r.audio,Qe.AUDIO)),n||(n=wh(r.video,Qe.VIDEO));const s={};r.audio&&r.video?s.audiovideo={container:"video/mp4",codec:i+","+n,initSegment:e,id:"main"}:r.audio?s.audio={container:"audio/mp4",codec:i,initSegment:e,id:"audio"}:r.video?s.video={container:"video/mp4",codec:n,initSegment:e,id:"main"}:N.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s}remux(e,i,n,r,s,a){var o,l;let{initPTS:c,lastEndTime:h}=this;const u={audio:void 0,video:void 0,text:r,id3:n,initSegment:void 0};be(h)||(h=this.lastEndTime=s||0);const f=i.samples;if(!(f!=null&&f.length))return u;const d={initPTS:void 0,timescale:1};let p=this.initData;if((o=p)!=null&&o.length||(this.generateInitSegment(f),p=this.initData),!((l=p)!=null&&l.length))return N.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),u;this.emitInitSegment&&(d.tracks=this.initTracks,this.emitInitSegment=!1);const m=ly(f,p),g=oy(p,f),v=g===null?s:g;(Hx(c,v,s,m)||d.timescale!==c.timescale&&a)&&(d.initPTS=v-s,c&&c.timescale===1&&N.warn(`Adjusting initPTS by ${d.initPTS-c.baseTime}`),this.initPTS=c={baseTime:d.initPTS,timescale:1});const x=e?v-c.baseTime/c.timescale:h,y=x+m;hy(p,f,c.baseTime/c.timescale),m>0?this.lastEndTime=y:(N.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const b=!!p.audio,E=!!p.video;let w="";b&&(w+="audio"),E&&(w+="video");const A={data1:f,startPTS:x,startDTS:x,endPTS:y,endDTS:y,type:w,hasAudio:b,hasVideo:E,nb:1,dropped:0};return u.audio=A.type==="audio"?A:void 0,u.video=A.type!=="audio"?A:void 0,u.initSegment=d,u.id3=Tf(n,s,c,c),r.samples.length&&(u.text=_f(r,s,c)),u}}function Hx(t,e,i,n){if(t===null)return!0;const r=Math.max(n,1),s=e-t.baseTime/t.timescale;return Math.abs(s-i)>r}function wh(t,e){const i=t==null?void 0:t.codec;return i&&i.length>4?i:i==="hvc1"||i==="hev1"?"hvc1.1.6.L120.90":i==="av01"?"av01.0.04M.08":i==="avc1"||e===Qe.VIDEO?"avc1.42e01e":"mp4a.40.5"}let Ni;try{Ni=self.performance.now.bind(self.performance)}catch{N.debug("Unable to use Performance API on this environment"),Ni=typeof self<"u"&&self.Date.now}const no=[{demux:_x,remux:Gx},{demux:Ki,remux:io},{demux:bx,remux:io},{demux:Px,remux:io}];class Ah{constructor(e,i,n,r,s){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=i,this.config=n,this.vendor=r,this.id=s}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,i,n,r){const s=n.transmuxing;s.executeStart=Ni();let a=new Uint8Array(e);const{currentTransmuxState:o,transmuxConfig:l}=this;r&&(this.currentTransmuxState=r);const{contiguous:c,discontinuity:h,trackSwitch:u,accurateTimeOffset:f,timeOffset:d,initSegmentChange:p}=r||o,{audioCodec:m,videoCodec:g,defaultInitPts:v,duration:x,initSegmentData:y}=l,b=Vx(a,i);if(b&&b.method==="AES-128"){const D=this.getDecrypter();if(D.isSync()){let O=D.softwareDecrypt(a,b.key.buffer,b.iv.buffer);if(n.part>-1&&(O=D.flush()),!O)return s.executeEnd=Ni(),ro(n);a=new Uint8Array(O)}else return this.decryptionPromise=D.webCryptoDecrypt(a,b.key.buffer,b.iv.buffer).then(O=>{const P=this.push(O,null,n);return this.decryptionPromise=null,P}),this.decryptionPromise}const E=this.needsProbing(h,u);if(E){const D=this.configureTransmuxer(a);if(D)return N.warn(`[transmuxer] ${D.message}`),this.observer.emit(T.ERROR,T.ERROR,{type:Se.MEDIA_ERROR,details:Y.FRAG_PARSING_ERROR,fatal:!1,error:D,reason:D.message}),s.executeEnd=Ni(),ro(n)}(h||u||p||E)&&this.resetInitSegment(y,m,g,x,i),(h||p||E)&&this.resetInitialTimestamp(v),c||this.resetContiguity();const w=this.transmux(a,b,d,f,n),A=this.currentTransmuxState;return A.contiguous=!0,A.discontinuity=!1,A.trackSwitch=!1,s.executeEnd=Ni(),w}flush(e){const i=e.transmuxing;i.executeStart=Ni();const{decrypter:n,currentTransmuxState:r,decryptionPromise:s}=this;if(s)return s.then(()=>this.flush(e));const a=[],{timeOffset:o}=r;if(n){const u=n.flush();u&&a.push(this.push(u,null,e))}const{demuxer:l,remuxer:c}=this;if(!l||!c)return i.executeEnd=Ni(),[ro(e)];const h=l.flush(o);return As(h)?h.then(u=>(this.flushRemux(a,u,e),a)):(this.flushRemux(a,h,e),a)}flushRemux(e,i,n){const{audioTrack:r,videoTrack:s,id3Track:a,textTrack:o}=i,{accurateTimeOffset:l,timeOffset:c}=this.currentTransmuxState;N.log(`[transmuxer.ts]: Flushed fragment ${n.sn}${n.part>-1?" p: "+n.part:""} of level ${n.level}`);const h=this.remuxer.remux(r,s,a,o,c,l,!0,this.id);e.push({remuxResult:h,chunkMeta:n}),n.transmuxing.executeEnd=Ni()}resetInitialTimestamp(e){const{demuxer:i,remuxer:n}=this;!i||!n||(i.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:i}=this;!e||!i||(e.resetContiguity(),i.resetNextTimestamp())}resetInitSegment(e,i,n,r,s){const{demuxer:a,remuxer:o}=this;!a||!o||(a.resetInitSegment(e,i,n,r),o.resetInitSegment(e,i,n,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,i,n,r,s){let a;return i&&i.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,i,n,r,s):a=this.transmuxUnencrypted(e,n,r,s),a}transmuxUnencrypted(e,i,n,r){const{audioTrack:s,videoTrack:a,id3Track:o,textTrack:l}=this.demuxer.demux(e,i,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,a,o,l,i,n,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,i,n,r,s){return this.demuxer.demuxSampleAes(e,i,n).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,n,r,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:i,observer:n,typeSupported:r,vendor:s}=this;let a;for(let u=0,f=no.length;u<f;u++)if(no[u].demux.probe(e)){a=no[u];break}if(!a)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,l=this.remuxer,c=a.remux,h=a.demux;(!l||!(l instanceof c))&&(this.remuxer=new c(n,i,r,s)),(!o||!(o instanceof h))&&(this.demuxer=new h(n,i,r),this.probe=h.probe)}needsProbing(e,i){return!this.demuxer||!this.remuxer||e||i}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new jl(this.config)),e}}function Vx(t,e){let i=null;return t.byteLength>0&&e!=null&&e.key!=null&&e.iv!==null&&e.method!=null&&(i=e),i}const ro=t=>({remuxResult:{},chunkMeta:t});function As(t){return"then"in t&&t.then instanceof Function}class zx{constructor(e,i,n,r,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=i,this.initSegmentData=n,this.duration=r,this.defaultInitPts=s||null}}class Wx{constructor(e,i,n,r,s,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=i,this.accurateTimeOffset=n,this.trackSwitch=r,this.timeOffset=s,this.initSegmentChange=a}}var wf={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,i="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(i=!1));function r(l,c,h){this.fn=l,this.context=c,this.once=h||!1}function s(l,c,h,u,f){if(typeof h!="function")throw new TypeError("The listener must be a function");var d=new r(h,u||l,f),p=i?i+c:c;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],d]:l._events[p].push(d):(l._events[p]=d,l._eventsCount++),l}function a(l,c){--l._eventsCount===0?l._events=new n:delete l._events[c]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],h,u;if(this._eventsCount===0)return c;for(u in h=this._events)e.call(h,u)&&c.push(i?u.slice(1):u);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(h)):c},o.prototype.listeners=function(c){var h=i?i+c:c,u=this._events[h];if(!u)return[];if(u.fn)return[u.fn];for(var f=0,d=u.length,p=new Array(d);f<d;f++)p[f]=u[f].fn;return p},o.prototype.listenerCount=function(c){var h=i?i+c:c,u=this._events[h];return u?u.fn?1:u.length:0},o.prototype.emit=function(c,h,u,f,d,p){var m=i?i+c:c;if(!this._events[m])return!1;var g=this._events[m],v=arguments.length,x,y;if(g.fn){switch(g.once&&this.removeListener(c,g.fn,void 0,!0),v){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,h),!0;case 3:return g.fn.call(g.context,h,u),!0;case 4:return g.fn.call(g.context,h,u,f),!0;case 5:return g.fn.call(g.context,h,u,f,d),!0;case 6:return g.fn.call(g.context,h,u,f,d,p),!0}for(y=1,x=new Array(v-1);y<v;y++)x[y-1]=arguments[y];g.fn.apply(g.context,x)}else{var b=g.length,E;for(y=0;y<b;y++)switch(g[y].once&&this.removeListener(c,g[y].fn,void 0,!0),v){case 1:g[y].fn.call(g[y].context);break;case 2:g[y].fn.call(g[y].context,h);break;case 3:g[y].fn.call(g[y].context,h,u);break;case 4:g[y].fn.call(g[y].context,h,u,f);break;default:if(!x)for(E=1,x=new Array(v-1);E<v;E++)x[E-1]=arguments[E];g[y].fn.apply(g[y].context,x)}}return!0},o.prototype.on=function(c,h,u){return s(this,c,h,u,!1)},o.prototype.once=function(c,h,u){return s(this,c,h,u,!0)},o.prototype.removeListener=function(c,h,u,f){var d=i?i+c:c;if(!this._events[d])return this;if(!h)return a(this,d),this;var p=this._events[d];if(p.fn)p.fn===h&&(!f||p.once)&&(!u||p.context===u)&&a(this,d);else{for(var m=0,g=[],v=p.length;m<v;m++)(p[m].fn!==h||f&&!p[m].once||u&&p[m].context!==u)&&g.push(p[m]);g.length?this._events[d]=g.length===1?g[0]:g:a(this,d)}return this},o.prototype.removeAllListeners=function(c){var h;return c?(h=i?i+c:c,this._events[h]&&a(this,h)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,t.exports=o})(wf);var jx=wf.exports,ql=M0(jx);const so=Ra()||{isTypeSupported:()=>!1};class Af{constructor(e,i,n,r){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const s=e.config;this.hls=e,this.id=i,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=n,this.onFlush=r;const a=(c,h)=>{h=h||{},h.frag=this.frag,h.id=this.id,c===T.ERROR&&(this.error=h.error),this.hls.trigger(c,h)};this.observer=new ql,this.observer.on(T.FRAG_DECRYPTED,a),this.observer.on(T.ERROR,a);const o={mp4:so.isTypeSupported("video/mp4"),mpeg:so.isTypeSupported("audio/mpeg"),mp3:so.isTypeSupported('audio/mp4; codecs="mp3"')},l=navigator.vendor;if(this.useWorker&&typeof Worker<"u"&&(s.workerPath||fx())){try{s.workerPath?(N.log(`loading Web Worker ${s.workerPath} for "${i}"`),this.workerContext=px(s.workerPath)):(N.log(`injecting Web Worker for "${i}"`),this.workerContext=dx()),this.onwmsg=u=>this.onWorkerMessage(u);const{worker:h}=this.workerContext;h.addEventListener("message",this.onwmsg),h.onerror=u=>{const f=new Error(`${u.message}  (${u.filename}:${u.lineno})`);s.enableWorker=!1,N.warn(`Error in "${i}" Web Worker, fallback to inline`),this.hls.trigger(T.ERROR,{type:Se.OTHER_ERROR,details:Y.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:f})},h.postMessage({cmd:"init",typeSupported:o,vendor:l,id:i,config:JSON.stringify(s)})}catch(h){N.warn(`Error setting up "${i}" Web Worker, fallback to inline`,h),this.resetWorker(),this.error=null,this.transmuxer=new Ah(this.observer,o,s,l,i)}return}this.transmuxer=new Ah(this.observer,o,s,l,i)}resetWorker(){if(this.workerContext){const{worker:e,objectURL:i}=this.workerContext;i&&self.URL.revokeObjectURL(i),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const i=this.transmuxer;i&&(i.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,i,n,r,s,a,o,l,c,h){var u,f;c.transmuxing.start=self.performance.now();const{transmuxer:d}=this,p=a?a.start:s.start,m=s.decryptdata,g=this.frag,v=!(g&&s.cc===g.cc),x=!(g&&c.level===g.level),y=g?c.sn-g.sn:-1,b=this.part?c.part-this.part.index:-1,E=y===0&&c.id>1&&c.id===(g==null?void 0:g.stats.chunkCount),w=!x&&(y===1||y===0&&(b===1||E&&b<=0)),A=self.performance.now();(x||y||s.stats.parsing.start===0)&&(s.stats.parsing.start=A),a&&(b||!w)&&(a.stats.parsing.start=A);const D=!(g&&((u=s.initSegment)==null?void 0:u.url)===((f=g.initSegment)==null?void 0:f.url)),O=new Wx(v,w,l,x,p,D);if(!w||v||D){N.log(`[transmuxer-interface, ${s.type}]: Starting new transmux session for sn: ${c.sn} p: ${c.part} level: ${c.level} id: ${c.id}
        discontinuity: ${v}
        trackSwitch: ${x}
        contiguous: ${w}
        accurateTimeOffset: ${l}
        timeOffset: ${p}
        initSegmentChange: ${D}`);const P=new zx(n,r,i,o,h);this.configureTransmuxer(P)}if(this.frag=s,this.part=a,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:m,chunkMeta:c,state:O},e instanceof ArrayBuffer?[e]:[]);else if(d){const P=d.push(e,m,c,O);As(P)?(d.async=!0,P.then(L=>{this.handleTransmuxComplete(L)}).catch(L=>{this.transmuxerError(L,c,"transmuxer-interface push error")})):(d.async=!1,this.handleTransmuxComplete(P))}}flush(e){e.transmuxing.start=self.performance.now();const{transmuxer:i}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(i){let n=i.flush(e);As(n)||i.async?(As(n)||(n=Promise.resolve(n)),n.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")})):this.handleFlushResult(n,e)}}transmuxerError(e,i,n){this.hls&&(this.error=e,this.hls.trigger(T.ERROR,{type:Se.MEDIA_ERROR,details:Y.FRAG_PARSING_ERROR,chunkMeta:i,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,i){e.forEach(n=>{this.handleTransmuxComplete(n)}),this.onFlush(i)}onWorkerMessage(e){const i=e.data,n=this.hls;switch(i.event){case"init":{var r;const s=(r=this.workerContext)==null?void 0:r.objectURL;s&&self.URL.revokeObjectURL(s);break}case"transmuxComplete":{this.handleTransmuxComplete(i.data);break}case"flush":{this.onFlush(i.data);break}case"workerLog":N[i.data.logType]&&N[i.data.logType](i.data.message);break;default:{i.data=i.data||{},i.data.frag=this.frag,i.data.id=this.id,n.trigger(i.event,i.data);break}}}configureTransmuxer(e){const{transmuxer:i}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):i&&i.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const $x=250,ao=2,Yx=.1,Kx=.05;class Xx{constructor(e,i,n,r){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=i,this.fragmentTracker=n,this.hls=r}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,i){const{config:n,media:r,stalled:s}=this;if(r===null)return;const{currentTime:a,seeking:o}=r,l=this.seeking&&!o,c=!this.seeking&&o;if(this.seeking=o,a!==e){if(this.moved=!0,s!==null){if(this.stallReported){const v=self.performance.now()-s;N.warn(`playback not stuck anymore @${a}, after ${Math.round(v)}ms`),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if(c||l){this.stalled=null;return}if(r.paused&&!o||r.ended||r.playbackRate===0||!at.getBuffered(r).length)return;const h=at.bufferInfo(r,a,0),u=h.len>0,f=h.nextStart||0;if(!u&&!f)return;if(o){const v=h.len>ao,x=!f||i&&i.start<=a||f-a>ao&&!this.fragmentTracker.getPartialFragment(a);if(v||x)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var d;const v=Math.max(f,h.start||0)-a,x=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,b=(x==null||(d=x.details)==null?void 0:d.live)?x.details.targetduration*2:ao,E=this.fragmentTracker.getPartialFragment(a);if(v>0&&(v<=b||E)){this._trySkipBufferHole(E);return}}const p=self.performance.now();if(s===null){this.stalled=p;return}const m=p-s;if(!o&&m>=$x&&(this._reportStall(h),!this.media))return;const g=at.bufferInfo(r,a,n.maxBufferHole);this._tryFixBufferStall(g,m)}_tryFixBufferStall(e,i){const{config:n,fragmentTracker:r,media:s}=this;if(s===null)return;const a=s.currentTime,o=r.getPartialFragment(a);o&&(this._trySkipBufferHole(o)||!this.media)||(e.len>n.maxBufferHole||e.nextStart&&e.nextStart-a<n.maxBufferHole)&&i>n.highBufferWatchdogPeriod*1e3&&(N.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){const{hls:i,media:n,stallReported:r}=this;if(!r&&n){this.stallReported=!0;const s=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${JSON.stringify(e)})`);N.warn(s.message),i.trigger(T.ERROR,{type:Se.MEDIA_ERROR,details:Y.BUFFER_STALLED_ERROR,fatal:!1,error:s,buffer:e.len})}}_trySkipBufferHole(e){const{config:i,hls:n,media:r}=this;if(r===null)return 0;const s=r.currentTime,a=at.bufferInfo(r,s,0),o=s<a.start?a.start:a.nextStart;if(o){const l=a.len<=i.maxBufferHole,c=a.len>0&&a.len<1&&r.readyState<3,h=o-s;if(h>0&&(l||c)){if(h>i.maxBufferHole){const{fragmentTracker:f}=this;let d=!1;if(s===0){const p=f.getAppendedFrag(0,Me.MAIN);p&&o<p.end&&(d=!0)}if(!d){const p=e||f.getAppendedFrag(s,Me.MAIN);if(p){let m=!1,g=p.end;for(;g<o;){const v=f.getPartialFragment(g);if(v)g+=v.duration;else{m=!0;break}}if(m)return 0}}}const u=Math.max(o+Kx,s+Yx);if(N.warn(`skipping hole, adjusting currentTime from ${s} to ${u}`),this.moved=!0,this.stalled=null,r.currentTime=u,e&&!e.gap){const f=new Error(`fragment loaded with buffer holes, seeking from ${s} to ${u}`);n.trigger(T.ERROR,{type:Se.MEDIA_ERROR,details:Y.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:f,reason:f.message,frag:e})}return u}}return 0}_tryNudgeBuffer(){const{config:e,hls:i,media:n,nudgeRetry:r}=this;if(n===null)return;const s=n.currentTime;if(this.nudgeRetry++,r<e.nudgeMaxRetry){const a=s+(r+1)*e.nudgeOffset,o=new Error(`Nudging 'currentTime' from ${s} to ${a}`);N.warn(o.message),n.currentTime=a,i.trigger(T.ERROR,{type:Se.MEDIA_ERROR,details:Y.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1})}else{const a=new Error(`Playhead still not moving while enough data buffered @${s} after ${e.nudgeMaxRetry} nudges`);N.error(a.message),i.trigger(T.ERROR,{type:Se.MEDIA_ERROR,details:Y.BUFFER_STALLED_ERROR,error:a,fatal:!0})}}}const qx=100;class Zx extends $l{constructor(e,i,n){super(e,i,n,"[stream-controller]",Me.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.LEVEL_LOADING,this.onLevelLoading,this),e.on(T.LEVEL_LOADED,this.onLevelLoaded,this),e.on(T.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(T.ERROR,this.onError,this),e.on(T.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(T.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(T.BUFFER_CREATED,this.onBufferCreated,this),e.on(T.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(T.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(T.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.LEVEL_LOADED,this.onLevelLoaded,this),e.off(T.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(T.ERROR,this.onError,this),e.off(T.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(T.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(T.BUFFER_CREATED,this.onBufferCreated,this),e.off(T.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(T.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(T.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),this.onMediaDetaching()}startLoad(e){if(this.levels){const{lastCurrentTime:i,hls:n}=this;if(this.stopLoad(),this.setInterval(qx),this.level=-1,!this.startFragRequested){let r=n.startLevel;r===-1&&(n.config.testBandwidth&&this.levels.length>1?(r=0,this.bitrateTest=!0):r=n.nextAutoLevel),this.level=n.nextLoadLevel=r,this.loadedmetadata=!1}i>0&&e===-1&&(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i),this.state=Z.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=Z.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case Z.WAITING_LEVEL:{var e;const{levels:n,level:r}=this,s=n==null||(e=n[r])==null?void 0:e.details;if(s&&(!s.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(s))break;this.state=Z.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=Z.IDLE;break}break}case Z.FRAG_LOADING_WAITING_RETRY:{var i;const n=self.performance.now(),r=this.retryDate;(!r||n>=r||(i=this.media)!=null&&i.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=Z.IDLE)}break}this.state===Z.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:i,levels:n,media:r}=this,{config:s,nextLoadLevel:a}=e;if(i===null||!r&&(this.startFragRequested||!s.startFragPrefetch)||this.altAudio&&this.audioOnly||!(n!=null&&n[a]))return;const o=n[a],l=this.getMainFwdBufferInfo();if(l===null)return;const c=this.getLevelDetails();if(c&&this._streamEnded(l,c)){const g={};this.altAudio&&(g.type="video"),this.hls.trigger(T.BUFFER_EOS,g),this.state=Z.ENDED;return}e.loadLevel!==a&&e.manualLevel===-1&&this.log(`Adapting to level ${a} from level ${this.level}`),this.level=e.nextLoadLevel=a;const h=o.details;if(!h||this.state===Z.WAITING_LEVEL||h.live&&this.levelLastLoaded!==a){this.level=a,this.state=Z.WAITING_LEVEL;return}const u=l.len,f=this.getMaxBufferLength(o.maxBitrate);if(u>=f)return;this.backtrackFragment&&this.backtrackFragment.start>l.end&&(this.backtrackFragment=null);const d=this.backtrackFragment?this.backtrackFragment.start:l.end;let p=this.getNextFragment(d,h);if(this.couldBacktrack&&!this.fragPrevious&&p&&p.sn!=="initSegment"&&this.fragmentTracker.getState(p)!==At.OK){var m;const v=((m=this.backtrackFragment)!=null?m:p).sn-h.startSN,x=h.fragments[v-1];x&&p.cc===x.cc&&(p=x,this.fragmentTracker.removeFragment(x))}else this.backtrackFragment&&l.len&&(this.backtrackFragment=null);if(p&&this.isLoopLoading(p,d)){if(!p.gap){const v=this.audioOnly&&!this.altAudio?Qe.AUDIO:Qe.VIDEO,x=(v===Qe.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;x&&this.afterBufferFlushed(x,v,Me.MAIN)}p=this.getNextFragmentLoopLoading(p,h,l,Me.MAIN,f)}p&&(p.initSegment&&!p.initSegment.data&&!this.bitrateTest&&(p=p.initSegment),this.loadFragment(p,o,d))}loadFragment(e,i,n){const r=this.fragmentTracker.getState(e);this.fragCurrent=e,r===At.NOT_LOADED||r===At.PARTIAL?e.sn==="initSegment"?this._loadInitSegment(e,i):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,i)):(this.startFragRequested=!0,super.loadFragment(e,i,n)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Me.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:i}=this;if(i!=null&&i.readyState){let n;const r=this.getAppendedFrag(i.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const o=this.getMainFwdBufferInfo();if(!o||o.len<s.targetduration*2)return}if(!i.paused&&e){const o=this.hls.nextLoadLevel,l=e[o],c=this.fragLastKbps;c&&this.fragCurrent?n=this.fragCurrent.duration*l.maxBitrate/(1e3*c)+1:n=0}else n=0;const a=this.getBufferedFrag(i.currentTime+n);if(a){const o=this.followingBufferedFrag(a);if(o){this.abortCurrentFrag();const l=o.maxStartPTS?o.maxStartPTS:o.start,c=o.duration,h=Math.max(a.end,l+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*.5),c*.75));this.flushMainBuffer(h,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Z.KEY_LOADING:case Z.FRAG_LOADING:case Z.FRAG_LOADING_WAITING_RETRY:case Z.PARSING:case Z.PARSED:this.state=Z.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,i){super.flushMainBuffer(e,i,this.altAudio?"video":null)}onMediaAttached(e,i){super.onMediaAttached(e,i);const n=i.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),n.addEventListener("playing",this.onvplaying),n.addEventListener("seeked",this.onvseeked),this.gapController=new Xx(this.config,n,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const e=this.media,i=e?e.currentTime:null;be(i)&&this.log(`Media seeked to ${i.toFixed(3)}`);const n=this.getMainFwdBufferInfo();if(n===null||n.len===0){this.warn(`Main forward buffer length on "seeked" event ${n?n.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(T.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1}onManifestParsed(e,i){let n=!1,r=!1,s;i.levels.forEach(a=>{s=a.audioCodec,s&&(s.indexOf("mp4a.40.2")!==-1&&(n=!0),s.indexOf("mp4a.40.5")!==-1&&(r=!0))}),this.audioCodecSwitch=n&&r&&!ux(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=i.levels,this.startFragRequested=!1}onLevelLoading(e,i){const{levels:n}=this;if(!n||this.state!==Z.IDLE)return;const r=n[i.level];(!r.details||r.details.live&&this.levelLastLoaded!==i.level||this.waitForCdnTuneIn(r.details))&&(this.state=Z.WAITING_LEVEL)}onLevelLoaded(e,i){var n;const{levels:r}=this,s=i.level,a=i.details,o=a.totalduration;if(!r){this.warn(`Levels were reset while loading level ${s}`);return}this.log(`Level ${s} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${o}`);const l=r[s],c=this.fragCurrent;c&&(this.state===Z.FRAG_LOADING||this.state===Z.FRAG_LOADING_WAITING_RETRY)&&(c.level!==i.level||c.urlId!==l.urlId)&&c.loader&&this.abortCurrentFrag();let h=0;if(a.live||(n=l.details)!=null&&n.live){if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;h=this.alignPlaylists(a,l.details)}if(l.details=a,this.levelLastLoaded=s,this.hls.trigger(T.LEVEL_UPDATED,{details:a,level:s}),this.state===Z.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=Z.IDLE}this.startFragRequested?a.live&&this.synchronizeToLiveEdge(a):this.setStartPosition(a,h),this.tick()}_handleFragmentLoadProgress(e){var i;const{frag:n,part:r,payload:s}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const o=a[n.level],l=o.details;if(!l){this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),this.fragmentTracker.removeFragment(n);return}const c=o.videoCodec,h=l.PTSKnown||!l.live,u=(i=n.initSegment)==null?void 0:i.data,f=this._getAudioCodec(o),d=this.transmuxer=this.transmuxer||new Af(this.hls,Me.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=r?r.index:-1,m=p!==-1,g=new zl(n.level,n.sn,n.stats.chunkCount,s.byteLength,p,m),v=this.initPTS[n.cc];d.push(s,u,f,c,n,r,l.totalduration,h,g,v)}onAudioTrackSwitching(e,i){const n=this.altAudio;if(!!!i.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const s=this.hls;n&&(s.trigger(T.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),s.trigger(T.AUDIO_TRACK_SWITCHED,i)}}onAudioTrackSwitched(e,i){const n=i.id,r=!!this.hls.audioTracks[n].url;if(r){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=r,this.tick()}onBufferCreated(e,i){const n=i.tracks;let r,s,a=!1;for(const o in n){const l=n[o];if(l.id==="main"){if(s=o,r=l,o==="video"){const c=n[o];c&&(this.videoBuffer=c.buffer)}}else a=!0}a&&r?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,i){const{frag:n,part:r}=i;if(n&&n.type!==Me.MAIN)return;if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${r?" p: "+r.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),this.state===Z.PARSED&&(this.state=Z.IDLE);return}const s=r?r.stats:n.stats;this.fragLastKbps=Math.round(8*s.total/(s.buffering.end-s.loading.first)),n.sn!=="initSegment"&&(this.fragPrevious=n),this.fragBufferedComplete(n,r)}onError(e,i){var n;if(i.fatal){this.state=Z.ERROR;return}switch(i.details){case Y.FRAG_GAP:case Y.FRAG_PARSING_ERROR:case Y.FRAG_DECRYPT_ERROR:case Y.FRAG_LOAD_ERROR:case Y.FRAG_LOAD_TIMEOUT:case Y.KEY_LOAD_ERROR:case Y.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Me.MAIN,i);break;case Y.LEVEL_LOAD_ERROR:case Y.LEVEL_LOAD_TIMEOUT:case Y.LEVEL_PARSING_ERROR:!i.levelRetry&&this.state===Z.WAITING_LEVEL&&((n=i.context)==null?void 0:n.type)===je.LEVEL&&(this.state=Z.IDLE);break;case Y.BUFFER_FULL_ERROR:if(!i.parent||i.parent!=="main")return;this.reduceLengthAndFlushBuffer(i)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case Y.INTERNAL_EXCEPTION:this.recoverWorkerError(i);break}}checkBuffer(){const{media:e,gapController:i}=this;if(!(!e||!i||!e.readyState)){if(this.loadedmetadata||!at.getBuffered(e).length){const n=this.state!==Z.IDLE?this.fragCurrent:null;i.poll(this.lastCurrentTime,n)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=Z.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:i}){if(i!==Qe.AUDIO||this.audioOnly&&!this.altAudio){const n=(i===Qe.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(n,i,Me.MAIN)}}onLevelsUpdated(e,i){this.levels=i.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const i=e.currentTime;let n=this.startPosition;if(n>=0&&i<n){if(e.seeking){this.log(`could not seek to ${n}, already seeking at ${i}`);return}const r=at.getBuffered(e),a=(r.length?r.start(0):0)-n;a>0&&(a<this.config.maxBufferHole||a<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${a} to match buffer start`),n+=a,this.startPosition=n),this.log(`seek to target start position ${n} from current time ${i}`),e.currentTime=n}}_getAudioCodec(e){let i=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&i&&(this.log("Swapping audio codec"),i.indexOf("mp4a.40.5")!==-1?i="mp4a.40.2":i="mp4a.40.5"),i}_loadBitrateTestFrag(e,i){e.bitrateTest=!0,this._doFragLoad(e,i).then(n=>{const{hls:r}=this;if(!n||this.fragContextChanged(e))return;i.fragmentError=0,this.state=Z.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const s=e.stats;s.parsing.start=s.parsing.end=s.buffering.start=s.buffering.end=self.performance.now(),r.trigger(T.FRAG_LOADED,n),e.bitrateTest=!1})}_handleTransmuxComplete(e){var i;const n="main",{hls:r}=this,{remuxResult:s,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:l,part:c,level:h}=o,{video:u,text:f,id3:d,initSegment:p}=s,{details:m}=h,g=this.altAudio?void 0:s.audio;if(this.fragContextChanged(l)){this.fragmentTracker.removeFragment(l);return}if(this.state=Z.PARSING,p){if(p!=null&&p.tracks){const y=l.initSegment||l;this._bufferInitSegment(h,p.tracks,y,a),r.trigger(T.FRAG_PARSING_INIT_SEGMENT,{frag:y,id:n,tracks:p.tracks})}const v=p.initPTS,x=p.timescale;be(v)&&(this.initPTS[l.cc]={baseTime:v,timescale:x},r.trigger(T.INIT_PTS_FOUND,{frag:l,id:n,initPTS:v,timescale:x}))}if(u&&m&&l.sn!=="initSegment"){const v=m.fragments[l.sn-1-m.startSN],x=l.sn===m.startSN,y=!v||l.cc>v.cc;if(s.independent!==!1){const{startPTS:b,endPTS:E,startDTS:w,endDTS:A}=u;if(c)c.elementaryStreams[u.type]={startPTS:b,endPTS:E,startDTS:w,endDTS:A};else if(u.firstKeyFrame&&u.independent&&a.id===1&&!y&&(this.couldBacktrack=!0),u.dropped&&u.independent){const D=this.getMainFwdBufferInfo(),O=(D?D.end:this.getLoadPosition())+this.config.maxBufferHole,P=u.firstKeyFramePTS?u.firstKeyFramePTS:b;if(!x&&O<P-this.config.maxBufferHole&&!y){this.backtrack(l);return}else y&&(l.gap=!0);l.setElementaryStreamInfo(u.type,l.start,E,l.start,A,!0)}l.setElementaryStreamInfo(u.type,b,E,w,A),this.backtrackFragment&&(this.backtrackFragment=l),this.bufferFragmentData(u,l,c,a,x||y)}else if(x||y)l.gap=!0;else{this.backtrack(l);return}}if(g){const{startPTS:v,endPTS:x,startDTS:y,endDTS:b}=g;c&&(c.elementaryStreams[Qe.AUDIO]={startPTS:v,endPTS:x,startDTS:y,endDTS:b}),l.setElementaryStreamInfo(Qe.AUDIO,v,x,y,b),this.bufferFragmentData(g,l,c,a)}if(m&&d!=null&&(i=d.samples)!=null&&i.length){const v={id:n,frag:l,details:m,samples:d.samples};r.trigger(T.FRAG_PARSING_METADATA,v)}if(m&&f){const v={id:n,frag:l,details:m,samples:f.samples};r.trigger(T.FRAG_PARSING_USERDATA,v)}}_bufferInitSegment(e,i,n,r){if(this.state!==Z.PARSING)return;this.audioOnly=!!i.audio&&!i.video,this.altAudio&&!this.audioOnly&&delete i.audio;const{audio:s,video:a,audiovideo:o}=i;if(s){let l=e.audioCodec;const c=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(l&&(l.indexOf("mp4a.40.5")!==-1?l="mp4a.40.2":l="mp4a.40.5"),s.metadata.channelCount!==1&&c.indexOf("firefox")===-1&&(l="mp4a.40.5")),c.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(l="mp4a.40.2",this.log(`Android: force audio codec to ${l}`)),e.audioCodec&&e.audioCodec!==l&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${l}"`),s.levelCodec=l,s.id="main",this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${l||""}/${e.audioCodec||""}/${s.codec}]`)}a&&(a.levelCodec=e.videoCodec,a.id="main",this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${a.codec}]`)),o&&this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${e.attrs.CODECS||""}/${o.codec}]`),this.hls.trigger(T.BUFFER_CODECS,i),Object.keys(i).forEach(l=>{const h=i[l].initSegment;h!=null&&h.byteLength&&this.hls.trigger(T.BUFFER_APPENDING,{type:l,data:h,frag:n,part:null,chunkMeta:r,parent:n.type})}),this.tick()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,Me.MAIN)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Z.IDLE}checkFragmentChanged(){const e=this.media;let i=null;if(e&&e.readyState>1&&e.seeking===!1){const n=e.currentTime;if(at.isBuffered(e,n)?i=this.getAppendedFrag(n):at.isBuffered(e,n+.1)&&(i=this.getAppendedFrag(n+.1)),i){this.backtrackFragment=null;const r=this.fragPlaying,s=i.level;(!r||i.sn!==r.sn||r.level!==s||i.urlId!==r.urlId)&&(this.fragPlaying=i,this.hls.trigger(T.FRAG_CHANGED,{frag:i}),(!r||r.level!==s)&&this.hls.trigger(T.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){const e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){const e=this.media;if(e){const i=e.currentTime,n=this.currentFrag;if(n&&be(i)&&be(n.programDateTime)){const r=n.programDateTime+(i-n.start)*1e3;return new Date(r)}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class Rn{constructor(e,i=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=i,this.totalWeight_=n}sample(e,i){const n=Math.pow(this.alpha_,e);this.estimate_=i*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class Jx{constructor(e,i,n,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Rn(e),this.fast_=new Rn(i),this.defaultTTFB_=r,this.ttfb_=new Rn(e)}update(e,i){const{slow_:n,fast_:r,ttfb_:s}=this;n.halfLife!==e&&(this.slow_=new Rn(e,n.getEstimate(),n.getTotalWeight())),r.halfLife!==i&&(this.fast_=new Rn(i,r.getEstimate(),r.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new Rn(e,s.getEstimate(),s.getTotalWeight()))}sample(e,i){e=Math.max(e,this.minDelayMs_);const n=8*i,r=e/1e3,s=n/r;this.fast_.sample(r,s),this.slow_.sample(r,s)}sampleTTFB(e){const i=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(i,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}class Qx{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;const i=e.config;this.bwEstimator=new Jx(i.abrEwmaSlowVoD,i.abrEwmaFastVoD,i.abrEwmaDefaultEstimate),this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(T.FRAG_LOADING,this.onFragLoading,this),e.on(T.FRAG_LOADED,this.onFragLoaded,this),e.on(T.FRAG_BUFFERED,this.onFragBuffered,this),e.on(T.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(T.LEVEL_LOADED,this.onLevelLoaded,this)}unregisterListeners(){const{hls:e}=this;e.off(T.FRAG_LOADING,this.onFragLoading,this),e.off(T.FRAG_LOADED,this.onFragLoaded,this),e.off(T.FRAG_BUFFERED,this.onFragBuffered,this),e.off(T.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(T.LEVEL_LOADED,this.onLevelLoaded,this)}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null}onFragLoading(e,i){var n;const r=i.frag;this.ignoreFragment(r)||(this.fragCurrent=r,this.partCurrent=(n=i.part)!=null?n:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))}onLevelSwitching(e,i){this.clearTimer()}getTimeToLoadFrag(e,i,n,r){const s=e+n/i,a=r?this.lastLevelLoadSec:0;return s+a}onLevelLoaded(e,i){const n=this.hls.config,{total:r,bwEstimate:s}=i.stats;be(r)&&be(s)&&(this.lastLevelLoadSec=8*r/s),i.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD)}_abandonRulesCheck(){const{fragCurrent:e,partCurrent:i,hls:n}=this,{autoLevelEnabled:r,media:s}=n;if(!e||!s)return;const a=performance.now(),o=i?i.stats:e.stats,l=i?i.duration:e.duration,c=a-o.loading.start;if(o.aborted||o.loaded&&o.loaded===o.total||e.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!r||s.paused||!s.playbackRate||!s.readyState)return;const h=n.mainForwardBufferInfo;if(h===null)return;const u=this.bwEstimator.getEstimateTTFB(),f=Math.abs(s.playbackRate);if(c<=Math.max(u,1e3*(l/(f*2))))return;const d=h.len/f;if(d>=2*l/f)return;const p=o.loading.first?o.loading.first-o.loading.start:-1,m=o.loaded&&p>-1,g=this.bwEstimator.getEstimate(),{levels:v,minAutoLevel:x}=n,y=v[e.level],b=o.total||Math.max(o.loaded,Math.round(l*y.maxBitrate/8));let E=c-p;E<1&&m&&(E=Math.min(c,o.loaded*8/g));const w=m?o.loaded*1e3/E:0,A=w?(b-o.loaded)/w:b*8/g+u/1e3;if(A<=d)return;const D=w?w*8:g;let O=Number.POSITIVE_INFINITY,P;for(P=e.level-1;P>x;P--){const L=v[P].maxBitrate;if(O=this.getTimeToLoadFrag(u/1e3,D,l*L,!v[P].details),O<d)break}O>=A||O>l*10||(n.nextLoadLevel=P,m?this.bwEstimator.sample(c-Math.min(u,p),o.loaded):this.bwEstimator.sampleTTFB(c),this.clearTimer(),N.warn(`[abr] Fragment ${e.sn}${i?" part "+i.index:""} of level ${e.level} is loading too slowly;
      Time to underbuffer: ${d.toFixed(3)} s
      Estimated load time for current fragment: ${A.toFixed(3)} s
      Estimated load time for down switch fragment: ${O.toFixed(3)} s
      TTFB estimate: ${p}
      Current BW estimate: ${be(g)?(g/1024).toFixed(3):"Unknown"} Kb/s
      New BW estimate: ${(this.bwEstimator.getEstimate()/1024).toFixed(3)} Kb/s
      Aborting and switching to level ${P}`),e.loader&&(this.fragCurrent=this.partCurrent=null,e.abortRequests()),n.trigger(T.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:i,stats:o}))}onFragLoaded(e,{frag:i,part:n}){const r=n?n.stats:i.stats;if(i.type===Me.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(i)){if(this.clearTimer(),this.lastLoadedFragLevel=i.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){const s=n?n.duration:i.duration,a=this.hls.levels[i.level],o=(a.loaded?a.loaded.bytes:0)+r.loaded,l=(a.loaded?a.loaded.duration:0)+s;a.loaded={bytes:o,duration:l},a.realBitrate=Math.round(8*o/l)}if(i.bitrateTest){const s={stats:r,frag:i,part:n,id:i.type};this.onFragBuffered(T.FRAG_BUFFERED,s),i.bitrateTest=!1}}}onFragBuffered(e,i){const{frag:n,part:r}=i,s=r!=null&&r.stats.loaded?r.stats:n.stats;if(s.aborted||this.ignoreFragment(n))return;const a=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,s.loaded),s.bwEstimate=this.bwEstimator.getEstimate(),n.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Me.MAIN||e.sn==="initSegment"}clearTimer(){self.clearInterval(this.timer)}get nextAutoLevel(){const e=this._nextAutoLevel,i=this.bwEstimator;if(e!==-1&&!i.canEstimate())return e;let n=this.getNextABRAutoLevel();if(e!==-1){const r=this.hls.levels;if(r.length>Math.max(e,n)&&r[e].loadError<=r[n].loadError)return e}return e!==-1&&(n=Math.min(e,n)),n}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:i,hls:n}=this,{maxAutoLevel:r,config:s,minAutoLevel:a,media:o}=n,l=i?i.duration:e?e.duration:0,c=o&&o.playbackRate!==0?Math.abs(o.playbackRate):1,h=this.bwEstimator?this.bwEstimator.getEstimate():s.abrEwmaDefaultEstimate,u=n.mainForwardBufferInfo,f=(u?u.len:0)/c;let d=this.findBestLevel(h,a,r,f,s.abrBandWidthFactor,s.abrBandWidthUpFactor);if(d>=0)return d;N.trace(`[abr] ${f?"rebuffering expected":"buffer is empty"}, finding optimal quality level`);let p=l?Math.min(l,s.maxStarvationDelay):s.maxStarvationDelay,m=s.abrBandWidthFactor,g=s.abrBandWidthUpFactor;if(!f){const v=this.bitrateTestDelay;v&&(p=(l?Math.min(l,s.maxLoadingDelay):s.maxLoadingDelay)-v,N.trace(`[abr] bitrate test took ${Math.round(1e3*v)}ms, set first fragment max fetchDuration to ${Math.round(1e3*p)} ms`),m=g=1)}return d=this.findBestLevel(h,a,r,f+p,m,g),Math.max(d,0)}findBestLevel(e,i,n,r,s,a){var o;const{fragCurrent:l,partCurrent:c,lastLoadedFragLevel:h}=this,{levels:u}=this.hls,f=u[h],d=!!(f!=null&&(o=f.details)!=null&&o.live),p=f==null?void 0:f.codecSet,m=c?c.duration:l?l.duration:0,g=this.bwEstimator.getEstimateTTFB()/1e3;let v=i,x=-1;for(let y=n;y>=i;y--){const b=u[y];if(!b||p&&b.codecSet!==p){b&&(v=Math.min(y,v),x=Math.max(y,x));continue}x!==-1&&N.trace(`[abr] Skipped level(s) ${v}-${x} with CODECS:"${u[x].attrs.CODECS}"; not compatible with "${f.attrs.CODECS}"`);const E=b.details,w=(c?E==null?void 0:E.partTarget:E==null?void 0:E.averagetargetduration)||m;let A;y<=h?A=s*e:A=a*e;const D=u[y].maxBitrate,O=this.getTimeToLoadFrag(g,A,D*w,E===void 0);if(N.trace(`[abr] level:${y} adjustedbw-bitrate:${Math.round(A-D)} avgDuration:${w.toFixed(1)} maxFetchDuration:${r.toFixed(1)} fetchDuration:${O.toFixed(1)}`),A>D&&(O===0||!be(O)||d&&!this.bitrateTestDelay||O<r))return y}return-1}set nextAutoLevel(e){this._nextAutoLevel=e}}class Sf{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:i}=this;let n;if(e.length)e.length===1?n=e[0]:n=eE(e,i);else return new Uint8Array(0);return this.reset(),n}reset(){this.chunks.length=0,this.dataLength=0}}function eE(t,e){const i=new Uint8Array(e);let n=0;for(let r=0;r<t.length;r++){const s=t[r];i.set(s,n),n+=s.length}return i}const Sh=100;class tE extends $l{constructor(e,i,n){super(e,i,n,"[audio-stream-controller]",Me.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:e}=this;e.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.LEVEL_LOADED,this.onLevelLoaded,this),e.on(T.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(T.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(T.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(T.ERROR,this.onError,this),e.on(T.BUFFER_RESET,this.onBufferReset,this),e.on(T.BUFFER_CREATED,this.onBufferCreated,this),e.on(T.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(T.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(T.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.LEVEL_LOADED,this.onLevelLoaded,this),e.off(T.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(T.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(T.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(T.ERROR,this.onError,this),e.off(T.BUFFER_RESET,this.onBufferReset,this),e.off(T.BUFFER_CREATED,this.onBufferCreated,this),e.off(T.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(T.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(T.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:i,id:n,initPTS:r,timescale:s}){if(n==="main"){const a=i.cc;this.initPTS[i.cc]={baseTime:r,timescale:s},this.log(`InitPTS for cc: ${a} found from main: ${r}`),this.videoTrackCC=a,this.state===Z.WAITING_INIT_PTS&&this.tick()}}startLoad(e){if(!this.levels){this.startPosition=e,this.state=Z.STOPPED;return}const i=this.lastCurrentTime;this.stopLoad(),this.setInterval(Sh),i>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i,this.state=Z.IDLE):(this.loadedmetadata=!1,this.state=Z.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case Z.IDLE:this.doTickIdle();break;case Z.WAITING_TRACK:{var e;const{levels:n,trackId:r}=this,s=n==null||(e=n[r])==null?void 0:e.details;if(s){if(this.waitForCdnTuneIn(s))break;this.state=Z.WAITING_INIT_PTS}break}case Z.FRAG_LOADING_WAITING_RETRY:{var i;const n=performance.now(),r=this.retryDate;(!r||n>=r||(i=this.media)!=null&&i.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=Z.IDLE);break}case Z.WAITING_INIT_PTS:{const n=this.waitingData;if(n){const{frag:r,part:s,cache:a,complete:o}=n;if(this.initPTS[r.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=Z.FRAG_LOADING;const l=a.flush(),c={frag:r,part:s,payload:l,networkDetails:null};this._handleFragmentLoadProgress(c),o&&super._handleFragmentLoadComplete(c)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${r.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const l=this.getLoadPosition(),c=at.bufferInfo(this.mediaBuffer,l,this.config.maxBufferHole);vl(c.end,this.config.maxFragLookUpTolerance,r)<0&&(this.log(`Waiting fragment cc (${r.cc}) @ ${r.start} cancelled because another fragment at ${c.end} is needed`),this.clearWaitingFragment())}}else this.state=Z.IDLE}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=Z.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){const{hls:e,levels:i,media:n,trackId:r}=this,s=e.config;if(!(i!=null&&i[r])||!n&&(this.startFragRequested||!s.startFragPrefetch))return;const a=i[r],o=a.details;if(!o||o.live&&this.levelLastLoaded!==r||this.waitForCdnTuneIn(o)){this.state=Z.WAITING_TRACK;return}const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,Qe.AUDIO,Me.AUDIO));const c=this.getFwdBufferInfo(l,Me.AUDIO);if(c===null)return;const{bufferedTrack:h,switchingTrack:u}=this;if(!u&&this._streamEnded(c,o)){e.trigger(T.BUFFER_EOS,{type:"audio"}),this.state=Z.ENDED;return}const f=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,Me.MAIN),d=c.len,p=this.getMaxBufferLength(f==null?void 0:f.len);if(d>=p&&!u)return;const g=o.fragments[0].start;let v=c.end;if(u&&n){const E=this.getLoadPosition();h&&u.attrs!==h.attrs&&(v=E),o.PTSKnown&&E<g&&(c.end>g||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=g+.05)}let x=this.getNextFragment(v,o),y=!1;if(x&&this.isLoopLoading(x,v)&&(y=!!x.gap,x=this.getNextFragmentLoopLoading(x,o,c,Me.MAIN,p)),!x){this.bufferFlushed=!0;return}const b=f&&x.start>f.end+o.targetduration;if(b||!(f!=null&&f.len)&&c.len){const E=this.getAppendedFrag(x.start,Me.MAIN);if(E===null||(y||(y=!!E.gap||!!b&&f.len===0),b&&!y||y&&c.nextStart&&c.nextStart<E.end))return}this.loadFragment(x,a,v)}getMaxBufferLength(e){const i=super.getMaxBufferLength();return e?Math.min(Math.max(i,e),this.config.maxMaxBufferLength):i}onMediaDetaching(){this.videoBuffer=null,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:i}){this.resetTransmuxer(),this.levels=i.map(n=>new ns(n))}onAudioTrackSwitching(e,i){const n=!!i.url;this.trackId=i.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),n?this.setInterval(Sh):this.resetTransmuxer(),n?(this.switchingTrack=i,this.state=Z.IDLE):(this.switchingTrack=null,this.bufferedTrack=i,this.state=Z.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,i){this.mainDetails=i.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(T.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,i){var n;if(this.mainDetails==null){this.cachedTrackLoadedData=i;return}const{levels:r}=this,{details:s,id:a}=i;if(!r){this.warn(`Audio tracks were reset while loading level ${a}`);return}this.log(`Track ${a} loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const o=r[a];let l=0;if(s.live||(n=o.details)!=null&&n.live){this.checkLiveUpdate(s);const c=this.mainDetails;if(s.deltaUpdateFailed||!c)return;!o.details&&s.hasProgramDateTime&&c.hasProgramDateTime?(hf(s,c),l=s.fragments[0].start):l=this.alignPlaylists(s,o.details)}o.details=s,this.levelLastLoaded=a,!this.startFragRequested&&(this.mainDetails||!s.live)&&this.setStartPosition(o.details,l),this.state===Z.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=Z.IDLE),this.tick()}_handleFragmentLoadProgress(e){var i;const{frag:n,part:r,payload:s}=e,{config:a,trackId:o,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const c=l[o];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const h=c.details;if(!h){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}const u=a.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new Af(this.hls,Me.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const d=this.initPTS[n.cc],p=(i=n.initSegment)==null?void 0:i.data;if(d!==void 0){const g=r?r.index:-1,v=g!==-1,x=new zl(n.level,n.sn,n.stats.chunkCount,s.byteLength,g,v);f.push(s,p,u,"",n,r,h.totalduration,!1,x,d)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${h.startSN} ,${h.endSN}],track ${o}`);const{cache:m}=this.waitingData=this.waitingData||{frag:n,part:r,cache:new Sf,complete:!1};m.push(new Uint8Array(s)),this.waitingVideoCC=this.videoTrackCC,this.state=Z.WAITING_INIT_PTS}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,i){const n=i.tracks.audio;n&&(this.mediaBuffer=n.buffer||null),i.tracks.video&&(this.videoBuffer=i.tracks.video.buffer||null)}onFragBuffered(e,i){const{frag:n,part:r}=i;if(n.type!==Me.AUDIO){if(!this.loadedmetadata&&n.type===Me.MAIN){const s=this.videoBuffer||this.media;s&&at.getBuffered(s).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${r?" p: "+r.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(n.sn!=="initSegment"){this.fragPrevious=n;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(T.AUDIO_TRACK_SWITCHED,zt({},s)))}this.fragBufferedComplete(n,r)}onError(e,i){var n;if(i.fatal){this.state=Z.ERROR;return}switch(i.details){case Y.FRAG_GAP:case Y.FRAG_PARSING_ERROR:case Y.FRAG_DECRYPT_ERROR:case Y.FRAG_LOAD_ERROR:case Y.FRAG_LOAD_TIMEOUT:case Y.KEY_LOAD_ERROR:case Y.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Me.AUDIO,i);break;case Y.AUDIO_TRACK_LOAD_ERROR:case Y.AUDIO_TRACK_LOAD_TIMEOUT:case Y.LEVEL_PARSING_ERROR:!i.levelRetry&&this.state===Z.WAITING_TRACK&&((n=i.context)==null?void 0:n.type)===je.AUDIO_TRACK&&(this.state=Z.IDLE);break;case Y.BUFFER_FULL_ERROR:if(!i.parent||i.parent!=="audio")return;this.reduceLengthAndFlushBuffer(i)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Y.INTERNAL_EXCEPTION:this.recoverWorkerError(i);break}}onBufferFlushed(e,{type:i}){i===Qe.AUDIO&&(this.bufferFlushed=!0,this.state===Z.ENDED&&(this.state=Z.IDLE))}_handleTransmuxComplete(e){var i;const n="audio",{hls:r}=this,{remuxResult:s,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:l,part:c,level:h}=o,{details:u}=h,{audio:f,text:d,id3:p,initSegment:m}=s;if(this.fragContextChanged(l)||!u){this.fragmentTracker.removeFragment(l);return}if(this.state=Z.PARSING,this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),m!=null&&m.tracks){const g=l.initSegment||l;this._bufferInitSegment(m.tracks,g,a),r.trigger(T.FRAG_PARSING_INIT_SEGMENT,{frag:g,id:n,tracks:m.tracks})}if(f){const{startPTS:g,endPTS:v,startDTS:x,endDTS:y}=f;c&&(c.elementaryStreams[Qe.AUDIO]={startPTS:g,endPTS:v,startDTS:x,endDTS:y}),l.setElementaryStreamInfo(Qe.AUDIO,g,v,x,y),this.bufferFragmentData(f,l,c,a)}if(p!=null&&(i=p.samples)!=null&&i.length){const g=bt({id:n,frag:l,details:u},p);r.trigger(T.FRAG_PARSING_METADATA,g)}if(d){const g=bt({id:n,frag:l,details:u},d);r.trigger(T.FRAG_PARSING_USERDATA,g)}}_bufferInitSegment(e,i,n){if(this.state!==Z.PARSING)return;e.video&&delete e.video;const r=e.audio;if(!r)return;r.levelCodec=r.codec,r.id="audio",this.log(`Init audio buffer, container:${r.container}, codecs[parsed]=[${r.codec}]`),this.hls.trigger(T.BUFFER_CODECS,e);const s=r.initSegment;if(s!=null&&s.byteLength){const a={type:"audio",frag:i,part:null,chunkMeta:n,parent:i.type,data:s};this.hls.trigger(T.BUFFER_APPENDING,a)}this.tick()}loadFragment(e,i,n){const r=this.fragmentTracker.getState(e);if(this.fragCurrent=e,this.switchingTrack||r===At.NOT_LOADED||r===At.PARTIAL){var s;e.sn==="initSegment"?this._loadInitSegment(e,i):(s=i.details)!=null&&s.live&&!this.initPTS[e.cc]?(this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=Z.WAITING_INIT_PTS):(this.startFragRequested=!0,super.loadFragment(e,i,n))}else this.clearTrackerIfNeeded(e)}completeAudioSwitch(e){const{hls:i,media:n,bufferedTrack:r}=this,s=r==null?void 0:r.attrs,a=e.attrs;n&&s&&(s.CHANNELS!==a.CHANNELS||s.NAME!==a.NAME||s.LANGUAGE!==a.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=e,this.switchingTrack=null,i.trigger(T.AUDIO_TRACK_SWITCHED,zt({},e))}}class iE extends Vl{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.LEVEL_LOADING,this.onLevelLoading,this),e.on(T.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(T.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(T.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.LEVEL_LOADING,this.onLevelLoading,this),e.off(T.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(T.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(T.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,i){this.tracks=i.audioTracks||[]}onAudioTrackLoaded(e,i){const{id:n,groupId:r,details:s}=i,a=this.tracksInGroup[n];if(!a||a.groupId!==r){this.warn(`Track with id:${n} and group:${r} not found in active group ${a.groupId}`);return}const o=a.details;a.details=i.details,this.log(`audio-track ${n} "${a.name}" lang:${a.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),n===this.trackId&&this.playlistLoaded(n,i,o)}onLevelLoading(e,i){this.switchLevel(i.level)}onLevelSwitching(e,i){this.switchLevel(i.level)}switchLevel(e){const i=this.hls.levels[e];if(!(i!=null&&i.audioGroupIds))return;const n=i.audioGroupIds[i.urlId];if(this.groupId!==n){this.groupId=n||null;const r=this.tracks.filter(a=>!n||a.groupId===n);this.selectDefaultTrack&&!r.some(a=>a.default)&&(this.selectDefaultTrack=!1),this.tracksInGroup=r;const s={audioTracks:r};this.log(`Updating audio tracks, ${r.length} track(s) found in group:${n}`),this.hls.trigger(T.AUDIO_TRACKS_UPDATED,s),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}onError(e,i){i.fatal||!i.context||i.context.type===je.AUDIO_TRACK&&i.context.id===this.trackId&&i.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(i))}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioTrack(e){const i=this.tracksInGroup;if(e<0||e>=i.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();const n=this.currentTrack;i[this.trackId];const r=i[e],{groupId:s,name:a}=r;if(this.log(`Switching to audio-track ${e} "${a}" lang:${r.lang} group:${s}`),this.trackId=e,this.currentTrack=r,this.selectDefaultTrack=!1,this.hls.trigger(T.AUDIO_TRACK_SWITCHING,zt({},r)),r.details&&!r.details.live)return;const o=this.switchParams(r.url,n==null?void 0:n.details);this.loadPlaylist(o)}selectInitialTrack(){const e=this.tracksInGroup,i=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(i!==-1)this.setAudioTrack(i);else{const n=new Error(`No track found for running audio group-ID: ${this.groupId} track count: ${e.length}`);this.warn(n.message),this.hls.trigger(T.ERROR,{type:Se.MEDIA_ERROR,details:Y.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:n})}}findTrackId(e){const i=this.tracksInGroup;for(let n=0;n<i.length;n++){const r=i[n];if((!this.selectDefaultTrack||r.default)&&(!e||e.attrs["STABLE-RENDITION-ID"]!==void 0&&e.attrs["STABLE-RENDITION-ID"]===r.attrs["STABLE-RENDITION-ID"]||e.name===r.name&&e.lang===r.lang))return r.id}return-1}loadPlaylist(e){super.loadPlaylist();const i=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(i)){const n=i.id,r=i.groupId;let s=i.url;if(e)try{s=e.addDirectives(s)}catch(a){this.warn(`Could not construct new URL with HLS Delivery Directives: ${a}`)}this.log(`loading audio-track playlist ${n} "${i.name}" lang:${i.lang} group:${r}`),this.clearTimer(),this.hls.trigger(T.AUDIO_TRACK_LOADING,{url:s,id:n,groupId:r,deliveryDirectives:e||null})}}}function Lf(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!nE(t[i].attrs,e[i].attrs))return!1;return!0}function nE(t,e){const i=t["STABLE-RENDITION-ID"];return i?i===e["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some(n=>t[n]!==e[n])}const Lh=500;class rE extends $l{constructor(e,i,n){super(e,i,n,"[subtitle-stream-controller]",Me.SUBTITLE),this.levels=[],this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null}_registerListeners(){const{hls:e}=this;e.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.LEVEL_LOADED,this.onLevelLoaded,this),e.on(T.ERROR,this.onError,this),e.on(T.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(T.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(T.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(T.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(T.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(T.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.LEVEL_LOADED,this.onLevelLoaded,this),e.off(T.ERROR,this.onError,this),e.off(T.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(T.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(T.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(T.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(T.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(T.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=Z.IDLE,this.setInterval(Lh),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,i){this.mainDetails=i.details}onSubtitleFragProcessed(e,i){const{frag:n,success:r}=i;if(this.fragPrevious=n,this.state=Z.IDLE,!r)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let a;const o=n.start;for(let c=0;c<s.length;c++)if(o>=s[c].start&&o<=s[c].end){a=s[c];break}const l=n.start+n.duration;a?a.end=l:(a={start:o,end:l},s.push(a)),this.fragmentTracker.fragBuffered(n)}onBufferFlushing(e,i){const{startOffset:n,endOffset:r}=i;if(n===0&&r!==Number.POSITIVE_INFINITY){const s=r-1;if(s<=0)return;i.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(a=>{for(let o=0;o<a.length;){if(a[o].end<=s){a.shift();continue}else if(a[o].start<s)a[o].start=s;else break;o++}}),this.fragmentTracker.removeFragmentsInRange(n,s,Me.SUBTITLE)}}onFragBuffered(e,i){if(!this.loadedmetadata&&i.frag.type===Me.MAIN){var n;(n=this.media)!=null&&n.buffered.length&&(this.loadedmetadata=!0)}}onError(e,i){const n=i.frag;(n==null?void 0:n.type)===Me.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Z.STOPPED&&(this.state=Z.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:i}){if(Lf(this.levels,i)){this.levels=i.map(n=>new ns(n));return}this.tracksBuffered=[],this.levels=i.map(n=>{const r=new ns(n);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Me.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,i){if(this.currentTrackId=i.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}const n=this.levels[this.currentTrackId];n!=null&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.setInterval(Lh)}onSubtitleTrackLoaded(e,i){var n;const{details:r,id:s}=i,{currentTrackId:a,levels:o}=this;if(!o.length)return;const l=o[a];if(s>=o.length||s!==a||!l)return;this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(r.live||(n=l.details)!=null&&n.live){const h=this.mainDetails;if(r.deltaUpdateFailed||!h)return;const u=h.fragments[0];l.details?(c=this.alignPlaylists(r,l.details),c===0&&u&&(c=u.start,gl(r,c))):r.hasProgramDateTime&&h.hasProgramDateTime?(hf(r,h),c=r.fragments[0].start):u&&(c=u.start,gl(r,c))}l.details=r,this.levelLastLoaded=s,!this.startFragRequested&&(this.mainDetails||!r.live)&&this.setStartPosition(l.details,c),this.tick(),r.live&&!this.fragCurrent&&this.media&&this.state===Z.IDLE&&(rs(null,r.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0))}_handleFragmentLoadComplete(e){const{frag:i,payload:n}=e,r=i.decryptdata,s=this.hls;if(!this.fragContextChanged(i)&&n&&n.byteLength>0&&r&&r.key&&r.iv&&r.method==="AES-128"){const a=performance.now();this.decrypter.decrypt(new Uint8Array(n),r.key.buffer,r.iv.buffer).catch(o=>{throw s.trigger(T.ERROR,{type:Se.MEDIA_ERROR,details:Y.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:i}),o}).then(o=>{const l=performance.now();s.trigger(T.FRAG_DECRYPTED,{frag:i,payload:o,stats:{tstart:a,tdecrypt:l}})}).catch(o=>{this.warn(`${o.name}: ${o.message}`),this.state=Z.IDLE})}}doTick(){if(!this.media){this.state=Z.IDLE;return}if(this.state===Z.IDLE){const{currentTrackId:e,levels:i}=this,n=i[e];if(!i.length||!n||!n.details)return;const{config:r}=this,s=this.getLoadPosition(),a=at.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,r.maxBufferHole),{end:o,len:l}=a,c=this.getFwdBufferInfo(this.media,Me.MAIN),h=n.details,u=this.getMaxBufferLength(c==null?void 0:c.len)+h.levelTargetDuration;if(l>u)return;const f=h.fragments,d=f.length,p=h.edge;let m=null;const g=this.fragPrevious;if(o<p){const v=r.maxFragLookUpTolerance,x=o>p-v?0:v;m=rs(g,f,Math.max(f[0].start,o),x),!m&&g&&g.start<f[0].start&&(m=f[0])}else m=f[d-1];if(!m)return;if(m=this.mapToInitFragWhenRequired(m),m.sn!=="initSegment"){const v=m.sn-h.startSN,x=f[v-1];x&&x.cc===m.cc&&this.fragmentTracker.getState(x)===At.NOT_LOADED&&(m=x)}this.fragmentTracker.getState(m)===At.NOT_LOADED&&this.loadFragment(m,n,o)}}getMaxBufferLength(e){const i=super.getMaxBufferLength();return e?Math.max(i,e):i}loadFragment(e,i,n){this.fragCurrent=e,e.sn==="initSegment"?this._loadInitSegment(e,i):(this.startFragRequested=!0,super.loadFragment(e,i,n))}get mediaBufferTimeRanges(){return new sE(this.tracksBuffered[this.currentTrackId]||[])}}class sE{constructor(e){this.buffered=void 0;const i=(n,r,s)=>{if(r=r>>>0,r>s-1)throw new DOMException(`Failed to execute '${n}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${s})`);return e[r][n]};this.buffered={get length(){return e.length},end(n){return i("end",n,e.length)},start(n){return i("start",n,e.length)}}}}class aE extends Vl{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.trackChangeListener=()=>this.onTextTracksChanged(),this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}registerListeners(){const{hls:e}=this;e.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.LEVEL_LOADING,this.onLevelLoading,this),e.on(T.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(T.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(T.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.LEVEL_LOADING,this.onLevelLoading,this),e.off(T.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(T.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(T.ERROR,this.onError,this)}onMediaAttached(e,i){this.media=i.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),oo(this.media.textTracks).forEach(i=>{Pn(i)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,i){this.tracks=i.subtitleTracks}onSubtitleTrackLoaded(e,i){const{id:n,details:r}=i,{trackId:s}=this,a=this.tracksInGroup[s];if(!a){this.warn(`Invalid subtitle track id ${n}`);return}const o=a.details;a.details=i.details,this.log(`subtitle track ${n} loaded [${r.startSN}-${r.endSN}]`),n===this.trackId&&this.playlistLoaded(n,i,o)}onLevelLoading(e,i){this.switchLevel(i.level)}onLevelSwitching(e,i){this.switchLevel(i.level)}switchLevel(e){const i=this.hls.levels[e];if(!(i!=null&&i.textGroupIds))return;const n=i.textGroupIds[i.urlId],r=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==n){const s=this.tracks.filter(l=>!n||l.groupId===n);this.tracksInGroup=s;const a=this.findTrackId(r==null?void 0:r.name)||this.findTrackId();this.groupId=n||null;const o={subtitleTracks:s};this.log(`Updating subtitle tracks, ${s.length} track(s) found in "${n}" group-id`),this.hls.trigger(T.SUBTITLE_TRACKS_UPDATED,o),a!==-1&&this.setSubtitleTrack(a,r)}else this.shouldReloadPlaylist(r)&&this.setSubtitleTrack(this.trackId,r)}findTrackId(e){const i=this.tracksInGroup;for(let n=0;n<i.length;n++){const r=i[n];if((!this.selectDefaultTrack||r.default)&&(!e||e===r.name))return r.id}return-1}onError(e,i){i.fatal||!i.context||i.context.type===je.SUBTITLE_TRACK&&i.context.id===this.trackId&&i.context.groupId===this.groupId&&this.checkRetry(i)}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1;const i=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,i)}loadPlaylist(e){super.loadPlaylist();const i=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(i)){const n=i.id,r=i.groupId;let s=i.url;if(e)try{s=e.addDirectives(s)}catch(a){this.warn(`Could not construct new URL with HLS Delivery Directives: ${a}`)}this.log(`Loading subtitle playlist for id ${n}`),this.hls.trigger(T.SUBTITLE_TRACK_LOADING,{url:s,id:n,groupId:r,deliveryDirectives:e||null})}}toggleTrackModes(e){const{media:i,trackId:n}=this;if(!i)return;const r=oo(i.textTracks),s=r.filter(o=>o.groupId===this.groupId);if(e===-1)[].slice.call(r).forEach(o=>{o.mode="disabled"});else{const o=s[n];o&&(o.mode="disabled")}const a=s[e];a&&(a.mode=this.subtitleDisplay?"showing":"hidden")}setSubtitleTrack(e,i){var n;const r=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(this.trackId!==e&&this.toggleTrackModes(e),this.trackId===e&&(e===-1||(n=r[e])!=null&&n.details)||e<-1||e>=r.length)return;this.clearTimer();const s=r[e];if(this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:"")),this.trackId=e,s){const{id:a,groupId:o="",name:l,type:c,url:h}=s;this.hls.trigger(T.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:l,type:c,url:h});const u=this.switchParams(s.url,i==null?void 0:i.details);this.loadPlaylist(u)}else this.hls.trigger(T.SUBTITLE_TRACK_SWITCH,{id:e})}onTextTracksChanged(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=-1;const i=oo(this.media.textTracks);for(let n=0;n<i.length;n++)if(i[n].mode==="hidden")e=n;else if(i[n].mode==="showing"){e=n;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}}function oo(t){const e=[];for(let i=0;i<t.length;i++){const n=t[i];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&e.push(t[i])}return e}class oE{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,i){const n=this.queues[i];n.push(e),n.length===1&&this.buffers[i]&&this.executeNext(i)}insertAbort(e,i){this.queues[i].unshift(e),this.executeNext(i)}appendBlocker(e){let i;const n=new Promise(s=>{i=s}),r={execute:i,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(r,e),n}executeNext(e){const{buffers:i,queues:n}=this,r=i[e],s=n[e];if(s.length){const a=s[0];try{a.execute()}catch(o){N.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),a.onError(o),r!=null&&r.updating||(s.shift(),this.executeNext(e))}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}const Mh=Ra(),Rh=/([ha]vc.)(?:\.[^.,]+)+/;class lE{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=()=>{const{media:i,mediaSource:n}=this;N.log("[buffer-controller]: Media source opened"),i&&(i.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(T.MEDIA_ATTACHED,{media:i})),n&&n.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{N.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=()=>{N.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=()=>{const{media:i,_objectUrl:n}=this;i&&i.src!==n&&N.error(`Media element src was set while attaching MediaSource (${n} > ${i.src})`)},this.hls=e,this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null}registerListeners(){const{hls:e}=this;e.on(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.BUFFER_RESET,this.onBufferReset,this),e.on(T.BUFFER_APPENDING,this.onBufferAppending,this),e.on(T.BUFFER_CODECS,this.onBufferCodecs,this),e.on(T.BUFFER_EOS,this.onBufferEos,this),e.on(T.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(T.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(T.FRAG_PARSED,this.onFragParsed,this),e.on(T.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:e}=this;e.off(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.BUFFER_RESET,this.onBufferReset,this),e.off(T.BUFFER_APPENDING,this.onBufferAppending,this),e.off(T.BUFFER_CODECS,this.onBufferCodecs,this),e.off(T.BUFFER_EOS,this.onBufferEos,this),e.off(T.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(T.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(T.FRAG_PARSED,this.onFragParsed,this),e.off(T.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new oE(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,i){let n=2;(i.audio&&!i.video||!i.altAudio)&&(n=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=n,N.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,i){const n=this.media=i.media;if(n&&Mh){const r=this.mediaSource=new Mh;r.addEventListener("sourceopen",this._onMediaSourceOpen),r.addEventListener("sourceended",this._onMediaSourceEnded),r.addEventListener("sourceclose",this._onMediaSourceClose),n.src=self.URL.createObjectURL(r),this._objectUrl=n.src,n.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:e,mediaSource:i,_objectUrl:n}=this;if(i){if(N.log("[buffer-controller]: media source detaching"),i.readyState==="open")try{i.endOfStream()}catch(r){N.warn(`[buffer-controller]: onMediaDetaching: ${r.message} while calling endOfStream`)}this.onBufferReset(),i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(e.removeEventListener("emptied",this._onMediaEmptied),n&&self.URL.revokeObjectURL(n),e.src===n?(e.removeAttribute("src"),e.load()):N.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(T.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(e=>{const i=this.sourceBuffer[e];try{i&&(this.removeBufferListeners(e),this.mediaSource&&this.mediaSource.removeSourceBuffer(i),this.sourceBuffer[e]=void 0)}catch(n){N.warn(`[buffer-controller]: Failed to reset the ${e} buffer`,n)}}),this._initSourceBuffer()}onBufferCodecs(e,i){const n=this.getSourceBufferTypes().length;Object.keys(i).forEach(r=>{if(n){const s=this.tracks[r];if(s&&typeof s.buffer.changeType=="function"){const{id:a,codec:o,levelCodec:l,container:c,metadata:h}=i[r],u=(s.levelCodec||s.codec).replace(Rh,"$1"),f=(l||o).replace(Rh,"$1");if(u!==f){const d=`${c};codecs=${l||o}`;this.appendChangeType(r,d),N.log(`[buffer-controller]: switching codec ${u} to ${f}`),this.tracks[r]={buffer:s.buffer,codec:o,container:c,levelCodec:l,metadata:h,id:a}}}}else this.pendingTracks[r]=i[r]}),!n&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())}appendChangeType(e,i){const{operationQueue:n}=this,r={execute:()=>{const s=this.sourceBuffer[e];s&&(N.log(`[buffer-controller]: changing ${e} sourceBuffer type to ${i}`),s.changeType(i)),n.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:s=>{N.warn(`[buffer-controller]: Failed to change ${e} SourceBuffer type`,s)}};n.append(r,e)}onBufferAppending(e,i){const{hls:n,operationQueue:r,tracks:s}=this,{data:a,type:o,frag:l,part:c,chunkMeta:h}=i,u=h.buffering[o],f=self.performance.now();u.start=f;const d=l.stats.buffering,p=c?c.stats.buffering:null;d.start===0&&(d.start=f),p&&p.start===0&&(p.start=f);const m=s.audio;let g=!1;o==="audio"&&(m==null?void 0:m.container)==="audio/mpeg"&&(g=!this.lastMpegAudioChunk||h.id===1||this.lastMpegAudioChunk.sn!==h.sn,this.lastMpegAudioChunk=h);const v=l.start,x={execute:()=>{if(u.executeStart=self.performance.now(),g){const y=this.sourceBuffer[o];if(y){const b=v-y.timestampOffset;Math.abs(b)>=.1&&(N.log(`[buffer-controller]: Updating audio SourceBuffer timestampOffset to ${v} (delta: ${b}) sn: ${l.sn})`),y.timestampOffset=v)}}this.appendExecutor(a,o)},onStart:()=>{},onComplete:()=>{const y=self.performance.now();u.executeEnd=u.end=y,d.first===0&&(d.first=y),p&&p.first===0&&(p.first=y);const{sourceBuffer:b}=this,E={};for(const w in b)E[w]=at.getBuffered(b[w]);this.appendError=0,this.hls.trigger(T.BUFFER_APPENDED,{type:o,frag:l,part:c,chunkMeta:h,parent:l.type,timeRanges:E})},onError:y=>{N.error(`[buffer-controller]: Error encountered while trying to append to the ${o} SourceBuffer`,y);const b={type:Se.MEDIA_ERROR,parent:l.type,details:Y.BUFFER_APPEND_ERROR,frag:l,part:c,chunkMeta:h,error:y,err:y,fatal:!1};y.code===DOMException.QUOTA_EXCEEDED_ERR?b.details=Y.BUFFER_FULL_ERROR:(this.appendError++,b.details=Y.BUFFER_APPEND_ERROR,this.appendError>n.config.appendErrorMaxRetry&&(N.error(`[buffer-controller]: Failed ${n.config.appendErrorMaxRetry} times to append segment in sourceBuffer`),b.fatal=!0)),n.trigger(T.ERROR,b)}};r.append(x,o)}onBufferFlushing(e,i){const{operationQueue:n}=this,r=s=>({execute:this.removeExecutor.bind(this,s,i.startOffset,i.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(T.BUFFER_FLUSHED,{type:s})},onError:a=>{N.warn(`[buffer-controller]: Failed to remove from ${s} SourceBuffer`,a)}});i.type?n.append(r(i.type),i.type):this.getSourceBufferTypes().forEach(s=>{n.append(r(s),s)})}onFragParsed(e,i){const{frag:n,part:r}=i,s=[],a=r?r.elementaryStreams:n.elementaryStreams;a[Qe.AUDIOVIDEO]?s.push("audiovideo"):(a[Qe.AUDIO]&&s.push("audio"),a[Qe.VIDEO]&&s.push("video"));const o=()=>{const l=self.performance.now();n.stats.buffering.end=l,r&&(r.stats.buffering.end=l);const c=r?r.stats:n.stats;this.hls.trigger(T.FRAG_BUFFERED,{frag:n,part:r,stats:c,id:n.type})};s.length===0&&N.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(o,s)}onFragChanged(e,i){this.flushBackBuffer()}onBufferEos(e,i){this.getSourceBufferTypes().reduce((r,s)=>{const a=this.sourceBuffer[s];return a&&(!i.type||i.type===s)&&(a.ending=!0,a.ended||(a.ended=!0,N.log(`[buffer-controller]: ${s} sourceBuffer now EOS`))),r&&!!(!a||a.ended)},!0)&&(N.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(s=>{const a=this.sourceBuffer[s];a&&(a.ending=!1)});const{mediaSource:r}=this;if(!r||r.readyState!=="open"){r&&N.info(`[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: ${r.readyState}`);return}N.log("[buffer-controller]: Calling mediaSource.endOfStream()"),r.endOfStream()}))}onLevelUpdated(e,{details:i}){i.fragments.length&&(this.details=i,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}flushBackBuffer(){const{hls:e,details:i,media:n,sourceBuffer:r}=this;if(!n||i===null)return;const s=this.getSourceBufferTypes();if(!s.length)return;const a=i.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(!be(a)||a<0)return;const o=n.currentTime,l=i.levelTargetDuration,c=Math.max(a,l),h=Math.floor(o/l)*l-c;s.forEach(u=>{const f=r[u];if(f){const d=at.getBuffered(f);if(d.length>0&&h>d.start(0)){if(e.trigger(T.BACK_BUFFER_REACHED,{bufferEnd:h}),i.live)e.trigger(T.LIVE_BACK_BUFFER_REACHED,{bufferEnd:h});else if(f.ended&&d.end(d.length-1)-o<l*2){N.info(`[buffer-controller]: Cannot flush ${u} back buffer while SourceBuffer is in ended state`);return}e.trigger(T.BUFFER_FLUSHING,{startOffset:0,endOffset:h,type:u})}}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:e,hls:i,media:n,mediaSource:r}=this,s=e.fragments[0].start+e.totalduration,a=n.duration,o=be(r.duration)?r.duration:0;e.live&&i.config.liveDurationInfinity?(N.log("[buffer-controller]: Media Source duration is set to Infinity"),r.duration=1/0,this.updateSeekableRange(e)):(s>o&&s>a||!be(a))&&(N.log(`[buffer-controller]: Updating Media Source duration to ${s.toFixed(3)}`),r.duration=s)}updateSeekableRange(e){const i=this.mediaSource,n=e.fragments;if(n.length&&e.live&&i!=null&&i.setLiveSeekableRange){const s=Math.max(0,n[0].start),a=Math.max(s,s+e.totalduration);i.setLiveSeekableRange(s,a)}}checkPendingTracks(){const{bufferCodecEventsExpected:e,operationQueue:i,pendingTracks:n}=this,r=Object.keys(n).length;if(r&&!e||r===2){this.createSourceBuffers(n),this.pendingTracks={};const s=this.getSourceBufferTypes();if(s.length)this.hls.trigger(T.BUFFER_CREATED,{tracks:this.tracks}),s.forEach(a=>{i.executeNext(a)});else{const a=new Error("could not create source buffer for media codec(s)");this.hls.trigger(T.ERROR,{type:Se.MEDIA_ERROR,details:Y.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:a,reason:a.message})}}}createSourceBuffers(e){const{sourceBuffer:i,mediaSource:n}=this;if(!n)throw Error("createSourceBuffers called when mediaSource was null");for(const r in e)if(!i[r]){const s=e[r];if(!s)throw Error(`source buffer exists for track ${r}, however track does not`);const a=s.levelCodec||s.codec,o=`${s.container};codecs=${a}`;N.log(`[buffer-controller]: creating sourceBuffer(${o})`);try{const l=i[r]=n.addSourceBuffer(o),c=r;this.addBufferListener(c,"updatestart",this._onSBUpdateStart),this.addBufferListener(c,"updateend",this._onSBUpdateEnd),this.addBufferListener(c,"error",this._onSBUpdateError),this.tracks[r]={buffer:l,codec:a,container:s.container,levelCodec:s.levelCodec,metadata:s.metadata,id:s.id}}catch(l){N.error(`[buffer-controller]: error while trying to add sourceBuffer: ${l.message}`),this.hls.trigger(T.ERROR,{type:Se.MEDIA_ERROR,details:Y.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:l,mimeType:o})}}}_onSBUpdateStart(e){const{operationQueue:i}=this;i.current(e).onStart()}_onSBUpdateEnd(e){const{operationQueue:i}=this;i.current(e).onComplete(),i.shiftAndExecuteNext(e)}_onSBUpdateError(e,i){const n=new Error(`${e} SourceBuffer error`);N.error(`[buffer-controller]: ${n}`,i),this.hls.trigger(T.ERROR,{type:Se.MEDIA_ERROR,details:Y.BUFFER_APPENDING_ERROR,error:n,fatal:!1});const r=this.operationQueue.current(e);r&&r.onError(i)}removeExecutor(e,i,n){const{media:r,mediaSource:s,operationQueue:a,sourceBuffer:o}=this,l=o[e];if(!r||!s||!l){N.warn(`[buffer-controller]: Attempting to remove from the ${e} SourceBuffer, but it does not exist`),a.shiftAndExecuteNext(e);return}const c=be(r.duration)?r.duration:1/0,h=be(s.duration)?s.duration:1/0,u=Math.max(0,i),f=Math.min(n,c,h);f>u&&!l.ending?(l.ended=!1,N.log(`[buffer-controller]: Removing [${u},${f}] from the ${e} SourceBuffer`),l.remove(u,f)):a.shiftAndExecuteNext(e)}appendExecutor(e,i){const{operationQueue:n,sourceBuffer:r}=this,s=r[i];if(!s){N.warn(`[buffer-controller]: Attempting to append to the ${i} SourceBuffer, but it does not exist`),n.shiftAndExecuteNext(i);return}s.ended=!1,s.appendBuffer(e)}blockBuffers(e,i=this.getSourceBufferTypes()){if(!i.length){N.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}const{operationQueue:n}=this,r=i.map(s=>n.appendBlocker(s));Promise.all(r).then(()=>{e(),i.forEach(s=>{const a=this.sourceBuffer[s];a!=null&&a.updating||n.shiftAndExecuteNext(s)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,i,n){const r=this.sourceBuffer[e];if(!r)return;const s=n.bind(this,e);this.listeners[e].push({event:i,listener:s}),r.addEventListener(i,s)}removeBufferListeners(e){const i=this.sourceBuffer[e];i&&this.listeners[e].forEach(n=>{i.removeEventListener(n.event,n.listener)})}}const Ih={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Mf=function(e){let i=e;return Ih.hasOwnProperty(e)&&(i=Ih[e]),String.fromCharCode(i)},di=15,Fi=100,cE={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},hE={17:2,18:4,21:6,22:8,23:10,19:13,20:15},uE={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},fE={25:2,26:4,29:6,30:8,31:10,27:13,28:15},dE=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class pE{constructor(){this.time=null,this.verboseLevel=0}log(e,i){if(this.verboseLevel>=e){const n=typeof i=="function"?i():i;N.log(`${this.time} [${e}] ${n}`)}}}const on=function(e){const i=[];for(let n=0;n<e.length;n++)i.push(e[n].toString(16));return i};class Rf{constructor(e,i,n,r,s){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=i||!1,this.italics=n||!1,this.background=r||"black",this.flash=s||!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const i=["foreground","underline","italics","background","flash"];for(let n=0;n<i.length;n++){const r=i[n];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class mE{constructor(e,i,n,r,s,a){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new Rf(i,n,r,s,a)}reset(){this.uchar=" ",this.penState.reset()}setChar(e,i){this.uchar=e,this.penState.copy(i)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class gE{constructor(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(let i=0;i<Fi;i++)this.chars.push(new mE);this.logger=e,this.pos=0,this.currPenState=new Rf}equals(e){let i=!0;for(let n=0;n<Fi;n++)if(!this.chars[n].equals(e.chars[n])){i=!1;break}return i}copy(e){for(let i=0;i<Fi;i++)this.chars[i].copy(e.chars[i])}isEmpty(){let e=!0;for(let i=0;i<Fi;i++)if(!this.chars[i].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Fi&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Fi)}moveCursor(e){const i=this.pos+e;if(e>1)for(let n=this.pos+1;n<i+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(i)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const i=Mf(e);if(this.pos>=Fi){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+i+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(i,this.currPenState),this.moveCursor(1)}clearFromPos(e){let i;for(i=e;i<Fi;i++)this.chars[i].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let i=!0;for(let n=0;n<Fi;n++){const r=this.chars[n].uchar;r!==" "&&(i=!1),e.push(r)}return i?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class lo{constructor(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(let i=0;i<di;i++)this.rows.push(new gE(e));this.logger=e,this.currRow=di-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}reset(){for(let e=0;e<di;e++)this.rows[e].clear();this.currRow=di-1}equals(e){let i=!0;for(let n=0;n<di;n++)if(!this.rows[n].equals(e.rows[n])){i=!1;break}return i}copy(e){for(let i=0;i<di;i++)this.rows[i].copy(e.rows[i])}isEmpty(){let e=!0;for(let i=0;i<di;i++)if(!this.rows[i].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+JSON.stringify(e));let i=e.row-1;if(this.nrRollUpRows&&i<this.nrRollUpRows-1&&(i=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==i){for(let o=0;o<di;o++)this.rows[o].clear();const s=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const o=a.rows[s].cueStartTime,l=this.logger.time;if(o&&l!==null&&o<l)for(let c=0;c<this.nrRollUpRows;c++)this.rows[i-this.nrRollUpRows+c+1].copy(a.rows[s+c])}}this.currRow=i;const n=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,a=Math.max(s-1,0);n.setCursor(e.indent),e.color=n.chars[a].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,i=this.rows.splice(e,1)[0];i.clear(),this.rows.splice(this.currRow,0,i),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const i=[];let n="",r=-1;for(let s=0;s<di;s++){const a=this.rows[s].getTextString();a&&(r=s+1,e?i.push("Row "+r+": '"+a+"'"):i.push(a.trim()))}return i.length>0&&(e?n="["+i.join(" | ")+"]":n=i.join(`
`)),n}getTextAndFormat(){return this.rows}}class Ch{constructor(e,i,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=i,this.mode=null,this.verbose=0,this.displayedMemory=new lo(n),this.nonDisplayedMemory=new lo(n),this.lastOutputScreen=new lo(n),this.currRollUpRow=this.displayedMemory.rows[di-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[di-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>i+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const i={flash:!1};if(i.underline=e%2===1,i.italics=e>=46,i.italics)i.foreground="white";else{const n=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];i.foreground=r[n]}this.logger.log(2,"MIDROW: "+JSON.stringify(i)),this.writeScreen.setPen(i)}outputDataUpdate(e=!1){const i=this.logger.time;i!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=i:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,i,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:i),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Dh{constructor(e,i,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;const r=new pE;this.channels=[null,new Ch(e,i,r),new Ch(e+1,n,r)],this.cmdHistory=Oh(),this.logger=r}getHandler(e){return this.channels[e].getHandler()}setHandler(e,i){this.channels[e].setHandler(i)}addData(e,i){let n,r,s,a=!1;this.logger.time=e;for(let o=0;o<i.length;o+=2)if(r=i[o]&127,s=i[o+1]&127,!(r===0&&s===0)){if(this.logger.log(3,"["+on([i[o],i[o+1]])+"] -> ("+on([r,s])+")"),n=this.parseCmd(r,s),n||(n=this.parseMidrow(r,s)),n||(n=this.parsePAC(r,s)),n||(n=this.parseBackgroundAttributes(r,s)),!n&&(a=this.parseChars(r,s),a)){const l=this.currentChannel;l&&l>0?this.channels[l].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!n&&!a&&this.logger.log(2,"Couldn't parse cleaned data "+on([r,s])+" orig: "+on([i[o],i[o+1]]))}}parseCmd(e,i){const{cmdHistory:n}=this,r=(e===20||e===28||e===21||e===29)&&i>=32&&i<=47,s=(e===23||e===31)&&i>=33&&i<=35;if(!(r||s))return!1;if(Ph(e,i,n))return In(null,null,n),this.logger.log(3,"Repeated command ("+on([e,i])+") is dropped"),!0;const a=e===20||e===21||e===23?1:2,o=this.channels[a];return e===20||e===21||e===28||e===29?i===32?o.ccRCL():i===33?o.ccBS():i===34?o.ccAOF():i===35?o.ccAON():i===36?o.ccDER():i===37?o.ccRU(2):i===38?o.ccRU(3):i===39?o.ccRU(4):i===40?o.ccFON():i===41?o.ccRDC():i===42?o.ccTR():i===43?o.ccRTD():i===44?o.ccEDM():i===45?o.ccCR():i===46?o.ccENM():i===47&&o.ccEOC():o.ccTO(i-32),In(e,i,n),this.currentChannel=a,!0}parseMidrow(e,i){let n=0;if((e===17||e===25)&&i>=32&&i<=47){if(e===17?n=1:n=2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[n];return r?(r.ccMIDROW(i),this.logger.log(3,"MIDROW ("+on([e,i])+")"),!0):!1}return!1}parsePAC(e,i){let n;const r=this.cmdHistory,s=(e>=17&&e<=23||e>=25&&e<=31)&&i>=64&&i<=127,a=(e===16||e===24)&&i>=64&&i<=95;if(!(s||a))return!1;if(Ph(e,i,r))return In(null,null,r),!0;const o=e<=23?1:2;i>=64&&i<=95?n=o===1?cE[e]:uE[e]:n=o===1?hE[e]:fE[e];const l=this.channels[o];return l?(l.setPAC(this.interpretPAC(n,i)),In(e,i,r),this.currentChannel=o,!0):!1}interpretPAC(e,i){let n;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return i>95?n=i-96:n=i-64,r.underline=(n&1)===1,n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((n-16)/2)*4,r}parseChars(e,i){let n,r=null,s=null;if(e>=25?(n=2,s=e-8):(n=1,s=e),s>=17&&s<=19){let a;s===17?a=i+80:s===18?a=i+112:a=i+144,this.logger.log(2,"Special char '"+Mf(a)+"' in channel "+n),r=[a]}else e>=32&&e<=127&&(r=i===0?[e]:[e,i]);if(r){const a=on(r);this.logger.log(3,"Char codes =  "+a.join(",")),In(e,i,this.cmdHistory)}return r}parseBackgroundAttributes(e,i){const n=(e===16||e===24)&&i>=32&&i<=47,r=(e===23||e===31)&&i>=45&&i<=47;if(!(n||r))return!1;let s;const a={};e===16||e===24?(s=Math.floor((i-32)/2),a.background=dE[s],i%2===1&&(a.background=a.background+"_semi")):i===45?a.background="transparent":(a.foreground="black",i===47&&(a.underline=!0));const o=e<=23?1:2;return this.channels[o].setBkgData(a),In(e,i,this.cmdHistory),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const i=this.channels[e];i&&i.reset()}this.cmdHistory=Oh()}cueSplitAtTime(e){for(let i=0;i<this.channels.length;i++){const n=this.channels[i];n&&n.cueSplitAtTime(e)}}}function In(t,e,i){i.a=t,i.b=e}function Ph(t,e,i){return i.a===t&&i.b===e}function Oh(){return{a:null,b:null}}class bs{constructor(e,i){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=i}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,i,n){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=i,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var Zl=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;const t=["","lr","rl"],e=["start","middle","end","left","right"];function i(o,l){if(typeof l!="string"||!Array.isArray(o))return!1;const c=l.toLowerCase();return~o.indexOf(c)?c:!1}function n(o){return i(t,o)}function r(o){return i(e,o)}function s(o,...l){let c=1;for(;c<arguments.length;c++){const h=arguments[c];for(const u in h)o[u]=h[u]}return o}function a(o,l,c){const h=this,u={enumerable:!0};h.hasBeenReset=!1;let f="",d=!1,p=o,m=l,g=c,v=null,x="",y=!0,b="auto",E="start",w=50,A="middle",D=50,O="middle";Object.defineProperty(h,"id",s({},u,{get:function(){return f},set:function(P){f=""+P}})),Object.defineProperty(h,"pauseOnExit",s({},u,{get:function(){return d},set:function(P){d=!!P}})),Object.defineProperty(h,"startTime",s({},u,{get:function(){return p},set:function(P){if(typeof P!="number")throw new TypeError("Start time must be set to a number.");p=P,this.hasBeenReset=!0}})),Object.defineProperty(h,"endTime",s({},u,{get:function(){return m},set:function(P){if(typeof P!="number")throw new TypeError("End time must be set to a number.");m=P,this.hasBeenReset=!0}})),Object.defineProperty(h,"text",s({},u,{get:function(){return g},set:function(P){g=""+P,this.hasBeenReset=!0}})),Object.defineProperty(h,"region",s({},u,{get:function(){return v},set:function(P){v=P,this.hasBeenReset=!0}})),Object.defineProperty(h,"vertical",s({},u,{get:function(){return x},set:function(P){const L=n(P);if(L===!1)throw new SyntaxError("An invalid or illegal string was specified.");x=L,this.hasBeenReset=!0}})),Object.defineProperty(h,"snapToLines",s({},u,{get:function(){return y},set:function(P){y=!!P,this.hasBeenReset=!0}})),Object.defineProperty(h,"line",s({},u,{get:function(){return b},set:function(P){if(typeof P!="number"&&P!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");b=P,this.hasBeenReset=!0}})),Object.defineProperty(h,"lineAlign",s({},u,{get:function(){return E},set:function(P){const L=r(P);if(!L)throw new SyntaxError("An invalid or illegal string was specified.");E=L,this.hasBeenReset=!0}})),Object.defineProperty(h,"position",s({},u,{get:function(){return w},set:function(P){if(P<0||P>100)throw new Error("Position must be between 0 and 100.");w=P,this.hasBeenReset=!0}})),Object.defineProperty(h,"positionAlign",s({},u,{get:function(){return A},set:function(P){const L=r(P);if(!L)throw new SyntaxError("An invalid or illegal string was specified.");A=L,this.hasBeenReset=!0}})),Object.defineProperty(h,"size",s({},u,{get:function(){return D},set:function(P){if(P<0||P>100)throw new Error("Size must be between 0 and 100.");D=P,this.hasBeenReset=!0}})),Object.defineProperty(h,"align",s({},u,{get:function(){return O},set:function(P){const L=r(P);if(!L)throw new SyntaxError("An invalid or illegal string was specified.");O=L,this.hasBeenReset=!0}})),h.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class vE{decode(e,i){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function If(t){function e(n,r,s,a){return(n|0)*3600+(r|0)*60+(s|0)+parseFloat(a||0)}const i=t.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return i?parseFloat(i[2])>59?e(i[2],i[3],0,i[4]):e(i[1],i[2],i[3],i[4]):null}class yE{constructor(){this.values=Object.create(null)}set(e,i){!this.get(e)&&i!==""&&(this.values[e]=i)}get(e,i,n){return n?this.has(e)?this.values[e]:i[n]:this.has(e)?this.values[e]:i}has(e){return e in this.values}alt(e,i,n){for(let r=0;r<n.length;++r)if(i===n[r]){this.set(e,i);break}}integer(e,i){/^-?\d+$/.test(i)&&this.set(e,parseInt(i,10))}percent(e,i){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(i)){const n=parseFloat(i);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function Cf(t,e,i,n){const r=n?t.split(n):[t];for(const s in r){if(typeof r[s]!="string")continue;const a=r[s].split(i);if(a.length!==2)continue;const o=a[0],l=a[1];e(o,l)}}const xl=new Zl(0,0,""),Ts=xl.align==="middle"?"middle":"center";function xE(t,e,i){const n=t;function r(){const o=If(t);if(o===null)throw new Error("Malformed timestamp: "+n);return t=t.replace(/^[^\sa-zA-Z-]+/,""),o}function s(o,l){const c=new yE;Cf(o,function(f,d){let p;switch(f){case"region":for(let m=i.length-1;m>=0;m--)if(i[m].id===d){c.set(f,i[m].region);break}break;case"vertical":c.alt(f,d,["rl","lr"]);break;case"line":p=d.split(","),c.integer(f,p[0]),c.percent(f,p[0])&&c.set("snapToLines",!1),c.alt(f,p[0],["auto"]),p.length===2&&c.alt("lineAlign",p[1],["start",Ts,"end"]);break;case"position":p=d.split(","),c.percent(f,p[0]),p.length===2&&c.alt("positionAlign",p[1],["start",Ts,"end","line-left","line-right","auto"]);break;case"size":c.percent(f,d);break;case"align":c.alt(f,d,["start",Ts,"end","left","right"]);break}},/:/,/\s/),l.region=c.get("region",null),l.vertical=c.get("vertical","");let h=c.get("line","auto");h==="auto"&&xl.line===-1&&(h=-1),l.line=h,l.lineAlign=c.get("lineAlign","start"),l.snapToLines=c.get("snapToLines",!0),l.size=c.get("size",100),l.align=c.get("align",Ts);let u=c.get("position","auto");u==="auto"&&xl.position===50&&(u=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=u}function a(){t=t.replace(/^\s+/,"")}if(a(),e.startTime=r(),a(),t.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);t=t.slice(3),a(),e.endTime=r(),a(),s(t,e)}function Df(t){return t.replace(/<br(?: \/)?>/gi,`
`)}class EE{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new vE,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const i=this;e&&(i.buffer+=i.decoder.decode(e,{stream:!0}));function n(){let s=i.buffer,a=0;for(s=Df(s);a<s.length&&s[a]!=="\r"&&s[a]!==`
`;)++a;const o=s.slice(0,a);return s[a]==="\r"&&++a,s[a]===`
`&&++a,i.buffer=s.slice(a),o}function r(s){Cf(s,function(a,o){},/:/)}try{let s="";if(i.state==="INITIAL"){if(!/\r\n|\n/.test(i.buffer))return this;s=n();const o=s.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(o!=null&&o[0]))throw new Error("Malformed WebVTT signature.");i.state="HEADER"}let a=!1;for(;i.buffer;){if(!/\r\n|\n/.test(i.buffer))return this;switch(a?a=!1:s=n(),i.state){case"HEADER":/:/.test(s)?r(s):s||(i.state="ID");continue;case"NOTE":s||(i.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){i.state="NOTE";break}if(!s)continue;if(i.cue=new Zl(0,0,""),i.state="CUE",s.indexOf("-->")===-1){i.cue.id=s;continue}case"CUE":if(!i.cue){i.state="BADCUE";continue}try{xE(s,i.cue,i.regionList)}catch{i.cue=null,i.state="BADCUE";continue}i.state="CUETEXT";continue;case"CUETEXT":{const o=s.indexOf("-->")!==-1;if(!s||o&&(a=!0)){i.oncue&&i.cue&&i.oncue(i.cue),i.cue=null,i.state="ID";continue}if(i.cue===null)continue;i.cue.text&&(i.cue.text+=`
`),i.cue.text+=s}continue;case"BADCUE":s||(i.state="ID")}}}catch{i.state==="CUETEXT"&&i.cue&&i.oncue&&i.oncue(i.cue),i.cue=null,i.state=i.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(i){e.onparsingerror&&e.onparsingerror(i)}return e.onflush&&e.onflush(),this}}const bE=/\r\n|\n\r|\n|\r/g,co=function(e,i,n=0){return e.slice(n,n+i.length)===i},TE=function(e){let i=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!be(i)||!be(n)||!be(r)||!be(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return i+=1e3*n,i+=60*1e3*r,i+=60*60*1e3*s,i},ho=function(e){let i=5381,n=e.length;for(;n;)i=i*33^e.charCodeAt(--n);return(i>>>0).toString()};function Jl(t,e,i){return ho(t.toString())+ho(e.toString())+ho(i)}const _E=function(e,i,n){let r=e[i],s=e[r.prevCC];if(!s||!s.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;(a=s)!=null&&a.new;){var a;e.ccOffset+=r.start-s.start,r.new=!1,r=s,s=e[r.prevCC]}e.presentationOffset=n};function wE(t,e,i,n,r,s,a){const o=new EE,l=wi(new Uint8Array(t)).trim().replace(bE,`
`).split(`
`),c=[],h=e?Fx(e.baseTime,e.timescale):0;let u="00:00.000",f=0,d=0,p,m=!0;o.oncue=function(g){const v=i[n];let x=i.ccOffset;const y=(f-h)/9e4;if(v!=null&&v.new&&(d!==void 0?x=i.ccOffset=v.start:_E(i,n,y)),y){if(!e){p=new Error("Missing initPTS for VTT MPEGTS");return}x=y-i.presentationOffset}const b=g.endTime-g.startTime,E=oi((g.startTime+x-d)*9e4,r*9e4)/9e4;g.startTime=Math.max(E,0),g.endTime=Math.max(E+b,0);const w=g.text.trim();g.text=decodeURIComponent(encodeURIComponent(w)),g.id||(g.id=Jl(g.startTime,g.endTime,w)),g.endTime>0&&c.push(g)},o.onparsingerror=function(g){p=g},o.onflush=function(){if(p){a(p);return}s(c)},l.forEach(g=>{if(m)if(co(g,"X-TIMESTAMP-MAP=")){m=!1,g.slice(16).split(",").forEach(v=>{co(v,"LOCAL:")?u=v.slice(6):co(v,"MPEGTS:")&&(f=parseInt(v.slice(7)))});try{d=TE(u)/1e3}catch(v){p=v}return}else g===""&&(m=!1);o.parse(g+`
`)}),o.flush()}const uo="stpp.ttml.im1t",Pf=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Of=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,AE={left:"start",center:"center",right:"end",start:"start",end:"end"};function Fh(t,e,i,n){const r=We(new Uint8Array(t),["mdat"]);if(r.length===0){n(new Error("Could not parse IMSC1 mdat"));return}const s=r.map(o=>wi(o)),a=Ox(e.baseTime,1,e.timescale);try{s.forEach(o=>i(SE(o,a)))}catch(o){n(o)}}function SE(t,e){const r=new DOMParser().parseFromString(t,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(s).reduce((u,f)=>(u[f]=r.getAttribute(`ttp:${f}`)||s[f],u),{}),o=r.getAttribute("xml:space")!=="preserve",l=kh(fo(r,"styling","style")),c=kh(fo(r,"layout","region")),h=fo(r,"body","[begin]");return[].map.call(h,u=>{const f=Ff(u,o);if(!f||!u.hasAttribute("begin"))return null;const d=mo(u.getAttribute("begin"),a),p=mo(u.getAttribute("dur"),a);let m=mo(u.getAttribute("end"),a);if(d===null)throw Nh(u);if(m===null){if(p===null)throw Nh(u);m=d+p}const g=new Zl(d-e,m-e,f);g.id=Jl(g.startTime,g.endTime,g.text);const v=c[u.getAttribute("region")],x=l[u.getAttribute("style")],y=LE(v,x,l),{textAlign:b}=y;if(b){const E=AE[b];E&&(g.lineAlign=E),g.align=b}return bt(g,y),g}).filter(u=>u!==null)}function fo(t,e,i){const n=t.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(i)):[]}function kh(t){return t.reduce((e,i)=>{const n=i.getAttribute("xml:id");return n&&(e[n]=i),e},{})}function Ff(t,e){return[].slice.call(t.childNodes).reduce((i,n,r)=>{var s;return n.nodeName==="br"&&r?i+`
`:(s=n.childNodes)!=null&&s.length?Ff(n,e):e?i+n.textContent.trim().replace(/\s+/g," "):i+n.textContent},"")}function LE(t,e,i){const n="http://www.w3.org/ns/ttml#styling";let r=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=t!=null&&t.hasAttribute("style")?t.getAttribute("style"):null;return a&&i.hasOwnProperty(a)&&(r=i[a]),s.reduce((o,l)=>{const c=po(e,n,l)||po(t,n,l)||po(r,n,l);return c&&(o[l]=c),o},{})}function po(t,e,i){return t&&t.hasAttributeNS(e,i)?t.getAttributeNS(e,i):null}function Nh(t){return new Error(`Could not parse ttml timestamp ${t}`)}function mo(t,e){if(!t)return null;let i=If(t);return i===null&&(Pf.test(t)?i=ME(t,e):Of.test(t)&&(i=RE(t,e))),i}function ME(t,e){const i=Pf.exec(t),n=(i[4]|0)+(i[5]|0)/e.subFrameRate;return(i[1]|0)*3600+(i[2]|0)*60+(i[3]|0)+n/e.frameRate}function RE(t,e){const i=Of.exec(t),n=Number(i[1]);switch(i[2]){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}class IE{constructor(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Bh(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){const i=new bs(this,"textTrack1"),n=new bs(this,"textTrack2"),r=new bs(this,"textTrack3"),s=new bs(this,"textTrack4");this.cea608Parser1=new Dh(1,i,n),this.cea608Parser2=new Dh(3,r,s)}e.on(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(T.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(T.FRAG_LOADING,this.onFragLoading,this),e.on(T.FRAG_LOADED,this.onFragLoaded,this),e.on(T.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(T.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(T.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(T.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(T.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(T.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(T.FRAG_LOADING,this.onFragLoading,this),e.off(T.FRAG_LOADED,this.onFragLoaded,this),e.off(T.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(T.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(T.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(T.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(T.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null}addCues(e,i,n,r,s){let a=!1;for(let o=s.length;o--;){const l=s[o],c=DE(l[0],l[1],i,n);if(c>=0&&(l[0]=Math.min(l[0],i),l[1]=Math.max(l[1],n),a=!0,c/(n-i)>.5))return}if(a||s.push([i,n]),this.config.renderTextTracksNatively){const o=this.captionsTracks[e];this.Cues.newCue(o,i,n,r)}else{const o=this.Cues.newCue(null,i,n,r);this.hls.trigger(T.CUES_PARSED,{type:"captions",cues:o,track:e})}}onInitPtsFound(e,{frag:i,id:n,initPTS:r,timescale:s}){const{unparsedVttFrags:a}=this;n==="main"&&(this.initPTS[i.cc]={baseTime:r,timescale:s}),a.length&&(this.unparsedVttFrags=[],a.forEach(o=>{this.onFragLoaded(T.FRAG_LOADED,o)}))}getExistingTrack(e){const{media:i}=this;if(i)for(let n=0;n<i.textTracks.length;n++){const r=i.textTracks[n];if(r[e])return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:i,captionsTracks:n,media:r}=this,{label:s,languageCode:a}=i[e],o=this.getExistingTrack(e);if(o)n[e]=o,Pn(n[e]),nf(n[e],r);else{const l=this.createTextTrack("captions",s,a);l&&(l[e]=!0,n[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const i=this.captionsProperties[e];if(!i)return;const n=i.label,r={_id:e,label:n,kind:"captions",default:i.media?!!i.media.default:!1,closedCaptions:i.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(T.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,i,n){const r=this.media;if(r)return r.addTextTrack(e,i,n)}onMediaAttaching(e,i){this.media=i.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:e}=this;Object.keys(e).forEach(i=>{Pn(e[i]),delete e[i]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Bh(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const i=e.textTracks;if(i)for(let n=0;n<i.length;n++)Pn(i[n])}onSubtitleTracksUpdated(e,i){const n=i.subtitleTracks||[],r=n.some(s=>s.textCodec===uo);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(Lf(this.tracks,n)){this.tracks=n;return}if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const a=this.media?this.media.textTracks:null;this.tracks.forEach((o,l)=>{let c;if(a&&l<a.length){let h=null;for(let u=0;u<a.length;u++)if(CE(a[u],o)){h=a[u];break}h&&(c=h)}if(c)Pn(c);else{const h=this._captionsOrSubtitlesFromCharacteristics(o);c=this.createTextTrack(h,o.name,o.lang),c&&(c.mode="disabled")}c&&(c.groupId=o.groupId,this.textTracks.push(c))})}else if(this.tracks.length){const a=this.tracks.map(o=>({label:o.name,kind:o.type.toLowerCase(),default:o.default,subtitleTrack:o}));this.hls.trigger(T.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}_captionsOrSubtitlesFromCharacteristics(e){if(e.attrs.CHARACTERISTICS){const i=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),n=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(i&&n)return"captions"}return"subtitles"}onManifestLoaded(e,i){this.config.enableCEA708Captions&&i.captions&&i.captions.forEach(n=>{const r=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!r)return;const s=`textTrack${r[1]}`,a=this.captionsProperties[s];a&&(a.label=n.name,n.lang&&(a.languageCode=n.lang),a.media=n)})}closedCaptionsForLevel(e){const i=this.hls.levels[e.level];return i==null?void 0:i.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,i){const{cea608Parser1:n,cea608Parser2:r,lastSn:s,lastPartIndex:a}=this;if(!(!this.enabled||!(n&&r))&&i.frag.type===Me.MAIN){var o,l;const c=i.frag.sn,h=(o=i==null||(l=i.part)==null?void 0:l.index)!=null?o:-1;c===s+1||c===s&&h===a+1||(n.reset(),r.reset()),this.lastSn=c,this.lastPartIndex=h}}onFragLoaded(e,i){const{frag:n,payload:r}=i;if(n.type===Me.SUBTITLE)if(r.byteLength){const s=n.decryptdata,a="stats"in i;if(s==null||!s.encrypted||a){const o=this.tracks[n.level],l=this.vttCCs;l[n.cc]||(l[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),o&&o.textCodec===uo?this._parseIMSC1(n,r):this._parseVTTs(i)}}else this.hls.trigger(T.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,i){const n=this.hls;Fh(i,this.initPTS[e.cc],r=>{this._appendCues(r,e.level),n.trigger(T.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},r=>{N.log(`Failed to parse IMSC1: ${r}`),n.trigger(T.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})})}_parseVTTs(e){var i;const{frag:n,payload:r}=e,{initPTS:s,unparsedVttFrags:a}=this,o=s.length-1;if(!s[n.cc]&&o===-1){a.push(e);return}const l=this.hls,c=(i=n.initSegment)!=null&&i.data?En(n.initSegment.data,new Uint8Array(r)):r;wE(c,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,h=>{this._appendCues(h,n.level),l.trigger(T.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},h=>{const u=h.message==="Missing initPTS for VTT MPEGTS";u?a.push(e):this._fallbackToIMSC1(n,r),N.log(`Failed to parse VTT cue: ${h}`),!(u&&o>n.cc)&&l.trigger(T.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:h})})}_fallbackToIMSC1(e,i){const n=this.tracks[e.level];n.textCodec||Fh(i,this.initPTS[e.cc],()=>{n.textCodec=uo,this._parseIMSC1(e,i)},()=>{n.textCodec="wvtt"})}_appendCues(e,i){const n=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[i];if(!r||r.mode==="disabled")return;e.forEach(s=>rf(r,s))}else{const r=this.tracks[i];if(!r)return;const s=r.default?"default":"subtitles"+i;n.trigger(T.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,i){const{frag:n}=i;n.type===Me.SUBTITLE&&this.onFragLoaded(T.FRAG_LOADED,i)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,i){const{cea608Parser1:n,cea608Parser2:r}=this;if(!this.enabled||!(n&&r))return;const{frag:s,samples:a}=i;if(!(s.type===Me.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let o=0;o<a.length;o++){const l=a[o].bytes;if(l){const c=this.extractCea608Data(l);n.addData(a[o].pts,c[0]),r.addData(a[o].pts,c[1])}}}onBufferFlushing(e,{startOffset:i,endOffset:n,endOffsetSubtitles:r,type:s}){const{media:a}=this;if(!(!a||a.currentTime<n)){if(!s||s==="video"){const{captionsTracks:o}=this;Object.keys(o).forEach(l=>dl(o[l],i,n))}if(this.config.renderTextTracksNatively&&i===0&&r!==void 0){const{textTracks:o}=this;Object.keys(o).forEach(l=>dl(o[l],i,r))}}}extractCea608Data(e){const i=[[],[]],n=e[0]&31;let r=2;for(let s=0;s<n;s++){const a=e[r++],o=127&e[r++],l=127&e[r++];if(o===0&&l===0)continue;if((4&a)!==0){const h=3&a;(h===0||h===1)&&(i[h].push(o),i[h].push(l))}}return i}}function CE(t,e){return!!t&&t.label===e.name&&!(t.textTrack1||t.textTrack2)}function DE(t,e,i,n){return Math.min(e,n)-Math.max(t,i)}function Bh(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class Ql{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(T.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(T.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.BUFFER_CODECS,this.onBufferCodecs,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(T.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(T.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.BUFFER_CODECS,this.onBufferCodecs,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,i){const n=this.hls.levels[i.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,i){this.media=i.media instanceof HTMLVideoElement?i.media:null,this.clientRect=null}onManifestParsed(e,i){const n=this.hls;this.restrictedLevels=[],this.firstLevel=i.firstLevel,n.config.capLevelToPlayerSize&&i.video&&this.startCapping()}onBufferCodecs(e,i){this.hls.config.capLevelToPlayerSize&&i.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){const e=this.hls.levels;if(e.length){const i=this.hls;i.autoLevelCapping=this.getMaxLevel(e.length-1),i.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=i.autoLevelCapping}}}getMaxLevel(e){const i=this.hls.levels;if(!i.length)return-1;const n=i.filter((r,s)=>this.isLevelAllowed(r)&&s<=e);return this.clientRect=null,Ql.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,i={width:0,height:0};if(e){const n=e.getBoundingClientRect();i.width=n.width,i.height=n.height,!i.width&&!i.height&&(i.width=n.right-n.left||e.width||0,i.height=n.bottom-n.top||e.height||0)}return this.clientRect=i,i}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return e}isLevelAllowed(e){return!this.restrictedLevels.some(n=>e.bitrate===n.bitrate&&e.width===n.width&&e.height===n.height)}static getMaxLevelByMediaSize(e,i,n){if(!(e!=null&&e.length))return-1;const r=(a,o)=>o?a.width!==o.width||a.height!==o.height:!0;let s=e.length-1;for(let a=0;a<e.length;a+=1){const o=e[a];if((o.width>=i||o.height>=n)&&r(o,e[a+1])){s=a;break}}return s}}class PE{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(T.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(T.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,i){const n=this.hls.config;if(n.capLevelOnFPSDrop){const r=i.media instanceof self.HTMLVideoElement?i.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}checkFPS(e,i,n){const r=performance.now();if(i){if(this.lastTime){const s=r-this.lastTime,a=n-this.lastDroppedFrames,o=i-this.lastDecodedFrames,l=1e3*a/s,c=this.hls;if(c.trigger(T.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:n}),l>0&&a>c.config.fpsDroppedMonitoringThreshold*o){let h=c.currentLevel;N.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=h)&&(h=h-1,c.trigger(T.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:c.currentLevel}),c.autoLevelCapping=h,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=i}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const i=e.getVideoPlaybackQuality();this.checkFPS(e,i.totalVideoFrames,i.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}const _s="[eme]";class Bn{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=Bn.CDMCleanupPromise?[Bn.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=N.debug.bind(N,_s),this.log=N.log.bind(N,_s),this.warn=N.warn.bind(N,_s),this.error=N.error.bind(N,_s),this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(T.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(T.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(T.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(T.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(T.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(T.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:i,widevineLicenseUrl:n}=this.config,r=i[e];if(r)return r.licenseUrl;if(e===dt.WIDEVINE&&n)return n;throw new Error(`no license server URL configured for key-system "${e}"`)}getServerCertificateUrl(e){const{drmSystems:i}=this.config,n=i[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const i=this.hls.levels,n=(a,o,l)=>!!a&&l.indexOf(a)===o,r=i.map(a=>a.audioCodec).filter(n),s=i.map(a=>a.videoCodec).filter(n);return r.length+s.length===0&&s.push("avc1.42e01e"),new Promise((a,o)=>{const l=c=>{const h=c.shift();this.getMediaKeysPromise(h,r,s).then(u=>a({keySystem:h,mediaKeys:u})).catch(u=>{c.length?l(c):u instanceof si?o(u):o(new si({type:Se.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_NO_ACCESS,error:u,fatal:!0},u.message))})};l(e)})}requestMediaKeySystemAccess(e,i){const{requestMediaKeySystemAccessFunc:n}=this.config;if(typeof n!="function"){let r=`Configured requestMediaKeySystemAccess is not a function ${n}`;return Wu===null&&self.location.protocol==="http:"&&(r=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(r))}return n(e,i)}getMediaKeysPromise(e,i,n){const r=Y0(e,i,n,this.config.drmSystemOptions),s=this.keySystemAccessPromises[e];let a=s==null?void 0:s.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${JSON.stringify(r)}`),a=this.requestMediaKeySystemAccess(e,r);const o=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(l=>{this.log(`Failed to obtain access to key-system "${e}": ${l}`)}),a.then(l=>{this.log(`Access for key-system "${l.keySystem}" obtained`);const c=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),o.mediaKeys=l.createMediaKeys().then(h=>(this.log(`Media-keys created for "${e}"`),c.then(u=>u?this.setMediaKeysServerCertificate(h,e,u):h))),o.mediaKeys.catch(h=>{this.error(`Failed to create media-keys for "${e}"}: ${h}`)}),o.mediaKeys})}return a.then(()=>s.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:i,mediaKeys:n}){this.log(`Creating key-system session "${i}" keyId: ${yi.hexDump(e.keyId||[])}`);const r=n.createSession(),s={decryptdata:e,keySystem:i,mediaKeys:n,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const i=e.decryptdata;if(i.pssh){const n=this.createMediaKeySessionContext(e),r=this.getKeyIdString(i),s="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(n,s,i.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return yi.hexDump(e.keyId)}updateKeySession(e,i){var n;const r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyID ${yi.hexDump(((n=e.decryptdata)==null?void 0:n.keyId)||[])}
      } (data length: ${i&&i.byteLength})`),r.update(i)}selectKeySystemFormat(e){const i=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise((i,n)=>{const r=Ya(this.config),s=e.map(Kc).filter(a=>!!a&&r.indexOf(a)!==-1);return this.getKeySystemSelectionPromise(s).then(({keySystem:a})=>{const o=Xc(a);o?i(o):n(new Error(`Unable to find format for key-system "${a}"`))}).catch(n)})}loadKey(e){const i=e.keyInfo.decryptdata,n=this.getKeyIdString(i),r=`(keyId: ${n} format: "${i.keyFormat}" method: ${i.method} uri: ${i.uri})`;this.log(`Starting session for key ${r}`);let s=this.keyIdToKeySessionPromise[n];return s||(s=this.keyIdToKeySessionPromise[n]=this.getKeySystemForKeyPromise(i).then(({keySystem:a,mediaKeys:o})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${r}`),this.attemptSetMediaKeys(a,o).then(()=>{this.throwIfDestroyed();const l=this.createMediaKeySessionContext({keySystem:a,mediaKeys:o,decryptdata:i}),c="cenc";return this.generateRequestWithPreferredKeySession(l,c,i.pssh,"playlist-key")}))),s.catch(a=>this.handleError(a))),s}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof si?this.hls.trigger(T.ERROR,e.data):this.hls.trigger(T.ERROR,{type:Se.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const i=this.getKeyIdString(e),n=this.keyIdToKeySessionPromise[i];if(!n){const r=Kc(e.keyFormat),s=r?[r]:Ya(this.config);return this.attemptKeySystemAccess(s)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=Ya(this.config)),e.length===0)throw new si({type:Se.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}_onMediaEncrypted(e){const{initDataType:i,initData:n}=e;if(this.debug(`"${e.type}" event: init data type: "${i}"`),n===null)return;let r,s;if(i==="sinf"&&this.config.drmSystems[dt.FAIRPLAY]){const h=St(new Uint8Array(n));try{const u=Ul(JSON.parse(h).sinf),f=Ju(new Uint8Array(u));if(!f)return;r=f.subarray(8,24),s=dt.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{const h=vy(n);if(h===null)return;h.version===0&&h.systemId===zu.WIDEVINE&&h.data&&(r=h.data.subarray(8,24)),s=$0(h.systemId)}if(!s||!r)return;const a=yi.hexDump(r),{keyIdToKeySessionPromise:o,mediaKeySessions:l}=this;let c=o[a];for(let h=0;h<l.length;h++){const u=l[h],f=u.decryptdata;if(f.pssh||!f.keyId)continue;const d=yi.hexDump(f.keyId);if(a===d||f.uri.replace(/-/g,"").indexOf(a)!==-1){c=o[d],delete o[d],f.pssh=new Uint8Array(n),f.keyId=r,c=o[a]=c.then(()=>this.generateRequestWithPreferredKeySession(u,i,n,"encrypted-event-key-match"));break}}c||(c=o[a]=this.getKeySystemSelectionPromise([s]).then(({keySystem:h,mediaKeys:u})=>{var f;this.throwIfDestroyed();const d=new is("ISO-23001-7",a,(f=Xc(h))!=null?f:"");return d.pssh=new Uint8Array(n),d.keyId=r,this.attemptSetMediaKeys(h,u).then(()=>{this.throwIfDestroyed();const p=this.createMediaKeySessionContext({decryptdata:d,keySystem:h,mediaKeys:u});return this.generateRequestWithPreferredKeySession(p,i,n,"encrypted-event-no-match")})})),c.catch(h=>this.handleError(h))}_onWaitingForKey(e){this.log(`"${e.type}" event`)}attemptSetMediaKeys(e,i){const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const r=Promise.all(n).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(i)});return this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>n.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,i,n,r){var s,a;const o=(s=this.config.drmSystems)==null||(a=s[e.keySystem])==null?void 0:a.generateRequest;if(o)try{const f=o.call(this.hls,i,n,e);if(!f)throw new Error("Invalid response from configured generateRequest filter");i=f.initDataType,n=e.decryptdata.pssh=f.initData?new Uint8Array(f.initData):null}catch(f){var l;if(this.warn(f.message),(l=this.hls)!=null&&l.config.debug)throw f}if(n===null)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);const c=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${r}": ${c} (init data type: ${i} length: ${n?n.byteLength:null})`);const h=new ql;e.mediaKeysSession.onmessage=f=>{const d=e.mediaKeysSession;if(!d){h.emit("error",new Error("invalid state"));return}const{messageType:p,message:m}=f;this.log(`"${p}" message event for session "${d.sessionId}" message size: ${m.byteLength}`),p==="license-request"||p==="license-renewal"?this.renewLicense(e,m).catch(g=>{this.handleError(g),h.emit("error",g)}):p==="license-release"?e.keySystem===dt.FAIRPLAY&&(this.updateKeySession(e,Vu("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${p}"`)},e.mediaKeysSession.onkeystatuseschange=f=>{if(!e.mediaKeysSession){h.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const p=e.keyStatus;h.emit("keyStatus",p),p==="expired"&&(this.warn(`${e.keySystem} expired for key ${c}`),this.renewKeySession(e))};const u=new Promise((f,d)=>{h.on("error",d),h.on("keyStatus",p=>{p.startsWith("usable")?f():p==="output-restricted"?d(new si({type:Se.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):p==="internal-error"?d(new si({type:Se.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${p}"`)):p==="expired"?d(new Error("key expired while generating request")):this.warn(`unhandled key status change "${p}"`)})});return e.mediaKeysSession.generateRequest(i,n).then(()=>{var f;this.log(`Request generated for key-session "${(f=e.mediaKeysSession)==null?void 0:f.sessionId}" keyId: ${c}`)}).catch(f=>{throw new si({type:Se.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_NO_SESSION,error:f,fatal:!1},`Error generating key-session request: ${f}`)}).then(()=>u).catch(f=>{throw h.removeAllListeners(),this.removeSession(e),f}).then(()=>(h.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((i,n)=>{this.log(`key status change "${i}" for keyStatuses keyId: ${yi.hexDump("buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n))} session keyId: ${yi.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=i})}fetchServerCertificate(e){const i=this.config,n=i.loader,r=new n(i),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching serverCertificate for "${e}"`),new Promise((a,o)=>{const l={responseType:"arraybuffer",url:s},c=i.certLoadPolicy.default,h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(f,d,p,m)=>{a(f.data)},onError:(f,d,p,m)=>{o(new si({type:Se.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:zt({url:l.url,data:void 0},f)},`"${e}" certificate request failed (${s}). Status: ${f.code} (${f.text})`))},onTimeout:(f,d,p)=>{o(new si({type:Se.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(f,d,p)=>{o(new Error("aborted"))}};r.load(l,h,u)})):Promise.resolve()}setMediaKeysServerCertificate(e,i,n){return new Promise((r,s)=>{e.setServerCertificate(n).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${n==null?void 0:n.byteLength}) on "${i}"`),r(e)}).catch(a=>{s(new si({type:Se.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,i){return this.requestLicense(e,new Uint8Array(i)).then(n=>this.updateKeySession(e,new Uint8Array(n)).catch(r=>{throw new si({type:Se.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:r,fatal:!0},r.message)}))}setupLicenseXHR(e,i,n,r){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,i,n,r)}).catch(a=>{if(!n.decryptdata)throw a;return e.open("POST",i,!0),s.call(this.hls,e,i,n,r)}).then(a=>(e.readyState||e.open("POST",i,!0),{xhr:e,licenseChallenge:a||r})):(e.open("POST",i,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,i){const n=this.config.keyLoadPolicy.default;return new Promise((r,s)=>{const a=this.getLicenseServerUrl(e.keySystem);this.log(`Sending license request to URL: ${a}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(o.readyState===4)if(o.status===200){this._requestLicenseFailureCount=0;let l=o.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const c=this.config.licenseResponseCallback;if(c)try{l=c.call(this.hls,o,a,e)}catch(h){this.error(h)}r(l)}else{const l=n.errorRetry,c=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||o.status>=400&&o.status<500)s(new si({type:Se.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:o,response:{url:a,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${a}). Status: ${o.status} (${o.statusText})`));else{const h=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${h} attempts left`),this.requestLicense(e,i).then(r,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,a,e,i).then(({xhr:l,licenseChallenge:c})=>{l.send(c)})})}onMediaAttached(e,i){if(!this.config.emeEnabled)return;const n=i.media;this.media=n,n.addEventListener("encrypted",this.onMediaEncrypted),n.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media,i=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},is.clearKeyUriToKeyIdMap();const n=i.length;Bn.CDMCleanupPromise=Promise.all(i.map(r=>this.removeSession(r)).concat(e==null?void 0:e.setMediaKeys(null).catch(r=>{this.log(`Could not clear media keys: ${r}. media.src: ${e==null?void 0:e.src}`)}))).then(()=>{n&&(this.log("finished closing key sessions and clearing media keys"),i.length=0)}).catch(r=>{this.log(`Could not close sessions and clear media keys: ${r}. media.src: ${e==null?void 0:e.src}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:i}){if(!(!i||!this.config.emeEnabled)&&!this.keyFormatPromise){const n=i.reduce((r,s)=>(r.indexOf(s.keyFormat)===-1&&r.push(s.keyFormat),r),[]);this.log(`Selecting key-system from session-keys ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)}}removeSession(e){const{mediaKeysSession:i,licenseXhr:n}=e;if(i){this.log(`Remove licenses and keys and close session ${i.sessionId}`),i.onmessage=null,i.onkeystatuseschange=null,n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(e);return r>-1&&this.mediaKeySessions.splice(r,1),i.remove().catch(s=>{this.log(`Could not remove session: ${s}`)}).then(()=>i.close()).catch(s=>{this.log(`Could not close session: ${s}`)})}}}Bn.CDMCleanupPromise=void 0;class si extends Error{constructor(e,i){super(i),this.data=void 0,e.error||(e.error=new Error(i)),this.data=e,e.err=e.error}}const OE=1;var Yt={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"};const FE="h";class Xi{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:Yt.MANIFEST,su:!this.initialized})}catch(s){N.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=r=>{try{const s=r.frag,a=this.hls.levels[s.level],o=this.getObjectType(s),l={d:s.duration*1e3,ot:o};(o===Yt.VIDEO||o===Yt.AUDIO||o==Yt.MUXED)&&(l.br=a.bitrate/1e3,l.tb=this.getTopBandwidth(o)/1e3,l.bl=this.getBufferLength(o)),this.apply(r,l)}catch(s){N.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const i=this.config=e.config,{cmcd:n}=i;n!=null&&(i.pLoader=this.createPlaylistLoader(),i.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||Xi.uuid(),this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.registerListeners())}registerListeners(){const e=this.hls;e.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(T.MEDIA_DETACHED,this.onMediaDetached,this),e.on(T.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(T.MEDIA_DETACHED,this.onMediaDetached,this),e.off(T.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null}onMediaAttached(e,i){this.media=i.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,i){var n,r;this.audioBuffer=(n=i.tracks.audio)==null?void 0:n.buffer,this.videoBuffer=(r=i.tracks.video)==null?void 0:r.buffer}createData(){var e;return{v:OE,sf:FE,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,i={}){bt(i,this.createData());const n=i.ot===Yt.INIT||i.ot===Yt.VIDEO||i.ot===Yt.MUXED;if(this.starved&&n&&(i.bs=!0,i.su=!0,this.starved=!1),i.su==null&&(i.su=this.buffering),this.useHeaders){const r=Xi.toHeaders(i);if(!Object.keys(r).length)return;e.headers||(e.headers={}),bt(e.headers,r)}else{const r=Xi.toQuery(i);if(!r)return;e.url=Xi.appendQueryToUri(e.url,r)}}getObjectType(e){const{type:i}=e;if(i==="subtitle")return Yt.TIMED_TEXT;if(e.sn==="initSegment")return Yt.INIT;if(i==="audio")return Yt.AUDIO;if(i==="main")return this.hls.audioTracks.length?Yt.VIDEO:Yt.MUXED}getTopBandwidth(e){let i=0,n;const r=this.hls;if(e===Yt.AUDIO)n=r.audioTracks;else{const s=r.maxAutoLevel,a=s>-1?s+1:r.levels.length;n=r.levels.slice(0,a)}for(const s of n)s.bitrate>i&&(i=s.bitrate);return i>0?i:NaN}getBufferLength(e){const i=this.hls.media,n=e===Yt.AUDIO?this.audioBuffer:this.videoBuffer;return!n||!i?NaN:at.bufferInfo(n,i.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,i=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,o){i(s),this.loader.load(s,a,o)}}}createFragmentLoader(){const{fLoader:e}=this.config,i=this.applyFragmentData,n=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,o){i(s),this.loader.load(s,a,o)}}}static uuid(){const e=URL.createObjectURL(new Blob),i=e.toString();return URL.revokeObjectURL(e),i.slice(i.lastIndexOf("/")+1)}static serialize(e){const i=[],n=c=>!Number.isNaN(c)&&c!=null&&c!==""&&c!==!1,r=c=>Math.round(c),s=c=>r(c/100)*100,o={br:r,d:r,bl:s,dl:s,mtp:s,nor:c=>encodeURIComponent(c),rtp:s,tb:r},l=Object.keys(e||{}).sort();for(const c of l){let h=e[c];if(!n(h)||c==="v"&&h===1||c=="pr"&&h===1)continue;const u=o[c];u&&(h=u(h));const f=typeof h;let d;c==="ot"||c==="sf"||c==="st"?d=`${c}=${h}`:f==="boolean"?d=c:f==="number"?d=`${c}=${h}`:d=`${c}=${JSON.stringify(h)}`,i.push(d)}return i.join(",")}static toHeaders(e){const i=Object.keys(e),n={},r=["Object","Request","Session","Status"],s=[{},{},{},{}],a={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};for(const o of i){const l=a[o]!=null?a[o]:1;s[l][o]=e[o]}for(let o=0;o<s.length;o++){const l=Xi.serialize(s[o]);l&&(n[`CMCD-${r[o]}`]=l)}return n}static toQuery(e){return`CMCD=${encodeURIComponent(Xi.serialize(e))}`}static appendQueryToUri(e,i){if(!i)return e;const n=e.includes("?")?"&":"?";return`${e}${n}${i}`}}const kE=3e5;class NE{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=N.log.bind(N,"[content-steering]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(T.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(T.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.ERROR,this.onError,this))}startLoad(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri)if(this.updated){const e=Math.max(this.timeToLoad*1e3-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,e)}else this.loadSteeringManifest(this.uri)}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const i=this.levels;i&&(this.levels=i.filter(n=>n!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,i){const{contentSteering:n}=i;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,i){this.audioTracks=i.audioTracks,this.subtitleTracks=i.subtitleTracks}onError(e,i){const{errorAction:n}=i;if((n==null?void 0:n.action)===Ot.SendAlternateToPenaltyBox&&n.flags===ai.MoveAllAlternatesMatchingHost){let r=this.pathwayPriority;const s=this.pathwayId;this.penalizedPathways[s]||(this.penalizedPathways[s]=performance.now()),!r&&this.levels&&(r=this.levels.reduce((a,o)=>(a.indexOf(o.pathwayId)===-1&&a.push(o.pathwayId),a),[])),r&&r.length>1&&(this.updatePathwayPriority(r),n.resolved=this.pathwayId!==s)}}filterParsedLevels(e){this.levels=e;let i=this.getLevelsForPathway(this.pathwayId);if(i.length===0){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),i=this.getLevelsForPathway(n),this.pathwayId=n}return i.length!==e.length?(this.log(`Found ${i.length}/${e.length} levels in Pathway "${this.pathwayId}"`),i):e}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(i=>e===i.pathwayId)}updatePathwayPriority(e){this.pathwayPriority=e;let i;const n=this.penalizedPathways,r=performance.now();Object.keys(n).forEach(s=>{r-n[s]>kE&&delete n[s]});for(let s=0;s<e.length;s++){const a=e[s];if(n[a])continue;if(a===this.pathwayId)return;const o=this.hls.nextLoadLevel,l=this.hls.levels[o];if(i=this.getLevelsForPathway(a),i.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,this.hls.trigger(T.LEVELS_UPDATED,{levels:i});const c=this.hls.levels[o];l&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=o);break}}}clonePathways(e){const i=this.levels;if(!i)return;const n={},r={};e.forEach(s=>{const{ID:a,"BASE-ID":o,"URI-REPLACEMENT":l}=s;if(i.some(h=>h.pathwayId===a))return;const c=this.getLevelsForPathway(o).map(h=>{const u=bt({},h);u.details=void 0,u.url=kf(h.uri,h.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l);const f=new ft(h.attrs);f["PATHWAY-ID"]=a;const d=f.AUDIO&&`${f.AUDIO}_clone_${a}`,p=f.SUBTITLES&&`${f.SUBTITLES}_clone_${a}`;d&&(n[f.AUDIO]=d,f.AUDIO=d),p&&(r[f.SUBTITLES]=p,f.SUBTITLES=p),u.attrs=f;const m=new ns(u);return Ea(m,"audio",d),Ea(m,"text",p),m});i.push(...c),Uh(this.audioTracks,n,l,a),Uh(this.subtitleTracks,r,l,a)})}loadSteeringManifest(e){const i=this.hls.config,n=i.loader;this.loader&&this.loader.destroy(),this.loader=new n(i);let r;try{r=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(r.protocol!=="data:"){const h=(this.hls.bandwidthEstimate||i.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+h)}const s={responseType:"json",url:r.href},a=i.steeringManifestLoadPolicy.default,o=a.errorRetry||a.timeoutRetry||{},l={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},c={onSuccess:(h,u,f,d)=>{this.log(`Loaded steering manifest: "${r}"`);const p=h.data;if(p.VERSION!==1){this.log(`Steering VERSION ${p.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=p.TTL;const{"RELOAD-URI":m,"PATHWAY-CLONES":g,"PATHWAY-PRIORITY":v}=p;if(m)try{this.uri=new self.URL(m,r).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${m}`);return}this.scheduleRefresh(this.uri||f.url),g&&this.clonePathways(g),v&&this.updatePathwayPriority(v)},onError:(h,u,f,d)=>{if(this.log(`Error loading steering manifest: ${h.code} ${h.text} (${u.url})`),this.stopLoad(),h.code===410){this.enabled=!1,this.log(`Steering manifest ${u.url} no longer available`);return}let p=this.timeToLoad*1e3;if(h.code===429){const m=this.loader;if(typeof(m==null?void 0:m.getResponseHeader)=="function"){const g=m.getResponseHeader("Retry-After");g&&(p=parseFloat(g)*1e3)}this.log(`Steering manifest ${u.url} rate limited`);return}this.scheduleRefresh(this.uri||u.url,p)},onTimeout:(h,u,f)=>{this.log(`Timeout loading steering manifest (${u.url})`),this.scheduleRefresh(this.uri||u.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(s,l,c)}scheduleRefresh(e,i=this.timeToLoad*1e3){self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout(()=>{this.loadSteeringManifest(e)},i)}}function Uh(t,e,i,n){t&&Object.keys(e).forEach(r=>{const s=t.filter(a=>a.groupId===r).map(a=>{const o=bt({},a);return o.details=void 0,o.attrs=new ft(o.attrs),o.url=o.attrs.URI=kf(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",i),o.groupId=o.attrs["GROUP-ID"]=e[r],o.attrs["PATHWAY-ID"]=n,o});t.push(...s)})}function kf(t,e,i,n){const{HOST:r,PARAMS:s,[i]:a}=n;let o;e&&(o=a==null?void 0:a[e],o&&(t=o));const l=new self.URL(t);return r&&!o&&(l.host=r),s&&Object.keys(s).sort().forEach(c=>{c&&l.searchParams.set(c,s[c])}),l.href}const BE=/^age:\s*[\d.]+\s*$/im;class Nf{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new La,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,i,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=i,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:i}=this;if(!e)return;const n=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!this.stats.aborted)return s(n,i.url)}).catch(a=>(n.open("GET",i.url,!0),s(n,i.url))).then(()=>{this.stats.aborted||this.openAndSendXhr(n,i,e)}).catch(a=>{this.callbacks.onError({code:n.status,text:a.message},i,n,r)}):this.openAndSendXhr(n,i,e)}openAndSendXhr(e,i,n){e.readyState||e.open("GET",i.url,!0);const r=this.context.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:a}=n.loadPolicy;if(r)for(const o in r)e.setRequestHeader(o,r[o]);i.rangeEnd&&e.setRequestHeader("Range","bytes="+i.rangeStart+"-"+(i.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=i.responseType,self.clearTimeout(this.requestTimeout),n.timeout=s&&be(s)?s:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:i,stats:n}=this;if(!e||!i)return;const r=i.readyState,s=this.config;if(!n.aborted&&r>=2&&(n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),i.onreadystatechange=null,i.onprogress=null;const a=i.status,o=i.responseType!=="text";if(a>=200&&a<300&&(o&&i.response||i.responseText!==null)){n.loading.end=Math.max(self.performance.now(),n.loading.first);const l=o?i.response:i.responseText,c=i.responseType==="arraybuffer"?l.byteLength:l.length;if(n.loaded=n.total=c,n.bwEstimate=n.total*8e3/(n.loading.end-n.loading.first),!this.callbacks)return;const h=this.callbacks.onProgress;if(h&&h(n,e,l,i),!this.callbacks)return;const u={url:i.responseURL,data:l,code:a};this.callbacks.onSuccess(u,n,e,i)}else{const l=s.loadPolicy.errorRetry,c=n.retry;xa(l,c,!1,a)?this.retry(l):(N.error(`${a} while loading ${e.url}`),this.callbacks.onError({code:a,text:i.statusText},e,i,n))}}}loadtimeout(){var e;const i=(e=this.config)==null?void 0:e.loadPolicy.timeoutRetry,n=this.stats.retry;if(xa(i,n,!0))this.retry(i);else{N.warn(`timeout while loading ${this.context.url}`);const r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:i,stats:n}=this;this.retryDelay=Hl(e,n.retry),n.retry++,N.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${i.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const i=this.stats;i.loaded=e.loaded,e.lengthComputable&&(i.total=e.total)}getCacheAge(){let e=null;if(this.loader&&BE.test(this.loader.getAllResponseHeaders())){const i=this.loader.getResponseHeader("age");e=i?parseFloat(i):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}function UE(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const GE=/(\d+)-(\d+)\/(\d+)/;class Gh{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||WE,this.controller=new self.AbortController,this.stats=new La}destroy(){this.loader=this.callbacks=null,this.abortInternal()}abortInternal(){const e=this.response;e!=null&&e.ok||(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,i,n){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const s=HE(e,this.controller.signal),a=n.onProgress,o=e.responseType==="arraybuffer",l=o?"byteLength":"length",{maxTimeToFirstByteMs:c,maxLoadTimeMs:h}=i.loadPolicy;this.context=e,this.config=i,this.callbacks=n,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),i.timeout=c&&be(c)?c:h,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),n.onTimeout(r,e,this.response)},i.timeout),self.fetch(this.request).then(u=>{this.response=this.loader=u;const f=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),i.timeout=h,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),n.onTimeout(r,e,this.response)},h-(f-r.loading.start)),!u.ok){const{status:d,statusText:p}=u;throw new jE(p||"fetch, bad network response",d,u)}return r.loading.first=f,r.total=zE(u.headers)||r.total,a&&be(i.highWaterMark)?this.loadProgressively(u,r,e,i.highWaterMark,a):o?u.arrayBuffer():e.responseType==="json"?u.json():u.text()}).then(u=>{const{response:f}=this;self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const d=u[l];d&&(r.loaded=r.total=d);const p={url:f.url,data:u,code:f.status};a&&!be(i.highWaterMark)&&a(r,e,u,f),n.onSuccess(p,r,e,f)}).catch(u=>{if(self.clearTimeout(this.requestTimeout),r.aborted)return;const f=u&&u.code||0,d=u?u.message:null;n.onError({code:f,text:d},e,u?u.details:null,r)})}getCacheAge(){let e=null;if(this.response){const i=this.response.headers.get("age");e=i?parseFloat(i):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,i,n,r=0,s){const a=new Sf,o=e.body.getReader(),l=()=>o.read().then(c=>{if(c.done)return a.dataLength&&s(i,n,a.flush(),e),Promise.resolve(new ArrayBuffer(0));const h=c.value,u=h.length;return i.loaded+=u,u<r||a.dataLength?(a.push(h),a.dataLength>=r&&s(i,n,a.flush(),e)):s(i,n,h,e),l()}).catch(()=>Promise.reject());return l()}}function HE(t,e){const i={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(bt({},t.headers))};return t.rangeEnd&&i.headers.set("Range","bytes="+t.rangeStart+"-"+String(t.rangeEnd-1)),i}function VE(t){const e=GE.exec(t);if(e)return parseInt(e[2])-parseInt(e[1])+1}function zE(t){const e=t.get("Content-Range");if(e){const n=VE(e);if(be(n))return n}const i=t.get("Content-Length");if(i)return parseInt(i)}function WE(t,e){return new self.Request(t.url,e)}class jE extends Error{constructor(e,i,n){super(e),this.code=void 0,this.details=void 0,this.code=i,this.details=n}}const $E=/\s/,YE={newCue(t,e,i,n){const r=[];let s,a,o,l,c;const h=self.VTTCue||self.TextTrackCue;for(let f=0;f<n.rows.length;f++)if(s=n.rows[f],o=!0,l=0,c="",!s.isEmpty()){var u;for(let m=0;m<s.chars.length;m++)$E.test(s.chars[m].uchar)&&o?l++:(c+=s.chars[m].uchar,o=!1);s.cueStartTime=e,e===i&&(i+=1e-4),l>=16?l--:l++;const d=Df(c.trim()),p=Jl(e,i,d);t!=null&&(u=t.cues)!=null&&u.getCueById(p)||(a=new h(e,i,d),a.id=p,a.line=f+1,a.align="left",a.position=10+Math.min(80,Math.floor(l*8/32)*10),r.push(a))}return t&&r.length&&(r.sort((f,d)=>f.line==="auto"||d.line==="auto"?0:f.line>8&&d.line>8?d.line-f.line:f.line-d.line),r.forEach(f=>rf(t,f))),r}},KE={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},XE=zt(zt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Nf,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Qx,bufferController:lE,capLevelController:Ql,errorController:jy,fpsController:PE,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Wu,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:KE},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},qE()),{},{subtitleStreamController:rE,subtitleTrackController:aE,timelineController:IE,audioStreamController:tE,audioTrackController:iE,emeController:Bn,cmcdController:Xi,contentSteeringController:NE});function qE(){return{cueHandler:YE,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function ZE(t,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=El(t),n=["manifest","level","frag"],r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return n.forEach(s=>{const a=`${s==="level"?"playlist":s}LoadPolicy`,o=e[a]===void 0,l=[];r.forEach(c=>{const h=`${s}Loading${c}`,u=e[h];if(u!==void 0&&o){l.push(h);const f=i[a].default;switch(e[a]={default:f},c){case"TimeOut":f.maxLoadTimeMs=u,f.maxTimeToFirstByteMs=u;break;case"MaxRetry":f.errorRetry.maxNumRetry=u,f.timeoutRetry.maxNumRetry=u;break;case"RetryDelay":f.errorRetry.retryDelayMs=u,f.timeoutRetry.retryDelayMs=u;break;case"MaxRetryTimeout":f.errorRetry.maxRetryDelayMs=u,f.timeoutRetry.maxRetryDelayMs=u;break}}}),l.length&&N.warn(`hls.js config: "${l.join('", "')}" setting(s) are deprecated, use "${a}": ${JSON.stringify(e[a])}`)}),zt(zt({},i),e)}function El(t){return t&&typeof t=="object"?Array.isArray(t)?t.map(El):Object.keys(t).reduce((e,i)=>(e[i]=El(t[i]),e),{}):t}function JE(t){const e=t.loader;e!==Gh&&e!==Nf?(N.log("[config]: Custom loader detected, cannot enable progressive streaming"),t.progressive=!1):UE()&&(t.loader=Gh,t.progressive=!0,t.enableSoftwareAES=!0,N.log("[config]: Progressive streaming enabled, using FetchLoader"))}class On{static get version(){return"1.4.14"}static isSupported(){return hx()}static get Events(){return T}static get ErrorTypes(){return Se}static get ErrorDetails(){return Y}static get DefaultConfig(){return On.defaultConfig?On.defaultConfig:XE}static set DefaultConfig(e){On.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new ql,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,k0(e.debug||!1,"Hls instance");const i=this.config=ZE(On.DefaultConfig,e);this.userConfig=e,this._autoLevelCapping=-1,i.progressive&&JE(i);const{abrController:n,bufferController:r,capLevelController:s,errorController:a,fpsController:o}=i,l=new a(this),c=this.abrController=new n(this),h=this.bufferController=new r(this),u=this.capLevelController=new s(this),f=new o(this),d=new Sy(this),p=new Cy(this),m=i.contentSteeringController,g=m?new m(this):null,v=this.levelController=new Yy(this,g),x=new Ky(this),y=new qy(this.config),b=this.streamController=new Zx(this,x,y);u.setStreamController(b),f.setStreamController(b);const E=[d,v,b];g&&E.splice(1,0,g),this.networkControllers=E;const w=[c,h,u,f,p,x];this.audioTrackController=this.createController(i.audioTrackController,E);const A=i.audioStreamController;A&&E.push(new A(this,x,y)),this.subtitleTrackController=this.createController(i.subtitleTrackController,E);const D=i.subtitleStreamController;D&&E.push(new D(this,x,y)),this.createController(i.timelineController,w),y.emeController=this.emeController=this.createController(i.emeController,w),this.cmcdController=this.createController(i.cmcdController,w),this.latencyController=this.createController(Dy,w),this.coreComponents=w,E.push(l);const O=l.onErrorOut;typeof O=="function"&&this.on(T.ERROR,O,l)}createController(e,i){if(e){const n=new e(this);return i&&i.push(n),n}return null}on(e,i,n=this){this._emitter.on(e,i,n)}once(e,i,n=this){this._emitter.once(e,i,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,i,n=this,r){this._emitter.off(e,i,n,r)}listeners(e){return this._emitter.listeners(e)}emit(e,i,n){return this._emitter.emit(e,i,n)}trigger(e,i){if(this.config.debug)return this.emit(e,e,i);try{return this.emit(e,e,i)}catch(n){N.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),this.trigger(T.ERROR,{type:Se.OTHER_ERROR,details:Y.INTERNAL_EXCEPTION,fatal:!1,event:e,error:n})}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){N.log("destroy"),this.trigger(T.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(i=>i.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(i=>i.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){N.log("attachMedia"),this._media=e,this.trigger(T.MEDIA_ATTACHING,{media:e})}detachMedia(){N.log("detachMedia"),this.trigger(T.MEDIA_DETACHING,void 0),this._media=null}loadSource(e){this.stopLoad();const i=this.media,n=this.url,r=this.url=Bl.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});N.log(`loadSource:${r}`),i&&n&&(n!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(i)),this.trigger(T.MANIFEST_LOADING,{url:e})}startLoad(e=-1){N.log(`startLoad(${e})`),this.networkControllers.forEach(i=>{i.startLoad(e)})}stopLoad(){N.log("stopLoad"),this.networkControllers.forEach(e=>{e.stopLoad()})}swapAudioCodec(){N.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){N.log("recoverMediaError");const e=this._media;this.detachMedia(),e&&this.attachMedia(e)}removeLevel(e,i=0){this.levelController.removeLevel(e,i)}get levels(){const e=this.levelController.levels;return e||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){N.log(`set currentLevel:${e}`),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){N.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){N.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){N.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){return this.levelController.startLevel}set startLevel(e){N.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const i=!!e;i!==this.config.capLevelToPlayerSize&&(i?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=i)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(N.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e)}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){ml.indexOf(e)>-1&&(this._maxHdcpLevel=e)}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:i}}=this;if(!e)return 0;const n=e.length;for(let r=0;r<n;r++)if(e[r].maxBitrate>=i)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:i,maxHdcpLevel:n}=this;let r;if(i===-1&&e&&e.length?r=e.length-1:r=i,n)for(let s=r;s--;){const a=e[s].attrs["HDCP-LEVEL"];if(a&&a<=n)return s}return r}get nextAutoLevel(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)}set nextAutoLevel(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const i=this.audioTrackController;i&&(i.audioTrack=e)}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const i=this.subtitleTrackController;i&&(i.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const i=this.subtitleTrackController;i&&(i.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}On.defaultConfig=void 0;var QE={exports:{}};(function(t){var e=e||jf,i=15e3,n=1e3,r=60*n,s=60*r,a=24*s,o="http://www.topografix.com/GPX/gpx_style/0/2",l={startIconUrl:"pin-icon-start.png",endIconUrl:"pin-icon-end.png",shadowUrl:"pin-shadow.png",wptIcons:[],wptIconsType:[],wptIconUrls:{"":"pin-icon-wpt.png"},wptIconTypeUrls:{"":"pin-icon-wpt.png"},pointMatchers:[],iconSize:[33,45],shadowSize:[50,50],iconAnchor:[16,45],shadowAnchor:[16,47],clickable:!1},c={color:"blue"},h={parseElements:["track","route","waypoint"],joinTrackSegments:!0};e.GPX=e.FeatureGroup.extend({initialize:function(u,f){f.max_point_interval=f.max_point_interval||i,f.marker_options=this._merge_objs(l,f.marker_options||{}),f.polyline_options=f.polyline_options||{},f.gpx_options=this._merge_objs(h,f.gpx_options||{}),e.Util.setOptions(this,f),e.GPXTrackIcon=e.Icon.extend({options:f.marker_options}),this._gpx=u,this._layers={},this._init_info(),u&&this._parse(u,f,this.options.async)},get_duration_string:function(u,f){var d="";u>=a&&(d+=Math.floor(u/a)+"d ",u=u%a),u>=s&&(d+=Math.floor(u/s)+":",u=u%s);var p=Math.floor(u/r);u=u%r,p<10&&(d+="0"),d+=p+"'";var m=Math.floor(u/n);return u=u%n,m<10&&(d+="0"),d+=m,!f&&u>0?d+="."+Math.round(Math.floor(u)*1e3)/1e3:d+='"',d},get_duration_string_iso:function(u,f){var d=this.get_duration_string(u,f);return d.replace("'",":").replace('"',"")},to_miles:function(u){return u/1.60934},to_ft:function(u){return u*3.28084},m_to_km:function(u){return u/1e3},m_to_mi:function(u){return u/1609.34},ms_to_kmh:function(u){return u*3.6},ms_to_mih:function(u){return u/1609.34*3600},get_name:function(){return this._info.name},get_desc:function(){return this._info.desc},get_author:function(){return this._info.author},get_copyright:function(){return this._info.copyright},get_distance:function(){return this._info.length},get_distance_imp:function(){return this.to_miles(this.m_to_km(this.get_distance()))},get_start_time:function(){return this._info.duration.start},get_end_time:function(){return this._info.duration.end},get_moving_time:function(){return this._info.duration.moving},get_total_time:function(){return this._info.duration.total},get_moving_pace:function(){return this.get_moving_time()/this.m_to_km(this.get_distance())},get_moving_pace_imp:function(){return this.get_moving_time()/this.get_distance_imp()},get_moving_speed:function(){return this.m_to_km(this.get_distance())/(this.get_moving_time()/(3600*1e3))},get_moving_speed_imp:function(){return this.to_miles(this.m_to_km(this.get_distance()))/(this.get_moving_time()/(3600*1e3))},get_total_speed:function(){return this.m_to_km(this.get_distance())/(this.get_total_time()/(3600*1e3))},get_total_speed_imp:function(){return this.to_miles(this.m_to_km(this.get_distance()))/(this.get_total_time()/(3600*1e3))},get_elevation_gain:function(){return this._info.elevation.gain},get_elevation_loss:function(){return this._info.elevation.loss},get_elevation_gain_imp:function(){return this.to_ft(this.get_elevation_gain())},get_elevation_loss_imp:function(){return this.to_ft(this.get_elevation_loss())},get_elevation_data:function(){var u=this;return this._info.elevation._points.map(function(f){return u._prepare_data_point(f,u.m_to_km,null,function(d,p){return d.toFixed(2)+" km, "+p.toFixed(0)+" m"})})},get_elevation_data_imp:function(){var u=this;return this._info.elevation._points.map(function(f){return u._prepare_data_point(f,u.m_to_mi,u.to_ft,function(d,p){return d.toFixed(2)+" mi, "+p.toFixed(0)+" ft"})})},get_elevation_max:function(){return this._info.elevation.max},get_elevation_min:function(){return this._info.elevation.min},get_elevation_max_imp:function(){return this.to_ft(this.get_elevation_max())},get_elevation_min_imp:function(){return this.to_ft(this.get_elevation_min())},get_speed_data:function(){var u=this;return this._info.speed._points.map(function(f){return u._prepare_data_point(f,u.m_to_km,u.ms_to_kmh,function(d,p){return d.toFixed(2)+" km, "+p.toFixed(2)+" km/h"})})},get_speed_data_imp:function(){var u=this;return this._info.speed._points.map(function(f){return u._prepare_data_point(f,u.m_to_mi,u.ms_to_mih,function(d,p){return d.toFixed(2)+" mi, "+p.toFixed(2)+" mi/h"})})},get_speed_max:function(){return this.m_to_km(this._info.speed.max)*3600},get_speed_max_imp:function(){return this.to_miles(this.get_speed_max())},get_average_hr:function(){return this._info.hr.avg},get_average_temp:function(){return this._info.atemp.avg},get_average_cadence:function(){return this._info.cad.avg},get_heartrate_data:function(){var u=this;return this._info.hr._points.map(function(f){return u._prepare_data_point(f,u.m_to_km,null,function(d,p){return d.toFixed(2)+" km, "+p.toFixed(0)+" bpm"})})},get_heartrate_data_imp:function(){var u=this;return this._info.hr._points.map(function(f){return u._prepare_data_point(f,u.m_to_mi,null,function(d,p){return d.toFixed(2)+" mi, "+p.toFixed(0)+" bpm"})})},get_cadence_data:function(){var u=this;return this._info.cad._points.map(function(f){return u._prepare_data_point(f,u.m_to_km,null,function(d,p){return d.toFixed(2)+" km, "+p.toFixed(0)+" rpm"})})},get_temp_data:function(){var u=this;return this._info.atemp._points.map(function(f){return u._prepare_data_point(f,u.m_to_km,null,function(d,p){return d.toFixed(2)+" km, "+p.toFixed(0)+" degrees"})})},get_cadence_data_imp:function(){var u=this;return this._info.cad._points.map(function(f){return u._prepare_data_point(f,u.m_to_mi,null,function(d,p){return d.toFixed(2)+" mi, "+p.toFixed(0)+" rpm"})})},get_temp_data_imp:function(){var u=this;return this._info.atemp._points.map(function(f){return u._prepare_data_point(f,u.m_to_mi,null,function(d,p){return d.toFixed(2)+" mi, "+p.toFixed(0)+" degrees"})})},reload:function(){this._init_info(),this.clearLayers(),this._parse(this._gpx,this.options,this.options.async)},_merge_objs:function(u,f){var d={};for(var p in u)d[p]=u[p];for(var p in f)d[p]=f[p];return d},_prepare_data_point:function(u,f,d,p){var m=[f&&f(u[0])||u[0],d&&d(u[1])||u[1]];return m.push(p&&p(m[0],m[1])||m[0]+": "+m[1]),m},_init_info:function(){this._info={name:null,length:0,elevation:{gain:0,loss:0,max:0,min:1/0,_points:[]},speed:{max:0,_points:[]},hr:{avg:0,_total:0,_points:[]},duration:{start:null,end:null,moving:0,total:0},atemp:{avg:0,_total:0,_points:[]},cad:{avg:0,_total:0,_points:[]}}},_load_xml:function(u,f,d,p){p==null&&(p=this.options.async),d==null&&(d=this.options);var m=new window.XMLHttpRequest;m.open("GET",u,p);try{m.overrideMimeType("text/xml")}catch{}m.onreadystatechange=function(){m.readyState==4&&m.status==200&&f(m.responseXML,d)},m.send(null)},_parse:function(u,f,d){var p=this,m=function(v,x){var y=p._parse_gpx_data(v,x);if(!y){p.fire("error",{err:"No parseable layers of type(s) "+JSON.stringify(x.gpx_options.parseElements)});return}p.addLayer(y),p.fire("loaded",{layers:y,element:v})};if(u.substr(0,1)==="<"){var g=new DOMParser;d?setTimeout(function(){m(g.parseFromString(u,"text/xml"),f)}):m(g.parseFromString(u,"text/xml"),f)}else this._load_xml(u,m,f,d)},_parse_gpx_data:function(u,f){var d,p,m=[],g=u.getElementsByTagName("name");g.length>0&&(this._info.name=g[0].textContent);var v=u.getElementsByTagName("desc");v.length>0&&(this._info.desc=v[0].textContent);var x=u.getElementsByTagName("author");x.length>0&&(this._info.author=x[0].textContent);var y=u.getElementsByTagName("copyright");y.length>0&&(this._info.copyright=y[0].textContent);var b=f.gpx_options.parseElements;if(b.indexOf("route")>-1){var E=u.getElementsByTagName("rte");for(d=0;d<E.length;d++)m=m.concat(this._parse_segment(E[d],f,{},"rtept"))}if(b.indexOf("track")>-1){var w=u.getElementsByTagName("trk");for(d=0;d<w.length;d++){var A=w[d],D=this._extract_styling(A);if(f.gpx_options.joinTrackSegments)m=m.concat(this._parse_segment(A,f,D,"trkpt"));else{var O=A.getElementsByTagName("trkseg");for(ae=0;ae<O.length;ae++)m=m.concat(this._parse_segment(O[ae],f,D,"trkpt"))}}}if(this._info.hr.avg=Math.round(this._info.hr._total/this._info.hr._points.length),this._info.cad.avg=Math.round(this._info.cad._total/this._info.cad._points.length),this._info.atemp.avg=Math.round(this._info.atemp._total/this._info.atemp._points.length),b.indexOf("waypoint")>-1)for(p=u.getElementsByTagName("wpt"),d=0;d<p.length;d++){var P=new e.LatLng(p[d].getAttribute("lat"),p[d].getAttribute("lon")),L=p[d].getElementsByTagName("name"),g=L.length>0?L[0].textContent:"",C=p[d].getElementsByTagName("desc"),v=C.length>0?C[0].textContent:"",U=p[d].getElementsByTagName("sym"),j=U.length>0?U[0].textContent:null,K=p[d].getElementsByTagName("type"),z=K.length>0?K[0].textContent:null,$=f.marker_options.wptIcons,k=f.marker_options.wptIconUrls,G=f.marker_options.wptIconsType,q=f.marker_options.wptIconTypeUrls,ee=f.marker_options.pointMatchers||[],Q;if($&&j&&$[j])Q=$[j];else if(G&&z&&G[z])Q=G[z];else if(k&&j&&k[j])Q=new e.GPXTrackIcon({iconUrl:k[j]});else if(q&&z&&q[z])Q=new e.GPXTrackIcon({iconUrl:q[z]});else if(ee.length>0){for(var ae=0;ae<ee.length;ae++)if(ee[ae].regex.test(g)){Q=ee[ae].icon;break}}else $&&$[""]?Q=$[""]:k&&k[""]&&(Q=new e.GPXTrackIcon({iconUrl:k[""]}));if(!Q){console.log("No waypoint icon could be matched for symKey=%s,typeKey=%s,name=%s on waypoint %o",j,z,g,p[d]);continue}var V=new e.Marker(P,{clickable:f.marker_options.clickable,title:g,icon:Q,type:"waypoint"});V.bindPopup("<b>"+g+"</b>"+(v.length>0?"<br>"+v:"")).openPopup(),this.fire("addpoint",{point:V,point_type:"waypoint",element:p[d]}),m.push(V)}if(m.length>1)return new e.FeatureGroup(m);if(m.length==1)return m[0]},_parse_segment:function(u,f,d,p){var m=u.getElementsByTagName(p);if(!m.length)return[];for(var g=[],v=[],x=[],y=null,b=0;b<m.length;b++){var E,w=new e.LatLng(m[b].getAttribute("lat"),m[b].getAttribute("lon"));w.meta={time:null,ele:null,hr:null,cad:null,atemp:null,speed:null},E=m[b].getElementsByTagName("time"),E.length>0?w.meta.time=new Date(Date.parse(E[0].textContent)):w.meta.time=new Date("1970-01-01T00:00:00");var A=y!=null?Math.abs(w.meta.time-y.meta.time):0;E=m[b].getElementsByTagName("ele"),E.length>0?w.meta.ele=parseFloat(E[0].textContent):w.meta.ele=y!=null?y.meta.ele:null;var D=y!=null?w.meta.ele-y.meta.ele:0,O=y!=null?this._dist3d(y,w):0;if(E=m[b].getElementsByTagName("speed"),E.length>0?w.meta.speed=parseFloat(E[0].textContent):w.meta.speed=A>0?1e3*O/A:0,E=m[b].getElementsByTagName("name"),E.length>0){for(var P=E[0].textContent,L=f.marker_options.pointMatchers||[],C=0;C<L.length;C++)if(L[C].regex.test(P)){v.push({label:P,coords:w,icon:L[C].icon,element:m[b]});break}}E=m[b].getElementsByTagNameNS("*","hr"),E.length>0&&(w.meta.hr=parseInt(E[0].textContent),this._info.hr._points.push([this._info.length,w.meta.hr]),this._info.hr._total+=w.meta.hr),E=m[b].getElementsByTagNameNS("*","cad"),E.length>0&&(w.meta.cad=parseInt(E[0].textContent),this._info.cad._points.push([this._info.length,w.meta.cad]),this._info.cad._total+=w.meta.cad),E=m[b].getElementsByTagNameNS("*","atemp"),E.length>0&&(w.meta.atemp=parseInt(E[0].textContent),this._info.atemp._points.push([this._info.length,w.meta.atemp]),this._info.atemp._total+=w.meta.atemp),w.meta.ele>this._info.elevation.max&&(this._info.elevation.max=w.meta.ele),w.meta.ele<this._info.elevation.min&&(this._info.elevation.min=w.meta.ele),this._info.elevation._points.push([this._info.length,w.meta.ele]),w.meta.speed>this._info.speed.max&&(this._info.speed.max=w.meta.speed),this._info.speed._points.push([this._info.length,w.meta.speed]),y==null&&this._info.duration.start==null&&(this._info.duration.start=w.meta.time),this._info.duration.end=w.meta.time,this._info.duration.total+=A,A<f.max_point_interval&&(this._info.duration.moving+=A),this._info.length+=O,D>0?this._info.elevation.gain+=D:this._info.elevation.loss+=Math.abs(D),y=w,g.push(w)}var U=new e.Polyline(g,this._extract_styling(u,d,f.polyline_options));if(this.fire("addline",{line:U,element:u}),x.push(U),f.marker_options.startIcon||f.marker_options.startIconUrl){var j=new e.Marker(g[0],{clickable:f.marker_options.clickable,icon:f.marker_options.startIcon||new e.GPXTrackIcon({iconUrl:f.marker_options.startIconUrl})});this.fire("addpoint",{point:j,point_type:"start",element:m[0]}),x.push(j)}if(f.marker_options.endIcon||f.marker_options.endIconUrl){var j=new e.Marker(g[g.length-1],{clickable:f.marker_options.clickable,icon:f.marker_options.endIcon||new e.GPXTrackIcon({iconUrl:f.marker_options.endIconUrl})});this.fire("addpoint",{point:j,point_type:"end",element:m[m.length-1]}),x.push(j)}for(var b=0;b<v.length;b++){var j=new e.Marker(v[b].coords,{clickable:f.marker_options.clickable,title:v[b].label,icon:v[b].icon});this.fire("addpoint",{point:j,point_type:"label",element:v[b].element}),x.push(j)}return x},_extract_styling:function(u,f,d){var p=this._merge_objs(c,f),m=u.getElementsByTagNameNS(o,"line");if(m.length>0){var g=m[0].getElementsByTagName("color");g.length>0&&(p.color="#"+g[0].textContent);var g=m[0].getElementsByTagName("opacity");g.length>0&&(p.opacity=g[0].textContent);var g=m[0].getElementsByTagName("weight");g.length>0&&(p.weight=g[0].textContent);var g=m[0].getElementsByTagName("linecap");g.length>0&&(p.lineCap=g[0].textContent);var g=m[0].getElementsByTagName("linejoin");g.length>0&&(p.lineJoin=g[0].textContent);var g=m[0].getElementsByTagName("dasharray");g.length>0&&(p.dashArray=g[0].textContent);var g=m[0].getElementsByTagName("dashoffset");g.length>0&&(p.dashOffset=g[0].textContent)}return this._merge_objs(p,d)},_dist2d:function(u,f){var d=6371e3,p=this._deg2rad(f.lat-u.lat),m=this._deg2rad(f.lng-u.lng),g=Math.sin(p/2)*Math.sin(p/2)+Math.cos(this._deg2rad(u.lat))*Math.cos(this._deg2rad(f.lat))*Math.sin(m/2)*Math.sin(m/2),v=2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g)),x=d*v;return x},_dist3d:function(u,f){var d=this._dist2d(u,f),p=Math.abs(f.meta.ele-u.meta.ele);return Math.sqrt(Math.pow(d,2)+Math.pow(p,2))},_deg2rad:function(u){return u*Math.PI/180}}),t.exports=e})(QE);const eb={props:["url"],data(){return{panorama:null,isPlaying:!1,progress:0,disabled:!1}},mounted(){this.initVideoPlayer()},methods:{initVideoPlayer(){const t=new Qt(this.url);new hl({container:this.$refs.vp_wrap}).add(t)}}},tb={ref:"vp_wrap",class:"vp_wrap"};function ib(t,e,i,n,r,s){return $f(),Yf("div",tb,null,512)}const ob=Kf(eb,[["render",ib]]);export{On as H,ob as P,hl as V,cn as a};
