import{L as c,o as m,A as k,a as g,c as p,w as d,b as r,m as f,n as h,s as v,C as u,z as V,v as y}from"./app-4fd626f8.js";import{P as x}from"./Panorama-db1fd8d9.js";import{T as z}from"./ThreeVideoPlayer-39ea6e55.js";import{_ as B}from"./_plugin-vue_export-helper-c27b6911.js";const C={components:{ThreeVideoPlayer:z,Panorama:x},props:["record"],data(){return{map:null,map_default_option:{view:[0,0],pin:[0,0],zoom:1},modal:!1,modal_video_url:null,modal_image_url:null,gpxOptions:{async:!0,marker_options:{startIconUrl:!1,endIconUrl:!1,shadowUrl:!1},gpx_options:{joinTrackSegments:!1},polyline_options:{color:"blue",weight:10,opacity:1,lineCap:"round"}}}},async mounted(){const o=this;new IntersectionObserver(a=>{a[0].isIntersecting&&o.$refs.map&&o.onInit()},{threshold:[1]}).observe(this.$refs.map)},methods:{onInit(){const o=this,t={maxZoom:o.constant.map.max_zoom},a=o.gpxOptions;a.polyline_options.weight=o.getLineWeightByZoom(o.constant.map.zoom,o.constant.map.gpx.weight);const _=o.getMarkerSizeByZoom(o.constant.map.zoom,o.constant.map.marker.size),e=c.icon({iconUrl:this.constant.map.marker.icon,iconSize:[_,_]}),l=c.map("map",t).setView(o.constant.map.view,o.constant.map.zoom).on("zoomend",o.onZoomChange);if(c.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://www.osm.org">OpenStreetMap</a>',maxZoom:o.constant.map.max_zoom}).addTo(l),o.record.type==1){const i=o.get_path_url(o.record.gpx_path);new c.GPX(i,a).on("loaded",function(s){const n=s.target;o.onFitBounds(l,n.getBounds()),n.addTo(l)}).on("click",function(){o.onShowModal()})}else if(o.record.type==2||o.record.type==3){const i=o.record.image_lat&&o.record.image_long?[o.record.image_lat,o.record.image_long]:o.constant.map.init_pos,s=c.marker(i,{icon:e,draggable:!0}).addTo(l).on("click",function(){o.onShowModal()});o.onFitBounds(l,i),s.on("dragstart",function(n){}),s.on("dragend",function(n){var w=s.getLatLng();o.$emit("update",w)})}o.map=l},onFitBounds(o,t){let a=o.getBounds();a.extend(t),o.fitBounds(a)},onShowModal(){this.record.type==1?(this.modal_video_url=this.record.video_path,this.modal=!0):(this.modal_image_url=this.get_path_url(this.record.image_path),this.modal=!0)}}},P={id:"map",ref:"map",class:"admin_map"},b={class:"vp_content"},S={class:"vp_content"};function T(o,t,a,_,e,l){const i=y("ThreeVideoPlayer"),s=y("Panorama");return m(),k("div",null,[g("div",P,null,512),a.record.type==1&&e.modal_video_url?(m(),p(v,{key:0,modelValue:e.modal,"onUpdate:modelValue":t[1]||(t[1]=n=>e.modal=n),width:"auto"},{default:d(()=>[r(h,{class:"vp_card"},{default:d(()=>[r(f,{icon:"mdi-close",class:"vp_close",onClick:t[0]||(t[0]=n=>e.modal=!1)}),r(i,{url:e.modal_video_url},null,8,["url"])]),_:1})]),_:1},8,["modelValue"])):u("",!0),a.record.type==2&&e.modal_image_url?(m(),p(v,{key:1,modelValue:e.modal,"onUpdate:modelValue":t[3]||(t[3]=n=>e.modal=n),width:"auto"},{default:d(()=>[r(h,{class:"vp_card"},{default:d(()=>[r(f,{icon:"mdi-close",class:"vp_close",onClick:t[2]||(t[2]=n=>e.modal=!1)}),g("div",b,[e.modal?(m(),p(V,{key:0,"lazy-src":"/empty.png","max-width":"1000",src:e.modal_image_url},null,8,["src"])):u("",!0)])]),_:1})]),_:1},8,["modelValue"])):u("",!0),a.record.type==3&&e.modal_image_url?(m(),p(v,{key:2,modelValue:e.modal,"onUpdate:modelValue":t[5]||(t[5]=n=>e.modal=n),width:"auto"},{default:d(()=>[r(h,{class:"vp_card"},{default:d(()=>[r(f,{icon:"mdi-close",class:"vp_close",onClick:t[4]||(t[4]=n=>e.modal=!1)}),g("div",S,[e.modal?(m(),p(s,{key:0,url:e.modal_image_url},null,8,["url"])):u("",!0)])]),_:1})]),_:1},8,["modelValue"])):u("",!0)])}const O=B(C,[["render",T]]);export{O as default};
