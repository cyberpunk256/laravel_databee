import{L as n}from"./leaflet-src-856a8e7f.js";import{P as h}from"./gpx-5e07d09f.js";import{T as c}from"./ThreeVideoPlayer-b8ac9c47.js";import{M as v}from"./MapLayout-f582bcd9.js";import{o as d,c as i,w as t,b as s,m as u,u as y,l as w,s as p,q as _,n as g,A as m,a as f,z as V}from"./app-54201836.js";import"./_plugin-vue_export-helper-c27b6911.js";const k=f("div",{id:"map",class:"fix_map"},null,-1),L={class:"vp_content"},b={class:"vp_content"},M={components:{ThreeVideoPlayer:c,Panorama:h},props:["records"],data(){return{map:null,map_default_option:{view:[0,0],pin:[0,0],scale:1},modal:!1,modal_type:1,modal_video_url:null,modal_image_url:null,bounds_sum:new n.LatLngBounds,loaded_gpxs:0,gpxOptions:{async:!0,marker_options:{startIconUrl:!1,endIconUrl:!1,shadowUrl:!1},gpx_options:{joinTrackSegments:!1}}}},mounted(){console.log("thisuser",this.user);const a=this,e=this.user.init_lat&&this.user.init_long?[this.user.init_lat,this.user.init_long]:a.map_default_option.view;a.map_default_option=this.constant.map,a.map=n.map("map").setView(e,a.map_default_option.zoom),n.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://www.osm.org">OpenStreetMap</a>'}).addTo(a.map);for(let l=0;l<a.records.length;l++){const o=a.records[l];if(o.type==1){const r=a.get_path_url(o.gpx_path);new n.GPX(r,this.gpxOptions).on("loaded",a.onGpxLoaded).on("click",function(){a.onShowModal(o)})}else if(o.type==2||o.type==3){const r=o.image_lat&&o.image_long?[o.image_lat,o.image_long]:this.map_default_option.pin;n.marker(r,{draggable:!0}).addTo(a.map).on("click",function(){a.onShowModal(o)}),this.bounds_sum.extend(r),this.loaded_gpxs+=1}}},watch:{loaded_gpxs(a){a==this.records.length}},methods:{onGpxLoaded(a){const e=a.target;this.bounds_sum.extend(e.getBounds()),e.addTo(this.map),this.loaded_gpxs+=1},onShowModal(a){this.modal_type=a.type,a.type==1?(this.modal_video_url=this.get_path_url(a.media_path),this.modal=!0):(this.modal_image_url=this.get_path_url(a.media_path),this.modal=!0)}}},z=Object.assign(M,{name:"Preview",setup(a){return(e,l)=>(d(),i(v,null,{map:t(()=>[k]),action:t(()=>[s(y(w),{href:"/admin/media",as:"div"},{default:t(()=>[s(u,{icon:"mdi-arrow-left",size:"large"})]),_:1})]),content:t(()=>[e.modal_type==1&&e.modal_video_url?(d(),i(p,{key:0,modelValue:e.modal,"onUpdate:modelValue":l[1]||(l[1]=o=>_(modal)?modal.value=o:null),width:"auto"},{default:t(()=>[s(g,{class:"vp_card"},{default:t(()=>[s(u,{icon:"mdi-close",onClick:l[0]||(l[0]=o=>e.modal=!1),class:"vp_close"}),s(c,{url:e.modal_video_url},null,8,["url"])]),_:1})]),_:1},8,["modelValue"])):m("",!0),e.modal_type==2&&e.modal_image_url?(d(),i(p,{key:1,modelValue:e.modal,"onUpdate:modelValue":l[3]||(l[3]=o=>_(modal)?modal.value=o:null),width:"auto"},{default:t(()=>[s(g,{class:"vp_card"},{default:t(()=>[s(u,{icon:"mdi-close",onClick:l[2]||(l[2]=o=>e.modal=!1),class:"vp_close"}),f("div",L,[e.modal?(d(),i(V,{key:0,"max-width":"1000",contain:"",src:e.modal_image_url},null,8,["src"])):m("",!0)])]),_:1})]),_:1},8,["modelValue"])):m("",!0),e.modal_type==3&&e.modal_image_url?(d(),i(p,{key:2,modelValue:e.modal,"onUpdate:modelValue":l[5]||(l[5]=o=>_(modal)?modal.value=o:null),width:"auto"},{default:t(()=>[s(g,{class:"vp_card"},{default:t(()=>[s(u,{icon:"mdi-close",onClick:l[4]||(l[4]=o=>e.modal=!1),class:"vp_close"}),f("div",b,[e.modal?(d(),i(h,{key:0,url:e.modal_image_url},null,8,["url"])):m("",!0)])]),_:1})]),_:1},8,["modelValue"])):m("",!0)]),_:1}))}});export{z as default};
