import{V as k,a as V,H as f}from"./Panorama-8161bc96.js";import{_ as w}from"./_plugin-vue_export-helper-c27b6911.js";import{o as c,A as v,a as y,b as i,w as l,g as d,m as u,c as p,C as m,J as C,K as T,p as _,t as g,D as P,F as E,B as q,M as x,N as L,f as S,P as B}from"./app-b91c83fa.js";const M={props:["url","capture"],data(){return{isM3u8:!1,viewer:null,panorama:null,video:null,hls:null,isPlaying:!1,progress:0,disabled:!1,step:2,current_quality:{value:-1,text:"自動"},qualities:[]}},mounted(){this.isM3u8=!!this.url.endsWith("m3u8"),this.initVideoPlayer()},unmounted(){self.video&&self.video.remove(),self.panorama&&self.panorama.dispose(),self.viewer&&self.viewer.dispose()},methods:{async initVideoPlayer(){const e=this,a=this.get_path_url(this.url);e.viewer=new k({container:e.$refs.vp_wrap,controlBar:!1}),e.panorama=new V(a,{}),e.viewer.add(e.panorama);const o=e.panorama.getVideoElement();if(e.isM3u8&&f.isSupported()){console.log("isSuppprted");const s=new f;s.loadSource(a),s.attachMedia(o),console.log("hls.levels",s.levels),console.log("this.hls.current_quality",s.current_quality),s.on(f.Events.MANIFEST_PARSED,function(t,n){e.qualities=[{value:-1,text:"自動"}],s.levels.forEach(function(r,h){e.qualities.push({value:h,text:r.height+"p"}),console.log("self.qualities",e.qualities)})}),s.on(f.Events.LEVEL_SWITCHED,function(t,n){console.log("LEVEL_SWITCHED"),console.log("current-quality-",n.level)}),e.hls=s}else o.canPlayType("application/vnd.apple.mpegurl")&&(o.src=a);o.addEventListener("timeupdate",function(){var s=o.currentTime,t=o.duration;e.progress=s/t*100}),e.video=o},async onPause(){try{await this.video.pause(),this.isPlaying=!1}catch(e){console.log(e)}},async onPlay(){try{await this.video.play(),this.isPlaying=!0}catch(e){console.log(e)}},onRewind(){this.video.currentTime=this.video.currentTime<this.step?0:this.video.currentTime-this.step},onFast(){this.video.currentTime=this.video.duration-this.video.currentTime<this.step?this.video.duration:this.video.currentTime+this.step},onSeekTo(e){const a=e.currentTarget.getBoundingClientRect(),o=e.clientX-a.left,s=a.width,t=o/s*100;this.progress=t;const n=parseInt(t/100*this.video.duration);this.video.currentTime=n},changeQuality(e){return console.log("changeQuality"),this.hls.nextLevel=e,this.current_quality=this.qualities.find(a=>a.value==e),!1}}},b={ref:"vp_wrap",class:"vp_wrap"},I={class:"vp_controls"},N={class:"vp_progress mt-2"};function R(e,a,o,s,t,n){return c(),v("div",b,[y("div",I,[i(S,{justify:"center"},{default:l(()=>[i(d,{cols:"auto",class:"pa-2"},{default:l(()=>[i(u,{density:"comfortable",icon:"mdi-rewind",onClick:n.onRewind},null,8,["onClick"])]),_:1}),i(d,{cols:"auto",class:"pa-2"},{default:l(()=>[t.isPlaying?(c(),p(u,{key:0,density:"comfortable",icon:"mdi-stop",onClick:n.onPause},null,8,["onClick"])):m("",!0),t.isPlaying?m("",!0):(c(),p(u,{key:1,density:"comfortable",icon:"mdi-play",onClick:n.onPlay},null,8,["onClick"]))]),_:1}),i(d,{cols:"auto",class:"pa-2"},{default:l(()=>[i(u,{density:"comfortable",icon:"mdi-fast-forward",onClick:n.onFast},null,8,["onClick"])]),_:1}),t.isM3u8?(c(),p(d,{key:0,cols:"auto",class:"pa-2"},{default:l(()=>[i(C,null,{activator:l(({props:r})=>[i(u,T(r,{width:"80",class:"px-1 text-caption"}),{default:l(()=>[_(g(t.current_quality.text),1)]),_:2},1040)]),default:l(()=>[i(P,null,{default:l(()=>[(c(!0),v(E,null,q(t.qualities,(r,h)=>(c(),p(x,{key:h,value:h},{default:l(()=>[i(L,{class:"text-caption",onClick:D=>n.changeQuality(r.value)},{default:l(()=>[_(g(r.text),1)]),_:2},1032,["onClick"])]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1})):m("",!0),o.capture?(c(),p(d,{key:1,cols:"auto",class:"pa-2"},{default:l(()=>[i(u,{icon:"mdi-record",onClick:e.onCapture},null,8,["onClick"])]),_:1})):m("",!0)]),_:1}),y("div",N,[i(B,{modelValue:t.progress,"onUpdate:modelValue":a[0]||(a[0]=r=>t.progress=r),height:10,onClick:n.onSeekTo},null,8,["modelValue","onClick"])])])],512)}const A=w(M,[["render",R]]);export{A as T};
