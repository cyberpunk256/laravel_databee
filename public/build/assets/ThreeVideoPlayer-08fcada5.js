import{V as k,a as V,H as p}from"./Panorama-04d91948.js";import{_ as w}from"./_plugin-vue_export-helper-c27b6911.js";import{o as c,A as f,a as _,b as i,w as o,g as d,m as u,c as h,C as v,J as C,K as T,p as g,t as y,D as P,F as x,B as E,M as q,N as L,f as S,P as B}from"./app-68115e54.js";const b={props:["url","capture"],data(){return{viewer:null,panorama:null,video:null,hls:null,isPlaying:!1,progress:0,disabled:!1,step:2,video_url:null,current_quality:{value:-1,text:"自動"},qualities:[]}},watch:{},async mounted(){console.log("xxx");try{this.video_url=await this.get_video_url(this.url),this.initVideoPlayer()}catch(e){console.log(e)}},methods:{async initVideoPlayer(){const e=this;e.viewer=new k({container:e.$refs.vp_wrap,controlBar:!1}),e.panorama=new V(this.video_url,{}),e.viewer.add(e.panorama);const t=e.panorama.getVideoElement();if(p.isSupported()){console.log("isSuppprted");const s=new p;s.loadSource(e.video_url),s.attachMedia(t),console.log("hls.levels",s.levels),console.log("this.hls.current_quality",s.current_quality),s.on(p.Events.MANIFEST_PARSED,function(r,l){e.qualities=[{value:-1,text:"自動"}],s.levels.forEach(function(a,n){e.qualities.push({value:n,text:a.height+"p"}),console.log("self.qualities",e.qualities)})}),s.on(p.Events.LEVEL_SWITCHED,function(r,l){console.log("LEVEL_SWITCHED"),console.log("current-quality-",l.level)}),e.hls=s}else t.canPlayType("application/vnd.apple.mpegurl")&&(t.src=e.video_url);t.addEventListener("timeupdate",function(){var s=t.currentTime,r=t.duration;e.progress=s/r*100}),e.video=t},onPause(){this.video.pause(),this.isPlaying=!1},async onPlay(){try{await this.video.play(),this.isPlaying=!0}catch(e){console.log(e)}},onRewind(){this.video.currentTime=this.video.currentTime<this.step?0:this.video.currentTime-this.step},onFast(){this.video.currentTime=this.video.duration-this.video.currentTime<this.step?this.video.duration:this.video.currentTime+this.step},onSeekTo(e){const t=e.currentTarget.getBoundingClientRect(),s=e.clientX-t.left,r=t.width,l=s/r*100;this.progress=l;const a=parseInt(l/100*this.video.duration);this.video.currentTime=a},changeQuality(e){return console.log("changeQuality"),this.hls.nextLevel=e,this.current_quality=this.qualities.find(t=>t.value==e),!1}}},I={ref:"vp_wrap",class:"vp_wrap"},N={class:"vp_controls"},R={class:"vp_progress mt-2"};function D(e,t,s,r,l,a){return c(),f("div",I,[_("div",N,[i(S,{justify:"center"},{default:o(()=>[i(d,{cols:"auto",class:"pa-2"},{default:o(()=>[i(u,{density:"comfortable",icon:"mdi-rewind",onClick:a.onRewind},null,8,["onClick"])]),_:1}),i(d,{cols:"auto",class:"pa-2"},{default:o(()=>[l.isPlaying?(c(),h(u,{key:0,density:"comfortable",icon:"mdi-stop",onClick:a.onPause},null,8,["onClick"])):v("",!0),l.isPlaying?v("",!0):(c(),h(u,{key:1,density:"comfortable",icon:"mdi-play",onClick:a.onPlay},null,8,["onClick"]))]),_:1}),i(d,{cols:"auto",class:"pa-2"},{default:o(()=>[i(u,{density:"comfortable",icon:"mdi-fast-forward",onClick:a.onFast},null,8,["onClick"])]),_:1}),i(d,{cols:"auto",class:"pa-2"},{default:o(()=>[i(C,null,{activator:o(({props:n})=>[i(u,T(n,{width:"80",class:"px-1 text-caption"}),{default:o(()=>[g(y(l.current_quality.text),1)]),_:2},1040)]),default:o(()=>[i(P,null,{default:o(()=>[(c(!0),f(x,null,E(l.qualities,(n,m)=>(c(),h(L,{key:m,value:m},{default:o(()=>[i(q,{class:"text-caption",onClick:F=>a.changeQuality(n.value)},{default:o(()=>[g(y(n.text),1)]),_:2},1032,["onClick"])]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1}),s.capture?(c(),h(d,{key:0,cols:"auto",class:"pa-2"},{default:o(()=>[i(u,{icon:"mdi-record",onClick:e.onCapture},null,8,["onClick"])]),_:1})):v("",!0)]),_:1}),_("div",R,[i(B,{modelValue:l.progress,"onUpdate:modelValue":t[0]||(t[0]=n=>l.progress=n),height:10,onClick:a.onSeekTo},null,8,["modelValue","onClick"])])])],512)}const Q=w(b,[["render",D]]);export{Q as T};
