import{o as i,c as d,w as s,b as n,m as u,u as k,l as V,s as c,q as g,n as h,C as r,a as f,z,L as m}from"./app-b42772e3.js";import{P as y}from"./Panorama-ff94029f.js";import{T as v}from"./ThreeVideoPlayer-fee0db93.js";import{M as b}from"./MapLayout-e70ef664.js";import"./_plugin-vue_export-helper-c27b6911.js";const x=f("div",{id:"map",class:"fix_map"},null,-1),B={class:"vp_content"},C={class:"vp_content"},L={components:{ThreeVideoPlayer:v,Panorama:y},props:["records"],data(){return{map:null,modal:!1,modal_type:1,modal_video_url:null,modal_image_url:null,bounds_sum:new m.LatLngBounds,loaded_gpxs:0,gpxOptions:{async:!0,marker_options:{startIconUrl:!1,endIconUrl:!1,shadowUrl:!1},gpx_options:{joinTrackSegments:!1},polyline_options:{color:"blue",weight:12,opacity:1,lineCap:"round"}}}},mounted(){console.log("thisuser",this.user);const o=this,a={maxZoom:o.constant.map.max_zoom},e=o.user.init_lat&&o.user.init_long?[o.user.init_lat,o.user.init_long]:o.constant.map.view;o.gpxOptions.polyline_options.weight=o.getLineWeightByZoom(o.constant.map.zoom,o.constant.map.gpx.weight);const t=o.getMarkerSizeByZoom(o.constant.map.zoom,o.constant.map.marker.size),w=m.icon({iconUrl:o.constant.map.marker.icon,iconSize:[t,t]});o.map=m.map("map",a).setView(e,o.constant.map.zoom).on("zoomend",o.onZoomChange),m.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://www.osm.org">OpenStreetMap</a>',maxZoom:o.constant.map.max_zoom}).addTo(o.map);for(let _=0;_<o.records.length;_++){const l=o.records[_];if(l.type==1){const p=o.get_path_url(l.gpx_path);new m.GPX(p,this.gpxOptions).on("loaded",o.onGpxLoaded).on("click",function(){o.onShowModal(l)})}else if(l.type==2||l.type==3){const p=l.image_lat&&l.image_long?[l.image_lat,l.image_long]:this.constant.map.pin;m.marker(p,{icon:w,draggable:!0}).addTo(o.map).on("click",function(){o.onShowModal(l)}),this.bounds_sum.extend(p),this.loaded_gpxs+=1}}},watch:{loaded_gpxs(o){o==this.records.length&&this.map.fitBounds(this.bounds_sum)}},methods:{onGpxLoaded(o){const a=o.target;this.bounds_sum.extend(a.getBounds()),a.addTo(this.map),this.loaded_gpxs+=1},onShowModal(o){this.modal_type=o.type,o.type==1?(this.modal_video_url=o.media_path,this.modal=!0):(this.modal_image_url=this.get_path_url(o.media_path),this.modal=!0)}}},P=Object.assign(L,{name:"Preview",setup(o){return(a,e)=>(i(),d(b,null,{map:s(()=>[x]),action:s(()=>[n(k(V),{href:"/admin/media",as:"div"},{default:s(()=>[n(u,{icon:"mdi-arrow-left",size:"large"})]),_:1})]),content:s(()=>[a.modal_type==1&&a.modal_video_url?(i(),d(c,{key:0,modelValue:a.modal,"onUpdate:modelValue":e[1]||(e[1]=t=>g(modal)?modal.value=t:null),width:"auto"},{default:s(()=>[n(h,{class:"vp_card"},{default:s(()=>[n(u,{icon:"mdi-close",onClick:e[0]||(e[0]=t=>a.modal=!1),class:"vp_close"}),n(v,{url:a.modal_video_url},null,8,["url"])]),_:1})]),_:1},8,["modelValue"])):r("",!0),a.modal_type==2&&a.modal_image_url?(i(),d(c,{key:1,modelValue:a.modal,"onUpdate:modelValue":e[3]||(e[3]=t=>g(modal)?modal.value=t:null),width:"auto"},{default:s(()=>[n(h,{class:"vp_card"},{default:s(()=>[n(u,{icon:"mdi-close",onClick:e[2]||(e[2]=t=>a.modal=!1),class:"vp_close"}),f("div",B,[a.modal?(i(),d(z,{key:0,"lazy-src":"/empty.png","max-width":"1000",src:a.modal_image_url},null,8,["src"])):r("",!0)])]),_:1})]),_:1},8,["modelValue"])):r("",!0),a.modal_type==3&&a.modal_image_url?(i(),d(c,{key:2,modelValue:a.modal,"onUpdate:modelValue":e[5]||(e[5]=t=>g(modal)?modal.value=t:null),width:"auto"},{default:s(()=>[n(h,{class:"vp_card"},{default:s(()=>[n(u,{icon:"mdi-close",onClick:e[4]||(e[4]=t=>a.modal=!1),class:"vp_close"}),f("div",C,[a.modal?(i(),d(y,{key:0,url:a.modal_image_url},null,8,["url"])):r("",!0)])]),_:1})]),_:1},8,["modelValue"])):r("",!0)]),_:1}))}});export{P as default};
