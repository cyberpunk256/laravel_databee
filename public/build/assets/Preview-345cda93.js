import{o as i,c as d,w as s,b as n,m as u,u as w,l as k,s as g,q as c,n as h,A as r,a as f,z as V,L as m}from"./app-1164ef07.js";import{P as y}from"./gpx-2ae07636.js";import{T as v}from"./ThreeVideoPlayer-a82acdf9.js";import{M as z}from"./MapLayout-1a7a3af6.js";import"./_plugin-vue_export-helper-c27b6911.js";const L=f("div",{id:"map",class:"fix_map"},null,-1),b={class:"vp_content"},B={class:"vp_content"},C={components:{ThreeVideoPlayer:v,Panorama:y},props:["records"],data(){return{map:null,modal:!1,modal_type:1,modal_video_url:null,modal_image_url:null,bounds_sum:new m.LatLngBounds,loaded_gpxs:0,gpxOptions:{async:!0,marker_options:{startIconUrl:!1,endIconUrl:!1,shadowUrl:!1},gpx_options:{joinTrackSegments:!1},polyline_options:{color:"blue",weight:12,opacity:1,lineCap:"round"}}}},mounted(){console.log("thisuser",this.user);const o=this,e=o.user.init_lat&&o.user.init_long?[o.user.init_lat,o.user.init_long]:o.constant.map.view;o.gpxOptions.polyline_options.weight=o.getLineWeightByZoom(o.constant.map.zoom,o.constant.map.gpx.weight);const a=o.getMarkerSizeByZoom(o.constant.map.zoom,o.constant.map.marker.size),l=m.icon({iconUrl:o.constant.map.marker.icon,iconSize:[a,a]});o.map=m.map("map").setView(e,o.constant.map.zoom).on("zoomend",o.onZoomChange),m.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://www.osm.org">OpenStreetMap</a>'}).addTo(o.map);for(let _=0;_<o.records.length;_++){const t=o.records[_];if(t.type==1){const p=o.get_path_url(t.gpx_path);new m.GPX(p,this.gpxOptions).on("loaded",o.onGpxLoaded).on("click",function(){o.onShowModal(t)})}else if(t.type==2||t.type==3){const p=t.image_lat&&t.image_long?[t.image_lat,t.image_long]:this.constant.map.pin;m.marker(p,{icon:l,draggable:!0}).addTo(o.map).on("click",function(){o.onShowModal(t)}),this.bounds_sum.extend(p),this.loaded_gpxs+=1}}},watch:{loaded_gpxs(o){o==this.records.length}},methods:{onGpxLoaded(o){const e=o.target;this.bounds_sum.extend(e.getBounds()),e.addTo(this.map),this.loaded_gpxs+=1},onShowModal(o){this.modal_type=o.type,o.type==1?(this.modal_video_url=o.media_path,this.modal=!0):(this.modal_image_url=this.get_path_url(o.media_path),this.modal=!0)}}},O=Object.assign(C,{name:"Preview",setup(o){return(e,a)=>(i(),d(z,null,{map:s(()=>[L]),action:s(()=>[n(w(k),{href:"/admin/media",as:"div"},{default:s(()=>[n(u,{icon:"mdi-arrow-left",size:"large"})]),_:1})]),content:s(()=>[e.modal_type==1&&e.modal_video_url?(i(),d(g,{key:0,modelValue:e.modal,"onUpdate:modelValue":a[1]||(a[1]=l=>c(modal)?modal.value=l:null),width:"auto"},{default:s(()=>[n(h,{class:"vp_card"},{default:s(()=>[n(u,{icon:"mdi-close",onClick:a[0]||(a[0]=l=>e.modal=!1),class:"vp_close"}),n(v,{url:e.modal_video_url},null,8,["url"])]),_:1})]),_:1},8,["modelValue"])):r("",!0),e.modal_type==2&&e.modal_image_url?(i(),d(g,{key:1,modelValue:e.modal,"onUpdate:modelValue":a[3]||(a[3]=l=>c(modal)?modal.value=l:null),width:"auto"},{default:s(()=>[n(h,{class:"vp_card"},{default:s(()=>[n(u,{icon:"mdi-close",onClick:a[2]||(a[2]=l=>e.modal=!1),class:"vp_close"}),f("div",b,[e.modal?(i(),d(V,{key:0,"lazy-src":"/empty.png","max-width":"1000",src:e.modal_image_url},null,8,["src"])):r("",!0)])]),_:1})]),_:1},8,["modelValue"])):r("",!0),e.modal_type==3&&e.modal_image_url?(i(),d(g,{key:2,modelValue:e.modal,"onUpdate:modelValue":a[5]||(a[5]=l=>c(modal)?modal.value=l:null),width:"auto"},{default:s(()=>[n(h,{class:"vp_card"},{default:s(()=>[n(u,{icon:"mdi-close",onClick:a[4]||(a[4]=l=>e.modal=!1),class:"vp_close"}),f("div",B,[e.modal?(i(),d(y,{key:0,url:e.modal_image_url},null,8,["url"])):r("",!0)])]),_:1})]),_:1},8,["modelValue"])):r("",!0)]),_:1}))}});export{O as default};
